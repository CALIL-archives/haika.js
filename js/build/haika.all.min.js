/*! haika.js 30-09-2014 */
function sprintf(){var a=sprintf.arguments,b=a.length;if(0==b)return"";var c,d,e,f="",g=a[0],h=g.length;c=0;for(var i,j,k=1,l=0,m=0;h>m;m++){var n=g.charAt(m);switch(l){case 0:"%"==n?(i=n,l=1,j=""):f+=n;break;case 1:if("%"==n){f+=n,l=0;break}switch(k>=b&&(a[b++]=""),d=0,e=-1,n){case"-":c|=1,l=1;break;case"+":c|=2,l=1;break;case"0":c|=4,l=2;break;case" ":c|=8,l=1;break;case"#":c|=16,l=1;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":d=parseInt(n),l=2;break;case"-":c=1,l=2;break;case".":d="",e=0,l=3;break;case"d":f+=toInteger(a[k],c,d,e),k++,l=0;break;case"f":f+=toFloatingPoint(a[k],c,d,6),k++,l=0;break;case"e":f+=toExponential(a[k],c,d,6,"e"),k++,l=0;break;case"E":f+=toExponential(a[k],c,d,6,"E"),k++,l=0;break;case"s":f+=a[k],k++,l=0;break;default:f+=j+n,l=0}break;case 2:switch(n){case".":e=0,l=3;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":d=10*d+parseInt(n),l=2;break;case"d":f+=toInteger(a[k],c,d,e),k++,l=0;break;case"f":f+=toFloatingPoint(a[k],c,d,6),k++,l=0;break;case"e":f+=toExponential(a[k],c,d,6,"e"),k++,l=0;break;case"E":f+=toExponential(a[k],c,d,6,"E"),k++,l=0;break;case"s":f+=toFormatString(a[k],d,e),k++,l=0;break;default:f+=j+n,l=0}break;case 3:switch(n){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":e=10*e+parseInt(n);break;case"d":f+=toInteger(a[k],c,d,e),k++,l=0;break;case"f":f+=toFloatingPoint(a[k],c,d,e),k++,l=0;break;case"e":f+=toExponential(a[k],c,d,e,"e"),k++,l=0;break;case"E":f+=toExponential(a[k],c,d,e,"E"),k++,l=0;break;case"s":f+=toFormatString(a[k],d,e),k++,l=0;break;default:f+=j+n,l=0}break;default:return"error"}l&&(j+=n)}return f}function toInteger(a,b,c,d){"number"!=typeof a&&("string"==typeof a?(a=parseFloat(a),isNaN(a)&&(a=0)):a=0);var e=a.toString();if(a>-1&&1>a)e="0";else{0>a&&(e=e.substring(1));var f=e.indexOf("e");if(-1!=f){var g=parseInt(e.substring(f+2)),h=e.indexOf(".");for(-1==h?(e=e.substring(0,f)+"000000000000000000000",g-=21):(e=e.substring(0,h)+e.substring(h+1,f)+"00000",g-=e.length-h);g;g--)e+="0"}else{var h=e.indexOf(".");-1!=h&&(e=e.substring(0,h))}}var i=e.length;if(d>i){for(var j="0",k=d-i;k;k--)e=j+e;i=d}return ProcFlag(e,b,c-i,a>=0)}function toFloatingPoint(a,b,c,d){"number"!=typeof a&&("string"==typeof a?(a=parseFloat(a),isNaN(a)&&(a=0)):a=0);var e=a>=0;return e||(a=-a),str=toFloatingPoint2(a,b,d),ProcFlag(str,b,c-str.length,e)}function toFloatingPoint2(a,b,c){var d=a.toString(),e=d.indexOf("e");if(-1!=e){var f=parseInt(d.substring(e+1));if(f>0){var g=d.indexOf(".");for(-1==g?(d=d.substring(0,e)+"000000000000000000000",f-=21):(d=d.charAt(0)+d.substring(2,e)+"00000",f-=d.length-1);f;f--)d+="0"}else{var h=f+c;if(-1>h)d="0";else if(h>=0){d=d.substring(0,e);var g=d.indexOf(".");for(-1!=g&&(d=d.charAt(0)+d.substring(2,e)),d="000000"+d,f+=7;f;f++)d="0"+d;d="0."+d}else{var i=parseFloat(d.substring(0,e));if(i>5){d="0.00000";for(var j=f+7;j;j++)d+="0";d+="1"}else d="0"}}}var k=d.length,g=d.indexOf(".");if(-1!=g){var l=k-g-1;if(l>c){var i=parseFloat(d.charAt(g+c+1)+"."+d.substring(g+c+2));if(i>5){var j;if(1>a){for(j=2;"0"==d.charAt(j);)j++;i=(parseInt(d.substring(j,c+2))+1).toString(),d=i.length>c+2-j?2==j?"1."+i.substring(1):d.substring(0,j-1)+i:d.substring(0,j)+i}else i=(parseInt(d.substring(0,g)+d.substring(g+1,g+c+1))+1).toString(),d=i.length>g+c?i.substring(0,g+1)+"."+i.substring(g+1):i.substring(0,g)+"."+i.substring(g)}else d=d.substring(0,c?g+c+1:g)}else if(c>l)for(var j=c-l;j;j--)d+="0"}else if(c){d+=".0";for(var j=c-1;j;j--)d+="0"}return d}function toExponential(a,b,c,d,e){"number"!=typeof a&&("string"==typeof a?(a=parseFloat(a),isNaN(a)&&(a=0)):a=0);var f=a>=0;f||(a=-a);var g,h=a.toString(),i=h.indexOf("."),j=h.indexOf("e"),k=((-1!=j)<<1)+(-1!=i);if(0==k)(g=h.length-1)&&(h=h.charAt(0)+"."+h.substring(i=1));else if(1==k)if(a>10)g=i-1,h=h.substring(0,1)+"."+h.substring(1,i)+h.substring(i+1),i=1;else if(a>1)g=0;else{for(var l=2;;l++)if("0"!=h.charAt(l)){g=1-l,h=h.charAt(l)+"."+h.substring(l+1);break}i=1}else g=parseInt(h.substring(j+1)),h=h.substring(0,j);return h=toFloatingPoint2(parseFloat(h),b,d),h+=g>=0?e+(10>g?"+0":"+")+g:e+(g>-10?"-0"+-g:g),h=ProcFlag(h,b,c-h.length,f)}function toFormatString(a,b,c){"string"!=typeof a&&(a=a.toString());var d=a.length;if(c>=0&&d>c&&(a=a.substring(0,c),d=c),b>d)for(var e=" ",f=b-d;f;f--)a=e+a;return a}function ProcFlag(a,b,c,d){var e=1&b,f=2&b,g=8&b;if(g&&c--,c-=!d+f>0,(4&b)>0&&!e){if(c>0)for(var h="0",i=c;i;i--)a=h+a;d?f&&(a="+"+a):a="-"+a}else{d?f&&(a="+"+a):a="-"+a;var h=" ";if(c>0){var h=" ";if(e)for(var i=c;i;i--)a+=h;else for(var i=c;i;i--)a=h+a}}return g&&(a=" "+a),a}function initAligningGuidelines(a){function b(a){d(a.x+.5,a.y1>a.y2?a.y2:a.y1,a.x+.5,a.y2>a.y1?a.y2:a.y1)}function c(a){d(a.x1>a.x2?a.x2:a.x1,a.y+.5,a.x2>a.x1?a.x2:a.x1,a.y+.5)}function d(a,b,c,d){f.save(),f.setLineDash([4,4]),f.lineWidth=i,f.strokeStyle=j,f.beginPath(),f.moveTo(Math.floor(a)+.5,Math.floor(b)+.5),f.lineTo(Math.floor(c)+.5,Math.floor(d)+.5),f.stroke(),f.restore()}function e(a,b){a=Math.round(a),b=Math.round(b);for(var c=a-h,d=a+h;d>=c;c++)if(c===b)return!0;return!1}var f=a.getSelectionContext(),g=5,h=4,i=1,j="rgb(0,255,0)",k=[],l=[];a.on("object:moving",function(b){var c=b.target,d=a.getObjects(),f=c.getCenterPoint(),h=f.x,i=f.y,j=c.getBoundingRectHeight(),m=c.getBoundingRectWidth(),n=!1,o=!1,p=a._currentTransform;if(p){l.length=0,k.length=0;for(var q=d.length;q--;)if(d[q]!==c){var r=d[q].getCenterPoint(),s=r.x,t=r.y,u=d[q].getBoundingRectHeight(),v=d[q].getBoundingRectWidth();if(e(s-v/2,h-m/2)&&(o=!0,k.push({x:s-v/2,y1:i>t?t-u/2-g:t+u/2+g,y2:i>t?i+j/2+g:i-j/2-g}),c.setPositionByOrigin(new fabric.Point(s-v/2+m/2,i),p.originX,p.originY)),e(s+v/2,h+m/2)&&(o=!0,k.push({x:s+v/2,y1:i>t?t-u/2-g:t+u/2+g,y2:i>t?i+j/2+g:i-j/2-g}),c.setPositionByOrigin(new fabric.Point(s+v/2-m/2,i),p.originX,p.originY)),e(t-u/2,i-j/2)){n=!0;for(var w={y:t-u/2,x1:h>s?s-v/2-g:s+v/2+g,x2:h>s?h+m/2+g:h-m/2-g},x=!0,y=l.length;y--;)w.y==l[y].y&&(Math.abs(l[y].x2-l[y].x1)>Math.abs(w.x2-w.x1)?Math.abs(l[y].x2-l[y].x1)-Math.abs(w.x2-w.x1)>5&&l.splice(y,1):x=!1);x&&(l.push(w),c.setPositionByOrigin(new fabric.Point(h,t-u/2+j/2),p.originX,p.originY))}e(t+u/2,i+j/2)&&(n=!0,l.push({y:t+u/2,x1:h>s?s-v/2-g:s+v/2+g,x2:h>s?h+m/2+g:h-m/2-g}),c.setPositionByOrigin(new fabric.Point(h,t+u/2-j/2),p.originX,p.originY))}n||(l.length=0),o||(k.length=0)}}),a.on("before:render",function(){a.clearContext(a.contextTop)}),a.on("after:render",function(){for(var a=k.length;a--;)b(k[a]);for(var a=l.length;a--;)c(l[a])}),a.on("mouse:up",function(){k.length=l.length=0,a.renderAll()})}var fabric=fabric||{version:"1.4.11"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow()),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],fabric.DPI=96,function(){function a(a,b){this.__eventListeners[a]&&(b?fabric.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function b(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function c(b,c){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==typeof arguments[0])for(var d in b)a.call(this,d,b[d]);else a.call(this,b,c);return this}}function d(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,e=c.length;e>d;d++)c[d].call(this,b||{});return this}}}fabric.Observable={observe:b,stopObserving:c,fire:d,on:b,off:c,trigger:d}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=0,b=arguments.length;b>a;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(a,b,c){var d=this.getObjects();return c?d[b]=a:d.splice(b,0,a),this._onObjectAdded(a),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var a,b=this.getObjects(),c=0,d=arguments.length;d>c;c++)a=b.indexOf(arguments[c]),-1!==a&&(b.splice(a,1),this._onObjectRemoved(arguments[c]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(a,b){for(var c=this.getObjects(),d=c.length;d--;)a.call(b,c[d],d,c);return this},getObjects:function(a){return"undefined"==typeof a?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)}},function(a){var b=Math.sqrt,c=Math.atan2,d=Math.PI/180;fabric.util={removeFromArray:function(a,b){var c=a.indexOf(b);return-1!==c&&a.splice(c,1),a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*d},radiansToDegrees:function(a){return a/d},rotatePoint:function(a,b,c){var d=Math.sin(c),e=Math.cos(c);a.subtractEquals(b);var f=a.x*e-a.y*d,g=a.x*d+a.y*e;return new fabric.Point(f,g).addEquals(b)},transformPoint:function(a,b,c){return c?new fabric.Point(b[0]*a.x+b[1]*a.y,b[2]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[1]*a.y+b[4],b[2]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){var b=a.slice(),c=1/(a[0]*a[3]-a[1]*a[2]);b=[c*a[3],-c*a[1],-c*a[2],c*a[0],0,0];var d=fabric.util.transformPoint({x:a[4],y:a[5]},b);return b[4]=-d.x,b[5]=-d.y,b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a){var b=/\D{0,2}$/.exec(a),c=parseFloat(a);switch(b[0]){case"mm":return c*fabric.DPI/25.4;case"cm":return c*fabric.DPI/2.54;case"in":return c*fabric.DPI;case"pt":return c*fabric.DPI/72;case"pc":return c*fabric.DPI/72*12;default:return c}},falseFunction:function(){return!1},getKlass:function(a,b){return a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(b){if(!b)return fabric;for(var c=b.split("."),d=c.length,e=a||fabric.window,f=0;d>f;++f)e=e[c[f]];return e},loadImage:function(a,b,c,d){if(!a)return void(b&&b.call(c,a));var e=fabric.util.createImage();e.onload=function(){b&&b.call(c,e),e=e.onload=e.onerror=null},e.onerror=function(){fabric.log("Error loading "+e.src),b&&b.call(c,null,!0),e=e.onload=e.onerror=null},0!==a.indexOf("data")&&"undefined"!=typeof d&&(e.crossOrigin=d),e.src=a},enlivenObjects:function(a,b,c,d){function e(){++g===h&&b&&b(f)}a=a||[];var f=[],g=0,h=a.length;return h?void a.forEach(function(a,b){if(!a||!a.type)return void e();var g=fabric.util.getKlass(a.type,c);g.async?g.fromObject(a,function(c,g){g||(f[b]=c,d&&d(a,f[b])),e()}):(f[b]=g.fromObject(a),d&&d(a,f[b]),e())}):void(b&&b(f))},groupSVGElements:function(a,b,c){var d;return d=new fabric.PathGroup(a,b),"undefined"!=typeof c&&d.setSourcePath(c),d},populateWithProperties:function(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,e=c.length;e>d;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(a,d,e,f,g,h){var i=f-d,j=g-e,k=b(i*i+j*j),l=c(j,i),m=h.length,n=0,o=!0;for(a.save(),a.translate(d,e),a.moveTo(0,0),a.rotate(l),d=0;k>d;)d+=h[n++%m],d>k&&(d=k),a[o?"lineTo":"moveTo"](d,0),o=!o;a.restore()},createCanvasElement:function(a){return a||(a=fabric.document.createElement("canvas")),a.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a),a},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){for(var b=a.prototype,c=b.stateProperties.length;c--;){var d=b.stateProperties[c],e=d.charAt(0).toUpperCase()+d.slice(1),f="set"+e,g="get"+e;b[g]||(b[g]=function(a){return new Function('return this.get("'+a+'")')}(d)),b[f]||(b[f]=function(a){return new Function("value",'return this.set("'+a+'", value)')}(d))}},clipContext:function(a,b){b.save(),b.beginPath(),a.clipTo(b),b.clip()},multiplyTransformMatrices:function(a,b){for(var c=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],d=[[b[0],b[2],b[4]],[b[1],b[3],b[5]],[0,0,1]],e=[],f=0;3>f;f++){e[f]=[];for(var g=0;3>g;g++){for(var h=0,i=0;3>i;i++)h+=c[f][i]*d[i][g];e[f][g]=h}}return[e[0][0],e[1][0],e[0][1],e[1][1],e[0][2],e[1][2]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,c,d){d>0&&(b>d?b-=d:b=0,c>d?c-=d:c=0);for(var e=!0,f=a.getImageData(b,c,2*d||1,2*d||1),g=3,h=f.data.length;h>g;g+=4){var i=f.data[g];if(e=0>=i,e===!1)break}return f=null,e}}}("undefined"!=typeof exports?exports:this),function(){function a(a,e,g,h,i,j,k){var l=f.call(arguments);if(d[l])return d[l];var m=Math.PI,n=k*(m/180),o=Math.sin(n),p=Math.cos(n),q=0,r=0;g=Math.abs(g),h=Math.abs(h);var s=-p*a-o*e,t=-p*e+o*a,u=g*g,v=h*h,w=t*t,x=s*s,y=4*u*v-u*w-v*x,z=0;if(0>y){var A=Math.sqrt(1-.25*y/(u*v));g*=A,h*=A}else z=(i===j?-.5:.5)*Math.sqrt(y/(u*w+v*x));var B=z*g*t/h,C=-z*h*s/g,D=p*B-o*C+a/2,E=o*B+p*C+e/2,F=c(1,0,(s-B)/g,(t-C)/h),G=c((s-B)/g,(t-C)/h,(-s-B)/g,(-t-C)/h);0===j&&G>0?G-=2*m:1===j&&0>G&&(G+=2*m);for(var H=Math.ceil(Math.abs(G/(.5*m))),I=[],J=G/H,K=8/3*Math.sin(J/4)*Math.sin(J/4)/Math.sin(J/2),L=F+J,M=0;H>M;M++)I[M]=b(F,L,p,o,g,h,D,E,K,q,r),q=I[M][4],r=I[M][5],F+=J,L+=J;return d[l]=I,I}function b(a,b,c,d,g,h,i,j,k,l,m){var n=f.call(arguments);if(e[n])return e[n];var o=Math.cos(a),p=Math.sin(a),q=Math.cos(b),r=Math.sin(b),s=c*g*q-d*h*r+i,t=d*g*q+c*h*r+j,u=l+k*(-c*g*p-d*h*o),v=m+k*(-d*g*p+c*h*o),w=s+k*(c*g*r+d*h*q),x=t+k*(d*g*r-c*h*q);return e[n]=[u,v,w,x,s,t],e[n]}function c(a,b,c,d){var e=Math.atan2(b,a),f=Math.atan2(d,c);return f>=e?f-e:2*Math.PI-(e-f)}var d={},e={},f=Array.prototype.join;fabric.util.drawArc=function(b,c,d,e){for(var f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=[[],[],[],[]],n=a(k-c,l-d,f,g,i,j,h),o=0;o<n.length;o++)m[o][0]=n[o][0]+c,m[o][1]=n[o][1]+d,m[o][2]=n[o][2]+c,m[o][3]=n[o][3]+d,m[o][4]=n[o][4]+c,m[o][5]=n[o][5]+d,b.bezierCurveTo.apply(b,m[o])}}(),function(){function a(a,b){for(var c=e.call(arguments,2),d=[],f=0,g=a.length;g>f;f++)d[f]=c.length?a[f][b].apply(a[f],c):a[f][b].call(a[f]);return d}function b(a,b){return d(a,b,function(a,b){return a>=b})}function c(a,b){return d(a,b,function(a,b){return b>a})}function d(a,b,c){if(a&&0!==a.length){var d=a.length-1,e=b?a[d][b]:a[d];if(b)for(;d--;)c(a[d][b],e)&&(e=a[d][b]);else for(;d--;)c(a[d],e)&&(e=a[d]);return e}}var e=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==Number.POSITIVE_INFINITY&&d!==Number.NEGATIVE_INFINITY&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)c in this&&a.call(b,this[c],c,this)}),Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=[],d=0,e=this.length>>>0;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),Array.prototype.every||(Array.prototype.every=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c,d=[],e=0,f=this.length>>>0;f>e;e++)e in this&&(c=this[e],a.call(b,c,e,this)&&d.push(c));return d}),Array.prototype.reduce||(Array.prototype.reduce=function(a){var b,c=this.length>>>0,d=0;if(arguments.length>1)b=arguments[1];else for(;;){if(d in this){b=this[d++];break}if(++d>=c)throw new TypeError}for(;c>d;d++)d in this&&(b=a.call(null,b,this[d],d,this));return b}),fabric.util.array={invoke:a,min:c,max:b}}(),function(){function a(a,b){for(var c in b)a[c]=b[c];return a}function b(b){return a({},b)}fabric.util.object={extend:a,clone:b}}(),function(){function a(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function b(a,b){return a.charAt(0).toUpperCase()+(b?a.slice(1):a.slice(1).toLowerCase())}function c(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:a,capitalize:b,escapeXml:c}}(),function(){var a=Array.prototype.slice,b=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var e,f=this,g=a.call(arguments,1);return e=g.length?function(){return b.call(f,this instanceof c?this:d,g.concat(a.call(arguments)))}:function(){return b.call(f,this instanceof c?this:d,arguments)},c.prototype=this.prototype,e.prototype=new c,e})}(),function(){function a(){}function b(a){var b=this.constructor.superclass.prototype[a];return arguments.length>1?b.apply(this,d.call(arguments,1)):b.call(this)}function c(){function c(){this.initialize.apply(this,arguments)}var f=null,h=d.call(arguments,0);"function"==typeof h[0]&&(f=h.shift()),c.superclass=f,c.subclasses=[],f&&(a.prototype=f.prototype,c.prototype=new a,f.subclasses.push(c));for(var i=0,j=h.length;j>i;i++)g(c,h[i],f);return c.prototype.initialize||(c.prototype.initialize=e),c.prototype.constructor=c,c.prototype.callSuper=b,c}var d=Array.prototype.slice,e=function(){},f=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,b,c){for(var d in b)a.prototype[d]=d in a.prototype&&"function"==typeof a.prototype[d]&&(b[d]+"").indexOf("callSuper")>-1?function(a){return function(){var d=this.constructor.superclass;this.constructor.superclass=c;var e=b[a].apply(this,arguments);return this.constructor.superclass=d,"initialize"!==a?e:void 0}}(d):b[d],f&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=c}(),function(){function a(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;e>c;c++)if(b=typeof a[d[c]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function b(a,b){return{handler:b,wrappedHandler:c(a,b)}}function c(a,b){return function(c){b.call(g(a),c||fabric.window.event)}}function d(a,b){return function(c){if(p[a]&&p[a][b])for(var d=p[a][b],e=0,f=d.length;f>e;e++)d[e].call(this,c||fabric.window.event)}}function e(a,b){a||(a=fabric.window.event);var c=a.target||(typeof a.srcElement!==i?a.srcElement:null),d=fabric.util.getScrollLeftTop(c,b);return{x:q(a)+d.left,y:r(a)+d.top}}function f(a,b,c){var d="touchend"===a.type?"changedTouches":"touches";return a[d]&&a[d][0]?a[d][0][b]-(a[d][0][b]-a[d][0][c])||a[c]:a[c]}var g,h,i="unknown",j=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};g=function(b){return a[b]},h=function(b,c){a[b]=c}}();var k,l,m=a(fabric.document.documentElement,"addEventListener","removeEventListener")&&a(fabric.window,"addEventListener","removeEventListener"),n=a(fabric.document.documentElement,"attachEvent","detachEvent")&&a(fabric.window,"attachEvent","detachEvent"),o={},p={};m?(k=function(a,b,c){a.addEventListener(b,c,!1)},l=function(a,b,c){a.removeEventListener(b,c,!1)}):n?(k=function(a,c,d){var e=j(a);h(e,a),o[e]||(o[e]={}),o[e][c]||(o[e][c]=[]);var f=b(e,d);o[e][c].push(f),a.attachEvent("on"+c,f.wrappedHandler)},l=function(a,b,c){var d,e=j(a);if(o[e]&&o[e][b])for(var f=0,g=o[e][b].length;g>f;f++)d=o[e][b][f],d&&d.handler===c&&(a.detachEvent("on"+b,d.wrappedHandler),o[e][b][f]=null)}):(k=function(a,b,c){var e=j(a);if(p[e]||(p[e]={}),!p[e][b]){p[e][b]=[];var f=a["on"+b];f&&p[e][b].push(f),a["on"+b]=d(e,b)}p[e][b].push(c)},l=function(a,b,c){var d=j(a);if(p[d]&&p[d][b])for(var e=p[d][b],f=0,g=e.length;g>f;f++)e[f]===c&&e.splice(f,1)}),fabric.util.addListener=k,fabric.util.removeListener=l;var q=function(a){return typeof a.clientX!==i?a.clientX:0},r=function(a){return typeof a.clientY!==i?a.clientY:0};fabric.isTouchSupported&&(q=function(a){return f(a,"pageX","clientX")},r=function(a){return f(a,"pageY","clientY")}),fabric.util.getPointer=e,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function a(a,b){var c=a.style;if(!c)return a;if("string"==typeof b)return a.style.cssText+=";"+b,b.indexOf("opacity")>-1?f(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in b)if("opacity"===d)f(a,b[d]);else{var e="float"===d||"cssFloat"===d?"undefined"==typeof c.styleFloat?"cssFloat":"styleFloat":d;c[e]=b[d]}return a}var b=fabric.document.createElement("div"),c="string"==typeof b.style.opacity,d="string"==typeof b.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};c?f=function(a,b){return a.style.opacity=b,a}:d&&(f=function(a,b){var c=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1),e.test(c.filter)?(b=b>=.9999?"":"alpha(opacity="+100*b+")",c.filter=c.filter.replace(e,b)):c.filter+=" alpha(opacity="+100*b+")",a}),fabric.util.setStyle=a}(),function(){function a(a){return"string"==typeof a?fabric.document.getElementById(a):a}function b(a,b){var c=fabric.document.createElement(a);for(var d in b)"class"===d?c.className=b[d]:"for"===d?c.htmlFor=b[d]:c.setAttribute(d,b[d]);return c}function c(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)}function d(a,c,d){return"string"==typeof c&&(c=b(c,d)),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a),c}function e(a,b){var c,d,e=0,f=0,g=fabric.document.documentElement,h=fabric.document.body||{scrollLeft:0,scrollTop:0};for(d=a;a&&a.parentNode&&!c;)a=a.parentNode,a!==fabric.document&&"fixed"===fabric.util.getElementStyle(a,"position")&&(c=a),a!==fabric.document&&d!==b&&"absolute"===fabric.util.getElementStyle(a,"position")?(e=0,f=0):a===fabric.document?(e=h.scrollLeft||g.scrollLeft||0,f=h.scrollTop||g.scrollTop||0):(e+=a.scrollLeft||0,f+=a.scrollTop||0);return{left:e,top:f}}function f(a){var b,c,d=a&&a.ownerDocument,e={left:0,top:0},f={left:0,top:0},g={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!d)return{left:0,top:0};for(var h in g)f[g[h]]+=parseInt(k(a,h),10)||0;return b=d.documentElement,"undefined"!=typeof a.getBoundingClientRect&&(e=a.getBoundingClientRect()),c=fabric.util.getScrollLeftTop(a,null),{left:e.left+c.left-(b.clientLeft||0)+f.left,top:e.top+c.top-(b.clientTop||0)+f.top}}var g,h=Array.prototype.slice,i=function(a){return h.call(a,0)};try{g=i(fabric.document.childNodes)instanceof Array}catch(j){}g||(i=function(a){for(var b=new Array(a.length),c=a.length;c--;)b[c]=a[c];return b});var k;k=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){return fabric.document.defaultView.getComputedStyle(a,null)[b]}:function(a,b){var c=a.style[b];return!c&&a.currentStyle&&(c=a.currentStyle[b]),c},function(){function a(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction),d?a.style[d]="none":"string"==typeof a.unselectable&&(a.unselectable="on"),a}function b(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=null),d?a.style[d]="":"string"==typeof a.unselectable&&(a.unselectable=""),a}var c=fabric.document.documentElement.style,d="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=a,fabric.util.makeElementSelectable=b}(),function(){function a(a,b){var c=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),e=!0;d.onload=d.onreadystatechange=function(a){if(e){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;e=!1,b(a||fabric.window.event),d=d.onload=d.onreadystatechange=null}},d.src=a,c.appendChild(d)}fabric.util.getScript=a}(),fabric.util.getById=a,fabric.util.toArray=i,fabric.util.makeElement=b,fabric.util.addClass=c,fabric.util.wrapElement=d,fabric.util.getScrollLeftTop=e,fabric.util.getElementOffset=f,fabric.util.getElementStyle=k}(),function(){function a(a,b){return a+(/\?/.test(a)?"&":"?")+b}function b(){}function c(c,e){e||(e={});var f,g=e.method?e.method.toUpperCase():"GET",h=e.onComplete||function(){},i=d();return i.onreadystatechange=function(){4===i.readyState&&(h(i),i.onreadystatechange=b)},"GET"===g&&(f=null,"string"==typeof e.parameters&&(c=a(c,e.parameters))),i.open(g,c,!0),("POST"===g||"PUT"===g)&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(f),i}var d=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{var c=a[b]();if(c)return a[b]}catch(d){}}();fabric.util.request=c}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(a){"undefined"!=typeof console[a]&&console[a].apply&&(fabric[a]=function(){return console[a].apply(console,arguments)})}),function(){function a(a){b(function(c){a||(a={});var d,e=c||+new Date,f=a.duration||500,g=e+f,h=a.onChange||function(){},i=a.abort||function(){return!1},j=a.easing||function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},k="startValue"in a?a.startValue:0,l="endValue"in a?a.endValue:100,m=a.byValue||l-k;a.onStart&&a.onStart(),function n(c){d=c||+new Date;var l=d>g?f:d-e;return i()?void(a.onComplete&&a.onComplete()):(h(j(l,k,m,f)),d>g?void(a.onComplete&&a.onComplete()):void b(n))}(e)})}function b(){return c.apply(fabric.window,arguments)}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1e3/60)};fabric.util.animate=a,fabric.util.requestAnimFrame=b}(),function(){function a(a,b,c,d){return a<Math.abs(b)?(a=b,d=c/4):d=c/(2*Math.PI)*Math.asin(b/a),{a:a,c:b,p:c,s:d}}function b(a,b,c){return a.a*Math.pow(2,10*(b-=1))*Math.sin(2*(b*c-a.s)*Math.PI/a.p)}function c(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b}function d(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b}function e(a,b,c,d){return c*(a/=d)*a*a*a+b}function f(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b}function g(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b}function h(a,b,c,d){return c*(a/=d)*a*a*a*a+b}function i(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b}function j(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b}function k(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b}function l(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b}function m(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}function n(a,b,c,d){return 0===a?b:c*Math.pow(2,10*(a/d-1))+b}function o(a,b,c,d){return a===d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b}function p(a,b,c,d){return 0===a?b:a===d?b+c:(a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b)}function q(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b}function r(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b}function s(a,b,c,d){return a/=d/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b}function t(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f,1===c)return d+e;h||(h=.3*f);var j=a(i,e,h,g);return-b(j,c,f)+d}function u(b,c,d,e){var f=1.70158,g=0,h=d;if(0===b)return c;if(b/=e,1===b)return c+d;g||(g=.3*e);var i=a(h,d,g,f);return i.a*Math.pow(2,-10*b)*Math.sin(2*(b*e-i.s)*Math.PI/i.p)+i.c+c}function v(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f/2,2===c)return d+e;h||(h=.3*f*1.5);var j=a(i,e,h,g);return 1>c?-.5*b(j,c,f)+d:j.a*Math.pow(2,-10*(c-=1))*Math.sin(2*(c*f-j.s)*Math.PI/j.p)*.5+j.c+d}function w(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b}function x(a,b,c,d,e){return void 0===e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b}function y(a,b,c,d,e){return void 0===e&&(e=1.70158),a/=d/2,1>a?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b}function z(a,b,c,d){return c-A(d-a,0,c,d)+b}function A(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b}function B(a,b,c,d){return d/2>a?.5*z(2*a,0,c,d)+b:.5*A(2*a-d,0,c,d)+.5*c+b}fabric.util.ease={easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:c,easeInOutCubic:d,easeInQuart:e,easeOutQuart:f,easeInOutQuart:g,easeInQuint:h,easeOutQuint:i,easeInOutQuint:j,easeInSine:k,easeOutSine:l,easeInOutSine:m,easeInExpo:n,easeOutExpo:o,easeInOutExpo:p,easeInCirc:q,easeOutCirc:r,easeInOutCirc:s,easeInElastic:t,easeOutElastic:u,easeInOutElastic:v,easeInBack:w,easeOutBack:x,easeInOutBack:y,easeInBounce:z,easeOutBounce:A,easeInOutBounce:B}}(),function(a){"use strict";function b(a){return a in w?w[a]:a}function c(a,b,c){var d,e="[object Array]"===Object.prototype.toString.call(b);return"fill"!==a&&"stroke"!==a||"none"!==b?"fillRule"===a?b="evenodd"===b?"destination-over":b:"strokeDashArray"===a?b=b.replace(/,/g," ").split(/\s+/).map(function(a){return parseInt(a)}):"transformMatrix"===a?b=c&&c.transformMatrix?v(c.transformMatrix,p.parseTransformAttribute(b)):p.parseTransformAttribute(b):"visible"===a?(b="none"===b||"hidden"===b?!1:!0,c&&c.visible===!1&&(b=!1)):"originX"===a?b="start"===b?"left":"end"===b?"right":"center":d=e?b.map(u):u(b):b="",!e&&isNaN(d)?b:d}function d(a){for(var b in x)if(a[b]&&"undefined"!=typeof a[x[b]]&&0!==a[b].indexOf("url(")){var c=new p.Color(a[b]);a[b]=c.setAlpha(t(c.getAlpha()*a[x[b]],2)).toRgba()}return a}function e(a,b){var c=a.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(c){var d=c[1],e=c[3],f=c[4],g=c[5],h=c[6];d&&(b.fontStyle=d),e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e)),f&&(b.fontSize=parseFloat(f)),h&&(b.fontFamily=h),g&&(b.lineHeight="normal"===g?1:g)}}function f(a,d){var f,g;a.replace(/;$/,"").split(";").forEach(function(a){var h=a.split(":");f=b(h[0].trim().toLowerCase()),g=c(f,h[1].trim()),"font"===f?e(g,d):d[f]=g})}function g(a,d){var f,g;for(var h in a)"undefined"!=typeof a[h]&&(f=b(h.toLowerCase()),g=c(f,a[h]),"font"===f?e(g,d):d[f]=g)}function h(a){var b={};for(var c in p.cssRules)if(i(a,c.split(" ")))for(var d in p.cssRules[c])b[d]=p.cssRules[c][d];return b}function i(a,b){var c,d=!0;return c=k(a,b.pop()),c&&b.length&&(d=j(a,b)),c&&d&&0===b.length}function j(a,b){for(var c,d=!0;a.parentNode&&1===a.parentNode.nodeType&&b.length;)d&&(c=b.pop()),a=a.parentNode,d=k(a,c);return 0===b.length}function k(a,b){var c,d=a.nodeName,e=a.getAttribute("class"),f=a.getAttribute("id");if(c=new RegExp("^"+d,"i"),b=b.replace(c,""),f&&b.length&&(c=new RegExp("#"+f+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")),e&&b.length){e=e.split(" ");for(var g=e.length;g--;)c=new RegExp("\\."+e[g]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")
}return 0===b.length}function l(a){for(var b=a.getElementsByTagName("use");b.length;){for(var c,d=b[0],e=d.getAttribute("xlink:href").substr(1),f=d.getAttribute("x")||0,g=d.getAttribute("y")||0,h=a.getElementById(e).cloneNode(!0),i=(d.getAttribute("transform")||"")+" translate("+f+", "+g+")",j=0,k=d.attributes,l=k.length;l>j;j++){var m=k.item(j);"x"!==m.nodeName&&"y"!==m.nodeName&&"xlink:href"!==m.nodeName&&("transform"===m.nodeName?i=i+" "+m.nodeValue:h.setAttribute(m.nodeName,m.nodeValue))}h.setAttribute("transform",i),h.removeAttribute("id"),c=d.parentNode,c.replaceChild(h,d)}}function m(a,b){if(b[3]=b[0]=b[0]>b[3]?b[3]:b[0],1!==b[0]||1!==b[3]||0!==b[4]||0!==b[5]){for(var c=a.ownerDocument.createElement("g");null!=a.firstChild;)c.appendChild(a.firstChild);c.setAttribute("transform","matrix("+b[0]+" "+b[1]+" "+b[2]+" "+b[3]+" "+b[4]+" "+b[5]+")"),a.appendChild(c)}}function n(a){var b=a.objects,c=a.options;return b=b.map(function(a){return p[r(a.type)].fromObject(a)}),{objects:b,options:c}}function o(a,b,c){b[c]&&b[c].toSVG&&a.push('<pattern x="0" y="0" id="',c,'Pattern" ','width="',b[c].source.width,'" height="',b[c].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',b[c].source.width,'" height="',b[c].source.height,'" xlink:href="',b[c].source.src,'"></image></pattern>')}var p=a.fabric||(a.fabric={}),q=p.util.object.extend,r=p.util.string.capitalize,s=p.util.object.clone,t=p.util.toFixed,u=p.util.parseUnit,v=p.util.multiplyTransformMatrices,w={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},x={stroke:"strokeOpacity",fill:"fillOpacity"};p.parseTransformAttribute=function(){function a(a,b){var c=b[0];a[0]=Math.cos(c),a[1]=Math.sin(c),a[2]=-Math.sin(c),a[3]=Math.cos(c)}function b(a,b){var c=b[0],d=2===b.length?b[1]:b[0];a[0]=c,a[3]=d}function c(a,b){a[2]=b[0]}function d(a,b){a[1]=b[0]}function e(a,b){a[4]=b[0],2===b.length&&(a[5]=b[1])}var f=[1,0,0,1,0,0],g="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",h="(?:\\s+,?\\s*|,\\s*)",i="(?:(skewX)\\s*\\(\\s*("+g+")\\s*\\))",j="(?:(skewY)\\s*\\(\\s*("+g+")\\s*\\))",k="(?:(rotate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+")"+h+"("+g+"))?\\s*\\))",l="(?:(scale)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",m="(?:(translate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",n="(?:(matrix)\\s*\\(\\s*("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")\\s*\\))",o="(?:"+n+"|"+m+"|"+l+"|"+k+"|"+i+"|"+j+")",q="(?:"+o+"(?:"+h+o+")*)",r="^\\s*(?:"+q+"?)\\s*$",s=new RegExp(r),t=new RegExp(o,"g");return function(g){var h=f.concat(),i=[];if(!g||g&&!s.test(g))return h;g.replace(t,function(g){var j=new RegExp(o).exec(g).filter(function(a){return""!==a&&null!=a}),k=j[1],l=j.slice(2).map(parseFloat);switch(k){case"translate":e(h,l);break;case"rotate":l[0]=p.util.degreesToRadians(l[0]),a(h,l);break;case"scale":b(h,l);break;case"skewX":c(h,l);break;case"skewY":d(h,l);break;case"matrix":h=l}i.push(h.concat()),h=f.concat()});for(var j=i[0];i.length>1;)i.shift(),j=p.util.multiplyTransformMatrices(j,i[0]);return j}}(),p.parseSVGDocument=function(){function a(a,b){for(;a&&(a=a.parentNode);)if(b.test(a.nodeName))return!0;return!1}var b=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,c="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",d=new RegExp("^\\s*("+c+"+)\\s*,?\\s*("+c+"+)\\s*,?\\s*("+c+"+)\\s*,?\\s*("+c+"+)\\s*$");return function(c,e,f){if(c){var g=new Date;l(c);var h,i,j=c.getAttribute("viewBox"),k=u(c.getAttribute("width")),n=u(c.getAttribute("height"));if(j&&(j=j.match(d))){var o=parseFloat(j[1]),q=parseFloat(j[2]),r=1,t=1;h=parseFloat(j[3]),i=parseFloat(j[4]),k&&k!==h&&(r=k/h),n&&n!==i&&(t=n/i),m(c,[r,0,0,t,r*-o,t*-q])}var v=p.util.toArray(c.getElementsByTagName("*"));if(0===v.length&&p.isLikelyNode){v=c.selectNodes('//*[name(.)!="svg"]');for(var w=[],x=0,y=v.length;y>x;x++)w[x]=v[x];v=w}var z=v.filter(function(c){return b.test(c.tagName)&&!a(c,/^(?:pattern|defs)$/)});if(!z||z&&!z.length)return void(e&&e([],{}));var A={width:k?k:h,height:n?n:i,widthAttr:k,heightAttr:n};p.gradientDefs=p.getGradientDefs(c),p.cssRules=p.getCSSRules(c),p.parseElements(z,function(a){p.documentParsingTime=new Date-g,e&&e(a,A)},s(A),f)}}}();var y={has:function(a,b){b(!1)},get:function(){},set:function(){}};q(p,{getGradientDefs:function(a){var b,c,d,e,f=a.getElementsByTagName("linearGradient"),g=a.getElementsByTagName("radialGradient"),h=0,i=[],j={},k={};for(i.length=f.length+g.length,c=f.length;c--;)i[h++]=f[c];for(c=g.length;c--;)i[h++]=g[c];for(;h--;)b=i[h],e=b.getAttribute("xlink:href"),d=b.getAttribute("id"),e&&(k[d]=e.substr(1)),j[d]=b;for(d in k){var l=j[k[d]].cloneNode(!0);for(b=j[d];l.firstChild;)b.appendChild(l.firstChild)}return j},parseAttributes:function(a,e){if(a){var f,g={};a.parentNode&&/^symbol|[g|a]$/i.test(a.parentNode.nodeName)&&(g=p.parseAttributes(a.parentNode,e));var i=e.reduce(function(d,e){return f=a.getAttribute(e),f&&(e=b(e),f=c(e,f,g),d[e]=f),d},{});return i=q(i,q(h(a),p.parseStyleAttribute(a))),d(q(g,i))}},parseElements:function(a,b,c,d){new p.ElementsParser(a,b,c,d).parse()},parseStyleAttribute:function(a){var b={},c=a.getAttribute("style");return c?("string"==typeof c?f(c,b):g(c,b),b):b},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim(),a=a.split(/\s+/);var b,c,d=[];for(b=0,c=a.length;c>b;b+=2)d.push({x:parseFloat(a[b]),y:parseFloat(a[b+1])});return d},getCSSRules:function(a){for(var d,e=a.getElementsByTagName("style"),f={},g=0,h=e.length;h>g;g++){var i=e[0].textContent;i=i.replace(/\/\*[\s\S]*?\*\//g,""),d=i.match(/[^{]*\{[\s\S]*?\}/g),d=d.map(function(a){return a.trim()}),d.forEach(function(a){for(var d=a.match(/([\s\S]*?)\s*\{([^}]*)\}/),e={},g=d[2].trim(),h=g.replace(/;$/,"").split(/\s*;\s*/),i=0,j=h.length;j>i;i++){var k=h[i].split(/\s*:\s*/),l=b(k[0]),m=c(l,k[1],k[0]);e[l]=m}a=d[1],a.split(",").forEach(function(a){f[a.trim()]=p.util.object.clone(e)})})}return f},loadSVGFromURL:function(a,b,c){function d(d){var e=d.responseXML;e&&!e.documentElement&&p.window.ActiveXObject&&d.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(d.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e&&e.documentElement&&p.parseSVGDocument(e.documentElement,function(c,d){y.set(a,{objects:p.util.array.invoke(c,"toObject"),options:d}),b(c,d)},c)}a=a.replace(/^\n\s*/,"").trim(),y.has(a,function(c){c?y.get(a,function(a){var c=n(a);b(c.objects,c.options)}):new p.util.request(a,{method:"get",onComplete:d})})},loadSVGFromString:function(a,b,c){a=a.trim();var d;if("undefined"!=typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(d=e.parseFromString(a,"text/xml"))}else p.window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));p.parseSVGDocument(d.documentElement,function(a,c){b(a,c)},c)},createSVGFontFacesMarkup:function(a){for(var b="",c=0,d=a.length;d>c;c++)"text"===a[c].type&&a[c].path&&(b+=["@font-face {","font-family: ",a[c].fontFamily,"; ","src: url('",a[c].path,"')","}"].join(""));return b&&(b=['<style type="text/css">',"<![CDATA[",b,"]]>","</style>"].join("")),b},createSVGRefElementsMarkup:function(a){var b=[];return o(b,a,"backgroundColor"),o(b,a,"overlayColor"),b.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(a,b,c,d){this.elements=a,this.callback=b,this.options=c,this.reviver=d},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var a=0,b=this.elements.length;b>a;a++)!function(a,b){setTimeout(function(){a.createObject(a.elements[b],b)},0)}(this,a)},fabric.ElementsParser.prototype.createObject=function(a,b){var c=fabric[fabric.util.string.capitalize(a.tagName)];if(c&&c.fromElement)try{this._createObject(c,a,b)}catch(d){fabric.log(d)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(a,b,c){if(a.async)a.fromElement(b,this.createCallback(c,b),this.options);else{var d=a.fromElement(b,this.options);this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(b,d),this.instances[c]=d,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(a,b){var c=this;return function(d){c.resolveGradient(d,"fill"),c.resolveGradient(d,"stroke"),c.reviver&&c.reviver(b,d),c.instances[a]=d,c.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(a,b){var c=a.get(b);if(/^url\(/.test(c)){var d=c.slice(5,c.length-1);fabric.gradientDefs[d]&&a.set(b,fabric.Gradient.fromElement(fabric.gradientDefs[d],a))}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances))},function(a){"use strict";function b(a,b){this.x=a,this.y=b}var c=a.fabric||(a.fabric={});return c.Point?void c.warn("fabric.Point is already defined"):(c.Point=b,void(b.prototype={constructor:b,add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){return this.x+=a.x,this.y+=a.y,this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){return this.x+=a,this.y+=a,this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){return this.x-=a.x,this.y-=a.y,this},scalarSubtract:function(a){return new b(this.x-a,this.y-a)},scalarSubtractEquals:function(a){return this.x-=a,this.y-=a,this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){return this.x/=a,this.y/=a,this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,c){return new b(this.x+(a.x-this.x)*c,this.y+(a.y-this.y)*c)},distanceFrom:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(a){return new b(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,b){this.x=a,this.y=b},setFromPoint:function(a){this.x=a.x,this.y=a.y},swap:function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){this.status=a,this.points=[]}var c=a.fabric||(a.fabric={});return c.Intersection?void c.warn("fabric.Intersection is already defined"):(c.Intersection=b,c.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},c.Intersection.intersectLineLine=function(a,d,e,f){var g,h=(f.x-e.x)*(a.y-e.y)-(f.y-e.y)*(a.x-e.x),i=(d.x-a.x)*(a.y-e.y)-(d.y-a.y)*(a.x-e.x),j=(f.y-e.y)*(d.x-a.x)-(f.x-e.x)*(d.y-a.y);if(0!==j){var k=h/j,l=i/j;k>=0&&1>=k&&l>=0&&1>=l?(g=new b("Intersection"),g.points.push(new c.Point(a.x+k*(d.x-a.x),a.y+k*(d.y-a.y)))):g=new b}else g=new b(0===h||0===i?"Coincident":"Parallel");return g},c.Intersection.intersectLinePolygon=function(a,c,d){for(var e=new b,f=d.length,g=0;f>g;g++){var h=d[g],i=d[(g+1)%f],j=b.intersectLineLine(a,c,h,i);e.appendPoints(j.points)}return e.points.length>0&&(e.status="Intersection"),e},c.Intersection.intersectPolygonPolygon=function(a,c){for(var d=new b,e=a.length,f=0;e>f;f++){var g=a[f],h=a[(f+1)%e],i=b.intersectLinePolygon(g,h,c);d.appendPoints(i.points)}return d.points.length>0&&(d.status="Intersection"),d},void(c.Intersection.intersectPolygonRectangle=function(a,d,e){var f=d.min(e),g=d.max(e),h=new c.Point(g.x,f.y),i=new c.Point(f.x,g.y),j=b.intersectLinePolygon(f,h,a),k=b.intersectLinePolygon(h,g,a),l=b.intersectLinePolygon(g,i,a),m=b.intersectLinePolygon(i,f,a),n=new b;return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function c(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var d=a.fabric||(a.fabric={});return d.Color?void d.warn("fabric.Color is already defined."):(d.Color=b,d.Color.prototype={_tryParsingColor:function(a){var c;return a in b.colorNameMap&&(a=b.colorNameMap[a]),"transparent"===a?void this.setSource([255,255,255,0]):(c=b.sourceFromHex(a),c||(c=b.sourceFromRgb(a)),c||(c=b.sourceFromHsl(a)),void(c&&this.setSource(c)))},_rgbToHsl:function(a,b,c){a/=255,b/=255,c/=255;var e,f,g,h=d.util.array.max([a,b,c]),i=d.util.array.min([a,b,c]);if(g=(h+i)/2,h===i)e=f=0;else{var j=h-i;switch(f=g>.5?j/(2-h-i):j/(h+i),h){case a:e=(b-c)/j+(c>b?6:0);break;case b:e=(c-a)/j+2;break;case c:e=(a-b)/j+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a,b,c,d=this.getSource();return a=d[0].toString(16),a=1===a.length?"0"+a:a,b=d[1].toString(16),b=1===b.length?"0"+b:b,c=d[2].toString(16),c=1===c.length?"0"+c:c,a.toUpperCase()+b.toUpperCase()+c.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10),c=a[3];return this.setSource([b,b,b,c]),this},toBlackWhite:function(a){var b=this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),d=b[3];return a=a||127,c=Number(c)<Number(a)?0:255,this.setSource([c,c,c,d]),this},overlayWith:function(a){a instanceof b||(a=new b(a));for(var c=[],d=this.getAlpha(),e=.5,f=this.getSource(),g=a.getSource(),h=0;3>h;h++)c.push(Math.round(f[h]*(1-e)+g[h]*e));return c[3]=d,this.setSource(c),this}},d.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,d.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},d.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},d.Color.sourceFromRgb=function(a){var c=a.match(b.reRGBa);if(c){var d=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),e=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),f=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(d,10),parseInt(e,10),parseInt(f,10),c[4]?parseFloat(c[4]):1]}},d.Color.fromRgba=b.fromRgb,d.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},d.Color.sourceFromHsl=function(a){var d=a.match(b.reHSLa);if(d){var e,f,g,h=(parseFloat(d[1])%360+360)%360/360,i=parseFloat(d[2])/(/%$/.test(d[2])?100:1),j=parseFloat(d[3])/(/%$/.test(d[3])?100:1);if(0===i)e=f=g=j;else{var k=.5>=j?j*(i+1):j+i-j*i,l=2*j-k;e=c(l,k,h+1/3),f=c(l,k,h),g=c(l,k,h-1/3)}return[Math.round(255*e),Math.round(255*f),Math.round(255*g),d[4]?parseFloat(d[4]):1]}},d.Color.fromHsla=b.fromHsl,d.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},d.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),d=3===c.length,e=d?c.charAt(0)+c.charAt(0):c.substring(0,2),f=d?c.charAt(1)+c.charAt(1):c.substring(2,4),g=d?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(e,16),parseInt(f,16),parseInt(g,16),1]}},void(d.Color.fromSource=function(a){var c=new b;return c.setSource(a),c}))}("undefined"!=typeof exports?exports:this),function(){function a(a){var b,c,d,e=a.getAttribute("style"),f=a.getAttribute("offset");if(f=parseFloat(f)/(/%$/.test(f)?100:1),e){var g=e.split(/\s*;\s*/);""===g[g.length-1]&&g.pop();for(var h=g.length;h--;){var i=g[h].split(/\s*:\s*/),j=i[0].trim(),k=i[1].trim();"stop-color"===j?b=k:"stop-opacity"===j&&(d=k)}}return b||(b=a.getAttribute("stop-color")||"rgb(0,0,0)"),d||(d=a.getAttribute("stop-opacity")),b=new fabric.Color(b),c=b.getAlpha(),d=isNaN(parseFloat(d))?1:parseFloat(d),d*=c,{offset:f,color:b.toRgb(),opacity:d}}function b(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function c(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}function d(a,b){for(var c in b)if("string"==typeof b[c]&&/^\d+%$/.test(b[c])){var d=parseFloat(b[c],10);"x1"===c||"x2"===c||"r2"===c?b[c]=fabric.util.toFixed(a.width*d/100,2)+a.left:("y1"===c||"y2"===c)&&(b[c]=fabric.util.toFixed(a.height*d/100,2)+a.top)}}function e(a,b){for(var c in b)"x1"===c||"x2"===c||"r2"===c?b[c]=fabric.util.toFixed((b[c]-a.fill.origX)/a.width*100,2)+"%":("y1"===c||"y2"===c)&&(b[c]=fabric.util.toFixed((b[c]-a.fill.origY)/a.height*100,2)+"%")}fabric.Gradient=fabric.util.createClass({origX:0,origY:0,initialize:function(a){a||(a={});var b={};this.id=fabric.Object.__uid++,this.type=a.type||"linear",b={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},"radial"===this.type&&(b.r1=a.coords.r1||0,b.r2=a.coords.r2||0),this.coords=b,this.gradientUnits=a.gradientUnits||"objectBoundingBox",this.colorStops=a.colorStops.slice(),a.gradientTransform&&(this.gradientTransform=a.gradientTransform),this.origX=a.left||this.origX,this.origY=a.top||this.origY},addColorStop:function(a){for(var b in a){var c=new fabric.Color(a[b]);this.colorStops.push({offset:b,color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(a,b){var c,d,f=fabric.util.object.clone(this.coords);this.colorStops.sort(function(a,b){return a.offset-b.offset}),b&&"userSpaceOnUse"===this.gradientUnits?(f.x1+=a.width/2,f.y1+=a.height/2,f.x2+=a.width/2,f.y2+=a.height/2):"objectBoundingBox"===this.gradientUnits&&e(a,f),d='id="SVGID_'+this.id+'" gradientUnits="'+this.gradientUnits+'"',this.gradientTransform&&(d+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?c=["<linearGradient ",d,' x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,'">\n']:"radial"===this.type&&(c=["<radialGradient ",d,' cx="',f.x2,'" cy="',f.y2,'" r="',f.r2,'" fx="',f.x1,'" fy="',f.y1,'">\n']);for(var g=0;g<this.colorStops.length;g++)c.push("<stop ",'offset="',100*this.colorStops[g].offset+"%",'" style="stop-color:',this.colorStops[g].color,null!=this.colorStops[g].opacity?";stop-opacity: "+this.colorStops[g].opacity:";",'"/>\n');return c.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),c.join("")},toLive:function(a){var b;if(this.type){"linear"===this.type?b=a.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):"radial"===this.type&&(b=a.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));for(var c=0,d=this.colorStops.length;d>c;c++){var e=this.colorStops[c].color,f=this.colorStops[c].opacity,g=this.colorStops[c].offset;"undefined"!=typeof f&&(e=new fabric.Color(e).setAlpha(f).toRgba()),b.addColorStop(parseFloat(g),e)}return b}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(e,f){var g=e.getElementsByTagName("stop"),h="linearGradient"===e.nodeName?"linear":"radial",i=e.getAttribute("gradientUnits")||"objectBoundingBox",j=e.getAttribute("gradientTransform"),k=[],l={};"linear"===h?l=b(e):"radial"===h&&(l=c(e));for(var m=g.length;m--;)k.push(a(g[m]));d(f,l);var n=new fabric.Gradient({type:h,coords:l,gradientUnits:i,colorStops:k});return j&&(n.gradientTransform=fabric.parseTransformAttribute(j)),n},forObject:function(a,b){return b||(b={}),d(a,b),new fabric.Gradient(b)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){if(a||(a={}),this.id=fabric.Object.__uid++,a.source)if("string"==typeof a.source)if("undefined"!=typeof fabric.util.getFunctionBody(a.source))this.source=new Function(fabric.util.getFunctionBody(a.source));else{var b=this;this.source=fabric.util.createImage(),fabric.util.loadImage(a.source,function(a){b.source=a})}else this.source=a.source;a.repeat&&(this.repeat=a.repeat),a.offsetX&&(this.offsetX=a.offsetX),a.offsetY&&(this.offsetY=a.offsetY)},toObject:function(){var a;return"function"==typeof this.source?a=String(this.source):"string"==typeof this.source.src&&(a=this.source.src),{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(a){var b="function"==typeof this.source?this.source():this.source,c=b.width/a.getWidth(),d=b.height/a.getHeight(),e="";return b.src?e=b.src:b.toDataURL&&(e=b.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+c+'" height="'+d+'"><image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+e+'"></image></pattern>'},toLive:function(a){var b="function"==typeof this.source?this.source():this.source;if(!b)return"";if("undefined"!=typeof b.src){if(!b.complete)return"";if(0===b.naturalWidth||0===b.naturalHeight)return""}return a.createPattern(b,this.repeat)}}),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Shadow?void b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"==typeof a&&(a=this._parseShadow(a));for(var c in a)this[c]=a[c];this.id=b.Object.__uid++},_parseShadow:function(a){var c=a.trim(),d=b.Shadow.reOffsetsAndBlur.exec(c)||[],e=c.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:e.trim(),offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var b="SourceAlpha";return!a||a.fill!==this.color&&a.stroke!==this.color||(b="SourceGraphic"),'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+b+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var a={},c=b.Shadow.prototype;return this.color!==c.color&&(a.color=this.color),this.blur!==c.blur&&(a.blur=this.blur),this.offsetX!==c.offsetX&&(a.offsetX=this.offsetX),this.offsetY!==c.offsetY&&(a.offsetY=this.offsetY),a}}),void(b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var a=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,d=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={}),this._initStatic(a,b),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[],this._createLowerCanvas(a),this._initOptions(b),this._setImageSmoothing(),b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this)),b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this)),b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this)),b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=b(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled,a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,a.mozImageSmoothingEnabled=this.imageSmoothingEnabled,a.msImageSmoothingEnabled=this.imageSmoothingEnabled,a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,d){return"string"==typeof b?fabric.util.loadImage(b,function(b){this[a]=new fabric.Image(b,d),c&&c()},this):(this[a]=b,c&&c()),this},__setBgOverlayColor:function(a,b,c){if(b&&b.source){var d=this;fabric.util.loadImage(b.source,function(e){d[a]=new fabric.Pattern({source:e,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY}),c&&c()})}else this[a]=b,c&&c();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");if(a.style||(a.style={}),!a)throw d;return this._initCanvasElement(a),a},_initCanvasElement:function(a){if(fabric.util.createCanvasElement(a),"undefined"==typeof a.getContext)throw d},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c;b=b||{};for(var d in a)c=a[d],b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px"),b.backstoreOnly||this._setCssDimension(d,c);return b.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.upperCanvasEl&&(this.upperCanvasEl[a]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this[a]=b,this},_setCssDimension:function(a,b){return this.lowerCanvasEl.style[a]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b),this.wrapperEl&&(this.wrapperEl.style[a]=b),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){this.viewportTransform=a,this.renderAll();for(var b=0,c=this._objects.length;c>b;b++)this._objects[b].setCoords();return this},zoomToPoint:function(a,b){var c=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=b,this.viewportTransform[3]=b;var d=fabric.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=c.x-d.x,this.viewportTransform[5]+=c.y-d.y,this.renderAll();for(var e=0,f=this._objects.length;f>e;e++)this._objects[e].setCoords();return this},setZoom:function(a){return this.zoomToPoint(new fabric.Point(0,0),a),this},absolutePan:function(a){this.viewportTransform[4]=-a.x,this.viewportTransform[5]=-a.y,this.renderAll();for(var b=0,c=this._objects.length;c>b;b++)this._objects[b].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var c=this.viewportTransform;a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),b.render(a),a.restore(),this.controlsAboveOverlay||b._renderControls(a)}},_onObjectAdded:function(a){this.stateful&&a.setupState(),a.canvas=this,a.setCoords(),this.fire("object:added",{target:a}),a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:a}),a.fire("removed")},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(a){var b=this[a===!0&&this.interactive?"contextTop":"contextContainer"],c=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),a||this.clearContext(b),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,b),this._renderBackground(b),this._renderObjects(b,c),this._renderActiveGroup(b,c),this.clipTo&&b.restore(),this._renderOverlay(b),this.controlsAboveOverlay&&this.interactive&&this.drawControls(b),this.fire("after:render"),this},_renderObjects:function(a,b){var c,d;if(b)for(c=0,d=this._objects.length;d>c;++c)this._objects[c]&&!b.contains(this._objects[c])&&this._draw(a,this._objects[c]);else for(c=0,d=this._objects.length;d>c;++c)this._draw(a,this._objects[c])},_renderActiveGroup:function(a,b){if(b){var c=[];this.forEachObject(function(a){b.contains(a)&&c.push(a)}),b._set("objects",c),this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this._draw(a,this.overlayImage)
},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a),this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();return b&&b.render(a),this._renderOverlay(a),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top)),this.renderAll(),this},_centerObject:function(a,b){return a.setPositionByOrigin(b,"center","center"),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(b,c){var d=this.getActiveGroup();d&&this.discardActiveGroup();var e={objects:this._toObjects(b,c)};return a(e,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,e,c),d&&(this.setActiveGroup(new fabric.Group(d.getObjects(),{originX:"center",originY:"center"})),d.forEachObject(function(a){a.set("active",!0)}),this._currentTransform&&(this._currentTransform.target=this.getActiveGroup())),e},_toObjects:function(a,b){return this.getObjects().map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){var d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);var e=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=d),e},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(a.overlayImage=this.overlayImage.toObject()),a},toSVG:function(a,b){a||(a={});var c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this._setSVGBgOverlayColor(c,"backgroundColor"),this._setSVGBgOverlayImage(c,"backgroundImage"),this._setSVGObjects(c,b),this._setSVGBgOverlayColor(c,"overlayColor"),this._setSVGBgOverlayImage(c,"overlayImage"),c.push("</svg>"),c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',b.viewBox?b.viewBox.width:this.width,'" ','height="',b.viewBox?b.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(a,b){var c=this.getActiveGroup();c&&this.discardActiveGroup();for(var d=0,e=this.getObjects(),f=e.length;f>d;d++)a.push(e[d].toSVG(b));c&&(this.setActiveGroup(new fabric.Group(c.getObjects())),c.forEachObject(function(a){a.set("active",!0)}))},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){return c(this._objects,a),this._objects.unshift(a),this.renderAll&&this.renderAll()},bringToFront:function(a){return c(this._objects,a),this._objects.push(a),this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var d=this._objects.indexOf(a);if(0!==d){var e=this._findNewLowerIndex(a,d,b);c(this._objects,a),this._objects.splice(e,0,a),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(a,b,c){var d;if(c){d=b;for(var e=b-1;e>=0;--e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b-1;return d},bringForward:function(a,b){var d=this._objects.indexOf(a);if(d!==this._objects.length-1){var e=this._findNewUpperIndex(a,d,b);c(this._objects,a),this._objects.splice(e,0,a),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(a,b,c){var d;if(c){d=b;for(var e=b+1;e<this._objects.length;++e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b+1;return d},moveTo:function(a,b){return c(this._objects,a),this._objects.splice(b,0,a),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),a(fabric.StaticCanvas.prototype,fabric.Observable),a(fabric.StaticCanvas.prototype,fabric.Collection),a(fabric.StaticCanvas.prototype,fabric.DataURLExporter),a(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case"getImageData":return"undefined"!=typeof c.getImageData;case"setLineDash":return"undefined"!=typeof c.setLineDash;case"toDataURL":return"undefined"!=typeof b.toDataURL;case"toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(a){return this.shadow=new fabric.Shadow(a),this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin},_setShadow:function(){if(this.shadow){var a=this.canvas.contextTop;a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}}),function(){var a=fabric.util.array.min,b=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a,this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a),this._captureDrawingPath(a),this._render()},onMouseMove:function(a){this._captureDrawingPath(a),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){var b=new fabric.Point(a.x,a.y);this._reset(),this._addPoint(b),this.canvas.contextTop.moveTo(b.x,b.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);this._addPoint(b)},_render:function(){var a=this.canvas.contextTop,b=this.canvas.viewportTransform,c=this._points[0],d=this._points[1];a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]),a.beginPath(),2===this._points.length&&c.x===d.x&&c.y===d.y&&(c.x-=.5,d.x+=.5),a.moveTo(c.x,c.y);for(var e=1,f=this._points.length;f>e;e++){var g=c.midPointFrom(d);a.quadraticCurveTo(c.x,c.y,g.x,g.y),c=this._points[e],d=this._points[e+1]}a.lineTo(c.x,c.y),a.stroke(),a.restore()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minX,this.box.minY)},getPathBoundingBox:function(c){for(var d=[],e=[],f=c[0],g=c[1],h=f,i=1,j=c.length;j>i;i++){var k=f.midPointFrom(g);d.push(h.x),d.push(k.x),e.push(h.y),e.push(k.y),f=c[i],g=c[i+1],h=k}return d.push(f.x),e.push(f.y),{minX:a(d),minY:a(e),maxX:b(d),maxY:b(e)}},convertPointsToSVGPath:function(a,b,c){var d=[],e=new fabric.Point(a[0].x-b,a[0].y-c),f=new fabric.Point(a[1].x-b,a[1].y-c);d.push("M ",a[0].x-b," ",a[0].y-c," ");for(var g=1,h=a.length;h>g;g++){var i=e.midPointFrom(f);d.push("Q ",e.x," ",e.y," ",i.x," ",i.y," "),e=new fabric.Point(a[g].x-b,a[g].y-c),g+1<a.length&&(f=new fabric.Point(a[g+1].x-b,a[g+1].y-c))}return d.push("L ",e.x," ",e.y," "),d},createPath:function(a){var b=new fabric.Path(a);return b.fill=null,b.stroke=this.color,b.strokeWidth=this.width,b.strokeLineCap=this.strokeLineCap,b.strokeLineJoin=this.strokeLineJoin,this.shadow&&(this.shadow.affectStroke=!0,b.setShadow(this.shadow)),b},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();var b=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===b)return void this.canvas.renderAll();var c=this.box.minX+(this.box.maxX-this.box.minX)/2,d=this.box.minY+(this.box.maxY-this.box.minY)/2;this.canvas.contextTop.arc(c,d,3,0,2*Math.PI,!1);var e=this.createPath(b);e.set({left:c,top:d,originX:"center",originY:"center"}),this.canvas.add(e),e.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:e})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var b=this.addPoint(a),c=this.canvas.contextTop,d=this.canvas.viewportTransform;c.save(),c.transform(d[0],d[1],d[2],d[3],d[4],d[5]),c.fillStyle=b.fill,c.beginPath(),c.arc(b.x,b.y,b.radius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.restore()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.points.length;d>c;c++){var e=this.points[c],f=new fabric.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&f.setShadow(this.shadow),b.push(f)}var g=new fabric.Group(b,{originX:"center",originY:"center"});g.canvas=this.canvas,this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.renderAll()},addPoint:function(a){var b=new fabric.Point(a.x,a.y),c=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return b.radius=c,b.fill=d,this.points.push(b),b}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render()},onMouseMove:function(a){this.addSprayChunk(a),this.render()},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.sprayChunks.length;d>c;c++)for(var e=this.sprayChunks[c],f=0,g=e.length;g>f;f++){var h=new fabric.Rect({width:e[f].width,height:e[f].width,left:e[f].x+1,top:e[f].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow),b.push(h)}this.optimizeOverlapping&&(b=this._getOptimizedRects(b));var i=new fabric.Group(b,{originX:"center",originY:"center"});i.canvas=this.canvas,this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.renderAll()},_getOptimizedRects:function(a){for(var b,c={},d=0,e=a.length;e>d;d++)b=a[d].left+""+a[d].top,c[b]||(c[b]=a[d]);var f=[];for(b in c)f.push(c[b]);return f},render:function(){var a=this.canvas.contextTop;a.fillStyle=this.color;var b=this.canvas.viewportTransform;a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);for(var c=0,d=this.sprayChunkPoints.length;d>c;c++){var e=this.sprayChunkPoints[c];"undefined"!=typeof e.opacity&&(a.globalAlpha=e.opacity),a.fillRect(e.x,e.y,e.width,e.width)}a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];for(var b,c,d,e=this.width/2,f=0;f<this.density;f++){b=fabric.util.getRandomInt(a.x-e,a.x+e),c=fabric.util.getRandomInt(a.y-e,a.y+e),d=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var g=new fabric.Point(b,c);g.width=d,this.randomOpacity&&(g.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(g)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var a=20,b=5,c=fabric.document.createElement("canvas"),d=c.getContext("2d");return c.width=c.height=a+b,d.fillStyle=this.color,d.beginPath(),d.arc(a/2,a/2,a/2,0,2*Math.PI,!1),d.closePath(),d.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(a){var b=this.callSuper("createPath",a);return b.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),b}}),function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians,c=fabric.util.radiansToDegrees,d=Math.atan2,e=Math.abs,f=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={}),this._initStatic(a,b),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(a){var b=this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,left:b.original.left,top:b.original.top}),this._shouldCenterTransform(a,b.target)?"rotate"===b.action?this._setOriginToCenter(b.target):("center"!==b.originX&&(b.mouseXSign="right"===b.originX?-1:1),"center"!==b.originY&&(b.mouseYSign="bottom"===b.originY?-1:1),b.originX="center",b.originY="center"):(b.originX=b.original.originX,b.originY=b.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a,!0),d=this._normalizePointer(b,c);return b.containsPoint(d)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c,d=this.getActiveGroup(),e=b.x,f=b.y,g=d&&"group"!==a.type&&d.contains(a);return g&&(c=new fabric.Point(d.left,d.top),c=fabric.util.transformPoint(c,this.viewportTransform,!0),e-=c.x,f-=c.y),{x:e,y:f}},isTargetTransparent:function(a,b,c){var d=a.hasBorders,e=a.transparentCorners;a.hasBorders=a.transparentCorners=!1,this._draw(this.contextCache,a),a.hasBorders=d,a.transparentCorners=e;var f=fabric.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);return this.clearContext(this.contextCache),f},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a,b){if(b){var c,d=this._currentTransform;return"scale"===d.action||"scaleX"===d.action||"scaleY"===d.action?c=this.centeredScaling||b.centeredScaling:"rotate"===d.action&&(c=this.centeredRotation||b.centeredRotation),c?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};return"ml"===b||"tl"===b||"bl"===b?c.x="right":("mr"===b||"tr"===b||"br"===b)&&(c.x="left"),"tl"===b||"mt"===b||"tr"===b?c.y="bottom":("bl"===b||"mb"===b||"br"===b)&&(c.y="top"),c},_getActionFromCorner:function(a,b){var c="drag";return b&&(c="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":"scale"),c},_setupCurrentTransform:function(a,c){if(c){var d=this.getPointer(a),e=c._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(c,e),g=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:f,scaleX:c.scaleX,scaleY:c.scaleY,offsetX:d.x-c.left,offsetY:d.y-c.top,originX:g.x,originY:g.y,ex:d.x,ey:d.y,left:c.left,top:c.top,theta:b(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,originX:g.x,originY:g.y},this._resetCurrentTransform(a)}},_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX),c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=e.get("lockScalingX"),g=e.get("lockScalingY"),h=e.get("lockScalingFlip");if(!f||!g){var i=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY),j=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY);this._setLocalMouse(j,d),this._setObjectScale(j,d,f,g,c,h),e.setPositionByOrigin(i,d.originX,d.originY)}},_setObjectScale:function(a,b,c,d,e,f){var g=b.target,h=!1,i=!1;b.newScaleX=a.x/(g.width+g.strokeWidth),b.newScaleY=a.y/(g.height+g.strokeWidth),f&&b.newScaleX<=0&&b.newScaleX<g.scaleX&&(h=!0),f&&b.newScaleY<=0&&b.newScaleY<g.scaleY&&(i=!0),"equally"!==e||c||d?e?"x"!==e||g.get("lockUniScaling")?"y"!==e||g.get("lockUniScaling")||i||d||g.set("scaleY",b.newScaleY):h||c||g.set("scaleX",b.newScaleX):(h||c||g.set("scaleX",b.newScaleX),i||d||g.set("scaleY",b.newScaleY)):h||i||this._scaleObjectEqually(a,g,b),h||i||this._flipObject(b)},_scaleObjectEqually:function(a,b,c){var d=a.y+a.x,e=(b.height+b.strokeWidth)*c.original.scaleY+(b.width+b.strokeWidth)*c.original.scaleX;c.newScaleX=c.original.scaleX*d/e,c.newScaleY=c.original.scaleY*d/e,b.set("scaleX",c.newScaleX),b.set("scaleY",c.newScaleY)},_flipObject:function(a){a.newScaleX<0&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left")),a.newScaleY<0&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x*=2*b.mouseXSign,a.x<0&&(b.mouseXSign=-b.mouseXSign)),"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y*=2*b.mouseYSign,a.y<0&&(b.mouseYSign=-b.mouseYSign)),e(a.x)>c.padding?a.x<0?a.x+=c.padding:a.x-=c.padding:a.x=0,e(a.y)>c.padding?a.y<0?a.y+=c.padding:a.y-=c.padding:a.y=0},_rotateObject:function(a,b){var e=this._currentTransform;if(!e.target.get("lockRotation")){var f=d(e.ey-e.top,e.ex-e.left),g=d(b-e.top,a-e.left),h=c(g-f+e.theta);0>h&&(h=360+h),e.target.angle=h}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,b=this._groupSelector,c=b.left,d=b.top,g=e(c),h=e(d);if(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(c>0?0:-c),b.ey-(d>0?0:-d),g,h),a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var i=b.ex+f-(c>0?0:g),j=b.ey+f-(d>0?0:h);a.beginPath(),fabric.util.drawDashedLine(a,i,j,i+g,j,this.selectionDashArray),fabric.util.drawDashedLine(a,i,j+h-1,i+g,j+h-1,this.selectionDashArray),fabric.util.drawDashedLine(a,i,j,i,j+h,this.selectionDashArray),fabric.util.drawDashedLine(a,i+g-1,j,i+g-1,j+h,this.selectionDashArray),a.closePath(),a.stroke()}else a.strokeRect(b.ex+f-(c>0?0:g),b.ey+f-(d>0?0:h),g,h)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;var d=this._searchPossibleTargets(a);return this._fireOverOutEvents(d),d}},_fireOverOutEvents:function(a){a?this._hoveredTarget!==a&&(this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b)){if(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing)return!0;var d=this.isTargetTransparent(b,c.x,c.y);if(!d)return!0}},_searchPossibleTargets:function(a){for(var b,c=this.getPointer(a,!0),d=this._objects.length;d--;)if(this._checkTarget(a,this._objects[d],c)){this.relatedTarget=this._objects[d],b=this._objects[d];break}return b},getPointer:function(b,c,d){d||(d=this.upperCanvasEl);var e,f=a(b,d),g=d.getBoundingClientRect();return this.calcOffset(),f.x=f.x-this._offset.left,f.y=f.y-this._offset.top,c||(f=fabric.util.transformPoint(f,fabric.util.invertTransform(this.viewportTransform))),e=0===g.width||0===g.height?{width:1,height:1}:{width:d.width/g.width,height:d.height/g.height},{x:f.x*e.width,y:f.y*e.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0}),a.width=b,a.height=c,fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=a,a.set("active",!0)},setActiveObject:function(a,b){return this._setActiveObject(a),this.renderAll(),this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(a){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:a}),this},_setActiveGroup:function(a){this._activeGroup=a,a&&a.set("active",!0)},setActiveGroup:function(a,b){return this._setActiveGroup(a),a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(a){return this._discardActiveGroup(),this.fire("selection:cleared",{e:a}),this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;c>b;b++)a[b].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();return b&&this.fire("before:selection:cleared",{target:b,e:a}),this.deactivateAll(),b&&this.fire("selection:cleared",{e:a}),this},drawControls:function(a){var b=this.getActiveGroup();b?this._drawGroupControls(a,b):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){b._renderControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;c>b;++b)this._objects[b]&&this._objects[b].active&&(this._objects[b]._renderControls(a),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b])}});for(var g in fabric.StaticCanvas)"prototype"!==g&&(fabric.Canvas[g]=fabric.StaticCanvas[g]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,c=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),b(fabric.window,"resize",this._onResize),b(this.upperCanvasEl,"mousedown",this._onMouseDown),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"mousewheel",this._onMouseWheel),b(this.upperCanvasEl,"touchstart",this._onMouseDown),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof Event&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){c(fabric.window,"resize",this._onResize),c(this.upperCanvasEl,"mousedown",this._onMouseDown),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"mousewheel",this._onMouseWheel),c(this.upperCanvasEl,"touchstart",this._onMouseDown),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof Event&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onMouseDown:function(a){this.__onMouseDown(a),b(fabric.document,"touchend",this._onMouseUp),b(fabric.document,"touchmove",this._onMouseMove),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===a.type?c(this.upperCanvasEl,"mousedown",this._onMouseDown):(b(fabric.document,"mouseup",this._onMouseUp),b(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){if(this.__onMouseUp(a),c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"touchend",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove),c(fabric.document,"touchmove",this._onMouseMove),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===a.type){var d=this;setTimeout(function(){b(d.upperCanvasEl,"mousedown",d._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(a);this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var c=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a),b&&(b.isMoving=!1),c&&this.renderAll(),this._handleCursorAndEvent(a,b)},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var c=this;setTimeout(function(){c._setCursorFromEvent(a,b)},50),this.fire("mouse:up",{target:b,e:a}),b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform,b=a.target;b._scaling&&(b._scaling=!1),b.setCoords(),this.stateful&&b.hasStateChanged()&&(this.fire("object:modified",{target:b}),b.fire("modified")),this._restoreOriginXY(b)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.discardActiveObject(a).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var b=fabric.util.invertTransform(this.viewportTransform),c=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseDown(c),this.fire("mouse:down",{e:a})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=fabric.util.invertTransform(this.viewportTransform),c=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseMove(c)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:a})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:a})},__onMouseDown:function(a){var b="which"in a?1===a.which:1===a.button;if(b||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(a);if(!this._currentTransform){var c=this.findTarget(a),d=this.getPointer(a,!0);this._previousPointer=d;var e=this._shouldRender(c,d),f=this._shouldGroup(a,c);
this._shouldClearSelection(a,c)?this._clearSelection(a,c,d):f&&(this._handleGrouping(a,c),c=this.getActiveGroup()),c&&c.selectable&&!f&&(this._beforeTransform(a,c),this._setupCurrentTransform(a,c)),e&&this.renderAll(),this.fire("mouse:down",{target:c,e:a}),c&&c.fire("mousedown",{e:a})}}},_beforeTransform:function(a,b){var c;this.stateful&&b.saveState(),(c=b._findTargetCorner(this.getPointer(a)))&&this.onBeforeScaleRotate(b),b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,c){this.deactivateAllWithDispatch(a),b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center",a.originY="center",a.left=b.x,a.top=b.y,this._currentTransform.left=a.left,this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);var d=this._groupSelector;d?(c=this.getPointer(a,!0),d.left=c.x-d.ex,d.top=c.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b)),this.fire("mouse:move",{target:b,e:a}),b&&b.fire("mousemove",{e:a})},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1,c.target.isMoving=!0,this._beforeScaleTransform(a,c),this._performTransformAction(a,c,b),this.renderAll()},_performTransformAction:function(a,b,c){var d=c.x,e=c.y,f=b.target,g=b.action;"rotate"===g?(this._rotateObject(d,e),this._fire("rotating",f,a)):"scale"===g?(this._onScale(a,b,d,e),this._fire("scaling",f,a)):"scaleX"===g?(this._scaleObject(d,e,"x"),this._fire("scaling",f,a)):"scaleY"===g?(this._scaleObject(d,e,"y"),this._fire("scaling",f,a)):(this._translateObject(d,e),this._fire("moving",f,a),this.setCursor(this.moveCursor))},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c}),b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(a,b.target);(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)&&(this._resetCurrentTransform(a),b.reset=!0)}},_onScale:function(a,b,c,d){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(a,b.target),b.currentAction="scaleEqually",this._scaleObject(c,d,"equally")):(b.currentAction="scale",this._scaleObject(c,d))},_setCursorFromEvent:function(a,b){if(!b||!b.selectable)return this.setCursor(this.defaultCursor),!1;var c=this.getActiveGroup(),d=b._findTargetCorner&&(!c||!c.contains(b))&&b._findTargetCorner(this.getPointer(a,!0));return d?this._setCornerCursor(d,b):this.setCursor(b.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(b,c){if(b in a)this.setCursor(this._getRotatedCornerCursor(b,c));else{if("mtr"!==b||!c.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(b,c){var d=Math.round(c.getAngle()%360/45);return 0>d&&(d+=8),d+=a[b],d%=8,this.cursorMap[d]}})}(),function(){var a=Math.min,b=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,b){var c=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||c&&c!==b)&&this.selection},_handleGrouping:function(a,b){(b!==this.getActiveGroup()||(b=this.findTarget(a,!0),b&&!b.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(b,a):this._createActiveGroup(b,a),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(a,b){var c=this.getActiveGroup();if(c.contains(a)){if(c.removeWithUpdate(a),this._resetObjectTransform(c),a.set("active",!1),1===c.size())return this.discardActiveGroup(b),void this.setActiveObject(c.item(0))}else c.addWithUpdate(a),this._resetObjectTransform(c);this.fire("selection:created",{target:c,e:b}),c.set("active",!0)},_createActiveGroup:function(a,b){if(this._activeObject&&a!==this._activeObject){var c=this._createGroup(a);c.addWithUpdate(),this.setActiveGroup(c),this._activeObject=null,this.fire("selection:created",{target:c,e:b})}a.set("active",!0)},_createGroup:function(a){var b=this.getObjects(),c=b.indexOf(this._activeObject)<b.indexOf(a),d=c?[this._activeObject,a]:[a,this._activeObject];return new fabric.Group(d,{originX:"center",originY:"center",canvas:this})},_groupSelectedObjects:function(a){var b=this._collectObjects();1===b.length?this.setActiveObject(b[0],a):b.length>1&&(b=new fabric.Group(b.reverse(),{originX:"center",originY:"center",canvas:this}),b.addWithUpdate(),this.setActiveGroup(b,a),b.saveCoords(),this.fire("selection:created",{target:b}),this.renderAll())},_collectObjects:function(){for(var c,d=[],e=this._groupSelector.ex,f=this._groupSelector.ey,g=e+this._groupSelector.left,h=f+this._groupSelector.top,i=new fabric.Point(a(e,g),a(f,h)),j=new fabric.Point(b(e,g),b(f,h)),k=e===g&&f===h,l=this._objects.length;l--&&(c=this._objects[l],!(c&&c.selectable&&c.visible&&(c.intersectsWithRect(i,j)||c.isContainedWithinRect(i,j)||c.containsPoint(i)||c.containsPoint(j))&&(c.set("active",!0),d.push(c),k))););return d},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);var b=this.getActiveGroup();b&&(b.setObjectsCoords().setCoords(),b.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",c=a.quality||1,d=a.multiplier||1,e={left:a.left,top:a.top,width:a.width,height:a.height};return 1!==d?this.__toDataURLWithMultiplier(b,c,e,d):this.__toDataURL(b,c,e)},__toDataURL:function(a,b,c){this.renderAll(!0);var d=this.upperCanvasEl||this.lowerCanvasEl,e=this.__getCroppedCanvas(d,c);"jpg"===a&&(a="jpeg");var f=fabric.StaticCanvas.supports("toDataURLWithQuality")?(e||d).toDataURL("image/"+a,b):(e||d).toDataURL("image/"+a);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),e&&(e=null),f},__getCroppedCanvas:function(a,b){var c,d,e="left"in b||"top"in b||"width"in b||"height"in b;return e&&(c=fabric.util.createCanvasElement(),d=c.getContext("2d"),c.width=b.width||this.width,c.height=b.height||this.height,d.drawImage(a,-b.left||0,-b.top||0)),c},__toDataURLWithMultiplier:function(a,b,c,d){var e=this.getWidth(),f=this.getHeight(),g=e*d,h=f*d,i=this.getActiveObject(),j=this.getActiveGroup(),k=this.contextTop||this.contextContainer;d>1&&this.setWidth(g).setHeight(h),k.scale(d,d),c.left&&(c.left*=d),c.top&&(c.top*=d),c.width?c.width*=d:1>d&&(c.width=g),c.height?c.height*=d:1>d&&(c.height=h),j?this._tempRemoveBordersControlsFromGroup(j):i&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var l=this.__toDataURL(a,b,c);return this.width=e,this.height=f,k.scale(1/d,1/d),this.setWidth(e).setHeight(f),j?this._restoreBordersControlsOnGroup(j):i&&this.setActiveObject&&this.setActiveObject(i),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),l},toDataURLWithMultiplier:function(a,b,c){return this.toDataURL({format:a,multiplier:b,quality:c})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls,a.origBorderColor=a.borderColor,a.hasControls=!0,a.borderColor="rgba(0,0,0,0)",a.forEachObject(function(a){a.origBorderColor=a.borderColor,a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls,a.borderColor=a.origBorderColor,a.forEachObject(function(a){a.borderColor=a.origBorderColor,delete a.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b,c){return this.loadFromJSON(a,b,c)},loadFromJSON:function(a,b,c){if(a){var d="string"==typeof a?JSON.parse(a):a;this.clear();var e=this;return this._enlivenObjects(d.objects,function(){e._setBgOverlay(d,b)},c),this}},_setBgOverlay:function(a,b){var c=this,d={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(a.backgroundImage||a.overlayImage||a.background||a.overlay))return void(b&&b());var e=function(){d.backgroundImage&&d.overlayImage&&d.backgroundColor&&d.overlayColor&&(c.renderAll(),b&&b())};this.__setBgOverlay("backgroundImage",a.backgroundImage,d,e),this.__setBgOverlay("overlayImage",a.overlayImage,d,e),this.__setBgOverlay("backgroundColor",a.background,d,e),this.__setBgOverlay("overlayColor",a.overlay,d,e),e()},__setBgOverlay:function(a,b,c,d){var e=this;return b?void("backgroundImage"===a||"overlayImage"===a?fabric.Image.fromObject(b,function(b){e[a]=b,c[a]=!0,d&&d()}):this["set"+fabric.util.string.capitalize(a,!0)](b,function(){c[a]=!0,d&&d()})):void(c[a]=!0)},_enlivenObjects:function(a,b,c){var d=this;if(!a||0===a.length)return void(b&&b());var e=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(a,function(a){a.forEach(function(a,b){d.insertAt(a,b,!0)}),d.renderOnAddRemove=e,b&&b()},null,c)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,c){this.clone(function(d){c(d.toDataURLWithMultiplier(a,b))})},clone:function(a,b){var c=JSON.stringify(this.toJSON(b));this.cloneWithoutData(function(b){b.loadFromJSON(c,function(){a&&a(b)})})},cloneWithoutData:function(a){var b=fabric.document.createElement("canvas");b.width=this.getWidth(),b.height=this.getHeight();var c=new fabric.Canvas(b);c.clipTo=this.clipTo,this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),a&&a(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):a&&a(c)}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.toFixed,e=b.util.string.capitalize,f=b.util.degreesToRadians,g=b.StaticCanvas.supports("setLineDash");b.Object||(b.Object=b.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||a.fill instanceof b.Gradient||this.set("fill",new b.Gradient(a.fill))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof b.Pattern||this.set("fill",new b.Pattern(a.fill)),!a.stroke||!a.stroke.source||a.stroke instanceof b.Pattern||this.set("stroke",new b.Pattern(a.stroke))},_initClipping:function(a){if(a.clipTo&&"string"==typeof a.clipTo){var c=b.util.getFunctionBody(a.clipTo);"undefined"!=typeof c&&(this.clipTo=new Function("ctx",c))}},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a),this._initPattern(a),this._initClipping(a)},transform:function(a,b){this.group&&this.group.transform(a,b),a.globalAlpha=this.opacity;var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y),a.rotate(f(this.angle)),a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS,e={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,c),top:d(this.top,c),width:d(this.width,c),height:d(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,c),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,c),scaleX:d(this.scaleX,c),scaleY:d(this.scaleY,c),angle:d(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};return this.includeDefaultValues||(e=this._removeDefaultValues(e)),b.util.populateWithProperties(this,e,a),e},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype,d=c.stateProperties;return d.forEach(function(b){a[b]===c[b]&&delete a[b]}),a},toString:function(){return"#<fabric."+e(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){return"object"==typeof a?this._setObject(a):"function"==typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b),this},_set:function(a,c){var e="scaleX"===a||"scaleY"===a;return e&&(c=this._constrainScale(c)),"scaleX"===a&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&0>c?(this.flipY=!this.flipY,c*=-1):"width"===a||"height"===a?this.minScaleLimit=d(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==a||!c||c instanceof b.Shadow||(c=new b.Shadow(c)),this[a]=c,this},toggle:function(a){var b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this},setSourcePath:function(a){return this.sourcePath=a,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,c){if(0!==this.width&&0!==this.height&&this.visible){if(a.save(),this._setupFillRule(a),this._transform(a,c),this._setStrokeStyles(a),this._setFillStyles(a),this.group&&"path-group"===this.group.type){a.translate(-this.group.width/2,-this.group.height/2);var d=this.transformMatrix;d&&a.transform.apply(a,d)}a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity,this._setShadow(a),this.clipTo&&b.util.clipContext(this,a),this._render(a,c),this.clipTo&&a.restore(),this._removeShadow(a),this._restoreFillRule(a),a.restore()}},_transform:function(a,b){var c=this.transformMatrix;c&&!this.group&&a.setTransform.apply(a,c),b||this.transform(a)},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill)},_renderControls:function(a,c){var d=this.getViewportTransform();if(a.save(),this.active&&!c){var e;this.group&&(e=b.util.transformPoint(this.group.getCenterPoint(),d),a.translate(e.x,e.y),a.rotate(f(this.group.angle))),e=b.util.transformPoint(this.getCenterPoint(),d,null!=this.group),this.group&&(e.x*=this.group.scaleX,e.y*=this.group.scaleY),a.translate(e.x,e.y),a.rotate(f(this.angle)),this.drawBorders(a),this.drawControls(a)}a.restore()},_setShadow:function(a){this.shadow&&(a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){if(this.fill){if(a.save(),this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),this.fill.gradientTransform){var b=this.fill.gradientTransform;a.transform.apply(a,b)}"destination-over"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a)}},_renderStroke:function(a){if(this.stroke&&0!==this.strokeWidth){if(a.save(),this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke();else{if(this.stroke.gradientTransform){var b=this.stroke.gradientTransform;a.transform.apply(a,b)}this._stroke?this._stroke(a):a.stroke()}this._removeShadow(a),a.restore()}},clone:function(a,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),a):new b.Object(this.toObject(c))},cloneAsImage:function(a){var c=this.toDataURL();return b.util.loadImage(c,function(c){a&&a(new b.Image(c))}),this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement(),d=this.getBoundingRect();c.width=d.width,c.height=d.height,b.util.wrapElement(c,"div");var e=new b.Canvas(c);"jpg"===a.format&&(a.format="jpeg"),"jpeg"===a.format&&(e.backgroundColor="#fff");var f={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new b.Point(c.width/2,c.height/2),"center","center");var g=this.canvas;e.add(this);var h=e.toDataURL(a);return this.set(f).setCoords(),this.canvas=g,e.dispose(),e=null,h},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};d.type=c.type||(c.r1||c.r2?"radial":"linear"),d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2},(c.r1||c.r2)&&(d.coords.r1=c.r1,d.coords.r2=c.r2);for(var e in c.colorStops){var f=new b.Color(c.colorStops[e]);d.colorStops.push({offset:e,color:f.toRgb(),opacity:f.getAlpha()})}return this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){return this.set("fill",a),this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return b&&this._setOriginToCenter(),this.set("angle",a),b&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupFillRule:function(a){this.fillRule&&(this._prevFillRule=a.globalCompositeOperation,a.globalCompositeOperation=this.fillRule)},_restoreFillRule:function(a){this.fillRule&&this._prevFillRule&&(a.globalCompositeOperation=this._prevFillRule)}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,c(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(b,c,d){var e=b.x,f=b.y,g=this.stroke?this.strokeWidth:0;return"left"===c?e=b.x+(this.getWidth()+g*this.scaleX)/2:"right"===c&&(e=b.x-(this.getWidth()+g*this.scaleX)/2),"top"===d?f=b.y+(this.getHeight()+g*this.scaleY)/2:"bottom"===d&&(f=b.y-(this.getHeight()+g*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(e,f),b,a(this.angle))},translateToOriginPoint:function(b,c,d){var e=b.x,f=b.y,g=this.stroke?this.strokeWidth:0;return"left"===c?e=b.x-(this.getWidth()+g*this.scaleX)/2:"right"===c&&(e=b.x+(this.getWidth()+g*this.scaleX)/2),"top"===d?f=b.y-(this.getHeight()+g*this.scaleY)/2:"bottom"===d&&(f=b.y+(this.getHeight()+g*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(e,f),b,a(this.angle))},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,b)},toLocalPoint:function(b,c,d){var e,f,g=this.getCenterPoint(),h=this.stroke?this.strokeWidth:0;return c&&d?(e="left"===c?g.x-(this.getWidth()+h*this.scaleX)/2:"right"===c?g.x+(this.getWidth()+h*this.scaleX)/2:g.x,f="top"===d?g.y-(this.getHeight()+h*this.scaleY)/2:"bottom"===d?g.y+(this.getHeight()+h*this.scaleY)/2:g.y):(e=this.left,f=this.top),fabric.util.rotatePoint(new fabric.Point(b.x,b.y),g,-a(this.angle)).subtractEquals(new fabric.Point(e,f))},setPositionByOrigin:function(a,b,c){var d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(b){var c=a(this.angle),d=this.getWidth()/2,e=Math.cos(c)*d,f=Math.sin(c)*d,g=this.getWidth(),h=Math.cos(c)*g,i=Math.sin(c)*g;"center"===this.originX&&"left"===b||"right"===this.originX&&"center"===b?(this.left-=e,this.top-=f):"left"===this.originX&&"center"===b||"center"===this.originX&&"right"===b?(this.left+=e,this.top+=f):"left"===this.originX&&"right"===b?(this.left+=h,this.top+=i):"right"===this.originX&&"left"===b&&(this.left-=h,this.top-=i),this.setCoords(),this.originX=b},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center",this.originY="center",this.left=a.x,this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=a.x,this.top=a.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(a,b){var c=this.oCoords,d=new fabric.Point(c.tl.x,c.tl.y),e=new fabric.Point(c.tr.x,c.tr.y),f=new fabric.Point(c.bl.x,c.bl.y),g=new fabric.Point(c.br.x,c.br.y),h=fabric.Intersection.intersectPolygonRectangle([d,e,g,f],a,b);return"Intersection"===h.status},intersectsWithObject:function(a){function b(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,a.tr.y),bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var c=b(this.oCoords),d=b(a.oCoords),e=fabric.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[d.tl,d.tr,d.br,d.bl]);return"Intersection"===e.status},isContainedWithinObject:function(a){var b=a.getBoundingRect(),c=new fabric.Point(b.left,b.top),d=new fabric.Point(b.left+b.width,b.top+b.height);return this.isContainedWithinRect(c,d)},isContainedWithinRect:function(a,b){var c=this.getBoundingRect();return c.left>=a.x&&c.left+c.width<=b.x&&c.top>=a.y&&c.top+c.height<=b.y},containsPoint:function(a){var b=this._getImageLines(this.oCoords),c=this._findCrossPoints(a,b);return 0!==c&&c%2===1},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var c,d,e,f,g,h,i,j=0;for(var k in b)if(i=b[k],!(i.o.y<a.y&&i.d.y<a.y||i.o.y>=a.y&&i.d.y>=a.y||(i.o.x===i.d.x&&i.o.x>=a.x?(g=i.o.x,h=a.y):(c=0,d=(i.d.y-i.o.y)/(i.d.x-i.o.x),e=a.y-c*a.x,f=i.o.y-d*i.o.x,g=-(e-f)/(c-d),h=e+c*g),g>=a.x&&(j+=1),2!==j)))break;return j},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],b=fabric.util.array.min(a),c=fabric.util.array.max(a),d=Math.abs(b-c),e=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],f=fabric.util.array.min(e),g=fabric.util.array.max(e),h=Math.abs(f-g);return{left:b,top:f,width:d,height:h}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){return a=this._constrainScale(a),0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1),this.scaleX=a,this.scaleY=a,this.setCoords(),this},scaleToWidth:function(a){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/b)},setCoords:function(){var b=this.strokeWidth>1?this.strokeWidth:0,c=a(this.angle),d=this.getViewportTransform(),e=function(a){return fabric.util.transformPoint(a,d)},f=this.width,g=this.height,h="round"===this.strokeLineCap||"square"===this.strokeLineCap,i="line"===this.type&&1===this.width,j="line"===this.type&&1===this.height,k=h&&j||"line"!==this.type,l=h&&i||"line"!==this.type;i?f=b:j&&(g=b),k&&(f+=b),l&&(g+=b),this.currentWidth=f*this.scaleX,this.currentHeight=g*this.scaleY,this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var m=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),n=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),o=Math.cos(n+c)*m,p=Math.sin(n+c)*m,q=Math.sin(c),r=Math.cos(c),s=this.getCenterPoint(),t=new fabric.Point(this.currentWidth,this.currentHeight),u=new fabric.Point(s.x-o,s.y-p),v=new fabric.Point(u.x+t.x*r,u.y+t.x*q),w=new fabric.Point(u.x-t.y*q,u.y+t.y*r),x=new fabric.Point(u.x+t.x/2*r,u.y+t.x/2*q),y=e(u),z=e(v),A=e(new fabric.Point(v.x-t.y*q,v.y+t.y*r)),B=e(w),C=e(new fabric.Point(u.x-t.y/2*q,u.y+t.y/2*r)),D=e(x),E=e(new fabric.Point(v.x-t.y/2*q,v.y+t.y/2*r)),F=e(new fabric.Point(w.x+t.x/2*r,w.y+t.x/2*q)),G=e(new fabric.Point(x.x,x.y)),H=Math.cos(n+c)*this.padding*Math.sqrt(2),I=Math.sin(n+c)*this.padding*Math.sqrt(2);return y=y.add(new fabric.Point(-H,-I)),z=z.add(new fabric.Point(I,-H)),A=A.add(new fabric.Point(H,I)),B=B.add(new fabric.Point(-I,H)),C=C.add(new fabric.Point((-H-I)/2,(-I+H)/2)),D=D.add(new fabric.Point((I-H)/2,-(I+H)/2)),E=E.add(new fabric.Point((I+H)/2,(I-H)/2)),F=F.add(new fabric.Point((H-I)/2,(H+I)/2)),G=G.add(new fabric.Point((I-H)/2,-(I+H)/2)),this.oCoords={tl:y,tr:z,br:A,bl:B,ml:C,mt:D,mr:E,mb:F,mtr:G},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var a=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",b="destination-over"===this.fillRule?"evenodd":this.fillRule,c=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",d=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"",f=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",i="undefined"!=typeof this.opacity?this.opacity:"1",j=this.visible?"":" visibility: hidden;",k=this.shadow&&"text"!==this.type?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",c,"; ","stroke-width: ",d,"; ","stroke-dasharray: ",e,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",h,"; ","fill: ",a,"; ","fill-rule: ",b,"; ","opacity: ",i,";",k,j].join("")},getSvgTransform:function(){if(this.group)return"";var a=fabric.util.toFixed,b=this.getAngle(),c=this.getViewportTransform(),d=fabric.util.transformPoint(this.getCenterPoint(),c),e=fabric.Object.NUM_FRACTION_DIGITS,f="path-group"===this.type?"":"translate("+a(d.x,e)+" "+a(d.y,e)+")",g=0!==b?" rotate("+a(b,e)+")":"",h=1===this.scaleX&&1===this.scaleY&&1===c[0]&&1===c[3]?"":" scale("+a(this.scaleX*c[0],e)+" "+a(this.scaleY*c[3],e)+")",i="path-group"===this.type?this.width*c[0]:0,j=this.flipX?" matrix(-1 0 0 1 "+i+" 0) ":"",k="path-group"===this.type?this.height*c[3]:0,l=this.flipY?" matrix(1 0 0 -1 0 "+k+")":"";return[f,g,h,j,l].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+")":""},_createBaseSVGMarkup:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),this.shadow&&a.push(this.shadow.toSVG(this)),a}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this.get(a)!==this.originalState[a]},this)},saveState:function(a){return this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this),a&&a.stateProperties&&a.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var a=fabric.util.degreesToRadians,b=function(){return"undefined"!=typeof G_vmlCanvasManager};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var b,c,d=a.x,e=a.y;for(var f in this.oCoords)if(this.isControlVisible(f)&&("mtr"!==f||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==f&&"mr"!==f&&"mb"!==f&&"ml"!==f)&&(c=this._getImageLines(this.oCoords[f].corner),b=this._findCrossPoints({x:d,y:e},c),0!==b&&b%2===1))return this.__corner=f,f;return!1},_setCornerCoords:function(){var b=this.oCoords,c=a(this.angle),d=a(45-this.angle),e=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,f=e*Math.cos(d),g=e*Math.sin(d),h=Math.sin(c),i=Math.cos(c);b.tl.corner={tl:{x:b.tl.x-g,y:b.tl.y-f},tr:{x:b.tl.x+f,y:b.tl.y-g},bl:{x:b.tl.x-f,y:b.tl.y+g},br:{x:b.tl.x+g,y:b.tl.y+f}},b.tr.corner={tl:{x:b.tr.x-g,y:b.tr.y-f},tr:{x:b.tr.x+f,y:b.tr.y-g},br:{x:b.tr.x+g,y:b.tr.y+f},bl:{x:b.tr.x-f,y:b.tr.y+g}},b.bl.corner={tl:{x:b.bl.x-g,y:b.bl.y-f},bl:{x:b.bl.x-f,y:b.bl.y+g},br:{x:b.bl.x+g,y:b.bl.y+f},tr:{x:b.bl.x+f,y:b.bl.y-g}},b.br.corner={tr:{x:b.br.x+f,y:b.br.y-g},bl:{x:b.br.x-f,y:b.br.y+g},br:{x:b.br.x+g,y:b.br.y+f},tl:{x:b.br.x-g,y:b.br.y-f}},b.ml.corner={tl:{x:b.ml.x-g,y:b.ml.y-f},tr:{x:b.ml.x+f,y:b.ml.y-g},bl:{x:b.ml.x-f,y:b.ml.y+g},br:{x:b.ml.x+g,y:b.ml.y+f}},b.mt.corner={tl:{x:b.mt.x-g,y:b.mt.y-f},tr:{x:b.mt.x+f,y:b.mt.y-g},bl:{x:b.mt.x-f,y:b.mt.y+g},br:{x:b.mt.x+g,y:b.mt.y+f}},b.mr.corner={tl:{x:b.mr.x-g,y:b.mr.y-f},tr:{x:b.mr.x+f,y:b.mr.y-g},bl:{x:b.mr.x-f,y:b.mr.y+g},br:{x:b.mr.x+g,y:b.mr.y+f}},b.mb.corner={tl:{x:b.mb.x-g,y:b.mb.y-f},tr:{x:b.mb.x+f,y:b.mb.y-g},bl:{x:b.mb.x-f,y:b.mb.y+g},br:{x:b.mb.x+g,y:b.mb.y+f}},b.mtr.corner={tl:{x:b.mtr.x-g+h*this.rotatingPointOffset,y:b.mtr.y-f-i*this.rotatingPointOffset},tr:{x:b.mtr.x+f+h*this.rotatingPointOffset,y:b.mtr.y-g-i*this.rotatingPointOffset},bl:{x:b.mtr.x-f+h*this.rotatingPointOffset,y:b.mtr.y+g-i*this.rotatingPointOffset},br:{x:b.mtr.x+g+h*this.rotatingPointOffset,y:b.mtr.y+f-i*this.rotatingPointOffset}}
},drawBorders:function(a){if(!this.hasBorders)return this;var b=this.padding,c=2*b,d=this.getViewportTransform();a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=this.borderColor;var e=1/this._constrainScale(this.scaleX),f=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;var g=this.getWidth(),h=this.getHeight(),i=this.strokeWidth>1?this.strokeWidth:0,j="round"===this.strokeLineCap||"square"===this.strokeLineCap,k="line"===this.type&&1===this.width,l="line"===this.type&&1===this.height,m=j&&l||"line"!==this.type,n=j&&k||"line"!==this.type;k?g=i/e:l&&(h=i/f),m&&(g+=i/e),n&&(h+=i/f);var o=fabric.util.transformPoint(new fabric.Point(g,h),d,!0),p=o.x,q=o.y;if(this.group&&(p*=this.group.scaleX,q*=this.group.scaleY),a.strokeRect(~~(-(p/2)-b)-.5,~~(-(q/2)-b)-.5,~~(p+c)+1,~~(q+c)+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var r=(-q-2*b)/2;a.beginPath(),a.moveTo(0,r),a.lineTo(0,r-this.rotatingPointOffset),a.closePath(),a.stroke()}return a.restore(),this},drawControls:function(a){if(!this.hasControls)return this;var b=this.cornerSize,c=b/2,d=this.getViewportTransform(),e=this.strokeWidth>1?this.strokeWidth:0,f=this.width,g=this.height,h="round"===this.strokeLineCap||"square"===this.strokeLineCap,i="line"===this.type&&1===this.width,j="line"===this.type&&1===this.height,k=h&&j||"line"!==this.type,l=h&&i||"line"!==this.type;i?f=e:j&&(g=e),k&&(f+=e),l&&(g+=e),f*=this.scaleX,g*=this.scaleY;var m=fabric.util.transformPoint(new fabric.Point(f,g),d,!0),n=m.x,o=m.y,p=-(n/2),q=-(o/2),r=this.padding,s=c,t=c-b,u=this.transparentCorners?"strokeRect":"fillRect";return a.save(),a.lineWidth=1,a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=a.fillStyle=this.cornerColor,this._drawControl("tl",a,u,p-s-r,q-s-r),this._drawControl("tr",a,u,p+n-s+r,q-s-r),this._drawControl("bl",a,u,p-s-r,q+o+t+r),this._drawControl("br",a,u,p+n+t+r,q+o+t+r),this.get("lockUniScaling")||(this._drawControl("mt",a,u,p+n/2-s,q-s-r),this._drawControl("mb",a,u,p+n/2-s,q+o+t+r),this._drawControl("mr",a,u,p+n+t+r,q+o/2-s),this._drawControl("ml",a,u,p-s-r,q+o/2-s)),this.hasRotatingPoint&&this._drawControl("mtr",a,u,p+n/2-s,q-this.rotatingPointOffset-this.cornerSize/2-r),a.restore(),this},_drawControl:function(a,c,d,e,f){var g=this.cornerSize;this.isControlVisible(a)&&(b()||this.transparentCorners||c.clearRect(e,f,g,g),c[d](e,f,g,g))},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,b){return this._getControlsVisibility()[a]=b,this},setControlsVisibility:function(a){a||(a={});for(var b in a)this.setControlVisible(b,a[b]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){a.set("left",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxCenterObjectV:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){a.set("top",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxRemove:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){a.set("active",!1)},onChange:function(b){a.set("opacity",b),f.renderAll(),e()},onComplete:function(){f.remove(a),d()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var a,b,c=[];for(a in arguments[0])c.push(a);for(var d=0,e=c.length;e>d;d++)a=c[d],b=d!==e-1,this._animate(a,arguments[0][a],arguments[1],b)}else this._animate.apply(this,arguments);return this},_animate:function(a,b,c,d){var e,f=this;b=b.toString(),c=c?fabric.util.object.clone(c):{},~a.indexOf(".")&&(e=a.split("."));var g=e?this.get(e[0])[e[1]]:this.get(a);"from"in c||(c.from=g),b=~b.indexOf("=")?g+parseFloat(b.replace("=","")):parseFloat(b),fabric.util.animate({startValue:c.from,endValue:b,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(b){e?f[e[0]][e[1]]=b:f.set(a,b),d||c.onChange&&c.onChange()},onComplete:function(){d||(f.setCoords(),c.onComplete&&c.onComplete())}})}}),function(a){"use strict";function b(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,g=b.nearest,h=b.center,i=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(d),this.get(e));case h:return Math.min(this.get(d),this.get(e))+.5*this.get(f);case i:return Math.max(this.get(d),this.get(e))}}}var c=a.fabric||(a.fabric={}),d=c.util.object.extend,e={x1:1,x2:1,y1:1,y2:1},f=c.StaticCanvas.supports("setLineDash");return c.Line?void c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{},a||(a=[0,0,0,0]),this.callSuper("initialize",b),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1)||1,this.height=Math.abs(this.y2-this.y1)||1,this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){return this[a]=b,"undefined"!=typeof e[a]&&this._setWidthHeight(),this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){if(a.beginPath(),b){var c=this.getCenterPoint();a.translate(c.x,c.y)}if(!this.strokeDashArray||this.strokeDashArray&&f){var d=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1;a.moveTo(1===this.width?0:d*this.width/2,1===this.height?0:e*this.height/2),a.lineTo(1===this.width?0:-1*d*this.width/2,1===this.height?0:-1*e*this.height/2)}a.lineWidth=this.strokeWidth;var g=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=g},_renderDashedStroke:function(a){var b=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,e=1===this.width?0:b*this.width/2,f=1===this.height?0:d*this.height/2;a.beginPath(),c.util.drawDashedLine(a,e,f,-e,-f,this.strokeDashArray),a.closePath()},toObject:function(a){return d(this.callSuper("toObject",a),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c="";if(!this.group){var d=-this.width/2-(this.x1>this.x2?this.x2:this.x1),e=-this.height/2-(this.y1>this.y2?this.y2:this.y1);c="translate("+d+", "+e+") "}return b.push("<line ",'x1="',this.x1,'" y1="',this.y1,'" x2="',this.x2,'" y2="',this.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),c,this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),c.Line.fromElement=function(a,b){var e=c.parseAttributes(a,c.Line.ATTRIBUTE_NAMES),f=[e.x1||0,e.y1||0,e.x2||0,e.y2||0];return new c.Line(f,d(e,b))},void(c.Line.fromObject=function(a){var b=[a.x1,a.y1,a.x2,a.y2];return new c.Line(b,a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){return"radius"in a&&a.radius>0}var c=a.fabric||(a.fabric={}),d=2*Math.PI,e=c.util.object.extend;return c.Circle?void c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,initialize:function(a){a=a||{},this.callSuper("initialize",a),this.set("radius",a.radius||0)},_set:function(a,b){return this.callSuper("_set",a,b),"radius"===a&&this.setRadius(b),this},toObject:function(a){return e(this.callSuper("toObject",a),{radius:this.get("radius")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;return this.group&&(c=this.left+this.radius,d=this.top+this.radius),b.push("<circle ",'cx="'+c+'" cy="'+d+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath(),a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,0,d,!1),this._renderFill(a),this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a,this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),c.Circle.fromElement=function(a,d){d||(d={});var f=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!b(f))throw new Error("value of `r` attribute is required and can not be negative");f.left=f.left||0,f.top=f.top||0;var g=new c.Circle(e(f,d));return g.left-=g.radius,g.top-=g.radius,g},void(c.Circle.fromObject=function(a){return new c.Circle(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Triangle?void b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(a){a=a||{},this.callSuper("initialize",a),this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=this.width/2,d=this.height/2;a.beginPath(),b.util.drawDashedLine(a,-c,d,0,-d,this.strokeDashArray),b.util.drawDashedLine(a,0,-d,c,d,this.strokeDashArray),b.util.drawDashedLine(a,c,d,-c,d,this.strokeDashArray),a.closePath()},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.width/2,d=this.height/2,e=[-c+" "+d,"0 "+-d,c+" "+d].join(",");return b.push("<polygon ",'points="',e,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),void(b.Triangle.fromObject=function(a){return new b.Triangle(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=2*Math.PI,d=b.util.object.extend;return b.Ellipse?void b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{},this.callSuper("initialize",a),this.set("rx",a.rx||0),this.set("ry",a.ry||0),this.set("width",2*this.get("rx")),this.set("height",2*this.get("ry"))},toObject:function(a){return d(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;return this.group&&(c=this.left+this.rx,d=this.top+this.ry),b.push("<ellipse ",'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath(),a.save(),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,c,!1),a.restore(),this._renderFill(a),this._renderStroke(a)},complexity:function(){return 1}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),b.Ellipse.fromElement=function(a,c){c||(c={});var e=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0;var f=new b.Ellipse(d(e,c));return f.top-=f.ry,f.left-=f.rx,f},void(b.Ellipse.fromObject=function(a){return new b.Ellipse(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Rect)return void console.warn("fabric.Rect is already defined");var d=b.Object.prototype.stateProperties.concat();d.push("rx","ry","x","y"),b.Rect=b.util.createClass(b.Object,{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{},this.callSuper("initialize",a),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===this.width&&1===this.height)return void a.fillRect(0,0,1,1);var c=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,f=this.height,g=b?this.left:0,h=b?this.top:0,i=0!==c||0!==d,j=.4477152502;a.beginPath(),b||a.translate(-this.width/2,-this.height/2),a.moveTo(g+c,h),a.lineTo(g+e-c,h),i&&a.bezierCurveTo(g+e-j*c,h,g+e,h+j*d,g+e,h+d),a.lineTo(g+e,h+f-d),i&&a.bezierCurveTo(g+e,h+f-j*d,g+e-j*c,h+f,g+e-c,h+f),a.lineTo(g+c,h+f),i&&a.bezierCurveTo(g+j*c,h+f,g,h+f-j*d,g,h+f-d),a.lineTo(g,h+d),i&&a.bezierCurveTo(g,h+j*d,g+j*c,h,g+c,h),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=-this.width/2,d=-this.height/2,e=this.width,f=this.height;a.beginPath(),b.util.drawDashedLine(a,c,d,c+e,d,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d,c+e,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d+f,c,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c,d+f,c,d,this.strokeDashArray),a.closePath()},toObject:function(a){var b=c(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(b),b},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.left,d=this.top;return this.group||(c=-this.width/2,d=-this.height/2),b.push("<rect ",'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,d){if(!a)return null;d=d||{};var e=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);return e.left=e.left||0,e.top=e.top||0,new b.Rect(c(d?b.util.object.clone(d):{},e))},b.Rect.fromObject=function(a){return new b.Rect(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.toFixed;return b.Polyline?void b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,initialize:function(a,b,c){b=b||{},this.set("points",a),this.callSuper("initialize",b),this._calcDimensions(c)},_calcDimensions:function(a){return b.Polygon.prototype._calcDimensions.call(this,a)},toObject:function(a){return b.Polygon.prototype.toObject.call(this,a)},toSVG:function(a){for(var b=[],d=this._createBaseSVGMarkup(),e=0,f=this.points.length;f>e;e++)b.push(c(this.points[e].x,2),",",c(this.points[e].y,2)," ");return d.push("<polyline ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(d.join("")):d.join("")},_render:function(a){var b;a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;d>c;c++)b=this.points[c],a.lineTo(b.x,b.y);this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c,d;a.beginPath();for(var e=0,f=this.points.length;f>e;e++)c=this.points[e],d=this.points[e+1]||c,b.util.drawDashedLine(a,c.x,c.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,c){if(!a)return null;c||(c={});var d=b.parsePointsAttribute(a.getAttribute("points")),e=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);return null===d?null:new b.Polyline(d,b.util.object.extend(e,c),!0)},void(b.Polyline.fromObject=function(a){var c=a.points;return new b.Polyline(c,a,!0)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.toFixed;return b.Polygon?void b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Object,{type:"polygon",points:null,initialize:function(a,b,c){b=b||{},this.points=a,this.callSuper("initialize",b),this._calcDimensions(c)},_calcDimensions:function(a){var b=this.points,c=d(b,"x"),f=d(b,"y"),g=e(b,"x"),h=e(b,"y");if(this.width=g-c||1,this.height=h-f||1,this.minX=c,this.minY=f,!a){var i=this.width/2+this.minX,j=this.height/2+this.minY;this.points.forEach(function(a){a.x-=i,a.y-=j},this)}},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;e>d;d++)b.push(f(this.points[d].x,2),",",f(this.points[d].y,2)," ");return c.push("<polygon ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(c.join("")):c.join("")},_render:function(a){var b;a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;d>c;c++)b=this.points[c],a.lineTo(b.x,b.y);this._renderFill(a),(this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a))},_renderDashedStroke:function(a){var c,d;a.beginPath();for(var e=0,f=this.points.length;f>e;e++)c=this.points[e],d=this.points[e+1]||this.points[0],b.util.drawDashedLine(a,c.x,c.y,d.x,d.y,this.strokeDashArray);a.closePath()},complexity:function(){return this.points.length}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});var e=b.parsePointsAttribute(a.getAttribute("points")),f=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);return null===e?null:new b.Polygon(e,c(f,d),!0)},void(b.Polygon.fromObject=function(a){return new b.Polygon(a.points,a,!0)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){return"H"===a[0]?a[1]:a[a.length-2]}function c(a){return"V"===a[0]?a[1]:a[a.length-1]}var d=a.fabric||(a.fabric={}),e=d.util.array.min,f=d.util.array.max,g=d.util.object.extend,h=Object.prototype.toString,i=d.util.drawArc,j={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},k={m:"l",M:"L"};return d.Path?void d.warn("fabric.Path is already defined"):(d.Path=d.util.createClass(d.Object,{type:"path",path:null,initialize:function(a,b){if(b=b||{},this.setOptions(b),!a)throw new Error("`path` argument is required");var c="[object Array]"===h.call(a);this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(c||(this.path=this._parsePath()),this._initializePath(b),b.sourcePath&&this.setSourcePath(b.sourcePath))},_initializePath:function(a){var b="width"in a&&null!=a.width,c="height"in a&&null!=a.width,d="left"in a,e="top"in a,f=d?this.left:0,h=e?this.top:0;b&&c?(e||(this.top=this.height/2),d||(this.left=this.width/2)):(g(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height)),this.pathOffset=this.pathOffset||this._calculatePathOffset(f,h)},_calculatePathOffset:function(a,b){return{x:this.left-a-this.width/2,y:this.top-b-this.height/2}},_render:function(a,b){var c,d,e,f,g,h=null,j=0,k=0,l=0,m=0,n=0,o=0,p=-(this.width/2+this.pathOffset.x),q=-(this.height/2+this.pathOffset.y);b&&(p+=this.width/2,q+=this.height/2);for(var r=0,s=this.path.length;s>r;++r){switch(c=this.path[r],c[0]){case"l":l+=c[1],m+=c[2],a.lineTo(l+p,m+q);break;case"L":l=c[1],m=c[2],a.lineTo(l+p,m+q);break;case"h":l+=c[1],a.lineTo(l+p,m+q);break;case"H":l=c[1],a.lineTo(l+p,m+q);break;case"v":m+=c[1],a.lineTo(l+p,m+q);break;case"V":m=c[1],a.lineTo(l+p,m+q);break;case"m":l+=c[1],m+=c[2],j=l,k=m,a.moveTo(l+p,m+q);break;case"M":l=c[1],m=c[2],j=l,k=m,a.moveTo(l+p,m+q);break;case"c":d=l+c[5],e=m+c[6],n=l+c[3],o=m+c[4],a.bezierCurveTo(l+c[1]+p,m+c[2]+q,n+p,o+q,d+p,e+q),l=d,m=e;break;case"C":l=c[5],m=c[6],n=c[3],o=c[4],a.bezierCurveTo(c[1]+p,c[2]+q,n+p,o+q,l+p,m+q);break;case"s":d=l+c[3],e=m+c[4],n=n?2*l-n:l,o=o?2*m-o:m,a.bezierCurveTo(n+p,o+q,l+c[1]+p,m+c[2]+q,d+p,e+q),n=l+c[1],o=m+c[2],l=d,m=e;break;case"S":d=c[3],e=c[4],n=2*l-n,o=2*m-o,a.bezierCurveTo(n+p,o+q,c[1]+p,c[2]+q,d+p,e+q),l=d,m=e,n=c[1],o=c[2];break;case"q":d=l+c[3],e=m+c[4],n=l+c[1],o=m+c[2],a.quadraticCurveTo(n+p,o+q,d+p,e+q),l=d,m=e;break;case"Q":d=c[3],e=c[4],a.quadraticCurveTo(c[1]+p,c[2]+q,d+p,e+q),l=d,m=e,n=c[1],o=c[2];break;case"t":d=l+c[1],e=m+c[2],null===h[0].match(/[QqTt]/)?(n=l,o=m):"t"===h[0]?(n=2*l-f,o=2*m-g):"q"===h[0]&&(n=2*l-n,o=2*m-o),f=n,g=o,a.quadraticCurveTo(n+p,o+q,d+p,e+q),l=d,m=e,n=l+c[1],o=m+c[2];break;case"T":d=c[1],e=c[2],n=2*l-n,o=2*m-o,a.quadraticCurveTo(n+p,o+q,d+p,e+q),l=d,m=e;break;case"a":i(a,l+p,m+q,[c[1],c[2],c[3],c[4],c[5],c[6]+l+p,c[7]+m+q]),l+=c[6],m+=c[7];break;case"A":i(a,l+p,m+q,[c[1],c[2],c[3],c[4],c[5],c[6]+p,c[7]+q]),l=c[6],m=c[7];break;case"z":case"Z":l=j,m=k,a.closePath()}h=c}},render:function(a,b){if(this.visible){a.save(),b&&a.translate(-this.width/2,-this.height/2);var c=this.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this._setShadow(a),this.clipTo&&d.util.clipContext(this,a),a.beginPath(),a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity,this._render(a,b),this._renderFill(a),this._renderStroke(a),this.clipTo&&a.restore(),this._removeShadow(a),a.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=g(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(b.sourcePath=this.sourcePath),this.transformMatrix&&(b.transformMatrix=this.transformMatrix),b},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.path=this.sourcePath),delete b.sourcePath,b},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.path.length;e>d;d++)b.push(this.path[d].join(" "));var f=b.join(" ");return c.push("<path ",'d="',f,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a,b,c,d,e,f=[],g=[],h=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,i=0,l=this.path.length;l>i;i++){for(a=this.path[i],d=a.slice(1).trim(),g.length=0;c=h.exec(d);)g.push(c[0]);e=[a.charAt(0)];for(var m=0,n=g.length;n>m;m++)b=parseFloat(g[m]),isNaN(b)||e.push(b);var o=e[0],p=j[o.toLowerCase()],q=k[o]||o;if(e.length-1>p)for(var r=1,s=e.length;s>r;r+=p)f.push([o].concat(e.slice(r,r+p))),o=q;else f.push(e)}return f},_parseDimensions:function(){var a=[],b=[],c={};this.path.forEach(function(d,e){this._getCoordsFromCommand(d,e,a,b,c)},this);var d=e(a),g=e(b),h=f(a),i=f(b),j=h-d,k=i-g,l={left:this.left+(d+j/2),top:this.top+(g+k/2),width:j,height:k};return l},_getCoordsFromCommand:function(a,d,e,f,g){var h=!1;"H"!==a[0]&&(g.x=b(0===d?a:this.path[d-1])),"V"!==a[0]&&(g.y=c(0===d?a:this.path[d-1])),a[0]===a[0].toLowerCase()&&(h=!0);var i,j=this._getXY(a,h,g);i=parseInt(j.x,10),isNaN(i)||e.push(i),i=parseInt(j.y,10),isNaN(i)||f.push(i)},_getXY:function(a,d,e){var f=d?e.x+b(a):"V"===a[0]?e.x:b(a),g=d?e.y+c(a):"H"===a[0]?e.y:c(a);return{x:f,y:g}}}),d.Path.fromObject=function(a,b){"string"==typeof a.path?d.loadSVGFromURL(a.path,function(c){var e=c[0],f=a.path;delete a.path,d.util.object.extend(e,a),e.setSourcePath(f),b(e)}):b(new d.Path(a.path,a))},d.Path.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(["d"]),d.Path.fromElement=function(a,b,c){var e=d.parseAttributes(a,d.Path.ATTRIBUTE_NAMES);b&&b(new d.Path(e.d,g(e,c)))},void(d.Path.async=!0))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.invoke,e=b.Object.prototype.toObject;return b.PathGroup?void b.warn("fabric.PathGroup is already defined"):(b.PathGroup=b.util.createClass(b.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{},this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b),b.widthAttr&&(this.scaleX=b.widthAttr/b.width),b.heightAttr&&(this.scaleY=b.heightAttr/b.height),this.setCoords(),b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(a){if(this.visible){a.save();var c=this.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this.transform(a),this._setShadow(a),this.clipTo&&b.util.clipContext(this,a);for(var d=0,e=this.paths.length;e>d;++d)this.paths[d].render(a,!0);this.clipTo&&a.restore(),this._removeShadow(a),a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){var b=c(e.call(this,a),{paths:d(this.getObjects(),"toObject",a)});return this.sourcePath&&(b.sourcePath=this.sourcePath),b},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.paths=this.sourcePath),b},toSVG:function(a){for(var b=this.getObjects(),c="translate("+this.left+" "+this.top+")",d=["<g ",'style="',this.getSvgStyles(),'" ','transform="',c,this.getSvgTransform(),'" ',">\n"],e=0,f=b.length;f>e;e++)d.push(b[e].toSVG(a));return d.push("</g>\n"),a?a(d.join("")):d.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(a,c){"string"==typeof a.paths?b.loadSVGFromURL(a.paths,function(d){var e=a.paths;delete a.paths;var f=b.util.groupSVGElements(d,a,e);c(f)}):b.util.enlivenObjects(a.paths,function(d){delete a.paths,c(new b.PathGroup(d,a))})},void(b.PathGroup.async=!0))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.array.invoke;if(!b.Group){var g={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",initialize:function(a,b){b=b||{},this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;this.originalState={},this.callSuper("initialize"),this._calcBounds(),this._updateObjectsCoords(),b&&c(this,b),this._setOpacityIfSame(),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop();a.set({originalLeft:b,originalTop:c,left:b-this.left,top:c-this.top}),a.setCoords(),a.__origHasControls=a.hasControls,a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),a&&(this._objects.push(a),a.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(a){a.set("active",!0),a.group=this},removeWithUpdate:function(a){return this._moveFlippedObject(a),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group,a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this._objects.length;for(this[a]=b;c--;)this._objects[c].set(a,b)}else this[a]=b},toObject:function(a){return c(this.callSuper("toObject",a),{objects:f(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save(),this.clipTo&&b.util.clipContext(this,a);for(var c=0,d=this._objects.length;d>c;c++)this._renderObject(this._objects[c],a);this.clipTo&&a.restore(),a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;d>c;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=c)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",originY:"center",left:d.x,top:d.y}),this._toggleFlipping(a);var e=a.getPointByOrigin(b,c);return a.set({originX:b,originY:c,left:e.x,top:e.y}),this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle())),this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){return this._setObjectPosition(a),a.setCoords(),a.hasControls=a.__origHasControls,delete a.__origHasControls,a.set("active",!1),a.setCoords(),delete a.group,this},_setObjectPosition:function(a){var b=this.getLeft(),c=this.getTop(),d=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b+d.left,top:c+d.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(a){a.setCoords()}),this},_setOpacityIfSame:function(){var a=this.getObjects(),b=a[0]?a[0].get("opacity"):1,c=a.every(function(a){return a.get("opacity")===b});c&&(this.opacity=b)},_calcBounds:function(a){for(var b,c=[],d=[],e=0,f=this._objects.length;f>e;++e){b=this._objects[e],b.setCoords();for(var g in b.oCoords)c.push(b.oCoords[g].x),d.push(b.oCoords[g].y)}this.set(this._getBounds(c,d,a))},_getBounds:function(a,c,f){var g=b.util.invertTransform(this.getViewportTransform()),h=b.util.transformPoint(new b.Point(d(a),d(c)),g),i=b.util.transformPoint(new b.Point(e(a),e(c)),g),j={width:i.x-h.x||0,height:i.y-h.y||0};return f||(j.left=(h.x+i.x)/2||0,j.top=(h.y+i.y)/2||0),j},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,d=this._objects.length;d>c;c++)b.push(this._objects[c].toSVG(a));return b.push("</g>\n"),a?a(b.join("")):b.join("")},get:function(a){if(a in g){if(this[a])return this[a];for(var b=0,c=this._objects.length;c>b;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}}),b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects,c&&c(new b.Group(d,a))})},b.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=fabric.util.object.extend;return a.fabric||(a.fabric={}),a.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(a,b){b||(b={}),this.filters=[],this.callSuper("initialize",b),this._initElement(a,b),this._initConfig(b),b.filters&&(this.filters=b.filters,this.applyFilters())
},getElement:function(){return this._element},setElement:function(a,b){return this._element=a,this._originalElement=a,this._initConfig(),0!==this.filters.length&&this.applyFilters(b),this},setCrossOrigin:function(a){return this.crossOrigin=a,this._element.crossOrigin=a,this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save(),this._setStrokeStyles(a),a.beginPath(),a.strokeRect(-this.width/2,-this.height/2,this.width,this.height),a.closePath(),a.restore()},_renderDashedStroke:function(a){var b=-this.width/2,c=-this.height/2,d=this.width,e=this.height;a.save(),this._setStrokeStyles(a),a.beginPath(),fabric.util.drawDashedLine(a,b,c,b+d,c,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c,b+d,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c+e,b,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b,c+e,b,c,this.strokeDashArray),a.closePath(),a.restore()},toObject:function(a){return b(this.callSuper("toObject",a),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(a){var b=[],c=-this.width/2,d=-this.height/2;if(this.group&&(c=this.left,d=this.top),b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',c,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>\n"),this.stroke||this.strokeDashArray){var e=this.fill;this.fill=null,b.push("<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=e}return b.push("</g>\n"),a?a(b.join("")):b.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a){if(this._originalElement){if(0===this.filters.length)return this._element=this._originalElement,void(a&&a());var b=this._originalElement,c=fabric.util.createCanvasElement(),d=fabric.util.createImage(),e=this;return c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(b,0,0,b.width,b.height),this.filters.forEach(function(a){a&&a.applyTo(c)}),d.width=b.width,d.height=b.height,fabric.isLikelyNode?(d.src=c.toBuffer(void 0,fabric.Image.pngCompression),e._element=d,a&&a()):(d.onload=function(){e._element=d,a&&a(),d.onload=c=b=null},d.src=c.toDataURL("image/png")),this}},_render:function(a,b){this._element&&a.drawImage(this._element,b?this.left:-this.width/2,b?this.top:-this.height/2,this.width,this.height),this._renderStroke(a)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width),this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,b){a.filters&&a.filters.length?fabric.util.enlivenObjects(a.filters,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0,this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c){fabric.Image.prototype._initFilters.call(a,a,function(d){a.filters=d||[];var e=new fabric.Image(c,a);b&&b(e)})},null,a.crossOrigin)},fabric.Image.fromURL=function(a,b,c){fabric.util.loadImage(a,function(a){b(new fabric.Image(a,c))},null,c&&c.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" ")),fabric.Image.fromElement=function(a,c,d){var e=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],c,b(d?fabric.util.object.clone(d):{},e))},fabric.Image.async=!0,void(fabric.Image.pngCompression=1))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(a){a=a||{};var b=function(){},c=a.onComplete||b,d=a.onChange||b,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){e.setAngle(a),d()},onComplete:function(){e.setCoords(),c()},onStart:function(){e.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.renderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Brightness=b.util.createClass(b.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{},this.brightness=a.brightness||0},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.brightness,f=0,g=d.length;g>f;f+=4)d[f]+=e,d[f+1]+=e,d[f+2]+=e;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}}),b.Image.filters.Brightness.fromObject=function(a){return new b.Image.filters.Brightness(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Convolute=b.util.createClass(b.Image.filters.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{},this.opaque=a.opaque,this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0];var c=b.util.createCanvasElement();this.tmpCtx=c.getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,b)},applyTo:function(a){for(var b=this.matrix,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=Math.round(Math.sqrt(b.length)),f=Math.floor(e/2),g=d.data,h=d.width,i=d.height,j=h,k=i,l=this._createImageData(j,k),m=l.data,n=this.opaque?1:0,o=0;k>o;o++)for(var p=0;j>p;p++){for(var q=o,r=p,s=4*(o*j+p),t=0,u=0,v=0,w=0,x=0;e>x;x++)for(var y=0;e>y;y++){var z=q+x-f,A=r+y-f;if(!(0>z||z>i||0>A||A>h)){var B=4*(z*h+A),C=b[x*e+y];t+=g[B]*C,u+=g[B+1]*C,v+=g[B+2]*C,w+=g[B+3]*C}}m[s]=t,m[s+1]=u,m[s+2]=v,m[s+3]=w+n*(255-w)}c.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),b.Image.filters.Convolute.fromObject=function(a){return new b.Image.filters.Convolute(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.GradientTransparency=b.util.createClass(b.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{},this.threshold=a.threshold||100},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.threshold,f=d.length,g=0,h=d.length;h>g;g+=4)d[g+3]=e+255*(f-g)/f;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}}),b.Image.filters.GradientTransparency.fromObject=function(a){return new b.Image.filters.GradientTransparency(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.Grayscale=b.util.createClass(b.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=d.width*d.height*4,g=0;f>g;)b=(e[g]+e[g+1]+e[g+2])/3,e[g]=b,e[g+1]=b,e[g+2]=b,g+=4;c.putImageData(d,0,0)}}),b.Image.filters.Grayscale.fromObject=function(){return new b.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.Invert=b.util.createClass(b.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=e.length;for(b=0;f>b;b+=4)e[b]=255-e[b],e[b+1]=255-e[b+1],e[b+2]=255-e[b+2];c.putImageData(d,0,0)}}),b.Image.filters.Invert.fromObject=function(){return new b.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Mask=b.util.createClass(b.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{},this.mask=a.mask,this.channel=[0,1,2,3].indexOf(a.channel)>-1?a.channel:0},applyTo:function(a){if(this.mask){var c,d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data,g=this.mask.getElement(),h=b.util.createCanvasElement(),i=this.channel,j=e.width*e.height*4;h.width=g.width,h.height=g.height,h.getContext("2d").drawImage(g,0,0,g.width,g.height);var k=h.getContext("2d").getImageData(0,0,g.width,g.height),l=k.data;for(c=0;j>c;c+=4)f[c+3]=l[c+i];d.putImageData(e,0,0)}},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),b.Image.filters.Mask.fromObject=function(a,c){b.util.loadImage(a.mask.src,function(d){a.mask=new b.Image(d,a.mask),c&&c(new b.Image.filters.Mask(a))})},b.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Noise=b.util.createClass(b.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{},this.noise=a.noise||0},applyTo:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=this.noise,g=0,h=e.length;h>g;g+=4)b=(.5-Math.random())*f,e[g]+=b,e[g+1]+=b,e[g+2]+=b;c.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),b.Image.filters.Noise.fromObject=function(a){return new b.Image.filters.Noise(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Pixelate=b.util.createClass(b.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{},this.blocksize=a.blocksize||4},applyTo:function(a){var b,c,d,e,f,g,h,i=a.getContext("2d"),j=i.getImageData(0,0,a.width,a.height),k=j.data,l=j.height,m=j.width;for(c=0;l>c;c+=this.blocksize)for(d=0;m>d;d+=this.blocksize){b=4*c*m+4*d,e=k[b],f=k[b+1],g=k[b+2],h=k[b+3];for(var n=c,o=c+this.blocksize;o>n;n++)for(var p=d,q=d+this.blocksize;q>p;p++)b=4*n*m+4*p,k[b]=e,k[b+1]=f,k[b+2]=g,k[b+3]=h}i.putImageData(j,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}}),b.Image.filters.Pixelate.fromObject=function(a){return new b.Image.filters.Pixelate(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.RemoveWhite=b.util.createClass(b.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{},this.threshold=a.threshold||30,this.distance=a.distance||20},applyTo:function(a){for(var b,c,d,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),g=f.data,h=this.threshold,i=this.distance,j=255-h,k=Math.abs,l=0,m=g.length;m>l;l+=4)b=g[l],c=g[l+1],d=g[l+2],b>j&&c>j&&d>j&&k(b-c)<i&&k(b-d)<i&&k(c-d)<i&&(g[l+3]=1);e.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),b.Image.filters.RemoveWhite.fromObject=function(a){return new b.Image.filters.RemoveWhite(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.Sepia=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(a){var b,c,d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data,g=f.length;for(b=0;g>b;b+=4)c=.3*f[b]+.59*f[b+1]+.11*f[b+2],f[b]=c+100,f[b+1]=c+50,f[b+2]=c+255;d.putImageData(e,0,0)}}),b.Image.filters.Sepia.fromObject=function(){return new b.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.Sepia2=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var b,c,d,e,f=a.getContext("2d"),g=f.getImageData(0,0,a.width,a.height),h=g.data,i=h.length;for(b=0;i>b;b+=4)c=h[b],d=h[b+1],e=h[b+2],h[b]=(.393*c+.769*d+.189*e)/1.351,h[b+1]=(.349*c+.686*d+.168*e)/1.203,h[b+2]=(.272*c+.534*d+.131*e)/2.14;f.putImageData(g,0,0)}}),b.Image.filters.Sepia2.fromObject=function(){return new b.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Tint=b.util.createClass(b.Image.filters.BaseFilter,{type:"Tint",initialize:function(a){a=a||{},this.color=a.color||"#000000",this.opacity="undefined"!=typeof a.opacity?a.opacity:new b.Color(this.color).getAlpha()},applyTo:function(a){var c,d,e,f,g,h,i,j,k,l=a.getContext("2d"),m=l.getImageData(0,0,a.width,a.height),n=m.data,o=n.length;for(k=new b.Color(this.color).getSource(),d=k[0]*this.opacity,e=k[1]*this.opacity,f=k[2]*this.opacity,j=1-this.opacity,c=0;o>c;c+=4)g=n[c],h=n[c+1],i=n[c+2],n[c]=d+g*j,n[c+1]=e+h*j,n[c+2]=f+i*j;l.putImageData(m,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),b.Image.filters.Tint.fromObject=function(a){return new b.Image.filters.Tint(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Multiply=b.util.createClass(b.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{},this.color=a.color||"#000000"},applyTo:function(a){var c,d,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),g=f.data,h=g.length;for(d=new b.Color(this.color).getSource(),c=0;h>c;c+=4)g[c]*=d[0]/255,g[c+1]*=d[1]/255,g[c+2]*=d[2]/255;e.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}}),b.Image.filters.Multiply.fromObject=function(a){return new b.Image.filters.Multiply(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric;b.Image.filters.Blend=b.util.createClass({type:"Blend",initialize:function(a){a=a||{},this.color=a.color||"#000",this.image=a.image||!1,this.mode=a.mode||"multiply",this.alpha=a.alpha||1},applyTo:function(a){var c,d,e,f,g,h,i,j=a.getContext("2d"),k=j.getImageData(0,0,a.width,a.height),l=k.data,m=!1;if(this.image){m=!0;var n=b.util.createCanvasElement();n.width=this.image.width,n.height=this.image.height;var o=new b.StaticCanvas(n);o.add(this.image);var p=o.getContext("2d");i=p.getImageData(0,0,o.width,o.height).data}else i=new b.Color(this.color).getSource(),c=i[0]*this.alpha,d=i[1]*this.alpha,e=i[2]*this.alpha;for(var q=0,r=l.length;r>q;q+=4)switch(f=l[q],g=l[q+1],h=l[q+2],m&&(c=i[q]*this.alpha,d=i[q+1]*this.alpha,e=i[q+2]*this.alpha),this.mode){case"multiply":l[q]=f*c/255,l[q+1]=g*d/255,l[q+2]=h*e/255;break;case"screen":l[q]=1-(1-f)*(1-c),l[q+1]=1-(1-g)*(1-d),l[q+2]=1-(1-h)*(1-e);break;case"add":l[q]=Math.min(255,f+c),l[q+1]=Math.min(255,g+d),l[q+2]=Math.min(255,h+e);break;case"diff":case"difference":l[q]=Math.abs(f-c),l[q+1]=Math.abs(g-d),l[q+2]=Math.abs(h-e);break;case"subtract":var s=f-c,t=g-d,u=h-e;l[q]=0>s?0:s,l[q+1]=0>t?0:t,l[q+2]=0>u?0:u;break;case"darken":l[q]=Math.min(f,c),l[q+1]=Math.min(g,d),l[q+2]=Math.min(h,e);break;case"lighten":l[q]=Math.max(f,c),l[q+1]=Math.max(g,d),l[q+2]=Math.max(h,e)}j.putImageData(k,0,0)}}),b.Image.filters.Blend.fromObject=function(a){return new b.Image.filters.Blend(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.object.clone,e=b.util.toFixed,f=b.StaticCanvas.supports("setLineDash");if(b.Text)return void b.warn("fabric.Text is already defined");var g=b.Object.prototype.stateProperties.concat();g.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:g,stroke:null,shadow:null,initialize:function(a,b){b=b||{},this.text=a,this.__skipDimension=!0,this.setOptions(b),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(){if(!this.__skipDimension){var a=b.util.createCanvasElement();this._render(a.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){"undefined"==typeof Cufon||this.useNative===!0?this._renderViaNative(a):this._renderViaCufon(a)},_renderViaNative:function(a){var c=this.text.split(this._reNewline);this._setTextStyles(a),this.width=this._getTextWidth(a,c),this.height=this._getTextHeight(a,c),this.clipTo&&b.util.clipContext(this,a),this._renderTextBackground(a,c),this._translateForTextAlign(a),this._renderText(a,c),"left"!==this.textAlign&&"justify"!==this.textAlign&&a.restore(),this._renderTextDecoration(a,c),this.clipTo&&a.restore(),this._setBoundaries(a,c),this._totalLineHeight=0},_renderText:function(a,b){a.save(),this._setShadow(a),this._setupFillRule(a),this._renderTextFill(a,b),this._renderTextStroke(a,b),this._restoreFillRule(a),this._removeShadow(a),a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&(a.save(),a.translate("center"===this.textAlign?this.width/2:this.width,0))},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,d=b.length;d>c;c++){var e=this._getLineWidth(a,b[c]),f=this._getLineLeftOffset(e);this._boundaries.push({height:this.fontSize*this.lineHeight,width:e,left:f})}},_setTextStyles:function(a){this._setFillStyles(a),this._setStrokeStyles(a),a.textBaseline="alphabetic",this.skipTextAlign||(a.textAlign=this.textAlign),a.font=this._getFontDeclaration()},_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]||"|").width,d=1,e=b.length;e>d;d++){var f=a.measureText(b[d]).width;f>c&&(c=f)}return c},_renderChars:function(a,b,c,d,e){b[a](c,d,e)},_renderTextLine:function(a,b,c,d,e,f){if(e-=this.fontSize/4,"justify"!==this.textAlign)return void this._renderChars(a,b,c,d,e,f);var g=b.measureText(c).width,h=this.width;if(h>g)for(var i=c.split(/\s+/),j=b.measureText(c.replace(/\s+/g,"")).width,k=h-j,l=i.length-1,m=k/l,n=0,o=0,p=i.length;p>o;o++)this._renderChars(a,b,i[o],d+n,e,f),n+=b.measureText(i[o]).width+m;else this._renderChars(a,b,c,d,e,f)},_getLeftOffset:function(){return b.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a,b){if(this.fill||this._skipFillStrokeCheck){this._boundaries=[];for(var c=0,d=0,e=b.length;e>d;d++){var f=this._getHeightOfLine(a,d,b);c+=f,this._renderTextLine("fillText",a,b[d],this._getLeftOffset(),this._getTopOffset()+c,d)}}},_renderTextStroke:function(a,b){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var c=0;a.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),f&&a.setLineDash(this.strokeDashArray)),a.beginPath();for(var d=0,e=b.length;e>d;d++){var g=this._getHeightOfLine(a,d,b);c+=g,this._renderTextLine("strokeText",a,b[d],this._getLeftOffset(),this._getTopOffset()+c,d)}a.closePath(),a.restore()}},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a),this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor){a.save(),a.fillStyle=this.textBackgroundColor;for(var c=0,d=b.length;d>c;c++)if(""!==b[c]){var e=this._getLineWidth(a,b[c]),f=this._getLineLeftOffset(e);a.fillRect(this._getLeftOffset()+f,this._getTopOffset()+c*this.fontSize*this.lineHeight,e,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_getLineWidth:function(a,b){return"justify"===this.textAlign?this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(c){for(var f=0,g=b.length;g>f;f++){var h=e._getLineWidth(a,b[f]),i=e._getLineLeftOffset(h);a.fillRect(e._getLeftOffset()+i,~~(c+f*e._getHeightOfLine(a,f,b)-d),h,1)}}if(this.textDecoration){var d=this._getTextHeight(a,b)/2,e=this;this.textDecoration.indexOf("underline")>-1&&c(this.fontSize*this.lineHeight),this.textDecoration.indexOf("line-through")>-1&&c(this.fontSize*this.lineHeight-this.fontSize/2),this.textDecoration.indexOf("overline")>-1&&c(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){if(this.visible){a.save(),this._transform(a,b);var c=this.transformMatrix,d=this.group&&"path-group"===this.group.type;d&&a.translate(-this.group.width/2,-this.group.height/2),c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),d&&a.translate(this.left,this.top),this._render(a),a.restore()}},toObject:function(a){var b=c(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(b),b},toSVG:function(a){var b=[],c=this.text.split(this._reNewline),d=this._getSVGLeftTopOffsets(c),e=this._getSVGTextAndBg(d.lineTop,d.textLeft,c),f=this._getSVGShadows(d.lineTop,c);return d.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,this._wrapSVGTextAndBg(b,e,f,d),a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){var b=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,c=-(this.width/2),d=this.useNative?this.fontSize-1:this.height/2-a.length*this.fontSize-this._totalLineHeight;return{textLeft:c+(this.group?this.left:0),textTop:d+(this.group?this.top:0),lineTop:b}},_wrapSVGTextAndBg:function(a,b,c,d){a.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',e(d.textLeft,2)," ",e(d.textTop,2),')">',c.join(""),b.textSpans.join(""),"</text>\n","</g>\n")},_getSVGShadows:function(a,c){var d,f,g=[],h=1;if(!this.shadow||!this._boundaries)return g;for(d=0,f=c.length;f>d;d++)if(""!==c[d]){var i=this._boundaries&&this._boundaries[d]?this._boundaries[d].left:0;g.push('<tspan x="',e(i+h+this.shadow.offsetX,2),0===d||this.useNative?'" y':'" dy','="',e(this.useNative?a*d-this.height/2+this.shadow.offsetY:a+(0===d?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",b.util.string.escapeXml(c[d]),"</tspan>"),h=1}else h++;return g},_getSVGTextAndBg:function(a,b,c){var d=[],e=[],f=1;this._setSVGBg(e);for(var g=0,h=c.length;h>g;g++)""!==c[g]?(this._setSVGTextLineText(c[g],g,d,a,f,e),f=1):f++,this.textBackgroundColor&&this._boundaries&&this._setSVGTextLineBg(e,g,b,a);return{textSpans:d,textBgRects:e}},_setSVGTextLineText:function(a,c,d,f,g){var h=this._boundaries&&this._boundaries[c]?e(this._boundaries[c].left,2):0;d.push('<tspan x="',h,'" ',0===c||this.useNative?"y":"dy",'="',e(this.useNative?f*c-this.height/2:f*g,2),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(a),"</tspan>")},_setSVGTextLineBg:function(a,b,c,d){a.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',e(c+this._boundaries[b].left,2),'" y="',e(d*b-this.height/2,2),'" width="',e(this._boundaries[b].width,2),'" height="',e(this._boundaries[b].height,2),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&this._boundaries&&a.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,2),'" y="',e(-this.height/2,2),'" width="',e(this.width,2),'" height="',e(this.height,2),'"></rect>')},_getFillAttributes:function(a){var c=a&&"string"==typeof a?new b.Color(a):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){"fontFamily"===a&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+b+"$3")),this.callSuper("_set",a,b),a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,c){if(!a)return null;var d=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);c=b.util.object.extend(c?b.util.object.clone(c):{},d),"dx"in d&&(c.left+=d.dx),"dy"in d&&(c.top+=d.dy),"fontSize"in c||(c.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE),c.originX||(c.originX="left");var e=new b.Text(a.textContent,c),f=0;return"left"===e.originX&&(f=e.getWidth()/2),"right"===e.originX&&(f=-e.getWidth()/2),e.set({left:e.getLeft()+f,top:e.getTop()-e.getHeight()/2}),e},b.Text.fromObject=function(a){return new b.Text(a.text,d(a))},b.util.createAccessors(b.Text)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(a,b){this.styles=b?b.styles||{}:{},this.callSuper("initialize",a,b),this.initBehavior(),fabric.IText.instances.push(this),this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles;for(var b in a)for(var c in a[b])for(var d in a[b][c])return!1;return!0},setSelectionStart:function(a){this.selectionStart!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})),this.selectionStart=a,this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=a)},setSelectionEnd:function(a){this.selectionEnd!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})),this.selectionEnd=a,this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=a)},getSelectionStyles:function(a,b){if(2===arguments.length){for(var c=[],d=a;b>d;d++)c.push(this.getSelectionStyles(d));return c}var e=this.get2DCursorLocation(a);return this.styles[e.lineIndex]?this.styles[e.lineIndex][e.charIndex]||{}:{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var b=this.selectionStart;b<this.selectionEnd;b++)this._extendStyles(b,a);return this},_extendStyles:function(a,b){var c=this.get2DCursorLocation(a);this.styles[c.lineIndex]||(this.styles[c.lineIndex]={}),this.styles[c.lineIndex][c.charIndex]||(this.styles[c.lineIndex][c.charIndex]={}),fabric.util.object.extend(this.styles[c.lineIndex][c.charIndex],b)},_render:function(a){this.callSuper("_render",a),this.ctx=a,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var a,b=this.text.split("");this.selectionStart===this.selectionEnd?(a=this._getCursorBoundaries(b,"cursor"),this.renderCursor(a)):(a=this._getCursorBoundaries(b,"selection"),this.renderSelection(b,a))}},get2DCursorLocation:function(a){"undefined"==typeof a&&(a=this.selectionStart);var b=this.text.slice(0,a),c=b.split(this._reNewline);return{lineIndex:c.length-1,charIndex:c[c.length-1].length}},getCurrentCharStyle:function(a,b){var c=this.styles[a]&&this.styles[a][0===b?0:b-1];return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(a,b){return this.styles[a]&&this.styles[a][0===b?0:b-1]&&this.styles[a][0===b?0:b-1].fontSize||this.fontSize},getCurrentCharColor:function(a,b){return this.styles[a]&&this.styles[a][0===b?0:b-1]&&this.styles[a][0===b?0:b-1].fill||this.cursorColor},_getCursorBoundaries:function(a,b){var c=this.get2DCursorLocation(),d=this.text.split(this._reNewline),e=Math.round(this._getLeftOffset()),f=-this.height/2,g=this._getCursorBoundariesOffsets(a,b,c,d);return{left:e,top:f,leftOffset:g.left+g.lineLeft,topOffset:g.top}},_getCursorBoundariesOffsets:function(a,b,c,d){for(var e=0,f=0,g=0,h=0,i="cursor"===b?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(c.lineIndex,c.charIndex):0,j=0;j<this.selectionStart;j++){if("\n"===a[j]){h=0;var k=f+("cursor"===b?1:0);i+=this._getCachedLineHeight(k),f++,g=0}else h+=this._getWidthOfChar(this.ctx,a[j],f,g),g++;e=this._getCachedLineOffset(f,d)}return this._clearCache(),{top:i,left:h,lineLeft:e}},_clearCache:function(){this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},_getCachedLineHeight:function(a){return this.__lineHeights[a]||(this.__lineHeights[a]=this._getHeightOfLine(this.ctx,a))},_getCachedLineWidth:function(a,b){return this.__lineWidths[a]||(this.__lineWidths[a]=this._getWidthOfLine(this.ctx,a,b))},_getCachedLineOffset:function(a,b){var c=this._getCachedLineWidth(a,b);return this.__lineOffsets[a]||(this.__lineOffsets[a]=this._getLineLeftOffset(c))},renderCursor:function(a){var b=this.ctx;b.save();var c=this.get2DCursorLocation(),d=c.lineIndex,e=c.charIndex,f=this.getCurrentCharFontSize(d,e),g=0===d&&0===e?this._getCachedLineOffset(d,this.text.split(this._reNewline)):a.leftOffset;b.fillStyle=this.getCurrentCharColor(d,e),b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,b.fillRect(a.left+g,a.top+a.topOffset,this.cursorWidth/this.scaleX,f),b.restore()},renderSelection:function(a,b){var c=this.ctx;c.save(),c.fillStyle=this.selectionColor;for(var d=this.get2DCursorLocation(this.selectionStart),e=this.get2DCursorLocation(this.selectionEnd),f=d.lineIndex,g=e.lineIndex,h=this.text.split(this._reNewline),i=f;g>=i;i++){var j=this._getCachedLineOffset(i,h)||0,k=this._getCachedLineHeight(i),l=0;
if(i===f)for(var m=0,n=h[i].length;n>m;m++)m>=d.charIndex&&(i!==g||m<e.charIndex)&&(l+=this._getWidthOfChar(c,h[i][m],i,m)),m<d.charIndex&&(j+=this._getWidthOfChar(c,h[i][m],i,m));else if(i>f&&g>i)l+=this._getCachedLineWidth(i,h)||5;else if(i===g)for(var o=0,p=e.charIndex;p>o;o++)l+=this._getWidthOfChar(c,h[i][o],i,o);c.fillRect(b.left+j,b.top+b.topOffset,l,k),b.topOffset+=k}c.restore()},_renderChars:function(a,b,c,d,e,f){if(this.isEmptyStyles())return this._renderCharsFast(a,b,c,d,e);this.skipTextAlign=!0,d-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var g,h=this.text.split(this._reNewline),i=this._getWidthOfLine(b,f,h),j=this._getHeightOfLine(b,f,h),k=this._getLineLeftOffset(i),l=c.split(""),m="";d+=k||0,b.save();for(var n=0,o=l.length;o>=n;n++){g=g||this.getCurrentCharStyle(f,n);var p=this.getCurrentCharStyle(f,n+1);(this._hasStyleChanged(g,p)||n===o)&&(this._renderChar(a,b,f,n-1,m,d,e,j),m="",g=p),m+=l[n]}b.restore()},_renderCharsFast:function(a,b,c,d,e){this.skipTextAlign=!1,"fillText"===a&&this.fill&&this.callSuper("_renderChars",a,b,c,d,e),"strokeText"===a&&this.stroke&&this.callSuper("_renderChars",a,b,c,d,e)},_renderChar:function(a,b,c,d,e,f,g,h){var i,j,k;if(this.styles&&this.styles[c]&&(i=this.styles[c][d])){var l=i.stroke||this.stroke,m=i.fill||this.fill;b.save(),j=this._applyCharStylesGetWidth(b,e,c,d,i),k=this._getHeightOfChar(b,e,c,d),m&&b.fillText(e,f,g),l&&b.strokeText(e,f,g),this._renderCharDecoration(b,i,f,g,j,h,k),b.restore(),b.translate(j,0)}else"strokeText"===a&&this.stroke&&b[a](e,f,g),"fillText"===a&&this.fill&&b[a](e,f,g),j=this._applyCharStylesGetWidth(b,e,c,d),this._renderCharDecoration(b,null,f,g,j,h),b.translate(b.measureText(e).width,0)},_hasStyleChanged:function(a,b){return a.fill!==b.fill||a.fontSize!==b.fontSize||a.textBackgroundColor!==b.textBackgroundColor||a.textDecoration!==b.textDecoration||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth},_renderCharDecoration:function(a,b,c,d,e,f,g){var h=b?b.textDecoration||this.textDecoration:this.textDecoration,i=(b?b.fontSize:null)||this.fontSize;h&&(h.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(a,c,d+this.fontSize/this._fontSizeFraction,e,0,this.fontSize/20),h.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(a,c,d+this.fontSize/this._fontSizeFraction,e,g/2,i/20),h.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(a,c,d,e,f-this.fontSize/this._fontSizeFraction,this.fontSize/20))},_renderCharDecorationAtOffset:function(a,b,c,d,e,f){a.fillRect(b,c-e,d,f)},_renderTextLine:function(a,b,c,d,e,f){e+=this.fontSize/4,this.callSuper("_renderTextLine",a,b,c,d,e,f)},_renderTextDecoration:function(a,b){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",a,b):void 0},_renderTextLinesBackground:function(a,b){if(this.textBackgroundColor||this.styles){a.save(),this.textBackgroundColor&&(a.fillStyle=this.textBackgroundColor);for(var c=0,d=this.fontSize/this._fontSizeFraction,e=0,f=b.length;f>e;e++){var g=this._getHeightOfLine(a,e,b);if(""!==b[e]){var h=this._getWidthOfLine(a,e,b),i=this._getLineLeftOffset(h);if(this.textBackgroundColor&&(a.fillStyle=this.textBackgroundColor,a.fillRect(this._getLeftOffset()+i,this._getTopOffset()+c+d,h,g)),this.styles[e])for(var j=0,k=b[e].length;k>j;j++)if(this.styles[e]&&this.styles[e][j]&&this.styles[e][j].textBackgroundColor){var l=b[e][j];a.fillStyle=this.styles[e][j].textBackgroundColor,a.fillRect(this._getLeftOffset()+i+this._getWidthOfCharsAt(a,e,j,b),this._getTopOffset()+c+d,this._getWidthOfChar(a,l,e,j,b)+1,g)}c+=g}else c+=g}a.restore()}},_getCacheProp:function(a,b){return a+b.fontFamily+b.fontSize+b.fontWeight+b.fontStyle+b.shadow},_applyCharStylesGetWidth:function(b,c,d,e,f){var g=f||this.styles[d]&&this.styles[d][e];g=g?a(g):{},this._applyFontStyles(g);var h=this._getCacheProp(c,g);if(this.isEmptyStyles()&&this._charWidthsCache[h]&&this.caching)return this._charWidthsCache[h];"string"==typeof g.shadow&&(g.shadow=new fabric.Shadow(g.shadow));var i=g.fill||this.fill;return b.fillStyle=i.toLive?i.toLive(b):i,g.stroke&&(b.strokeStyle=g.stroke&&g.stroke.toLive?g.stroke.toLive(b):g.stroke),b.lineWidth=g.strokeWidth||this.strokeWidth,b.font=this._getFontDeclaration.call(g),this._setShadow.call(g,b),this.caching?(this._charWidthsCache[h]||(this._charWidthsCache[h]=b.measureText(c).width),this._charWidthsCache[h]):b.measureText(c).width},_applyFontStyles:function(a){a.fontFamily||(a.fontFamily=this.fontFamily),a.fontSize||(a.fontSize=this.fontSize),a.fontWeight||(a.fontWeight=this.fontWeight),a.fontStyle||(a.fontStyle=this.fontStyle)},_getStyleDeclaration:function(b,c){return this.styles[b]&&this.styles[b][c]?a(this.styles[b][c]):{}},_getWidthOfChar:function(a,b,c,d){var e=this._getStyleDeclaration(c,d);this._applyFontStyles(e);var f=this._getCacheProp(b,e);if(this._charWidthsCache[f]&&this.caching)return this._charWidthsCache[f];if(a){a.save();var g=this._applyCharStylesGetWidth(a,b,c,d);return a.restore(),g}},_getHeightOfChar:function(a,b,c,d){return this.styles[c]&&this.styles[c][d]?this.styles[c][d].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(a,b,c,d){d=d||this.text.split(this._reNewline);var e=d[b].split("")[c];return this._getWidthOfChar(a,e,b,c)},_getHeightOfCharAt:function(a,b,c,d){d=d||this.text.split(this._reNewline);var e=d[b].split("")[c];return this._getHeightOfChar(a,e,b,c)},_getWidthOfCharsAt:function(a,b,c,d){for(var e=0,f=0;c>f;f++)e+=this._getWidthOfCharAt(a,b,f,d);return e},_getWidthOfLine:function(a,b,c){return this._getWidthOfCharsAt(a,b,c[b].length,c)},_getTextWidth:function(a,b){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",a,b);for(var c=this._getWidthOfLine(a,0,b),d=1,e=b.length;e>d;d++){var f=this._getWidthOfLine(a,d,b);f>c&&(c=f)}return c},_getHeightOfLine:function(a,b,c){c=c||this.text.split(this._reNewline);for(var d=this._getHeightOfChar(a,c[b][0],b,0),e=c[b],f=e.split(""),g=1,h=f.length;h>g;g++){var i=this._getHeightOfChar(a,f[g],b,g);i>d&&(d=i)}return d*this.lineHeight},_getTextHeight:function(a,b){for(var c=0,d=0,e=b.length;e>d;d++)c+=this._getHeightOfLine(a,d,b);return c},_getTopOffset:function(){var a=fabric.Text.prototype._getTopOffset.call(this);return a-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),a.restore())},toObject:function(b){return fabric.util.object.extend(this.callSuper("toObject",b),{styles:a(this.styles)})}}),fabric.IText.fromObject=function(b){return new fabric.IText(b.text,a(b))},fabric.IText.instances=[]}(),function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var a=this;setTimeout(function(){a.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers())})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers.call()}),this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(a){a.__isMousedown=!1})}),this.canvas.on("object:selected",function(a){fabric.IText.prototype.exitEditingOnOthers.call(a.target)})},_tick:function(){if(!this._abortCursorAnimation){var a=this;this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){a._onTickComplete()},onChange:function(){a.canvas&&a.canvas.renderAll()},abort:function(){return a._abortCursorAnimation}})}},_onTickComplete:function(){if(!this._abortCursorAnimation){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){a.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){a._tick()},onChange:function(){a.canvas&&a.canvas.renderAll()},abort:function(){return a._abortCursorAnimation}})},100)}},initDelayedCursor:function(a){var b=this,c=a?0:this.cursorDelay;a&&(this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){b._abortCursorAnimation=!1,b._tick()},c)},abortCursorAnimation:function(){this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.renderAll();var a=this;setTimeout(function(){a._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(a){var b=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)b++,c--;for(;/\S/.test(this.text.charAt(c))&&c>-1;)b++,c--;return a-b},findWordBoundaryRight:function(a){var b=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)b++,c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)b++,c++;return a+b},findLineBoundaryLeft:function(a){for(var b=0,c=a-1;!/\n/.test(this.text.charAt(c))&&c>-1;)b++,c--;return a-b},findLineBoundaryRight:function(a){for(var b=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)b++,c++;return a+b},getNumNewLinesInSelectedText:function(){for(var a=this.getSelectedText(),b=0,c=0,d=a.split(""),e=d.length;e>c;c++)"\n"===d[c]&&b++;return b},searchWordBoundary:function(a,b){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,d=this.text.charAt(c),e=/[ \n\.,;!\?\-]/;!e.test(d)&&c>0&&c<this.text.length;)c+=b,d=this.text.charAt(c);return e.test(d)&&"\n"!==d&&(c+=1===b?0:1),c},selectWord:function(a){var b=this.searchWordBoundary(a,-1),c=this.searchWordBoundary(a,1);this.setSelectionStart(b),this.setSelectionEnd(c),this.initDelayedCursor(!0)},selectLine:function(a){var b=this.findLineBoundaryLeft(a),c=this.findLineBoundaryRight(a);this.setSelectionStart(b),this.setSelectionEnd(c),this.initDelayedCursor(!0)},enterEditing:function(){return!this.isEditing&&this.editable?(this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this):void 0},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){var a=this.text.split(this._reNewline);for(var b in this.styles)a[b]||delete this.styles[b]},_removeCharsFromTo:function(a,b){for(var c=b;c!==a;){var d=this.get2DCursorLocation(c).charIndex;c--;var e=this.get2DCursorLocation(c).charIndex,f=e>d;f?this.removeStyleObject(f,c+1):this.removeStyleObject(0===this.get2DCursorLocation(c).charIndex,c)}this.text=this.text.slice(0,a)+this.text.slice(b)},insertChars:function(a){var b="\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd&&this.insertStyleObjects(a,b,this.copiedStyles),this.selectionStart+=a.length,this.selectionEnd=this.selectionStart,this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(b,c,d){this.shiftLineStyles(b,1),this.styles[b+1]||(this.styles[b+1]={});var e=this.styles[b][c-1],f={};if(d)f[0]=a(e),this.styles[b+1]=f;else{for(var g in this.styles[b])parseInt(g,10)>=c&&(f[parseInt(g,10)-c]=this.styles[b][g],delete this.styles[b][g]);this.styles[b+1]=f}},insertCharStyleObject:function(b,c,d){var e=this.styles[b],f=a(e);0!==c||d||(c=1);for(var g in f){var h=parseInt(g,10);h>=c&&(e[h+1]=f[h])}this.styles[b][c]=d||a(e[c-1])},insertStyleObjects:function(a,b,c){if(!this.isEmptyStyles()){var d=this.get2DCursorLocation(),e=d.lineIndex,f=d.charIndex;this.styles[e]||(this.styles[e]={}),"\n"===a?this.insertNewlineStyleObject(e,f,b):c?this._insertStyles(c):this.insertCharStyleObject(e,f)}},_insertStyles:function(a){for(var b=0,c=a.length;c>b;b++){var d=this.get2DCursorLocation(this.selectionStart+b),e=d.lineIndex,f=d.charIndex;this.insertCharStyleObject(e,f,a[b])}},shiftLineStyles:function(b,c){var d=a(this.styles);for(var e in this.styles){var f=parseInt(e,10);f>b&&(this.styles[f+c]=d[f])}},removeStyleObject:function(b,c){var d=this.get2DCursorLocation(c),e=d.lineIndex,f=d.charIndex;if(b){var g=this.text.split(this._reNewline),h=g[e-1],i=h?h.length:0;this.styles[e-1]||(this.styles[e-1]={});for(f in this.styles[e])this.styles[e-1][parseInt(f,10)+i]=this.styles[e][f];this.shiftLineStyles(e,-1)}else{var j=this.styles[e];if(j){var k=this.selectionStart===this.selectionEnd?-1:0;delete j[f+k]}var l=a(j);for(var m in l){var n=parseInt(m,10);n>=f&&0!==n&&(j[n-1]=l[n],delete j[n])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(a){this.__newClickTime=+new Date;var b=this.canvas.getPointer(a.e);this.isTripleClick(b)?(this.fire("tripleclick",a),this._stopEvent(a.e)):this.isDoubleClick(b)&&(this.fire("dblclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=b,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y&&this.__lastIsEditing},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMousemoveHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))}),this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},initMousedownHandler:function(){this.on("mousedown",function(a){var b=this.canvas.getPointer(a.e);this.__mousedownX=b.x,this.__mousedownY=b.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(a.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},initMousemoveHandler:function(){this.on("mousemove",function(a){if(this.__isMousedown&&this.isEditing){var b=this.getSelectionStartFromPointer(a.e);b>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(b)):(this.setSelectionStart(b),this.setSelectionEnd(this.__selectionStartOnMouseDown))}})},_isObjectMoved:function(a){var b=this.canvas.getPointer(a);return this.__mousedownX!==b.x||this.__mousedownY!==b.y},initMouseupHandler:function(){this.on("mouseup",function(a){this.__isMousedown=!1,this._isObjectMoved(a.e)||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(a){var b=this.getSelectionStartFromPointer(a);a.shiftKey?b<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(b)):this.setSelectionEnd(b):(this.setSelectionStart(b),this.setSelectionEnd(b))},_getLocalRotatedPointer:function(a){var b=this.canvas.getPointer(a),c=new fabric.Point(b.x,b.y),d=new fabric.Point(this.left,this.top),e=fabric.util.rotatePoint(c,d,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(a,e)},getSelectionStartFromPointer:function(a){for(var b,c=this._getLocalRotatedPointer(a),d=this.text.split(this._reNewline),e=0,f=0,g=0,h=0,i=0,j=d.length;j>i;i++){g+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var k=this._getWidthOfLine(this.ctx,i,d),l=this._getLineLeftOffset(k);f=l*this.scaleX,this.flipX&&(d[i]=d[i].split("").reverse().join(""));for(var m=0,n=d[i].length;n>m;m++){var o=d[i][m];if(e=f,f+=this._getWidthOfChar(this.ctx,o,i,this.flipX?n-m:m)*this.scaleX,!(g<=c.y||f<=c.x))return this._getNewSelectionStartFromOffset(c,e,f,h+i,n);h++}if(c.y<g)return this._getNewSelectionStartFromOffset(c,e,f,h+i,n)}return"undefined"==typeof b?this.text.length:void 0},_getNewSelectionStartFromOffset:function(a,b,c,d,e){var f=a.x-b,g=c-a.x,h=g>f?0:1,i=d+h;return this.flipX&&(i=e-i),i>this.text.length&&(i=this.text.length),i}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){if(a.keyCode in this._keysMap&&0===a.charCode)this[this._keysMap[a.keyCode]](a);else{if(!(a.keyCode in this._ctrlKeysMap&&(a.ctrlKey||a.metaKey)))return;this[this._ctrlKeysMap[a.keyCode]](a)}a.stopPropagation(),this.canvas&&this.canvas.renderAll()}},forwardDelete:function(a){this.selectionStart===this.selectionEnd&&this.moveCursorRight(a),this.removeChars(a)},copy:function(a){var b=this.getSelectedText(),c=this._getClipboardData(a);c&&c.setData("text",b),this.copiedText=b,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(a){var b=null,c=this._getClipboardData(a);b=c?c.getData("text"):this.copiedText,b&&this.insertChars(b)},cut:function(a){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(a))},_getClipboardData:function(a){return a&&(a.clipboardData||fabric.window.clipboardData)},onKeyPress:function(a){!this.isEditing||a.metaKey||a.ctrlKey||a.keyCode in this._keysMap&&0===a.charCode||(this.insertChars(String.fromCharCode(a.which)),a.stopPropagation())},getDownCursorOffset:function(a,b){var c,d,e=b?this.selectionEnd:this.selectionStart,f=this.text.split(this._reNewline),g=this.text.slice(0,e),h=this.text.slice(e),i=g.slice(g.lastIndexOf("\n")+1),j=h.match(/(.*)\n?/)[1],k=(h.match(/.*\n(.*)\n?/)||{})[1]||"",l=this.get2DCursorLocation(e);if(l.lineIndex===f.length-1||a.metaKey)return this.text.length-e;var m=this._getWidthOfLine(this.ctx,l.lineIndex,f);d=this._getLineLeftOffset(m);for(var n=d,o=l.lineIndex,p=0,q=i.length;q>p;p++)c=i[p],n+=this._getWidthOfChar(this.ctx,c,o,p);var r=this._getIndexOnNextLine(l,k,n,f);return j.length+1+r},_getIndexOnNextLine:function(a,b,c,d){for(var e,f=a.lineIndex+1,g=this._getWidthOfLine(this.ctx,f,d),h=this._getLineLeftOffset(g),i=h,j=0,k=0,l=b.length;l>k;k++){var m=b[k],n=this._getWidthOfChar(this.ctx,m,f,k);if(i+=n,i>c){e=!0;var o=i-n,p=i,q=Math.abs(o-c),r=Math.abs(p-c);j=q>r?k+1:k;break}}return e||(j=b.length),j},moveCursorDown:function(a){this.abortCursorAnimation(),this._currentCursorOpacity=1;var b=this.getDownCursorOffset(a,"right"===this._selectionDirection);a.shiftKey?this.moveCursorDownWithShift(b):this.moveCursorDownWithoutShift(b),this.initDelayedCursor()},moveCursorDownWithoutShift:function(a){this._selectionDirection="right",this.selectionStart+=a,this.selectionStart>this.text.length&&(this.selectionStart=this.text.length),this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(a){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?(this.selectionStart+=a,void(this._selectionDirection="left")):(this._selectionDirection="right",this.selectionEnd+=a,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),void 0)},getUpCursorOffset:function(a,b){var c=b?this.selectionEnd:this.selectionStart,d=this.get2DCursorLocation(c);if(0===d.lineIndex||a.metaKey)return c;for(var e,f=this.text.slice(0,c),g=f.slice(f.lastIndexOf("\n")+1),h=(f.match(/\n?(.*)\n.*$/)||{})[1]||"",i=this.text.split(this._reNewline),j=this._getWidthOfLine(this.ctx,d.lineIndex,i),k=this._getLineLeftOffset(j),l=k,m=d.lineIndex,n=0,o=g.length;o>n;n++)e=g[n],l+=this._getWidthOfChar(this.ctx,e,m,n);var p=this._getIndexOnPrevLine(d,h,l,i);return h.length-p+g.length},_getIndexOnPrevLine:function(a,b,c,d){for(var e,f=a.lineIndex-1,g=this._getWidthOfLine(this.ctx,f,d),h=this._getLineLeftOffset(g),i=h,j=0,k=0,l=b.length;l>k;k++){var m=b[k],n=this._getWidthOfChar(this.ctx,m,f,k);if(i+=n,i>c){e=!0;var o=i-n,p=i,q=Math.abs(o-c),r=Math.abs(p-c);j=q>r?k:k-1;break}}return e||(j=b.length-1),j},moveCursorUp:function(a){this.abortCursorAnimation(),this._currentCursorOpacity=1;var b=this.getUpCursorOffset(a,"right"===this._selectionDirection);a.shiftKey?this.moveCursorUpWithShift(b):this.moveCursorUpWithoutShift(b),this.initDelayedCursor()},moveCursorUpWithShift:function(a){if(this.selectionStart===this.selectionEnd)this.selectionStart-=a;else{if("right"===this._selectionDirection)return this.selectionEnd-=a,void(this._selectionDirection="right");this.selectionStart-=a}this.selectionStart<0&&(this.selectionStart=0),this._selectionDirection="left"},moveCursorUpWithoutShift:function(a){this.selectionStart===this.selectionEnd&&(this.selectionStart-=a),this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd=this.selectionStart,this._selectionDirection="left"},moveCursorLeft:function(a){(0!==this.selectionStart||0!==this.selectionEnd)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,a.shiftKey?this.moveCursorLeftWithShift(a):this.moveCursorLeftWithoutShift(a),this.initDelayedCursor())},_move:function(a,b,c){a.altKey?this[b]=this["findWordBoundary"+c](this[b]):a.metaKey?this[b]=this["findLineBoundary"+c](this[b]):this[b]+="Left"===c?-1:1},_moveLeft:function(a,b){this._move(a,b,"Left")},_moveRight:function(a,b){this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(a,"selectionStart"),this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(a){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(a,"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.selectionStart--,this.selectionStart<0&&(this.selectionStart=0))},moveCursorRight:function(a){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,a.shiftKey?this.moveCursorRightWithShift(a):this.moveCursorRightWithoutShift(a),this.initDelayedCursor())},moveCursorRightWithShift:function(a){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):(this._selectionDirection="right",this._moveRight(a,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(a){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(a){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(a):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.selectionEnd=this.selectionStart,this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(a){if(0!==this.selectionStart)if(a.metaKey){var b=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(b,this.selectionStart),this.selectionStart=b}else if(a.altKey){var c=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(c,this.selectionStart),this.selectionStart=c}else{var d="\n"===this.text.slice(this.selectionStart-1,this.selectionStart);this.removeStyleObject(d),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(a,b,c,d,e,f){this.styles[b]?this._setSVGTextLineChars(a,b,c,d,e,f):this.callSuper("_setSVGTextLineText",a,b,c,d,e)},_setSVGTextLineChars:function(a,b,c,d,e,f){for(var g=0===b||this.useNative?"y":"dy",h=a.split(""),i=0,j=this._getSVGLineLeftOffset(b),k=this._getSVGLineTopOffset(b),l=this._getHeightOfLine(this.ctx,b),m=0,n=h.length;n>m;m++){var o=this.styles[b][m]||{};c.push(this._createTextCharSpan(h[m],o,j,k,g,i));var p=this._getWidthOfChar(this.ctx,h[m],b,m);o.textBackgroundColor&&f.push(this._createTextCharBg(o,j,k,l,p,i)),i+=p}},_getSVGLineLeftOffset:function(a){return this._boundaries&&this._boundaries[a]?fabric.util.toFixed(this._boundaries[a].left,2):0},_getSVGLineTopOffset:function(a){for(var b=0,c=0;a>=c;c++)b+=this._getHeightOfLine(this.ctx,c);return b-this.height/2},_createTextCharBg:function(a,b,c,d,e,f){return['<rect fill="',a.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+d,")",'" x="',b+f,'" y="',c+d,'" width="',e,'" height="',d,'"></rect>'].join("")},_createTextCharSpan:function(a,b,c,d,e,f){var g=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},b));return['<tspan x="',c+f,'" ',e,'="',d,'" ',b.fontFamily?'font-family="'+b.fontFamily.replace(/"/g,"'")+'" ':"",b.fontSize?'font-size="'+b.fontSize+'" ':"",b.fontStyle?'font-style="'+b.fontStyle+'" ':"",b.fontWeight?'font-weight="'+b.fontWeight+'" ':"",b.textDecoration?'text-decoration="'+b.textDecoration+'" ':"",'style="',g,'">',fabric.util.string.escapeXml(a),"</tspan>"].join("")}}),function(){function request(a,b,c){var d=URL.parse(a);d.port||(d.port=0===d.protocol.indexOf("https:")?443:80);var e=443===d.port?HTTPS:HTTP,f=e.request({hostname:d.hostname,port:d.port,path:d.path,method:"GET"},function(a){var d="";b&&a.setEncoding(b),a.on("end",function(){c(d)}),a.on("data",function(b){200===a.statusCode&&(d+=b)})});f.on("error",function(a){fabric.log(a.errno===process.ECONNREFUSED?"ECONNREFUSED: connection refused to "+d.hostname+":"+d.port:a.message)}),f.end()}function requestFs(a,b){var c=require("fs");c.readFile(a,function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(a,b,c){function d(d){e.src=new Buffer(d,"binary"),e._src=a,b&&b.call(c,e)}var e=new Image;a&&(a instanceof Buffer||0===a.indexOf("data"))?(e.src=e._src=a,b&&b.call(c,e)):a&&0!==a.indexOf("http")?requestFs(a,d):a?request(a,"binary",d):b&&b.call(c,a)},fabric.loadSVGFromURL=function(a,b,c){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==a.indexOf("http")?requestFs(a,function(a){fabric.loadSVGFromString(a.toString(),b,c)}):request(a,"",function(a){fabric.loadSVGFromString(a,b,c)})},fabric.loadSVGFromString=function(a,b,c){var d=(new DOMParser).parseFromString(a);fabric.parseSVGDocument(d.documentElement,function(a,c){b&&b(a,c)},c)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c){var d=new fabric.Image(c);d._initConfig(a),d._initFilters(a,function(a){d.filters=a||[],b&&b(d)})})},fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas"),f=new Canvas(a||600,b||600,d);e.style={},e.width=f.width,e.height=f.height;var g=fabric.Canvas||fabric.StaticCanvas,h=new g(e,c);return h.contextContainer=f.getContext("2d"),h.nodeCanvas=f,h.Font=Canvas.Font,h},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a,b){return origSetWidth.call(this,a,b),this.nodeCanvas.width=a,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(a,b){return origSetHeight.call(this,a,b),this.nodeCanvas.height=a,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}(),!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.proj4=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;
if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(a,b,d){if(!(this instanceof c))return new c(a,b,d);if(Array.isArray(a))this.x=a[0],this.y=a[1],this.z=a[2]||0;else if("object"==typeof a)this.x=a.x,this.y=a.y,this.z=a.z||0;else if("string"==typeof a&&"undefined"==typeof b){var e=a.split(",");this.x=parseFloat(e[0],10),this.y=parseFloat(e[1],10),this.z=parseFloat(e[2],10)||0}else this.x=a,this.y=b,this.z=d||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var d=a("mgrs");c.fromMGRS=function(a){return new c(d.toPoint(a))},c.prototype.toMGRS=function(a){return d.forward([this.x,this.y],a)},b.exports=c},{mgrs:66}],2:[function(a,b){function c(a,b){if(!(this instanceof c))return new c(a);b=b||function(a){if(a)throw a};var f=d(a);if("object"!=typeof f)return void b(a);var h=g(f),i=c.projections.get(h.projName);i?(e(this,h),e(this,i),this.init(),b(null,this)):b(a)}var d=a("./parseCode"),e=a("./extend"),f=a("./projections"),g=a("./deriveConstants");c.projections=f,c.projections.start(),b.exports=c},{"./deriveConstants":32,"./extend":33,"./parseCode":36,"./projections":38}],3:[function(a,b){b.exports=function(a,b,c){var d,e,f,g=c.x,h=c.y,i=c.z||0;for(f=0;3>f;f++)if(!b||2!==f||void 0!==c.z)switch(0===f?(d=g,e="x"):1===f?(d=h,e="y"):(d=i,e="z"),a.axis[f]){case"e":c[e]=d;break;case"w":c[e]=-d;break;case"n":c[e]=d;break;case"s":c[e]=-d;break;case"u":void 0!==c[e]&&(c.z=d);break;case"d":void 0!==c[e]&&(c.z=-d);break;default:return null}return c}},{}],4:[function(a,b){var c=Math.PI/2,d=a("./sign");b.exports=function(a){return Math.abs(a)<c?a:a-d(a)*Math.PI}},{"./sign":21}],5:[function(a,b){var c=2*Math.PI,d=a("./sign");b.exports=function(a){return Math.abs(a)<Math.PI?a:a-d(a)*c}},{"./sign":21}],6:[function(a,b){b.exports=function(a){return Math.abs(a)>1&&(a=a>1?1:-1),Math.asin(a)}},{}],7:[function(a,b){b.exports=function(a){return 1-.25*a*(1+a/16*(3+1.25*a))}},{}],8:[function(a,b){b.exports=function(a){return.375*a*(1+.25*a*(1+.46875*a))}},{}],9:[function(a,b){b.exports=function(a){return.05859375*a*a*(1+.75*a)}},{}],10:[function(a,b){b.exports=function(a){return a*a*a*(35/3072)}},{}],11:[function(a,b){b.exports=function(a,b,c){var d=b*c;return a/Math.sqrt(1-d*d)}},{}],12:[function(a,b){b.exports=function(a,b,c,d,e){var f,g;f=a/b;for(var h=0;15>h;h++)if(g=(a-(b*f-c*Math.sin(2*f)+d*Math.sin(4*f)-e*Math.sin(6*f)))/(b-2*c*Math.cos(2*f)+4*d*Math.cos(4*f)-6*e*Math.cos(6*f)),f+=g,Math.abs(g)<=1e-10)return f;return 0/0}},{}],13:[function(a,b){var c=Math.PI/2;b.exports=function(a,b){var d=1-(1-a*a)/(2*a)*Math.log((1-a)/(1+a));if(Math.abs(Math.abs(b)-d)<1e-6)return 0>b?-1*c:c;for(var e,f,g,h,i=Math.asin(.5*b),j=0;30>j;j++)if(f=Math.sin(i),g=Math.cos(i),h=a*f,e=Math.pow(1-h*h,2)/(2*g)*(b/(1-a*a)-f/(1-h*h)+.5/a*Math.log((1-h)/(1+h))),i+=e,Math.abs(e)<=1e-10)return i;return 0/0}},{}],14:[function(a,b){b.exports=function(a,b,c,d,e){return a*e-b*Math.sin(2*e)+c*Math.sin(4*e)-d*Math.sin(6*e)}},{}],15:[function(a,b){b.exports=function(a,b,c){var d=a*b;return c/Math.sqrt(1-d*d)}},{}],16:[function(a,b){var c=Math.PI/2;b.exports=function(a,b){for(var d,e,f=.5*a,g=c-2*Math.atan(b),h=0;15>=h;h++)if(d=a*Math.sin(g),e=c-2*Math.atan(b*Math.pow((1-d)/(1+d),f))-g,g+=e,Math.abs(e)<=1e-10)return g;return-9999}},{}],17:[function(a,b){var c=1,d=.25,e=.046875,f=.01953125,g=.01068115234375,h=.75,i=.46875,j=.013020833333333334,k=.007120768229166667,l=.3645833333333333,m=.005696614583333333,n=.3076171875;b.exports=function(a){var b=[];b[0]=c-a*(d+a*(e+a*(f+a*g))),b[1]=a*(h-a*(e+a*(f+a*g)));var o=a*a;return b[2]=o*(i-a*(j+a*k)),o*=a,b[3]=o*(l-a*m),b[4]=o*a*n,b}},{}],18:[function(a,b){var c=a("./pj_mlfn"),d=1e-10,e=20;b.exports=function(a,b,f){for(var g=1/(1-b),h=a,i=e;i;--i){var j=Math.sin(h),k=1-b*j*j;if(k=(c(h,j,Math.cos(h),f)-a)*k*Math.sqrt(k)*g,h-=k,Math.abs(k)<d)return h}return h}},{"./pj_mlfn":19}],19:[function(a,b){b.exports=function(a,b,c,d){return c*=b,b*=b,d[0]*a-c*(d[1]+b*(d[2]+b*(d[3]+b*d[4])))}},{}],20:[function(a,b){b.exports=function(a,b){var c;return a>1e-7?(c=a*b,(1-a*a)*(b/(1-c*c)-.5/a*Math.log((1-c)/(1+c)))):2*b}},{}],21:[function(a,b){b.exports=function(a){return 0>a?-1:1}},{}],22:[function(a,b){b.exports=function(a,b){return Math.pow((1-a)/(1+a),b)}},{}],23:[function(a,b){b.exports=function(a){var b={x:a[0],y:a[1]};return a.length>2&&(b.z=a[2]),a.length>3&&(b.m=a[3]),b}},{}],24:[function(a,b){var c=Math.PI/2;b.exports=function(a,b,d){var e=a*d,f=.5*a;return e=Math.pow((1-e)/(1+e),f),Math.tan(.5*(c-b))/e}},{}],25:[function(a,b,c){c.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},c.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},c.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},c.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},c.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},c.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},c.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},c.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},c.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},c.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},c.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},c.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},c.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},c.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},c.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},c.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}},{}],26:[function(a,b,c){c.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"},c.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},c.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},c.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"},c.airy={a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},c.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},c.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},c.mod_airy={a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},c.andrae={a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},c.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},c.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},c.bessel={a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},c.bess_nam={a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},c.clrk66={a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},c.clrk80={a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},c.clrk58={a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},c.CPM={a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},c.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},c.engelis={a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},c.evrst30={a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},c.evrst48={a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},c.evrst56={a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},c.evrst69={a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},c.evrstSS={a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},c.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},c.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"},c.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"},c.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"},c.hough={a:6378270,rf:297,ellipseName:"Hough"},c.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},c.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"},c.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"},c.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"},c.new_intl={a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},c.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},c.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},c.SEasia={a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},c.walbeck={a:6376896,b:6355834.8467,ellipseName:"Walbeck"},c.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"},c.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"},c.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"},c.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"},c.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},{}],27:[function(a,b,c){c.greenwich=0,c.lisbon=-9.131906111111,c.paris=2.337229166667,c.bogota=-74.080916666667,c.madrid=-3.687938888889,c.rome=12.452333333333,c.bern=7.439583333333,c.jakarta=106.807719444444,c.ferro=-17.666666666667,c.brussels=4.367975,c.stockholm=18.058277777778,c.athens=23.7163375,c.oslo=10.722916666667},{}],28:[function(a,b){function c(a,b,c){var d;return Array.isArray(c)?(d=g(a,b,c),3===c.length?[d.x,d.y,d.z]:[d.x,d.y]):g(a,b,c)}function d(a){return a instanceof f?a:a.oProj?a.oProj:f(a)}function e(a,b,e){a=d(a);var f,g=!1;return"undefined"==typeof b?(b=a,a=h,g=!0):("undefined"!=typeof b.x||Array.isArray(b))&&(e=b,b=a,a=h,g=!0),b=d(b),e?c(a,b,e):(f={forward:function(d){return c(a,b,d)},inverse:function(d){return c(b,a,d)}},g&&(f.oProj=b),f)}var f=a("./Proj"),g=a("./transform"),h=f("WGS84");b.exports=e},{"./Proj":2,"./transform":64}],29:[function(a,b){var c=Math.PI/2,d=1,e=2,f=3,g=4,h=5,i=484813681109536e-20,j=1.0026,k=.3826834323650898,l=function(a){if(!(this instanceof l))return new l(a);if(this.datum_type=g,a){if(a.datumCode&&"none"===a.datumCode&&(this.datum_type=h),a.datum_params){for(var b=0;b<a.datum_params.length;b++)a.datum_params[b]=parseFloat(a.datum_params[b]);(0!==a.datum_params[0]||0!==a.datum_params[1]||0!==a.datum_params[2])&&(this.datum_type=d),a.datum_params.length>3&&(0!==a.datum_params[3]||0!==a.datum_params[4]||0!==a.datum_params[5]||0!==a.datum_params[6])&&(this.datum_type=e,a.datum_params[3]*=i,a.datum_params[4]*=i,a.datum_params[5]*=i,a.datum_params[6]=a.datum_params[6]/1e6+1)}this.datum_type=a.grids?f:this.datum_type,this.a=a.a,this.b=a.b,this.es=a.es,this.ep2=a.ep2,this.datum_params=a.datum_params,this.datum_type===f&&(this.grids=a.grids)}};l.prototype={compare_datums:function(a){return this.datum_type!==a.datum_type?!1:this.a!==a.a||Math.abs(this.es-a.es)>5e-11?!1:this.datum_type===d?this.datum_params[0]===a.datum_params[0]&&this.datum_params[1]===a.datum_params[1]&&this.datum_params[2]===a.datum_params[2]:this.datum_type===e?this.datum_params[0]===a.datum_params[0]&&this.datum_params[1]===a.datum_params[1]&&this.datum_params[2]===a.datum_params[2]&&this.datum_params[3]===a.datum_params[3]&&this.datum_params[4]===a.datum_params[4]&&this.datum_params[5]===a.datum_params[5]&&this.datum_params[6]===a.datum_params[6]:this.datum_type===f||a.datum_type===f?this.nadgrids===a.nadgrids:!0},geodetic_to_geocentric:function(a){var b,d,e,f,g,h,i,j=a.x,k=a.y,l=a.z?a.z:0,m=0;if(-c>k&&k>-1.001*c)k=-c;else if(k>c&&1.001*c>k)k=c;else if(-c>k||k>c)return null;return j>Math.PI&&(j-=2*Math.PI),g=Math.sin(k),i=Math.cos(k),h=g*g,f=this.a/Math.sqrt(1-this.es*h),b=(f+l)*i*Math.cos(j),d=(f+l)*i*Math.sin(j),e=(f*(1-this.es)+l)*g,a.x=b,a.y=d,a.z=e,m},geocentric_to_geodetic:function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=1e-12,u=t*t,v=30,w=a.x,x=a.y,y=a.z?a.z:0;if(o=!1,b=Math.sqrt(w*w+x*x),d=Math.sqrt(w*w+x*x+y*y),b/this.a<t){if(o=!0,q=0,d/this.a<t)return r=c,void(s=-this.b)}else q=Math.atan2(x,w);e=y/d,f=b/d,g=1/Math.sqrt(1-this.es*(2-this.es)*f*f),j=f*(1-this.es)*g,k=e*g,p=0;do p++,i=this.a/Math.sqrt(1-this.es*k*k),s=b*j+y*k-i*(1-this.es*k*k),h=this.es*i/(i+s),g=1/Math.sqrt(1-h*(2-h)*f*f),l=f*(1-h)*g,m=e*g,n=m*j-l*k,j=l,k=m;while(n*n>u&&v>p);return r=Math.atan(m/Math.abs(l)),a.x=q,a.y=r,a.z=s,a},geocentric_to_geodetic_noniter:function(a){var b,d,e,f,g,h,i,l,m,n,o,p,q,r,s,t,u,v=a.x,w=a.y,x=a.z?a.z:0;if(v=parseFloat(v),w=parseFloat(w),x=parseFloat(x),u=!1,0!==v)b=Math.atan2(w,v);else if(w>0)b=c;else if(0>w)b=-c;else if(u=!0,b=0,x>0)d=c;else{if(!(0>x))return d=c,void(e=-this.b);d=-c}return g=v*v+w*w,f=Math.sqrt(g),h=x*j,l=Math.sqrt(h*h+g),n=h/l,p=f/l,o=n*n*n,i=x+this.b*this.ep2*o,t=f-this.a*this.es*p*p*p,m=Math.sqrt(i*i+t*t),q=i/m,r=t/m,s=this.a/Math.sqrt(1-this.es*q*q),e=r>=k?f/r-s:-k>=r?f/-r-s:x/q+s*(this.es-1),u===!1&&(d=Math.atan(q/r)),a.x=b,a.y=d,a.z=e,a},geocentric_to_wgs84:function(a){if(this.datum_type===d)a.x+=this.datum_params[0],a.y+=this.datum_params[1],a.z+=this.datum_params[2];else if(this.datum_type===e){var b=this.datum_params[0],c=this.datum_params[1],f=this.datum_params[2],g=this.datum_params[3],h=this.datum_params[4],i=this.datum_params[5],j=this.datum_params[6],k=j*(a.x-i*a.y+h*a.z)+b,l=j*(i*a.x+a.y-g*a.z)+c,m=j*(-h*a.x+g*a.y+a.z)+f;a.x=k,a.y=l,a.z=m}},geocentric_from_wgs84:function(a){if(this.datum_type===d)a.x-=this.datum_params[0],a.y-=this.datum_params[1],a.z-=this.datum_params[2];else if(this.datum_type===e){var b=this.datum_params[0],c=this.datum_params[1],f=this.datum_params[2],g=this.datum_params[3],h=this.datum_params[4],i=this.datum_params[5],j=this.datum_params[6],k=(a.x-b)/j,l=(a.y-c)/j,m=(a.z-f)/j;a.x=k+i*l-h*m,a.y=-i*k+l+g*m,a.z=h*k-g*l+m}}},b.exports=l},{}],30:[function(a,b){var c=1,d=2,e=3,f=5,g=6378137,h=.006694379990141316;b.exports=function(a,b,i){function j(a){return a===c||a===d}var k,l,m;if(a.compare_datums(b))return i;if(a.datum_type===f||b.datum_type===f)return i;var n=a.a,o=a.es,p=b.a,q=b.es,r=a.datum_type;if(r===e)if(0===this.apply_gridshift(a,0,i))a.a=g,a.es=h;else{if(!a.datum_params)return a.a=n,a.es=a.es,i;for(k=1,l=0,m=a.datum_params.length;m>l;l++)k*=a.datum_params[l];if(0===k)return a.a=n,a.es=a.es,i;r=a.datum_params.length>3?d:c}return b.datum_type===e&&(b.a=g,b.es=h),(a.es!==b.es||a.a!==b.a||j(r)||j(b.datum_type))&&(a.geodetic_to_geocentric(i),j(a.datum_type)&&a.geocentric_to_wgs84(i),j(b.datum_type)&&b.geocentric_from_wgs84(i),b.geocentric_to_geodetic(i)),b.datum_type===e&&this.apply_gridshift(b,1,i),a.a=n,a.es=o,b.a=p,b.es=q,i}},{}],31:[function(a,b){function c(a){var b=this;if(2===arguments.length)c[a]="+"===arguments[1][0]?e(arguments[1]):f(arguments[1]);else if(1===arguments.length)return Array.isArray(a)?a.map(function(a){Array.isArray(a)?c.apply(b,a):c(a)}):void("string"==typeof a||("EPSG"in a?c["EPSG:"+a.EPSG]=a:"ESRI"in a?c["ESRI:"+a.ESRI]=a:"IAU2000"in a?c["IAU2000:"+a.IAU2000]=a:console.log(a)))}var d=a("./global"),e=a("./projString"),f=a("./wkt");d(c),b.exports=c},{"./global":34,"./projString":37,"./wkt":65}],32:[function(a,b){var c=a("./constants/Datum"),d=a("./constants/Ellipsoid"),e=a("./extend"),f=a("./datum"),g=1e-10,h=.16666666666666666,i=.04722222222222222,j=.022156084656084655;b.exports=function(a){if(a.datumCode&&"none"!==a.datumCode){var b=c[a.datumCode];b&&(a.datum_params=b.towgs84?b.towgs84.split(","):null,a.ellps=b.ellipse,a.datumName=b.datumName?b.datumName:a.datumCode)}if(!a.a){var k=d[a.ellps]?d[a.ellps]:d.WGS84;e(a,k)}return a.rf&&!a.b&&(a.b=(1-1/a.rf)*a.a),(0===a.rf||Math.abs(a.a-a.b)<g)&&(a.sphere=!0,a.b=a.a),a.a2=a.a*a.a,a.b2=a.b*a.b,a.es=(a.a2-a.b2)/a.a2,a.e=Math.sqrt(a.es),a.R_A&&(a.a*=1-a.es*(h+a.es*(i+a.es*j)),a.a2=a.a*a.a,a.b2=a.b*a.b,a.es=0),a.ep2=(a.a2-a.b2)/a.b2,a.k0||(a.k0=1),a.axis||(a.axis="enu"),a.datum=f(a),a}},{"./constants/Datum":25,"./constants/Ellipsoid":26,"./datum":29,"./extend":33}],33:[function(a,b){b.exports=function(a,b){a=a||{};var c,d;if(!b)return a;for(d in b)c=b[d],void 0!==c&&(a[d]=c);return a}},{}],34:[function(a,b){b.exports=function(a){a("WGS84","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),a("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),a("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),a("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),a["EPSG:3785"]=a["EPSG:3857"],a.GOOGLE=a["EPSG:3857"],a["EPSG:900913"]=a["EPSG:3857"],a["EPSG:102113"]=a["EPSG:3857"]}},{}],35:[function(a,b){var c=a("./core");c.defaultDatum="WGS84",c.Proj=a("./Proj"),c.WGS84=new c.Proj("WGS84"),c.Point=a("./Point"),c.toPoint=a("./common/toPoint"),c.defs=a("./defs"),c.transform=a("./transform"),c.mgrs=a("mgrs"),c.version=a("../package.json").version,a("./includedProjections")(c),b.exports=c},{"../package.json":67,"./Point":1,"./Proj":2,"./common/toPoint":23,"./core":28,"./defs":31,"./includedProjections":"gWUPNW","./transform":64,mgrs:66}],36:[function(a,b){function c(a){return"string"==typeof a}function d(a){return a in h}function e(a){var b=["GEOGCS","GEOCCS","PROJCS","LOCAL_CS"];return b.reduce(function(b,c){return b+1+a.indexOf(c)},0)}function f(a){return"+"===a[0]}function g(a){return c(a)?d(a)?h[a]:e(a)?i(a):f(a)?j(a):void 0:a}var h=a("./defs"),i=a("./wkt"),j=a("./projString");b.exports=g},{"./defs":31,"./projString":37,"./wkt":65}],37:[function(a,b){var c=.017453292519943295,d=a("./constants/PrimeMeridian");b.exports=function(a){var b={},e={};a.split("+").map(function(a){return a.trim()}).filter(function(a){return a}).forEach(function(a){var b=a.split("=");b.push(!0),e[b[0].toLowerCase()]=b[1]});var f,g,h,i={proj:"projName",datum:"datumCode",rf:function(a){b.rf=parseFloat(a,10)},lat_0:function(a){b.lat0=a*c},lat_1:function(a){b.lat1=a*c},lat_2:function(a){b.lat2=a*c},lat_ts:function(a){b.lat_ts=a*c},lon_0:function(a){b.long0=a*c},lon_1:function(a){b.long1=a*c},lon_2:function(a){b.long2=a*c},alpha:function(a){b.alpha=parseFloat(a)*c},lonc:function(a){b.longc=a*c},x_0:function(a){b.x0=parseFloat(a,10)},y_0:function(a){b.y0=parseFloat(a,10)},k_0:function(a){b.k0=parseFloat(a,10)},k:function(a){b.k0=parseFloat(a,10)},r_a:function(){b.R_A=!0},zone:function(a){b.zone=parseInt(a,10)},south:function(){b.utmSouth=!0},towgs84:function(a){b.datum_params=a.split(",").map(function(a){return parseFloat(a,10)})},to_meter:function(a){b.to_meter=parseFloat(a,10)},from_greenwich:function(a){b.from_greenwich=a*c},pm:function(a){b.from_greenwich=(d[a]?d[a]:parseFloat(a,10))*c},nadgrids:function(a){"@null"===a?b.datumCode="none":b.nadgrids=a},axis:function(a){var c="ewnsud";3===a.length&&-1!==c.indexOf(a.substr(0,1))&&-1!==c.indexOf(a.substr(1,1))&&-1!==c.indexOf(a.substr(2,1))&&(b.axis=a)}};for(f in e)g=e[f],f in i?(h=i[f],"function"==typeof h?h(g):b[h]=g):b[f]=g;return"string"==typeof b.datumCode&&"WGS84"!==b.datumCode&&(b.datumCode=b.datumCode.toLowerCase()),b}},{"./constants/PrimeMeridian":27}],38:[function(a,b,c){function d(a,b){var c=g.length;return a.names?(g[c]=a,a.names.forEach(function(a){f[a.toLowerCase()]=c}),this):(console.log(b),!0)}var e=[a("./projections/merc"),a("./projections/longlat")],f={},g=[];c.add=d,c.get=function(a){if(!a)return!1;var b=a.toLowerCase();return"undefined"!=typeof f[b]&&g[f[b]]?g[f[b]]:void 0},c.start=function(){e.forEach(d)}},{"./projections/longlat":50,"./projections/merc":51}],39:[function(a,b,c){var d=1e-10,e=a("../common/msfnz"),f=a("../common/qsfnz"),g=a("../common/adjust_lon"),h=a("../common/asinz");c.init=function(){Math.abs(this.lat1+this.lat2)<d||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=e(this.e3,this.sin_po,this.cos_po),this.qs1=f(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=e(this.e3,this.sin_po,this.cos_po),this.qs2=f(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=f(this.e3,this.sin_po,this.cos_po),this.ns0=Math.abs(this.lat1-this.lat2)>d?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},c.forward=function(a){var b=a.x,c=a.y;this.sin_phi=Math.sin(c),this.cos_phi=Math.cos(c);var d=f(this.e3,this.sin_phi,this.cos_phi),e=this.a*Math.sqrt(this.c-this.ns0*d)/this.ns0,h=this.ns0*g(b-this.long0),i=e*Math.sin(h)+this.x0,j=this.rh-e*Math.cos(h)+this.y0;return a.x=i,a.y=j,a},c.inverse=function(a){var b,c,d,e,f,h;return a.x-=this.x0,a.y=this.rh-a.y+this.y0,this.ns0>=0?(b=Math.sqrt(a.x*a.x+a.y*a.y),d=1):(b=-Math.sqrt(a.x*a.x+a.y*a.y),d=-1),e=0,0!==b&&(e=Math.atan2(d*a.x,d*a.y)),d=b*this.ns0/this.a,this.sphere?h=Math.asin((this.c-d*d)/(2*this.ns0)):(c=(this.c-d*d)/this.ns0,h=this.phi1z(this.e3,c)),f=g(e/this.ns0+this.long0),a.x=f,a.y=h,a},c.phi1z=function(a,b){var c,e,f,g,i,j=h(.5*b);if(d>a)return j;for(var k=a*a,l=1;25>=l;l++)if(c=Math.sin(j),e=Math.cos(j),f=a*c,g=1-f*f,i=.5*g*g/e*(b/(1-k)-c/g+.5/a*Math.log((1-f)/(1+f))),j+=i,Math.abs(i)<=1e-7)return j;return null},c.names=["Albers_Conic_Equal_Area","Albers","aea"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/msfnz":15,"../common/qsfnz":20}],40:[function(a,b,c){var d=a("../common/adjust_lon"),e=Math.PI/2,f=1e-10,g=a("../common/mlfn"),h=a("../common/e0fn"),i=a("../common/e1fn"),j=a("../common/e2fn"),k=a("../common/e3fn"),l=a("../common/gN"),m=a("../common/asinz"),n=a("../common/imlfn");c.init=function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},c.forward=function(a){var b,c,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=a.x,I=a.y,J=Math.sin(a.y),K=Math.cos(a.y),L=d(H-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=f?(a.x=this.x0+this.a*(e-I)*Math.sin(L),a.y=this.y0-this.a*(e-I)*Math.cos(L),a):Math.abs(this.sin_p12+1)<=f?(a.x=this.x0+this.a*(e+I)*Math.sin(L),a.y=this.y0+this.a*(e+I)*Math.cos(L),a):(B=this.sin_p12*J+this.cos_p12*K*Math.cos(L),z=Math.acos(B),A=z/Math.sin(z),a.x=this.x0+this.a*A*K*Math.sin(L),a.y=this.y0+this.a*A*(this.cos_p12*J-this.sin_p12*K*Math.cos(L)),a):(b=h(this.es),c=i(this.es),m=j(this.es),n=k(this.es),Math.abs(this.sin_p12-1)<=f?(o=this.a*g(b,c,m,n,e),p=this.a*g(b,c,m,n,I),a.x=this.x0+(o-p)*Math.sin(L),a.y=this.y0-(o-p)*Math.cos(L),a):Math.abs(this.sin_p12+1)<=f?(o=this.a*g(b,c,m,n,e),p=this.a*g(b,c,m,n,I),a.x=this.x0+(o+p)*Math.sin(L),a.y=this.y0+(o+p)*Math.cos(L),a):(q=J/K,r=l(this.a,this.e,this.sin_p12),s=l(this.a,this.e,J),t=Math.atan((1-this.es)*q+this.es*r*this.sin_p12/(s*K)),u=Math.atan2(Math.sin(L),this.cos_p12*Math.tan(t)-this.sin_p12*Math.cos(L)),C=0===u?Math.asin(this.cos_p12*Math.sin(t)-this.sin_p12*Math.cos(t)):Math.abs(Math.abs(u)-Math.PI)<=f?-Math.asin(this.cos_p12*Math.sin(t)-this.sin_p12*Math.cos(t)):Math.asin(Math.sin(L)*Math.cos(t)/Math.sin(u)),v=this.e*this.sin_p12/Math.sqrt(1-this.es),w=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es),x=v*w,y=w*w,D=C*C,E=D*C,F=E*C,G=F*C,z=r*C*(1-D*y*(1-y)/6+E/8*x*(1-2*y)+F/120*(y*(4-7*y)-3*v*v*(1-7*y))-G/48*x),a.x=this.x0+z*Math.sin(u),a.y=this.y0+z*Math.cos(u),a))},c.inverse=function(a){a.x-=this.x0,a.y-=this.y0;var b,c,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;if(this.sphere){if(b=Math.sqrt(a.x*a.x+a.y*a.y),b>2*e*this.a)return;return c=b/this.a,o=Math.sin(c),p=Math.cos(c),q=this.long0,Math.abs(b)<=f?r=this.lat0:(r=m(p*this.sin_p12+a.y*o*this.cos_p12/b),s=Math.abs(this.lat0)-e,q=d(Math.abs(s)<=f?this.lat0>=0?this.long0+Math.atan2(a.x,-a.y):this.long0-Math.atan2(-a.x,a.y):this.long0+Math.atan2(a.x*o,b*this.cos_p12*p-a.y*this.sin_p12*o))),a.x=q,a.y=r,a}return t=h(this.es),u=i(this.es),v=j(this.es),w=k(this.es),Math.abs(this.sin_p12-1)<=f?(x=this.a*g(t,u,v,w,e),b=Math.sqrt(a.x*a.x+a.y*a.y),y=x-b,r=n(y/this.a,t,u,v,w),q=d(this.long0+Math.atan2(a.x,-1*a.y)),a.x=q,a.y=r,a):Math.abs(this.sin_p12+1)<=f?(x=this.a*g(t,u,v,w,e),b=Math.sqrt(a.x*a.x+a.y*a.y),y=b-x,r=n(y/this.a,t,u,v,w),q=d(this.long0+Math.atan2(a.x,a.y)),a.x=q,a.y=r,a):(b=Math.sqrt(a.x*a.x+a.y*a.y),B=Math.atan2(a.x,a.y),z=l(this.a,this.e,this.sin_p12),C=Math.cos(B),D=this.e*this.cos_p12*C,E=-D*D/(1-this.es),F=3*this.es*(1-E)*this.sin_p12*this.cos_p12*C/(1-this.es),G=b/z,H=G-E*(1+E)*Math.pow(G,3)/6-F*(1+3*E)*Math.pow(G,4)/24,I=1-E*H*H/2-G*H*H*H/6,A=Math.asin(this.sin_p12*Math.cos(H)+this.cos_p12*Math.sin(H)*C),q=d(this.long0+Math.asin(Math.sin(B)*Math.sin(H)/Math.cos(A))),r=Math.atan((1-this.es*I*this.sin_p12/Math.sin(A))*Math.tan(A)/(1-this.es)),a.x=q,a.y=r,a)},c.names=["Azimuthal_Equidistant","aeqd"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],41:[function(a,b,c){var d=a("../common/mlfn"),e=a("../common/e0fn"),f=a("../common/e1fn"),g=a("../common/e2fn"),h=a("../common/e3fn"),i=a("../common/gN"),j=a("../common/adjust_lon"),k=a("../common/adjust_lat"),l=a("../common/imlfn"),m=Math.PI/2,n=1e-10;c.init=function(){this.sphere||(this.e0=e(this.es),this.e1=f(this.es),this.e2=g(this.es),this.e3=h(this.es),this.ml0=this.a*d(this.e0,this.e1,this.e2,this.e3,this.lat0))},c.forward=function(a){var b,c,e=a.x,f=a.y;if(e=j(e-this.long0),this.sphere)b=this.a*Math.asin(Math.cos(f)*Math.sin(e)),c=this.a*(Math.atan2(Math.tan(f),Math.cos(e))-this.lat0);else{var g=Math.sin(f),h=Math.cos(f),k=i(this.a,this.e,g),l=Math.tan(f)*Math.tan(f),m=e*Math.cos(f),n=m*m,o=this.es*h*h/(1-this.es),p=this.a*d(this.e0,this.e1,this.e2,this.e3,f);b=k*m*(1-n*l*(1/6-(8-l+8*o)*n/120)),c=p-this.ml0+k*g/h*n*(.5+(5-l+6*o)*n/24)}return a.x=b+this.x0,a.y=c+this.y0,a},c.inverse=function(a){a.x-=this.x0,a.y-=this.y0;var b,c,d=a.x/this.a,e=a.y/this.a;if(this.sphere){var f=e+this.lat0;b=Math.asin(Math.sin(f)*Math.cos(d)),c=Math.atan2(Math.tan(d),Math.cos(f))}else{var g=this.ml0/this.a+e,h=l(g,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(h)-m)<=n)return a.x=this.long0,a.y=m,0>e&&(a.y*=-1),a;var o=i(this.a,this.e,Math.sin(h)),p=o*o*o/this.a/this.a*(1-this.es),q=Math.pow(Math.tan(h),2),r=d*this.a/o,s=r*r;b=h-o*Math.tan(h)/p*r*r*(.5-(1+3*q)*r*r/24),c=r*(1-s*(q/3+(1+3*q)*q*s/15))/Math.cos(h)}return a.x=j(c+this.long0),a.y=k(b),a},c.names=["Cassini","Cassini_Soldner","cass"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/imlfn":12,"../common/mlfn":14}],42:[function(a,b,c){var d=a("../common/adjust_lon"),e=a("../common/qsfnz"),f=a("../common/msfnz"),g=a("../common/iqsfnz");c.init=function(){this.sphere||(this.k0=f(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},c.forward=function(a){var b,c,f=a.x,g=a.y,h=d(f-this.long0);if(this.sphere)b=this.x0+this.a*h*Math.cos(this.lat_ts),c=this.y0+this.a*Math.sin(g)/Math.cos(this.lat_ts);else{var i=e(this.e,Math.sin(g));b=this.x0+this.a*this.k0*h,c=this.y0+this.a*i*.5/this.k0}return a.x=b,a.y=c,a},c.inverse=function(a){a.x-=this.x0,a.y-=this.y0;var b,c;return this.sphere?(b=d(this.long0+a.x/this.a/Math.cos(this.lat_ts)),c=Math.asin(a.y/this.a*Math.cos(this.lat_ts))):(c=g(this.e,2*a.y*this.k0/this.a),b=d(this.long0+a.x/(this.a*this.k0))),a.x=b,a.y=c,a},c.names=["cea"]},{"../common/adjust_lon":5,"../common/iqsfnz":13,"../common/msfnz":15,"../common/qsfnz":20}],43:[function(a,b,c){var d=a("../common/adjust_lon"),e=a("../common/adjust_lat");c.init=function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},c.forward=function(a){var b=a.x,c=a.y,f=d(b-this.long0),g=e(c-this.lat0);return a.x=this.x0+this.a*f*this.rc,a.y=this.y0+this.a*g,a},c.inverse=function(a){var b=a.x,c=a.y;return a.x=d(this.long0+(b-this.x0)/(this.a*this.rc)),a.y=e(this.lat0+(c-this.y0)/this.a),a},c.names=["Equirectangular","Equidistant_Cylindrical","eqc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5}],44:[function(a,b,c){var d=a("../common/e0fn"),e=a("../common/e1fn"),f=a("../common/e2fn"),g=a("../common/e3fn"),h=a("../common/msfnz"),i=a("../common/mlfn"),j=a("../common/adjust_lon"),k=a("../common/adjust_lat"),l=a("../common/imlfn"),m=1e-10;c.init=function(){Math.abs(this.lat1+this.lat2)<m||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=d(this.es),this.e1=e(this.es),this.e2=f(this.es),this.e3=g(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=h(this.e,this.sinphi,this.cosphi),this.ml1=i(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<m?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=h(this.e,this.sinphi,this.cosphi),this.ml2=i(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=i(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},c.forward=function(a){var b,c=a.x,d=a.y;if(this.sphere)b=this.a*(this.g-d);else{var e=i(this.e0,this.e1,this.e2,this.e3,d);b=this.a*(this.g-e)}var f=this.ns*j(c-this.long0),g=this.x0+b*Math.sin(f),h=this.y0+this.rh-b*Math.cos(f);return a.x=g,a.y=h,a},c.inverse=function(a){a.x-=this.x0,a.y=this.rh-a.y+this.y0;var b,c,d,e;this.ns>=0?(c=Math.sqrt(a.x*a.x+a.y*a.y),b=1):(c=-Math.sqrt(a.x*a.x+a.y*a.y),b=-1);var f=0;if(0!==c&&(f=Math.atan2(b*a.x,b*a.y)),this.sphere)return e=j(this.long0+f/this.ns),d=k(this.g-c/this.a),a.x=e,a.y=d,a;var g=this.g-c/this.a;return d=l(g,this.e0,this.e1,this.e2,this.e3),e=j(this.long0+f/this.ns),a.x=e,a.y=d,a},c.names=["Equidistant_Conic","eqdc"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/imlfn":12,"../common/mlfn":14,"../common/msfnz":15}],45:[function(a,b,c){var d=Math.PI/4,e=a("../common/srat"),f=Math.PI/2,g=20;c.init=function(){var a=Math.sin(this.lat0),b=Math.cos(this.lat0);b*=b,this.rc=Math.sqrt(1-this.es)/(1-this.es*a*a),this.C=Math.sqrt(1+this.es*b*b/(1-this.es)),this.phic0=Math.asin(a/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+d)/(Math.pow(Math.tan(.5*this.lat0+d),this.C)*e(this.e*a,this.ratexp))},c.forward=function(a){var b=a.x,c=a.y;return a.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*c+d),this.C)*e(this.e*Math.sin(c),this.ratexp))-f,a.x=this.C*b,a},c.inverse=function(a){for(var b=1e-14,c=a.x/this.C,h=a.y,i=Math.pow(Math.tan(.5*h+d)/this.K,1/this.C),j=g;j>0&&(h=2*Math.atan(i*e(this.e*Math.sin(a.y),-.5*this.e))-f,!(Math.abs(h-a.y)<b));--j)a.y=h;return j?(a.x=c,a.y=h,a):null},c.names=["gauss"]},{"../common/srat":22}],46:[function(a,b,c){var d=a("../common/adjust_lon"),e=1e-10,f=a("../common/asinz");c.init=function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},c.forward=function(a){var b,c,f,g,h,i,j,k,l=a.x,m=a.y;return f=d(l-this.long0),b=Math.sin(m),c=Math.cos(m),g=Math.cos(f),i=this.sin_p14*b+this.cos_p14*c*g,h=1,i>0||Math.abs(i)<=e?(j=this.x0+this.a*h*c*Math.sin(f)/i,k=this.y0+this.a*h*(this.cos_p14*b-this.sin_p14*c*g)/i):(j=this.x0+this.infinity_dist*c*Math.sin(f),k=this.y0+this.infinity_dist*(this.cos_p14*b-this.sin_p14*c*g)),a.x=j,a.y=k,a},c.inverse=function(a){var b,c,e,g,h,i;return a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,(b=Math.sqrt(a.x*a.x+a.y*a.y))?(g=Math.atan2(b,this.rc),c=Math.sin(g),e=Math.cos(g),i=f(e*this.sin_p14+a.y*c*this.cos_p14/b),h=Math.atan2(a.x*c,b*this.cos_p14*e-a.y*this.sin_p14*c),h=d(this.long0+h)):(i=this.phic0,h=0),a.x=h,a.y=i,a},c.names=["gnom"]
},{"../common/adjust_lon":5,"../common/asinz":6}],47:[function(a,b,c){var d=a("../common/adjust_lon");c.init=function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},c.forward=function(a){var b,c,e,f,g,h,i,j=a.x,k=a.y,l=d(j-this.long0);return b=Math.pow((1+this.e*Math.sin(k))/(1-this.e*Math.sin(k)),this.alfa*this.e/2),c=2*(Math.atan(this.k*Math.pow(Math.tan(k/2+this.s45),this.alfa)/b)-this.s45),e=-l*this.alfa,f=Math.asin(Math.cos(this.ad)*Math.sin(c)+Math.sin(this.ad)*Math.cos(c)*Math.cos(e)),g=Math.asin(Math.cos(c)*Math.sin(e)/Math.cos(f)),h=this.n*g,i=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(f/2+this.s45),this.n),a.y=i*Math.cos(h)/1,a.x=i*Math.sin(h)/1,this.czech||(a.y*=-1,a.x*=-1),a},c.inverse=function(a){var b,c,d,e,f,g,h,i,j=a.x;a.x=a.y,a.y=j,this.czech||(a.y*=-1,a.x*=-1),g=Math.sqrt(a.x*a.x+a.y*a.y),f=Math.atan2(a.y,a.x),e=f/Math.sin(this.s0),d=2*(Math.atan(Math.pow(this.ro0/g,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),b=Math.asin(Math.cos(this.ad)*Math.sin(d)-Math.sin(this.ad)*Math.cos(d)*Math.cos(e)),c=Math.asin(Math.cos(d)*Math.sin(e)/Math.cos(b)),a.x=this.long0-c/this.alfa,h=b,i=0;var k=0;do a.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(b/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.e/2))-this.s45),Math.abs(h-a.y)<1e-10&&(i=1),h=a.y,k+=1;while(0===i&&15>k);return k>=15?null:a},c.names=["Krovak","krovak"]},{"../common/adjust_lon":5}],48:[function(a,b,c){var d=Math.PI/2,e=Math.PI/4,f=1e-10,g=a("../common/qsfnz"),h=a("../common/adjust_lon");c.S_POLE=1,c.N_POLE=2,c.EQUIT=3,c.OBLIQ=4,c.init=function(){var a=Math.abs(this.lat0);if(this.mode=Math.abs(a-d)<f?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(a)<f?this.EQUIT:this.OBLIQ,this.es>0){var b;switch(this.qp=g(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),b=Math.sin(this.lat0),this.sinb1=g(this.e,b)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*b*b)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},c.forward=function(a){var b,c,i,j,k,l,m,n,o,p,q=a.x,r=a.y;if(q=h(q-this.long0),this.sphere){if(k=Math.sin(r),p=Math.cos(r),i=Math.cos(q),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c=this.mode===this.EQUIT?1+p*i:1+this.sinph0*k+this.cosph0*p*i,f>=c)return null;c=Math.sqrt(2/c),b=c*p*Math.sin(q),c*=this.mode===this.EQUIT?k:this.cosph0*k-this.sinph0*p*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(r+this.phi0)<f)return null;c=e-.5*r,c=2*(this.mode===this.S_POLE?Math.cos(c):Math.sin(c)),b=c*Math.sin(q),c*=i}}else{switch(m=0,n=0,o=0,i=Math.cos(q),j=Math.sin(q),k=Math.sin(r),l=g(this.e,k),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(m=l/this.qp,n=Math.sqrt(1-m*m)),this.mode){case this.OBLIQ:o=1+this.sinb1*m+this.cosb1*n*i;break;case this.EQUIT:o=1+n*i;break;case this.N_POLE:o=d+r,l=this.qp-l;break;case this.S_POLE:o=r-d,l=this.qp+l}if(Math.abs(o)<f)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:o=Math.sqrt(2/o),c=this.mode===this.OBLIQ?this.ymf*o*(this.cosb1*m-this.sinb1*n*i):(o=Math.sqrt(2/(1+n*i)))*m*this.ymf,b=this.xmf*o*n*j;break;case this.N_POLE:case this.S_POLE:l>=0?(b=(o=Math.sqrt(l))*j,c=i*(this.mode===this.S_POLE?o:-o)):b=c=0}}return a.x=this.a*b+this.x0,a.y=this.a*c+this.y0,a},c.inverse=function(a){a.x-=this.x0,a.y-=this.y0;var b,c,e,g,i,j,k,l=a.x/this.a,m=a.y/this.a;if(this.sphere){var n,o=0,p=0;if(n=Math.sqrt(l*l+m*m),c=.5*n,c>1)return null;switch(c=2*Math.asin(c),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(p=Math.sin(c),o=Math.cos(c)),this.mode){case this.EQUIT:c=Math.abs(n)<=f?0:Math.asin(m*p/n),l*=p,m=o*n;break;case this.OBLIQ:c=Math.abs(n)<=f?this.phi0:Math.asin(o*this.sinph0+m*p*this.cosph0/n),l*=p*this.cosph0,m=(o-Math.sin(c)*this.sinph0)*n;break;case this.N_POLE:m=-m,c=d-c;break;case this.S_POLE:c-=d}b=0!==m||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(l,m):0}else{if(k=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(l/=this.dd,m*=this.dd,j=Math.sqrt(l*l+m*m),f>j)return a.x=0,a.y=this.phi0,a;g=2*Math.asin(.5*j/this.rq),e=Math.cos(g),l*=g=Math.sin(g),this.mode===this.OBLIQ?(k=e*this.sinb1+m*g*this.cosb1/j,i=this.qp*k,m=j*this.cosb1*e-m*this.sinb1*g):(k=m*g/j,i=this.qp*k,m=j*e)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(m=-m),i=l*l+m*m,!i)return a.x=0,a.y=this.phi0,a;k=1-i/this.qp,this.mode===this.S_POLE&&(k=-k)}b=Math.atan2(l,m),c=this.authlat(Math.asin(k),this.apa)}return a.x=h(this.long0+b),a.y=c,a},c.P00=.3333333333333333,c.P01=.17222222222222222,c.P02=.10257936507936508,c.P10=.06388888888888888,c.P11=.0664021164021164,c.P20=.016415012942191543,c.authset=function(a){var b,c=[];return c[0]=a*this.P00,b=a*a,c[0]+=b*this.P01,c[1]=b*this.P10,b*=a,c[0]+=b*this.P02,c[1]+=b*this.P11,c[2]=b*this.P20,c},c.authlat=function(a,b){var c=a+a;return a+b[0]*Math.sin(c)+b[1]*Math.sin(c+c)+b[2]*Math.sin(c+c+c)},c.names=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"]},{"../common/adjust_lon":5,"../common/qsfnz":20}],49:[function(a,b,c){var d=1e-10,e=a("../common/msfnz"),f=a("../common/tsfnz"),g=Math.PI/2,h=a("../common/sign"),i=a("../common/adjust_lon"),j=a("../common/phi2z");c.init=function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<d)){var a=this.b/this.a;this.e=Math.sqrt(1-a*a);var b=Math.sin(this.lat1),c=Math.cos(this.lat1),g=e(this.e,b,c),h=f(this.e,this.lat1,b),i=Math.sin(this.lat2),j=Math.cos(this.lat2),k=e(this.e,i,j),l=f(this.e,this.lat2,i),m=f(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>d?Math.log(g/k)/Math.log(h/l):b,isNaN(this.ns)&&(this.ns=b),this.f0=g/(this.ns*Math.pow(h,this.ns)),this.rh=this.a*this.f0*Math.pow(m,this.ns),this.title||(this.title="Lambert Conformal Conic")}},c.forward=function(a){var b=a.x,c=a.y;Math.abs(2*Math.abs(c)-Math.PI)<=d&&(c=h(c)*(g-2*d));var e,j,k=Math.abs(Math.abs(c)-g);if(k>d)e=f(this.e,c,Math.sin(c)),j=this.a*this.f0*Math.pow(e,this.ns);else{if(k=c*this.ns,0>=k)return null;j=0}var l=this.ns*i(b-this.long0);return a.x=this.k0*j*Math.sin(l)+this.x0,a.y=this.k0*(this.rh-j*Math.cos(l))+this.y0,a},c.inverse=function(a){var b,c,d,e,f,h=(a.x-this.x0)/this.k0,k=this.rh-(a.y-this.y0)/this.k0;this.ns>0?(b=Math.sqrt(h*h+k*k),c=1):(b=-Math.sqrt(h*h+k*k),c=-1);var l=0;if(0!==b&&(l=Math.atan2(c*h,c*k)),0!==b||this.ns>0){if(c=1/this.ns,d=Math.pow(b/(this.a*this.f0),c),e=j(this.e,d),-9999===e)return null}else e=-g;return f=i(l/this.ns+this.long0),a.x=f,a.y=e,a},c.names=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],50:[function(a,b,c){function d(a){return a}c.init=function(){},c.forward=d,c.inverse=d,c.names=["longlat","identity"]},{}],51:[function(a,b,c){var d=a("../common/msfnz"),e=Math.PI/2,f=1e-10,g=57.29577951308232,h=a("../common/adjust_lon"),i=Math.PI/4,j=a("../common/tsfnz"),k=a("../common/phi2z");c.init=function(){var a=this.b/this.a;this.es=1-a*a,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.k0=this.sphere?Math.cos(this.lat_ts):d(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k0=this.k?this.k:1)},c.forward=function(a){var b=a.x,c=a.y;if(c*g>90&&-90>c*g&&b*g>180&&-180>b*g)return null;var d,k;if(Math.abs(Math.abs(c)-e)<=f)return null;if(this.sphere)d=this.x0+this.a*this.k0*h(b-this.long0),k=this.y0+this.a*this.k0*Math.log(Math.tan(i+.5*c));else{var l=Math.sin(c),m=j(this.e,c,l);d=this.x0+this.a*this.k0*h(b-this.long0),k=this.y0-this.a*this.k0*Math.log(m)}return a.x=d,a.y=k,a},c.inverse=function(a){var b,c,d=a.x-this.x0,f=a.y-this.y0;if(this.sphere)c=e-2*Math.atan(Math.exp(-f/(this.a*this.k0)));else{var g=Math.exp(-f/(this.a*this.k0));if(c=k(this.e,g),-9999===c)return null}return b=h(this.long0+d/(this.a*this.k0)),a.x=b,a.y=c,a},c.names=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/tsfnz":24}],52:[function(a,b,c){var d=a("../common/adjust_lon");c.init=function(){},c.forward=function(a){var b=a.x,c=a.y,e=d(b-this.long0),f=this.x0+this.a*e,g=this.y0+this.a*Math.log(Math.tan(Math.PI/4+c/2.5))*1.25;return a.x=f,a.y=g,a},c.inverse=function(a){a.x-=this.x0,a.y-=this.y0;var b=d(this.long0+a.x/this.a),c=2.5*(Math.atan(Math.exp(.8*a.y/this.a))-Math.PI/4);return a.x=b,a.y=c,a},c.names=["Miller_Cylindrical","mill"]},{"../common/adjust_lon":5}],53:[function(a,b,c){var d=a("../common/adjust_lon"),e=1e-10;c.init=function(){},c.forward=function(a){for(var b=a.x,c=a.y,f=d(b-this.long0),g=c,h=Math.PI*Math.sin(c),i=0;!0;i++){var j=-(g+Math.sin(g)-h)/(1+Math.cos(g));if(g+=j,Math.abs(j)<e)break}g/=2,Math.PI/2-Math.abs(c)<e&&(f=0);var k=.900316316158*this.a*f*Math.cos(g)+this.x0,l=1.4142135623731*this.a*Math.sin(g)+this.y0;return a.x=k,a.y=l,a},c.inverse=function(a){var b,c;a.x-=this.x0,a.y-=this.y0,c=a.y/(1.4142135623731*this.a),Math.abs(c)>.999999999999&&(c=.999999999999),b=Math.asin(c);var e=d(this.long0+a.x/(.900316316158*this.a*Math.cos(b)));e<-Math.PI&&(e=-Math.PI),e>Math.PI&&(e=Math.PI),c=(2*b+Math.sin(2*b))/Math.PI,Math.abs(c)>1&&(c=1);var f=Math.asin(c);return a.x=e,a.y=f,a},c.names=["Mollweide","moll"]},{"../common/adjust_lon":5}],54:[function(a,b,c){var d=484813681109536e-20;c.iterations=1,c.init=function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},c.forward=function(a){var b,c=a.x,e=a.y,f=e-this.lat0,g=c-this.long0,h=f/d*1e-5,i=g,j=1,k=0;for(b=1;10>=b;b++)j*=h,k+=this.A[b]*j;var l,m,n=k,o=i,p=1,q=0,r=0,s=0;for(b=1;6>=b;b++)l=p*n-q*o,m=q*n+p*o,p=l,q=m,r=r+this.B_re[b]*p-this.B_im[b]*q,s=s+this.B_im[b]*p+this.B_re[b]*q;return a.x=s*this.a+this.x0,a.y=r*this.a+this.y0,a},c.inverse=function(a){var b,c,e,f=a.x,g=a.y,h=f-this.x0,i=g-this.y0,j=i/this.a,k=h/this.a,l=1,m=0,n=0,o=0;for(b=1;6>=b;b++)c=l*j-m*k,e=m*j+l*k,l=c,m=e,n=n+this.C_re[b]*l-this.C_im[b]*m,o=o+this.C_im[b]*l+this.C_re[b]*m;for(var p=0;p<this.iterations;p++){var q,r,s=n,t=o,u=j,v=k;for(b=2;6>=b;b++)q=s*n-t*o,r=t*n+s*o,s=q,t=r,u+=(b-1)*(this.B_re[b]*s-this.B_im[b]*t),v+=(b-1)*(this.B_im[b]*s+this.B_re[b]*t);s=1,t=0;var w=this.B_re[1],x=this.B_im[1];for(b=2;6>=b;b++)q=s*n-t*o,r=t*n+s*o,s=q,t=r,w+=b*(this.B_re[b]*s-this.B_im[b]*t),x+=b*(this.B_im[b]*s+this.B_re[b]*t);var y=w*w+x*x;n=(u*w+v*x)/y,o=(v*w-u*x)/y}var z=n,A=o,B=1,C=0;for(b=1;9>=b;b++)B*=z,C+=this.D[b]*B;var D=this.lat0+C*d*1e5,E=this.long0+A;return a.x=E,a.y=D,a},c.names=["New_Zealand_Map_Grid","nzmg"]},{}],55:[function(a,b,c){var d=a("../common/tsfnz"),e=a("../common/adjust_lon"),f=a("../common/phi2z"),g=Math.PI/2,h=Math.PI/4,i=1e-10;c.init=function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var a=Math.sin(this.lat0),b=Math.cos(this.lat0),c=this.e*a;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(b,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-c*c);var f=d(this.e,this.lat0,a),g=this.bl/b*Math.sqrt((1-this.es)/(1-c*c));1>g*g&&(g=1);var h,i;if(isNaN(this.longc)){var j=d(this.e,this.lat1,Math.sin(this.lat1)),k=d(this.e,this.lat2,Math.sin(this.lat2));this.el=this.lat0>=0?(g+Math.sqrt(g*g-1))*Math.pow(f,this.bl):(g-Math.sqrt(g*g-1))*Math.pow(f,this.bl);var l=Math.pow(j,this.bl),m=Math.pow(k,this.bl);h=this.el/l,i=.5*(h-1/h);var n=(this.el*this.el-m*l)/(this.el*this.el+m*l),o=(m-l)/(m+l),p=e(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(n*Math.tan(.5*this.bl*p)/o)/this.bl,this.long0=e(this.long0);var q=e(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*q)/i),this.alpha=Math.asin(g*Math.sin(this.gamma0))}else h=this.lat0>=0?g+Math.sqrt(g*g-1):g-Math.sqrt(g*g-1),this.el=h*Math.pow(f,this.bl),i=.5*(h-1/h),this.gamma0=Math.asin(Math.sin(this.alpha)/g),this.long0=this.longc-Math.asin(i*Math.tan(this.gamma0))/this.bl;this.uc=this.no_off?0:this.lat0>=0?this.al/this.bl*Math.atan2(Math.sqrt(g*g-1),Math.cos(this.alpha)):-1*this.al/this.bl*Math.atan2(Math.sqrt(g*g-1),Math.cos(this.alpha))},c.forward=function(a){var b,c,f,j=a.x,k=a.y,l=e(j-this.long0);if(Math.abs(Math.abs(k)-g)<=i)f=k>0?-1:1,c=this.al/this.bl*Math.log(Math.tan(h+f*this.gamma0*.5)),b=-1*f*g*this.al/this.bl;else{var m=d(this.e,k,Math.sin(k)),n=this.el/Math.pow(m,this.bl),o=.5*(n-1/n),p=.5*(n+1/n),q=Math.sin(this.bl*l),r=(o*Math.sin(this.gamma0)-q*Math.cos(this.gamma0))/p;c=Math.abs(Math.abs(r)-1)<=i?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-r)/(1+r))/this.bl,b=Math.abs(Math.cos(this.bl*l))<=i?this.al*this.bl*l:this.al*Math.atan2(o*Math.cos(this.gamma0)+q*Math.sin(this.gamma0),Math.cos(this.bl*l))/this.bl}return this.no_rot?(a.x=this.x0+b,a.y=this.y0+c):(b-=this.uc,a.x=this.x0+c*Math.cos(this.alpha)+b*Math.sin(this.alpha),a.y=this.y0+b*Math.cos(this.alpha)-c*Math.sin(this.alpha)),a},c.inverse=function(a){var b,c;this.no_rot?(c=a.y-this.y0,b=a.x-this.x0):(c=(a.x-this.x0)*Math.cos(this.alpha)-(a.y-this.y0)*Math.sin(this.alpha),b=(a.y-this.y0)*Math.cos(this.alpha)+(a.x-this.x0)*Math.sin(this.alpha),b+=this.uc);var d=Math.exp(-1*this.bl*c/this.al),h=.5*(d-1/d),j=.5*(d+1/d),k=Math.sin(this.bl*b/this.al),l=(k*Math.cos(this.gamma0)+h*Math.sin(this.gamma0))/j,m=Math.pow(this.el/Math.sqrt((1+l)/(1-l)),1/this.bl);return Math.abs(l-1)<i?(a.x=this.long0,a.y=g):Math.abs(l+1)<i?(a.x=this.long0,a.y=-1*g):(a.y=f(this.e,m),a.x=e(this.long0-Math.atan2(h*Math.cos(this.gamma0)-k*Math.sin(this.gamma0),Math.cos(this.bl*b/this.al))/this.bl)),a},c.names=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},{"../common/adjust_lon":5,"../common/phi2z":16,"../common/tsfnz":24}],56:[function(a,b,c){var d=a("../common/e0fn"),e=a("../common/e1fn"),f=a("../common/e2fn"),g=a("../common/e3fn"),h=a("../common/adjust_lon"),i=a("../common/adjust_lat"),j=a("../common/mlfn"),k=1e-10,l=a("../common/gN"),m=20;c.init=function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=d(this.es),this.e1=e(this.es),this.e2=f(this.es),this.e3=g(this.es),this.ml0=this.a*j(this.e0,this.e1,this.e2,this.e3,this.lat0)},c.forward=function(a){var b,c,d,e=a.x,f=a.y,g=h(e-this.long0);if(d=g*Math.sin(f),this.sphere)Math.abs(f)<=k?(b=this.a*g,c=-1*this.a*this.lat0):(b=this.a*Math.sin(d)/Math.tan(f),c=this.a*(i(f-this.lat0)+(1-Math.cos(d))/Math.tan(f)));else if(Math.abs(f)<=k)b=this.a*g,c=-1*this.ml0;else{var m=l(this.a,this.e,Math.sin(f))/Math.tan(f);b=m*Math.sin(d),c=this.a*j(this.e0,this.e1,this.e2,this.e3,f)-this.ml0+m*(1-Math.cos(d))}return a.x=b+this.x0,a.y=c+this.y0,a},c.inverse=function(a){var b,c,d,e,f,g,i,l,n;if(d=a.x-this.x0,e=a.y-this.y0,this.sphere)if(Math.abs(e+this.a*this.lat0)<=k)b=h(d/this.a+this.long0),c=0;else{g=this.lat0+e/this.a,i=d*d/this.a/this.a+g*g,l=g;var o;for(f=m;f;--f)if(o=Math.tan(l),n=-1*(g*(l*o+1)-l-.5*(l*l+i)*o)/((l-g)/o-1),l+=n,Math.abs(n)<=k){c=l;break}b=h(this.long0+Math.asin(d*Math.tan(l)/this.a)/Math.sin(c))}else if(Math.abs(e+this.ml0)<=k)c=0,b=h(this.long0+d/this.a);else{g=(this.ml0+e)/this.a,i=d*d/this.a/this.a+g*g,l=g;var p,q,r,s,t;for(f=m;f;--f)if(t=this.e*Math.sin(l),p=Math.sqrt(1-t*t)*Math.tan(l),q=this.a*j(this.e0,this.e1,this.e2,this.e3,l),r=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),s=q/this.a,n=(g*(p*s+1)-s-.5*p*(s*s+i))/(this.es*Math.sin(2*l)*(s*s+i-2*g*s)/(4*p)+(g-s)*(p*r-2/Math.sin(2*l))-r),l-=n,Math.abs(n)<=k){c=l;break}p=Math.sqrt(1-this.es*Math.pow(Math.sin(c),2))*Math.tan(c),b=h(this.long0+Math.asin(d*p/this.a)/Math.sin(c))}return a.x=b,a.y=c,a},c.names=["Polyconic","poly"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/gN":11,"../common/mlfn":14}],57:[function(a,b,c){var d=a("../common/adjust_lon"),e=a("../common/adjust_lat"),f=a("../common/pj_enfn"),g=20,h=a("../common/pj_mlfn"),i=a("../common/pj_inv_mlfn"),j=Math.PI/2,k=1e-10,l=a("../common/asinz");c.init=function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=f(this.es)},c.forward=function(a){var b,c,e=a.x,f=a.y;if(e=d(e-this.long0),this.sphere){if(this.m)for(var i=this.n*Math.sin(f),j=g;j;--j){var l=(this.m*f+Math.sin(f)-i)/(this.m+Math.cos(f));if(f-=l,Math.abs(l)<k)break}else f=1!==this.n?Math.asin(this.n*Math.sin(f)):f;b=this.a*this.C_x*e*(this.m+Math.cos(f)),c=this.a*this.C_y*f}else{var m=Math.sin(f),n=Math.cos(f);c=this.a*h(f,m,n,this.en),b=this.a*e*n/Math.sqrt(1-this.es*m*m)}return a.x=b,a.y=c,a},c.inverse=function(a){var b,c,f,g;return a.x-=this.x0,f=a.x/this.a,a.y-=this.y0,b=a.y/this.a,this.sphere?(b/=this.C_y,f/=this.C_x*(this.m+Math.cos(b)),this.m?b=l((this.m*b+Math.sin(b))/this.n):1!==this.n&&(b=l(Math.sin(b)/this.n)),f=d(f+this.long0),b=e(b)):(b=i(a.y/this.a,this.es,this.en),g=Math.abs(b),j>g?(g=Math.sin(b),c=this.long0+a.x*Math.sqrt(1-this.es*g*g)/(this.a*Math.cos(b)),f=d(c)):j>g-k&&(f=this.long0)),a.x=f,a.y=b,a},c.names=["Sinusoidal","sinu"]},{"../common/adjust_lat":4,"../common/adjust_lon":5,"../common/asinz":6,"../common/pj_enfn":17,"../common/pj_inv_mlfn":18,"../common/pj_mlfn":19}],58:[function(a,b,c){c.init=function(){var a=this.lat0;this.lambda0=this.long0;var b=Math.sin(a),c=this.a,d=this.rf,e=1/d,f=2*e-Math.pow(e,2),g=this.e=Math.sqrt(f);this.R=this.k0*c*Math.sqrt(1-f)/(1-f*Math.pow(b,2)),this.alpha=Math.sqrt(1+f/(1-f)*Math.pow(Math.cos(a),4)),this.b0=Math.asin(b/this.alpha);var h=Math.log(Math.tan(Math.PI/4+this.b0/2)),i=Math.log(Math.tan(Math.PI/4+a/2)),j=Math.log((1+g*b)/(1-g*b));this.K=h-this.alpha*i+this.alpha*g/2*j},c.forward=function(a){var b=Math.log(Math.tan(Math.PI/4-a.y/2)),c=this.e/2*Math.log((1+this.e*Math.sin(a.y))/(1-this.e*Math.sin(a.y))),d=-this.alpha*(b+c)+this.K,e=2*(Math.atan(Math.exp(d))-Math.PI/4),f=this.alpha*(a.x-this.lambda0),g=Math.atan(Math.sin(f)/(Math.sin(this.b0)*Math.tan(e)+Math.cos(this.b0)*Math.cos(f))),h=Math.asin(Math.cos(this.b0)*Math.sin(e)-Math.sin(this.b0)*Math.cos(e)*Math.cos(f));return a.y=this.R/2*Math.log((1+Math.sin(h))/(1-Math.sin(h)))+this.y0,a.x=this.R*g+this.x0,a},c.inverse=function(a){for(var b=a.x-this.x0,c=a.y-this.y0,d=b/this.R,e=2*(Math.atan(Math.exp(c/this.R))-Math.PI/4),f=Math.asin(Math.cos(this.b0)*Math.sin(e)+Math.sin(this.b0)*Math.cos(e)*Math.cos(d)),g=Math.atan(Math.sin(d)/(Math.cos(this.b0)*Math.cos(d)-Math.sin(this.b0)*Math.tan(e))),h=this.lambda0+g/this.alpha,i=0,j=f,k=-1e3,l=0;Math.abs(j-k)>1e-7;){if(++l>20)return;i=1/this.alpha*(Math.log(Math.tan(Math.PI/4+f/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(j))/2)),k=j,j=2*Math.atan(Math.exp(i))-Math.PI/2}return a.x=h,a.y=j,a},c.names=["somerc"]},{}],59:[function(a,b,c){var d=Math.PI/2,e=1e-10,f=a("../common/sign"),g=a("../common/msfnz"),h=a("../common/tsfnz"),i=a("../common/phi2z"),j=a("../common/adjust_lon");c.ssfn_=function(a,b,c){return b*=c,Math.tan(.5*(d+a))*Math.pow((1-b)/(1+b),.5*c)},c.init=function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=e&&(this.k0=.5*(1+f(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=e&&(this.con=this.lat0>0?1:-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=e&&(this.k0=.5*this.cons*g(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/h(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=g(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-d,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},c.forward=function(a){var b,c,f,g,i,k,l=a.x,m=a.y,n=Math.sin(m),o=Math.cos(m),p=j(l-this.long0);return Math.abs(Math.abs(l-this.long0)-Math.PI)<=e&&Math.abs(m+this.lat0)<=e?(a.x=0/0,a.y=0/0,a):this.sphere?(b=2*this.k0/(1+this.sinlat0*n+this.coslat0*o*Math.cos(p)),a.x=this.a*b*o*Math.sin(p)+this.x0,a.y=this.a*b*(this.coslat0*n-this.sinlat0*o*Math.cos(p))+this.y0,a):(c=2*Math.atan(this.ssfn_(m,n,this.e))-d,g=Math.cos(c),f=Math.sin(c),Math.abs(this.coslat0)<=e?(i=h(this.e,m*this.con,this.con*n),k=2*this.a*this.k0*i/this.cons,a.x=this.x0+k*Math.sin(l-this.long0),a.y=this.y0-this.con*k*Math.cos(l-this.long0),a):(Math.abs(this.sinlat0)<e?(b=2*this.a*this.k0/(1+g*Math.cos(p)),a.y=b*f):(b=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*f+this.cosX0*g*Math.cos(p))),a.y=b*(this.cosX0*f-this.sinX0*g*Math.cos(p))+this.y0),a.x=b*g*Math.sin(p)+this.x0,a))},c.inverse=function(a){a.x-=this.x0,a.y-=this.y0;var b,c,f,g,h,k=Math.sqrt(a.x*a.x+a.y*a.y);if(this.sphere){var l=2*Math.atan(k/(.5*this.a*this.k0));return b=this.long0,c=this.lat0,e>=k?(a.x=b,a.y=c,a):(c=Math.asin(Math.cos(l)*this.sinlat0+a.y*Math.sin(l)*this.coslat0/k),b=j(Math.abs(this.coslat0)<e?this.lat0>0?this.long0+Math.atan2(a.x,-1*a.y):this.long0+Math.atan2(a.x,a.y):this.long0+Math.atan2(a.x*Math.sin(l),k*this.coslat0*Math.cos(l)-a.y*this.sinlat0*Math.sin(l))),a.x=b,a.y=c,a)}if(Math.abs(this.coslat0)<=e){if(e>=k)return c=this.lat0,b=this.long0,a.x=b,a.y=c,a;a.x*=this.con,a.y*=this.con,f=k*this.cons/(2*this.a*this.k0),c=this.con*i(this.e,f),b=this.con*j(this.con*this.long0+Math.atan2(a.x,-1*a.y))}else g=2*Math.atan(k*this.cosX0/(2*this.a*this.k0*this.ms1)),b=this.long0,e>=k?h=this.X0:(h=Math.asin(Math.cos(g)*this.sinX0+a.y*Math.sin(g)*this.cosX0/k),b=j(this.long0+Math.atan2(a.x*Math.sin(g),k*this.cosX0*Math.cos(g)-a.y*this.sinX0*Math.sin(g)))),c=-1*i(this.e,Math.tan(.5*(d+h)));return a.x=b,a.y=c,a},c.names=["stere"]},{"../common/adjust_lon":5,"../common/msfnz":15,"../common/phi2z":16,"../common/sign":21,"../common/tsfnz":24}],60:[function(a,b,c){var d=a("./gauss"),e=a("../common/adjust_lon");c.init=function(){d.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},c.forward=function(a){var b,c,f,g;return a.x=e(a.x-this.long0),d.forward.apply(this,[a]),b=Math.sin(a.y),c=Math.cos(a.y),f=Math.cos(a.x),g=this.k0*this.R2/(1+this.sinc0*b+this.cosc0*c*f),a.x=g*c*Math.sin(a.x),a.y=g*(this.cosc0*b-this.sinc0*c*f),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a},c.inverse=function(a){var b,c,f,g,h;if(a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,h=Math.sqrt(a.x*a.x+a.y*a.y)){var i=2*Math.atan2(h,this.R2);b=Math.sin(i),c=Math.cos(i),g=Math.asin(c*this.sinc0+a.y*b*this.cosc0/h),f=Math.atan2(a.x*b,h*this.cosc0*c-a.y*this.sinc0*b)}else g=this.phic0,f=0;return a.x=f,a.y=g,d.inverse.apply(this,[a]),a.x=e(a.x+this.long0),a},c.names=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},{"../common/adjust_lon":5,"./gauss":45}],61:[function(a,b,c){var d=a("../common/e0fn"),e=a("../common/e1fn"),f=a("../common/e2fn"),g=a("../common/e3fn"),h=a("../common/mlfn"),i=a("../common/adjust_lon"),j=Math.PI/2,k=1e-10,l=a("../common/sign"),m=a("../common/asinz");c.init=function(){this.e0=d(this.es),this.e1=e(this.es),this.e2=f(this.es),this.e3=g(this.es),this.ml0=this.a*h(this.e0,this.e1,this.e2,this.e3,this.lat0)},c.forward=function(a){var b,c,d,e=a.x,f=a.y,g=i(e-this.long0),j=Math.sin(f),k=Math.cos(f);if(this.sphere){var l=k*Math.sin(g);if(Math.abs(Math.abs(l)-1)<1e-10)return 93;c=.5*this.a*this.k0*Math.log((1+l)/(1-l)),b=Math.acos(k*Math.cos(g)/Math.sqrt(1-l*l)),0>f&&(b=-b),d=this.a*this.k0*(b-this.lat0)}else{var m=k*g,n=Math.pow(m,2),o=this.ep2*Math.pow(k,2),p=Math.tan(f),q=Math.pow(p,2);b=1-this.es*Math.pow(j,2);var r=this.a/Math.sqrt(b),s=this.a*h(this.e0,this.e1,this.e2,this.e3,f);c=this.k0*r*m*(1+n/6*(1-q+o+n/20*(5-18*q+Math.pow(q,2)+72*o-58*this.ep2)))+this.x0,d=this.k0*(s-this.ml0+r*p*n*(.5+n/24*(5-q+9*o+4*Math.pow(o,2)+n/30*(61-58*q+Math.pow(q,2)+600*o-330*this.ep2))))+this.y0}return a.x=c,a.y=d,a},c.inverse=function(a){var b,c,d,e,f,g,h=6;if(this.sphere){var n=Math.exp(a.x/(this.a*this.k0)),o=.5*(n-1/n),p=this.lat0+a.y/(this.a*this.k0),q=Math.cos(p);b=Math.sqrt((1-q*q)/(1+o*o)),f=m(b),0>p&&(f=-f),g=0===o&&0===q?this.long0:i(Math.atan2(o,q)+this.long0)}else{var r=a.x-this.x0,s=a.y-this.y0;for(b=(this.ml0+s/this.k0)/this.a,c=b,e=0;d=(b+this.e1*Math.sin(2*c)-this.e2*Math.sin(4*c)+this.e3*Math.sin(6*c))/this.e0-c,c+=d,!(Math.abs(d)<=k);e++)if(e>=h)return 95;if(Math.abs(c)<j){var t=Math.sin(c),u=Math.cos(c),v=Math.tan(c),w=this.ep2*Math.pow(u,2),x=Math.pow(w,2),y=Math.pow(v,2),z=Math.pow(y,2);b=1-this.es*Math.pow(t,2);var A=this.a/Math.sqrt(b),B=A*(1-this.es)/b,C=r/(A*this.k0),D=Math.pow(C,2);f=c-A*v*D/B*(.5-D/24*(5+3*y+10*w-4*x-9*this.ep2-D/30*(61+90*y+298*w+45*z-252*this.ep2-3*x))),g=i(this.long0+C*(1-D/6*(1+2*y+w-D/20*(5-2*w+28*y-3*x+8*this.ep2+24*z)))/u)}else f=j*l(s),g=this.long0}return a.x=g,a.y=f,a},c.names=["Transverse_Mercator","Transverse Mercator","tmerc"]},{"../common/adjust_lon":5,"../common/asinz":6,"../common/e0fn":7,"../common/e1fn":8,"../common/e2fn":9,"../common/e3fn":10,"../common/mlfn":14,"../common/sign":21}],62:[function(a,b,c){var d=.017453292519943295,e=a("./tmerc");c.dependsOn="tmerc",c.init=function(){this.zone&&(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*d,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,e.init.apply(this),this.forward=e.forward,this.inverse=e.inverse)},c.names=["Universal Transverse Mercator System","utm"]},{"./tmerc":61}],63:[function(a,b,c){var d=a("../common/adjust_lon"),e=Math.PI/2,f=1e-10,g=a("../common/asinz");c.init=function(){this.R=this.a},c.forward=function(a){var b,c,h=a.x,i=a.y,j=d(h-this.long0);Math.abs(i)<=f&&(b=this.x0+this.R*j,c=this.y0);var k=g(2*Math.abs(i/Math.PI));(Math.abs(j)<=f||Math.abs(Math.abs(i)-e)<=f)&&(b=this.x0,c=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*k):this.y0+Math.PI*this.R*-Math.tan(.5*k));var l=.5*Math.abs(Math.PI/j-j/Math.PI),m=l*l,n=Math.sin(k),o=Math.cos(k),p=o/(n+o-1),q=p*p,r=p*(2/n-1),s=r*r,t=Math.PI*this.R*(l*(p-s)+Math.sqrt(m*(p-s)*(p-s)-(s+m)*(q-s)))/(s+m);0>j&&(t=-t),b=this.x0+t;var u=m+p;return t=Math.PI*this.R*(r*u-l*Math.sqrt((s+m)*(m+1)-u*u))/(s+m),c=i>=0?this.y0+t:this.y0-t,a.x=b,a.y=c,a},c.inverse=function(a){var b,c,e,g,h,i,j,k,l,m,n,o,p;return a.x-=this.x0,a.y-=this.y0,n=Math.PI*this.R,e=a.x/n,g=a.y/n,h=e*e+g*g,i=-Math.abs(g)*(1+h),j=i-2*g*g+e*e,k=-2*i+1+2*g*g+h*h,p=g*g/k+(2*j*j*j/k/k/k-9*i*j/k/k)/27,l=(i-j*j/3/k)/k,m=2*Math.sqrt(-l/3),n=3*p/l/m,Math.abs(n)>1&&(n=n>=0?1:-1),o=Math.acos(n)/3,c=a.y>=0?(-m*Math.cos(o+Math.PI/3)-j/3/k)*Math.PI:-(-m*Math.cos(o+Math.PI/3)-j/3/k)*Math.PI,b=Math.abs(e)<f?this.long0:d(this.long0+Math.PI*(h-1+Math.sqrt(1+2*(e*e-g*g)+h*h))/2/e),a.x=b,a.y=c,a},c.names=["Van_der_Grinten_I","VanDerGrinten","vandg"]},{"../common/adjust_lon":5,"../common/asinz":6}],64:[function(a,b){var c=.017453292519943295,d=57.29577951308232,e=1,f=2,g=a("./datum_transform"),h=a("./adjust_axis"),i=a("./Proj"),j=a("./common/toPoint");b.exports=function k(a,b,l){function m(a,b){return(a.datum.datum_type===e||a.datum.datum_type===f)&&"WGS84"!==b.datumCode}var n;return Array.isArray(l)&&(l=j(l)),a.datum&&b.datum&&(m(a,b)||m(b,a))&&(n=new i("WGS84"),k(a,n,l),a=n),"enu"!==a.axis&&h(a,!1,l),"longlat"===a.projName?(l.x*=c,l.y*=c):(a.to_meter&&(l.x*=a.to_meter,l.y*=a.to_meter),a.inverse(l)),a.from_greenwich&&(l.x+=a.from_greenwich),l=g(a.datum,b.datum,l),b.from_greenwich&&(l.x-=b.from_greenwich),"longlat"===b.projName?(l.x*=d,l.y*=d):(b.forward(l),b.to_meter&&(l.x/=b.to_meter,l.y/=b.to_meter)),"enu"!==b.axis&&h(b,!0,l),l}},{"./Proj":2,"./adjust_axis":3,"./common/toPoint":23,"./datum_transform":30}],65:[function(a,b){function c(a,b,c){a[b]=c.map(function(a){var b={};return d(a,b),b}).reduce(function(a,b){return i(a,b)},{})}function d(a,b){var e;return Array.isArray(a)?(e=a.shift(),"PARAMETER"===e&&(e=a.shift()),void(1===a.length?Array.isArray(a[0])?(b[e]={},d(a[0],b[e])):b[e]=a[0]:a.length?"TOWGS84"===e?b[e]=a:(b[e]={},["UNIT","PRIMEM","VERT_DATUM"].indexOf(e)>-1?(b[e]={name:a[0].toLowerCase(),convert:a[1]},3===a.length&&(b[e].auth=a[2])):"SPHEROID"===e?(b[e]={name:a[0],a:a[1],rf:a[2]},4===a.length&&(b[e].auth=a[3])):["GEOGCS","GEOCCS","DATUM","VERT_CS","COMPD_CS","LOCAL_CS","FITTED_CS","LOCAL_DATUM"].indexOf(e)>-1?(a[0]=["name",a[0]],c(b,e,a)):a.every(function(a){return Array.isArray(a)})?c(b,e,a):d(a,b[e])):b[e]=!0)):void(b[a]=!0)}function e(a,b){var c=b[0],d=b[1];!(c in a)&&d in a&&(a[c]=a[d],3===b.length&&(a[c]=b[2](a[c])))}function f(a){return a*h}function g(a){function b(b){var c=a.to_meter||1;return parseFloat(b,10)*c}"GEOGCS"===a.type?a.projName="longlat":"LOCAL_CS"===a.type?(a.projName="identity",a.local=!0):a.projName="object"==typeof a.PROJECTION?Object.keys(a.PROJECTION)[0]:a.PROJECTION,a.UNIT&&(a.units=a.UNIT.name.toLowerCase(),"metre"===a.units&&(a.units="meter"),a.UNIT.convert&&(a.to_meter=parseFloat(a.UNIT.convert,10))),a.GEOGCS&&(a.datumCode=a.GEOGCS.DATUM?a.GEOGCS.DATUM.name.toLowerCase():a.GEOGCS.name.toLowerCase(),"d_"===a.datumCode.slice(0,2)&&(a.datumCode=a.datumCode.slice(2)),("new_zealand_geodetic_datum_1949"===a.datumCode||"new_zealand_1949"===a.datumCode)&&(a.datumCode="nzgd49"),"wgs_1984"===a.datumCode&&("Mercator_Auxiliary_Sphere"===a.PROJECTION&&(a.sphere=!0),a.datumCode="wgs84"),"_ferro"===a.datumCode.slice(-6)&&(a.datumCode=a.datumCode.slice(0,-6)),"_jakarta"===a.datumCode.slice(-8)&&(a.datumCode=a.datumCode.slice(0,-8)),~a.datumCode.indexOf("belge")&&(a.datumCode="rnb72"),a.GEOGCS.DATUM&&a.GEOGCS.DATUM.SPHEROID&&(a.ellps=a.GEOGCS.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===a.ellps.toLowerCase().slice(0,13)&&(a.ellps="intl"),a.a=a.GEOGCS.DATUM.SPHEROID.a,a.rf=parseFloat(a.GEOGCS.DATUM.SPHEROID.rf,10))),a.b&&!isFinite(a.b)&&(a.b=a.a);
var c=function(b){return e(a,b)},d=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",f],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",f],["x0","false_easting",b],["y0","false_northing",b],["long0","central_meridian",f],["lat0","latitude_of_origin",f],["lat0","standard_parallel_1",f],["lat1","standard_parallel_1",f],["lat2","standard_parallel_2",f],["alpha","azimuth",f],["srsCode","name"]];d.forEach(c),a.long0||!a.longc||"Albers_Conic_Equal_Area"!==a.PROJECTION&&"Lambert_Azimuthal_Equal_Area"!==a.PROJECTION||(a.long0=a.longc)}var h=.017453292519943295,i=a("./extend");b.exports=function(a,b){var c=JSON.parse((","+a).replace(/\s*\,\s*([A-Z_0-9]+?)(\[)/g,',["$1",').slice(1).replace(/\s*\,\s*([A-Z_0-9]+?)\]/g,',"$1"]')),e=c.shift(),f=c.shift();c.unshift(["name",f]),c.unshift(["type",e]),c.unshift("output");var h={};return d(c,h),g(h.output),i(b,h.output)}},{"./extend":33}],66:[function(a,b,c){function d(a){return a*(Math.PI/180)}function e(a){return 180*(a/Math.PI)}function f(a){var b,c,e,f,g,i,j,k,l,m=a.lat,n=a.lon,o=6378137,p=.00669438,q=.9996,r=d(m),s=d(n);l=Math.floor((n+180)/6)+1,180===n&&(l=60),m>=56&&64>m&&n>=3&&12>n&&(l=32),m>=72&&84>m&&(n>=0&&9>n?l=31:n>=9&&21>n?l=33:n>=21&&33>n?l=35:n>=33&&42>n&&(l=37)),b=6*(l-1)-180+3,k=d(b),c=p/(1-p),e=o/Math.sqrt(1-p*Math.sin(r)*Math.sin(r)),f=Math.tan(r)*Math.tan(r),g=c*Math.cos(r)*Math.cos(r),i=Math.cos(r)*(s-k),j=o*((1-p/4-3*p*p/64-5*p*p*p/256)*r-(3*p/8+3*p*p/32+45*p*p*p/1024)*Math.sin(2*r)+(15*p*p/256+45*p*p*p/1024)*Math.sin(4*r)-35*p*p*p/3072*Math.sin(6*r));var t=q*e*(i+(1-f+g)*i*i*i/6+(5-18*f+f*f+72*g-58*c)*i*i*i*i*i/120)+5e5,u=q*(j+e*Math.tan(r)*(i*i/2+(5-f+9*g+4*g*g)*i*i*i*i/24+(61-58*f+f*f+600*g-330*c)*i*i*i*i*i*i/720));return 0>m&&(u+=1e7),{northing:Math.round(u),easting:Math.round(t),zoneNumber:l,zoneLetter:h(m)}}function g(a){var b=a.northing,c=a.easting,d=a.zoneLetter,f=a.zoneNumber;if(0>f||f>60)return null;var h,i,j,k,l,m,n,o,p,q,r=.9996,s=6378137,t=.00669438,u=(1-Math.sqrt(1-t))/(1+Math.sqrt(1-t)),v=c-5e5,w=b;"N">d&&(w-=1e7),o=6*(f-1)-180+3,h=t/(1-t),n=w/r,p=n/(s*(1-t/4-3*t*t/64-5*t*t*t/256)),q=p+(3*u/2-27*u*u*u/32)*Math.sin(2*p)+(21*u*u/16-55*u*u*u*u/32)*Math.sin(4*p)+151*u*u*u/96*Math.sin(6*p),i=s/Math.sqrt(1-t*Math.sin(q)*Math.sin(q)),j=Math.tan(q)*Math.tan(q),k=h*Math.cos(q)*Math.cos(q),l=s*(1-t)/Math.pow(1-t*Math.sin(q)*Math.sin(q),1.5),m=v/(i*r);var x=q-i*Math.tan(q)/l*(m*m/2-(5+3*j+10*k-4*k*k-9*h)*m*m*m*m/24+(61+90*j+298*k+45*j*j-252*h-3*k*k)*m*m*m*m*m*m/720);x=e(x);var y=(m-(1+2*j+k)*m*m*m/6+(5-2*k+28*j-3*k*k+8*h+24*j*j)*m*m*m*m*m/120)/Math.cos(q);y=o+e(y);var z;if(a.accuracy){var A=g({northing:a.northing+a.accuracy,easting:a.easting+a.accuracy,zoneLetter:a.zoneLetter,zoneNumber:a.zoneNumber});z={top:A.lat,right:A.lon,bottom:x,left:y}}else z={lat:x,lon:y};return z}function h(a){var b="Z";return 84>=a&&a>=72?b="X":72>a&&a>=64?b="W":64>a&&a>=56?b="V":56>a&&a>=48?b="U":48>a&&a>=40?b="T":40>a&&a>=32?b="S":32>a&&a>=24?b="R":24>a&&a>=16?b="Q":16>a&&a>=8?b="P":8>a&&a>=0?b="N":0>a&&a>=-8?b="M":-8>a&&a>=-16?b="L":-16>a&&a>=-24?b="K":-24>a&&a>=-32?b="J":-32>a&&a>=-40?b="H":-40>a&&a>=-48?b="G":-48>a&&a>=-56?b="F":-56>a&&a>=-64?b="E":-64>a&&a>=-72?b="D":-72>a&&a>=-80&&(b="C"),b}function i(a,b){var c=""+a.easting,d=""+a.northing;return a.zoneNumber+a.zoneLetter+j(a.easting,a.northing,a.zoneNumber)+c.substr(c.length-5,b)+d.substr(d.length-5,b)}function j(a,b,c){var d=k(c),e=Math.floor(a/1e5),f=Math.floor(b/1e5)%20;return l(e,f,d)}function k(a){var b=a%q;return 0===b&&(b=q),b}function l(a,b,c){var d=c-1,e=r.charCodeAt(d),f=s.charCodeAt(d),g=e+a-1,h=f+b,i=!1;g>x&&(g=g-x+t-1,i=!0),(g===u||u>e&&g>u||(g>u||u>e)&&i)&&g++,(g===v||v>e&&g>v||(g>v||v>e)&&i)&&(g++,g===u&&g++),g>x&&(g=g-x+t-1),h>w?(h=h-w+t-1,i=!0):i=!1,(h===u||u>f&&h>u||(h>u||u>f)&&i)&&h++,(h===v||v>f&&h>v||(h>v||v>f)&&i)&&(h++,h===u&&h++),h>w&&(h=h-w+t-1);var j=String.fromCharCode(g)+String.fromCharCode(h);return j}function m(a){if(a&&0===a.length)throw"MGRSPoint coverting from nothing";for(var b,c=a.length,d=null,e="",f=0;!/[A-Z]/.test(b=a.charAt(f));){if(f>=2)throw"MGRSPoint bad conversion from: "+a;e+=b,f++}var g=parseInt(e,10);if(0===f||f+3>c)throw"MGRSPoint bad conversion from: "+a;var h=a.charAt(f++);if("A">=h||"B"===h||"Y"===h||h>="Z"||"I"===h||"O"===h)throw"MGRSPoint zone letter "+h+" not handled: "+a;d=a.substring(f,f+=2);for(var i=k(g),j=n(d.charAt(0),i),l=o(d.charAt(1),i);l<p(h);)l+=2e6;var m=c-f;if(m%2!==0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+a;var q,r,s,t,u,v=m/2,w=0,x=0;return v>0&&(q=1e5/Math.pow(10,v),r=a.substring(f,f+v),w=parseFloat(r)*q,s=a.substring(f+v),x=parseFloat(s)*q),t=w+j,u=x+l,{easting:t,northing:u,zoneLetter:h,zoneNumber:g,accuracy:q}}function n(a,b){for(var c=r.charCodeAt(b-1),d=1e5,e=!1;c!==a.charCodeAt(0);){if(c++,c===u&&c++,c===v&&c++,c>x){if(e)throw"Bad character: "+a;c=t,e=!0}d+=1e5}return d}function o(a,b){if(a>"V")throw"MGRSPoint given invalid Northing "+a;for(var c=s.charCodeAt(b-1),d=0,e=!1;c!==a.charCodeAt(0);){if(c++,c===u&&c++,c===v&&c++,c>w){if(e)throw"Bad character: "+a;c=t,e=!0}d+=1e5}return d}function p(a){var b;switch(a){case"C":b=11e5;break;case"D":b=2e6;break;case"E":b=28e5;break;case"F":b=37e5;break;case"G":b=46e5;break;case"H":b=55e5;break;case"J":b=64e5;break;case"K":b=73e5;break;case"L":b=82e5;break;case"M":b=91e5;break;case"N":b=0;break;case"P":b=8e5;break;case"Q":b=17e5;break;case"R":b=26e5;break;case"S":b=35e5;break;case"T":b=44e5;break;case"U":b=53e5;break;case"V":b=62e5;break;case"W":b=7e6;break;case"X":b=79e5;break;default:b=-1}if(b>=0)return b;throw"Invalid zone letter: "+a}var q=6,r="AJSAJS",s="AFAFAF",t=65,u=73,v=79,w=86,x=90;c.forward=function(a,b){return b=b||5,i(f({lat:a[1],lon:a[0]}),b)},c.inverse=function(a){var b=g(m(a.toUpperCase()));return[b.left,b.bottom,b.right,b.top]},c.toPoint=function(a){var b=c.inverse(a);return[(b[2]+b[0])/2,(b[3]+b[1])/2]}},{}],67:[function(a,b){b.exports={name:"proj4",version:"2.1.2",description:"Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",main:"lib/index.js",directories:{test:"test",doc:"docs"},scripts:{test:"./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},repository:{type:"git",url:"git://github.com/proj4js/proj4js.git"},author:"",license:"MIT",jam:{main:"dist/proj4.js",include:["dist/proj4.js","README.md","AUTHORS","LICENSE.md"]},devDependencies:{"grunt-cli":"~0.1.13",grunt:"~0.4.2","grunt-contrib-connect":"~0.6.0","grunt-contrib-jshint":"~0.8.0",chai:"~1.8.1",mocha:"~1.17.1","grunt-mocha-phantomjs":"~0.4.0",browserify:"~3.24.5","grunt-browserify":"~1.3.0","grunt-contrib-uglify":"~0.3.2",curl:"git://github.com/cujojs/curl.git",istanbul:"~0.2.4",tin:"~0.4.0"},dependencies:{mgrs:"0.0.0"}}},{}],"./includedProjections":[function(a,b){b.exports=a("gWUPNW")},{}],gWUPNW:[function(a,b){var c=[a("./lib/projections/tmerc"),a("./lib/projections/utm"),a("./lib/projections/sterea"),a("./lib/projections/stere"),a("./lib/projections/somerc"),a("./lib/projections/omerc"),a("./lib/projections/lcc"),a("./lib/projections/krovak"),a("./lib/projections/cass"),a("./lib/projections/laea"),a("./lib/projections/aea"),a("./lib/projections/gnom"),a("./lib/projections/cea"),a("./lib/projections/eqc"),a("./lib/projections/poly"),a("./lib/projections/nzmg"),a("./lib/projections/mill"),a("./lib/projections/sinu"),a("./lib/projections/moll"),a("./lib/projections/eqdc"),a("./lib/projections/vandg"),a("./lib/projections/aeqd")];b.exports=function(a){c.forEach(function(b){a.Proj.projections.add(b)})}},{"./lib/projections/aea":39,"./lib/projections/aeqd":40,"./lib/projections/cass":41,"./lib/projections/cea":42,"./lib/projections/eqc":43,"./lib/projections/eqdc":44,"./lib/projections/gnom":46,"./lib/projections/krovak":47,"./lib/projections/laea":48,"./lib/projections/lcc":49,"./lib/projections/mill":52,"./lib/projections/moll":53,"./lib/projections/nzmg":54,"./lib/projections/omerc":55,"./lib/projections/poly":56,"./lib/projections/sinu":57,"./lib/projections/somerc":58,"./lib/projections/stere":59,"./lib/projections/sterea":60,"./lib/projections/tmerc":61,"./lib/projections/utm":62,"./lib/projections/vandg":63}]},{},[35])(35)}),!function(){!function(){var a=!1,b=/xyz/.test(function(){postMessage("xyz")})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(c){function d(){!a&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}(),function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var a=function(a){if(a.constructor&&!a.hasOwnProperty("constructor")&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf"))return!1;var b;for(b in a);return void 0===b||a.hasOwnProperty(b)},b=function(c){var d,e,f;for(e=1;e<arguments.length;e++){d=arguments[e];for(f in d)d[f]&&a(d[f])?(c[f]=c[f]||{},b(c[f],d[f])):c[f]=d[f]}return c},c=function(a,b){if(a){var c;if("undefined"!=typeof a.length){for(c=0;c<a.length;c++)if(b(c,a[c])===!1)return}else for(c in a)if(a.hasOwnProperty(c)&&b(c,a[c])===!1)return}},d=function(a,b){var c=document.createEvent("HTMLEvents");c.initEvent(b,!0,!0),a.dispatchEvent(c)},e=function(a,b){var c=new CustomEvent(b,{bubbles:!0,cancelable:!0});a.dispatchEvent(c)},f=function(a,c){c=b({},f.defaults.options,c||{}),this.element=a,this.options=c,this.init()};f.prototype={init:function(){var a=this;this.ready=!1;var b=f.defaults.themes[this.options.theme||f.defaults.theme];if(!b)throw"Unknown theme "+(this.options.theme||f.defaults.theme);this.schema=this.options.schema,this.theme=new b,this.template=this.options.template,this.uuid=0,this.__data={};var c=f.defaults.iconlibs[this.options.iconlib||f.defaults.iconlib];c&&(this.iconlib=new c),this.root_container=this.theme.getContainer(),this.element.appendChild(this.root_container),this.validator=new f.Validator(this.schema,{ajax:this.options.ajax,refs:this.options.refs,no_additional_properties:this.options.no_additional_properties,required_by_default:this.options.required_by_default}),this.validator.ready(function(b){if(!a.ready){a.schema=b;var c=a.getEditorClass(a.schema);a.root=a.createEditor(c,{jsoneditor:a,schema:a.schema,container:a.root_container,required:!0}),a.options.startval&&a.root.setValue(a.options.startval),a.validation_results=a.validator.validate(a.root.getValue()),a.root.showValidationErrors(a.validation_results),a.ready=!0,requestAnimationFrame(function(){a.validation_results=a.validator.validate(a.root.getValue()),a.root.showValidationErrors(a.validation_results),a.trigger("ready"),a.trigger("change")})}})},getValue:function(){if(!this.ready)throw"JSON Editor not ready yet.  Listen for 'ready' event before getting the value";return this.root.getValue()},setValue:function(a){if(!this.ready)throw"JSON Editor not ready yet.  Listen for 'ready' event before setting the value";return this.root.setValue(a),this},validate:function(a){if(!this.ready)throw"JSON Editor not ready yet.  Listen for 'ready' event before validating";return 1===arguments.length?this.validator.validate(a):this.validation_results},destroy:function(){this.destroyed||this.ready&&(this.schema=null,this.options=null,this.root.destroy(),this.root=null,this.root_container=null,this.validator=null,this.validation_results=null,this.theme=null,this.iconlib=null,this.template=null,this.__data=null,this.ready=!1,this.element.innerHTML="",this.destroyed=!0)},on:function(a,b){this.callbacks=this.callbacks||{},this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b)},off:function(a,b){if(a&&b){this.callbacks=this.callbacks||{},this.callbacks[a]=this.callbacks[a]||[];for(var c=[],d=0;d<this.callbacks[a].length;d++)this.callbacks[a][d]!==b&&c.push(this.callbacks[a][d]);this.callbacks[a]=c}else a?(this.callbacks=this.callbacks||{},this.callbacks[a]=[]):this.callbacks={}},trigger:function(a){if(this.callbacks&&this.callbacks[a]&&this.callbacks[a].length)for(var b=0;b<this.callbacks[a].length;b++)this.callbacks[a][b]()},getEditorClass:function(a){var b;if(c(f.defaults.resolvers,function(c,d){var e=d(a);return e&&f.defaults.editors[e]?(b=e,!1):void 0}),!b)throw"Unknown editor for schema "+JSON.stringify(a);if(!f.defaults.editors[b])throw"Unknown editor "+b;return f.defaults.editors[b]},createEditor:function(a,c){return c=b({},a.options||{},c),new a(c)},onChange:function(){if(this.ready&&!this.firing_change){this.firing_change=!0;var a=this;requestAnimationFrame(function(){a.firing_change=!1,a.validation_results=a.validator.validate(a.root.getValue()),a.root.showValidationErrors(a.validation_results),a.trigger("change")})}},compileTemplate:function(a,b){b=b||f.defaults.template;var c;if("string"==typeof b){if(!f.defaults.templates[b])throw"Unknown template engine "+b;if(c=f.defaults.templates[b](),!c)throw"Template engine "+b+" missing required library."}else c=b;if(!c)throw"No template engine set";if(!c.compile)throw"Invalid template engine set";return c.compile(a)},_data:function(a,b,c){if(3!==arguments.length)return a.hasAttribute("data-jsoneditor-"+b)?this.__data[a.getAttribute("data-jsoneditor-"+b)]:null;var d;a.hasAttribute("data-jsoneditor-"+b)?d=a.getAttribute("data-jsoneditor-"+b):(d=this.uuid++,a.setAttribute("data-jsoneditor-"+b,d)),this.__data[d]=c},registerEditor:function(a){return this.editors=this.editors||{},this.editors[a.path]=a,this},unregisterEditor:function(a){return this.editors=this.editors||{},this.editors[a.path]=null,this},getEditor:function(a){return this.editors?this.editors[a]:void 0},watch:function(a,b){return this.watchlist=this.watchlist||{},this.watchlist[a]=this.watchlist[a]||[],this.watchlist[a].push(b),this},unwatch:function(a,b){if(!this.watchlist||!this.watchlist[a])return this;if(!b)return this.watchlist[a]=null,this;for(var c=[],d=0;d<this.watchlist[a].length;d++)this.watchlist[a][d]!==b&&c.push(this.watchlist[a][d]);return this.watchlist[a]=c.length?c:null,this},notifyWatchers:function(a){if(!this.watchlist||!this.watchlist[a])return this;for(var b=0;b<this.watchlist[a].length;b++)this.watchlist[a][b]()},isEnabled:function(){return!this.root||this.root.isEnabled()},enable:function(){this.root.enable()},disable:function(){this.root.disable()}},f.defaults={themes:{},templates:{},iconlibs:{},editors:{},resolvers:[],custom_validators:[]},f.Validator=Class.extend({init:function(a,b){this.original_schema=a,this.options=b||{},this.refs=this.options.refs||{},this.ready_callbacks=[],this.options.ready&&this.ready(this.options.ready),this.getRefs()},ready:function(a){return this.is_ready?a.apply(this,[this.expanded]):this.ready_callbacks.push(a),this},getRefs:function(){var a=this;this._getRefs(this.original_schema,function(b){a.schema=b,a.expanded=a.expandSchema(a.schema),a.is_ready=!0,c(a.ready_callbacks,function(b,c){c.apply(a,[a.expanded])})})},_getRefs:function(a,d,e,f){var g=this,h=a===this.original_schema;e=e||"#";var i,j,k,l;if(a=b({},a),a.definitions&&(h||f)){var m=a.definitions;delete a.definitions,i=j=0,k=function(a){if(j>=i){if(l)return;l=!0,g._getRefs(a,d,e)}},c(m,function(){i++}),i?c(m,function(b,c){g._getRefs(c,function(c){g.refs[e+"/definitions/"+b]=c,j++,k(a)},e+"/definitions/"+b,!0)}):k(a)}else if(a.$ref){var n=a.$ref;if(delete a.$ref,g.refs[n]&&g.refs[n]instanceof Array)g.refs[n].push(function(){a=b({},g.refs[n],a),d(a)});else if(g.refs[n])a=b({},g.refs[n],a),d(a);else{if(!g.options.ajax)throw"Must set ajax option to true to load external url "+n;var o=new XMLHttpRequest;o.open("GET",n,!0),o.onreadystatechange=function(){if(4==o.readyState){if(200===o.status){var f=JSON.parse(o.responseText);return g.refs[n]=[],void g._getRefs(f,function(e){var f=g.refs[n];g.refs[n]=e,a=b({},g.refs[n],a),d(a),c(f,function(a,b){b()})},e)}throw"Failed to fetch ref via ajax- "+n}},o.send()}}else i=j=0,k=function(a){if(j>=i){if(l)return;l=!0,d(a)}},c(a,function(a,b){"object"==typeof b&&b&&b instanceof Array?c(b,function(a,b){"object"!=typeof b||!b||b instanceof Array||i++}):"object"==typeof b&&b&&i++}),i?c(a,function(b,d){"object"==typeof d&&d&&d instanceof Array?c(d,function(c,d){"object"!=typeof d||!d||d instanceof Array||g._getRefs(d,function(d){a[b][c]=d,j++,k(a)},e+"/"+b+"/"+c)}):"object"==typeof d&&d&&g._getRefs(d,function(c){a[b]=c,j++,k(a)},e+"/"+b)}):k(a)},validate:function(a){return this._validateSchema(this.schema,a)},_validateSchema:function(a,d,e){var g,h,i,j=[],k=JSON.stringify(d);if(e=e||"root",a=b({},a),a.required&&a.required===!0){if("undefined"==typeof d)return j.push({path:e,property:"required",message:"Property must be set"}),j}else if("undefined"==typeof d){if(!this.options.required_by_default)return j;j.push({path:e,property:"required",message:"Property must be set"})}if(a.enum){for(g=!1,h=0;h<a.enum.length;h++)k===JSON.stringify(a.enum[h])&&(g=!0);g||j.push({path:e,property:"enum",message:"Value must be one of the enumerated values"})}if(a.extends)for(h=0;h<a.extends.length;h++)j=j.concat(this._validateSchema(a.extends[h],d,e));if(a.allOf)for(h=0;h<a.allOf.length;h++)j=j.concat(this._validateSchema(a.allOf[h],d,e));if(a.anyOf){for(g=!1,h=0;h<a.anyOf.length;h++)if(!this._validateSchema(a.anyOf[h],d,e).length){g=!0;break}g||j.push({path:e,property:"anyOf",message:"Value must validate against at least one of the provided schemas"})}if(a.oneOf){g=0;var l=[];for(h=0;h<a.oneOf.length;h++){var m=this._validateSchema(a.oneOf[h],d,e);for(m.length||g++,i=0;i<m.length;i++)m[i].path=e+".oneOf["+h+"]"+m[i].path.substr(e.length);l=l.concat(m)}1!==g&&(j.push({path:e,property:"oneOf",message:"Value must validate against exactly one of the provided schemas. It currently validates against "+g+" of the schemas."}),j=j.concat(l))}if(a.not&&(this._validateSchema(a.not,d,e).length||j.push({path:e,property:"not",message:"Value must not validate against the provided schema"})),a.type)if(a.type instanceof Array){for(g=!1,h=0;h<a.type.length;h++)if(this._checkType(a.type[h],d)){g=!0;break}g||j.push({path:e,property:"type",message:"Value must be one of the provided types"})}else this._checkType(a.type,d)||j.push({path:e,property:"type",message:"Value must be of type "+a.type});if(a.disallow)if(a.disallow instanceof Array){for(g=!0,h=0;h<a.disallow.length;h++)if(this._checkType(a.disallow[h],d)){g=!1;break}g||j.push({path:e,property:"disallow",message:"Value must not be one of the provided disallowed types"})}else this._checkType(a.disallow,d)&&j.push({path:e,property:"disallow",message:"Value must not be of type "+a.disallow});if("number"==typeof d)(a.multipleOf||a.divisibleBy)&&(g=d/(a.multipleOf||a.divisibleBy),g!==Math.floor(g)&&j.push({path:e,property:a.multipleOf?"multipleOf":"divisibleBy",message:"Value must be a multiple of "+(a.multipleOf||a.divisibleBy)})),a.maximum&&(a.exclusiveMaximum&&d>=a.maximum?j.push({path:e,property:"maximum",message:"Value must be less than "+a.maximum}):!a.exclusiveMaximum&&d>a.maximum&&j.push({path:e,property:"maximum",message:"Value must be at most "+a.maximum})),a.minimum&&(a.exclusiveMinimum&&d<=a.minimum?j.push({path:e,property:"minimum",message:"Value must be greater than "+a.minimum}):!a.exclusiveMinimum&&d<a.minimum&&j.push({path:e,property:"minimum",message:"Value must be at least "+a.minimum}));else if("string"==typeof d)a.maxLength&&(d+"").length>a.maxLength&&j.push({path:e,property:"maxLength",message:"Value must be at most "+a.maxLength+" characters long"}),a.minLength&&(d+"").length<a.minLength&&j.push({path:e,property:"minLength",message:"Value must be at least "+a.minLength+" characters long"}),a.pattern&&(new RegExp(a.pattern).test(d)||j.push({path:e,property:"pattern",message:"Value must match the provided pattern"}));else if("object"==typeof d&&null!==d&&d instanceof Array){if(a.items)if(a.items instanceof Array)for(h=0;h<d.length;h++)if(a.items[h])j=j.concat(this._validateSchema(a.items[h],d[h],e+"."+h));else{if(a.additionalItems===!0)break;if(!a.additionalItems){if(a.additionalItems===!1){j.push({path:e,property:"additionalItems",message:"No additional items allowed in this array"});break}break}j=j.concat(this._validateSchema(a.additionalItems,d[h],e+"."+h))}else for(h=0;h<d.length;h++)j=j.concat(this._validateSchema(a.items,d[h],e+"."+h));if(a.maxItems&&d.length>a.maxItems&&j.push({path:e,property:"maxItems",message:"Value must have at most "+a.maxItems+" items"}),a.minItems&&d.length<a.minItems&&j.push({path:e,property:"minItems",message:"Value must have at least "+a.minItems+" items"}),a.uniqueItems){var n={};for(h=0;h<d.length;h++){if(g=JSON.stringify(d[h]),n[g]){j.push({path:e,property:"uniqueItems",message:"Array must have unique items"});break}n[g]=!0}}}else if("object"==typeof d&&null!==d){if(a.maxProperties){g=0;for(h in d)d.hasOwnProperty(h)&&g++;g>a.maxProperties&&j.push({path:e,property:"maxProperties",message:"Object must have at most "+a.maxProperties+" properties"})}if(a.minProperties){g=0;for(h in d)d.hasOwnProperty(h)&&g++;g<a.minProperties&&j.push({path:e,property:"minProperties",message:"Object must have at least "+a.minProperties+" properties"})}if(a.required&&a.required instanceof Array)for(h=0;h<a.required.length;h++)"undefined"==typeof d[a.required[h]]&&j.push({path:e,property:"required",message:"Object is missing the required property "+a.required[h]});var o={};if(a.properties)for(h in a.properties)a.properties.hasOwnProperty(h)&&(o[h]=!0,j=j.concat(this._validateSchema(a.properties[h],d[h],e+"."+h)));if(a.patternProperties)for(h in a.patternProperties)if(a.patternProperties.hasOwnProperty(h)){var p=new RegExp(h);for(i in d)d.hasOwnProperty(i)&&p.test(i)&&(o[i]=!0,j=j.concat(this._validateSchema(a.patternProperties[h],d[i],e+"."+i)))}if("undefined"!=typeof a.additionalProperties||!this.options.no_additional_properties||a.oneOf||a.anyOf||(a.additionalProperties=!1),"undefined"!=typeof a.additionalProperties)for(h in d)if(d.hasOwnProperty(h)&&!o[h]){if(!a.additionalProperties){j.push({path:e,property:"additionalProperties",message:"No additional properties allowed, but property "+h+" is set"});break}if(a.additionalProperties===!0)break;j=j.concat(this._validateSchema(a.additionalProperties,d[h],e+"."+h))}if(a.dependencies)for(h in a.dependencies)if(a.dependencies.hasOwnProperty(h)&&"undefined"!=typeof d[h])if(a.dependencies[h]instanceof Array)for(i=0;i<a.dependencies[h].length;i++)"undefined"==typeof d[a.dependencies[h][i]]&&j.push({path:e,property:"dependencies",message:"Must have property "+a.dependencies[h][i]});else j=j.concat(this._validateSchema(a.dependencies[h],d,e))}return c(f.defaults.custom_validators,function(b,c){j=j.concat(c(a,d,e))}),j},_checkType:function(a,b){return"string"==typeof a?"string"===a?"string"==typeof b:"number"===a?"number"==typeof b:"integer"===a?"number"==typeof b&&b===Math.floor(b):"boolean"===a?"boolean"==typeof b:"array"===a?b instanceof Array:"object"===a?null!==b&&!(b instanceof Array)&&"object"==typeof b:"null"===a?null===b:!0:!this._validateSchema(a,b).length},expandSchema:function(a){var d,e=this,f=a;if("object"==typeof a.type&&(a.type instanceof Array?c(a.type,function(b,c){"object"==typeof c&&(a.type[b]=e.expandSchema(c))}):a.type=e.expandSchema(a.type)),"object"==typeof a.disallow&&(a.disallow instanceof Array?c(a.disallow,function(b,c){"object"==typeof c&&(a.disallow[b]=e.expandSchema(c))}):a.disallow=e.expandSchema(a.disallow)),a.anyOf&&c(a.anyOf,function(b,c){a.anyOf[b]=e.expandSchema(c)}),a.dependencies&&c(a.dependencies,function(b,c){"object"!=typeof c||c instanceof Array||(a.dependencies[b]=e.expandSchema(c))}),a.items&&(a.items instanceof Array?c(a.items,function(b,c){"object"==typeof c&&(a.items[b]=e.expandSchema(c))}):a.items=e.expandSchema(a.items)),a.properties&&c(a.properties,function(b,c){"object"!=typeof c||c instanceof Array||(a.properties[b]=e.expandSchema(c))}),a.patternProperties&&c(a.patternProperties,function(b,c){"object"!=typeof c||c instanceof Array||(a.patternProperties[b]=e.expandSchema(c))}),a.not&&(a.not=this.expandSchema(a.not)),a.additionalProperties&&"object"==typeof a.additionalProperties&&(a.additionalProperties=e.expandSchema(a.additionalProperties)),a.additionalItems&&"object"==typeof a.additionalItems&&(a.additionalItems=e.expandSchema(a.additionalItems)),a.allOf){for(d=0;d<a.allOf.length;d++)f=this.extend(f,this.expandSchema(a.allOf[d]));delete f.allOf}if(a.extends){if(a.extends instanceof Array)for(d=0;d<a.extends.length;d++)f=this.extend(f,this.expandSchema(a.extends[d]));else f=this.extend(f,this.expandSchema(a.extends));delete f.extends}if(a.oneOf){var g=b({},f);for(delete g.oneOf,d=0;d<a.oneOf.length;d++)f.oneOf[d]=this.extend(this.expandSchema(a.oneOf[d]),g)}return f},extend:function(a,d){a=b({},a),d=b({},d);var e=this,f={};return c(a,function(a,b){"undefined"!=typeof d[a]?"required"===a&&"object"==typeof b&&b instanceof Array?f.required=b.concat(d[a]).reduce(function(a,b){return a.indexOf(b)<0&&a.push(b),a},[]):"type"===a?("object"!=typeof b&&(b=[b]),"object"!=typeof d.type&&(d.type=[d.type]),f.type=b.filter(function(a){return-1!==d.type.indexOf(a)}),1===f.type.length&&"string"==typeof f.type[0]&&(f.type=f.type[0])):f[a]="object"==typeof b&&b instanceof Array?b.filter(function(b){return-1!==d[a].indexOf(b)}):"object"==typeof b&&null!==b?e.extend(b,d[a]):b:f[a]=b}),c(d,function(b,c){"undefined"==typeof a[b]&&(f[b]=c)}),f}}),f.AbstractEditor=Class.extend({fireChangeHeaderEvent:function(){e(this.container,"change_header_text")},onChildEditorChange:function(){this.watch_listener&&(this.watch_listener(),this.jsoneditor.notifyWatchers(this.path),this.parent?this.parent.onChildEditorChange(this):this.jsoneditor.onChange())},register:function(){this.jsoneditor.registerEditor(this)},unregister:function(){this.jsoneditor&&this.jsoneditor.unregisterEditor(this)},getNumColumns:function(){return 12},init:function(a){var c=this;if(this.container=a.container,this.jsoneditor=a.jsoneditor,this.theme=this.jsoneditor.theme,this.template_engine=this.jsoneditor.template,this.iconlib=this.jsoneditor.iconlib,this.options=b({},this.options||{},a.schema.options||{},a),this.schema=this.options.schema,a.path||this.schema.id||(this.schema.id="root"),this.path=a.path||"root",this.formname=a.formname||this.path.replace(/\.([^.]+)/g,"[$1]"),this.jsoneditor.options.form_name_root&&(this.formname=this.formname.replace(/^root\[/,this.jsoneditor.options.form_name_root+"[")),this.schema.id&&this.container.setAttribute("data-schemaid",this.schema.id),this.schema.type&&"string"==typeof this.schema.type&&this.container.setAttribute("data-schematype",this.schema.type),this.container.setAttribute("data-schemapath",this.path),this.jsoneditor._data(this.container,"editor",this),this.key=this.path.split(".").pop(),this.parent=a.parent,this.link_watchers=[],this.register(),this.watched={},this.schema.vars&&(this.schema.watch=this.schema.vars),this.watched_values={},this.watch_listener=function(){c.refreshWatchedFieldValues()&&c.onWatchedFieldChange()},this.schema.watch){var d,e,f,g,h;for(var i in this.schema.watch)if(this.schema.watch.hasOwnProperty(i)){if(d=this.schema.watch[i],d instanceof Array?e=[d[0]].concat(d[1].split(".")):(e=d.split("."),c.theme.closest(c.container,'[data-schemaid="'+e[0]+'"]')||e.unshift("#")),f=e.shift(),"#"===f&&(f=c.jsoneditor.schema.id||"root"),g=c.theme.closest(c.container,'[data-schemaid="'+f+'"]'),!g)throw"Could not find ancestor node with id "+f;h=g.getAttribute("data-schemapath")+"."+e.join("."),c.jsoneditor.watch(h,c.watch_listener),c.watched[i]=h}}if(this.schema.headerTemplate&&(this.header_template=this.jsoneditor.compileTemplate(this.schema.headerTemplate,this.template_engine)),this.build(),!this.no_link_holder&&(this.link_holder=this.theme.getLinksHolder(),this.container.appendChild(this.link_holder),this.schema.links))for(var j=0;j<this.schema.links.length;j++)this.addLink(this.getLink(this.schema.links[j]));this.setValue(this.getDefault(),!0),this.updateHeaderText(),this.watch_listener()},getButton:function(a,b,c){var d="json-editor-btn-"+b;b=this.iconlib?this.iconlib.getIcon(b):null,!b&&c&&(a=c,c=null);var e=this.theme.getButton(a,b,c);return e.className+=" "+d+" ",e},setButtonText:function(a,b,c,d){return c=this.iconlib?this.iconlib.getIcon(c):null,!c&&d&&(b=d,d=null),this.theme.setButtonText(a,b,c,d)},addLink:function(a){this.link_holder&&this.link_holder.appendChild(a)},getLink:function(a){var b,c,d=a.mediaType||"application/javascript",e=d.split("/")[0],f=this.jsoneditor.compileTemplate(a.href,this.template_engine);if("image"===e){b=this.theme.getBlockLinkHolder(),c=document.createElement("a"),c.setAttribute("target","_blank");var g=document.createElement("img");this.theme.createImageLink(b,c,g),this.link_watchers.push(function(b){var d=f(b);c.setAttribute("href",d),c.setAttribute("title",a.rel||d),g.setAttribute("src",d)})}else if(["audio","video"].indexOf(e)>=0){b=this.theme.getBlockLinkHolder(),c=this.theme.getBlockLink(),c.setAttribute("target","_blank");var h=document.createElement(e);h.setAttribute("controls","controls"),this.theme.createMediaLink(b,c,h),this.link_watchers.push(function(b){var d=f(b);c.setAttribute("href",d),c.textContent=a.rel||d,h.setAttribute("src",d)})}else b=this.theme.getBlockLink(),b.setAttribute("target","_blank"),b.textContent=a.rel,this.link_watchers.push(function(c){var d=f(c);b.setAttribute("href",d),b.textContent=a.rel||d});return b},refreshWatchedFieldValues:function(){if(this.watched_values){var a={},b=!1,c=this;if(this.watched){var d,e;for(var f in this.watched)this.watched.hasOwnProperty(f)&&(e=c.jsoneditor.getEditor(this.watched[f]),d=e?e.getValue():null,c.watched_values[f]!==d&&(b=!0),a[f]=d)}return a.self=this.getValue(),this.watched_values.self!==a.self&&(b=!0),this.watched_values=a,b}},getWatchedFieldValues:function(){return this.watched_values},updateHeaderText:function(){this.header&&(this.header.textContent=this.getHeaderText())},getHeaderText:function(a){return this.header_text?this.header_text:a?this.schema.title:this.getTitle()},onWatchedFieldChange:function(){var a;if(this.header_template){a=b(this.getWatchedFieldValues(),{key:this.key,i:this.key,title:this.getTitle()});var c=this.header_template(a);c!==this.header_text&&(this.header_text=c,this.updateHeaderText(),this.fireChangeHeaderEvent())}if(this.link_watchers.length){a=this.getWatchedFieldValues();for(var d=0;d<this.link_watchers.length;d++)this.link_watchers[d](a)}},build:function(){},isValid:function(a){a()},setValue:function(a){this.value=a},getValue:function(){return this.value},refreshValue:function(){},getChildEditors:function(){return!1},destroy:function(){var a=this;this.unregister(this),c(this.watched,function(b,c){a.jsoneditor.unwatch(c,a.watch_listener)
}),this.watched=null,this.watched_values=null,this.watch_listener=null,this.header_text=null,this.header_template=null,this.value=null,this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.jsoneditor=null,this.schema=null,this.path=null,this.key=null,this.parent=null},isRequired:function(){return"undefined"!=typeof this.options.required?this.options.required:"boolean"==typeof this.schema.required?this.schema.required:this.jsoneditor.options.required_by_default?!0:!1},getDefault:function(){return this.schema.default||null},getTheme:function(){return this.theme},getSchema:function(){return this.schema},getContainer:function(){return this.container},getTitle:function(){return this.schema.title||this.key},getPath:function(){return this.path},getParent:function(){return this.parent},enable:function(){this.addremove&&(this.addremove.style.opacity=""),this.disabled=!1},disable:function(){this.addremove&&(this.addremove.style.opacity=".6"),this.disabled=!0},isEnabled:function(){return!this.disabled},getOption:function(a,b){return"undefined"!=typeof this.options[a]?this.options[a]:b},getDisplayText:function(a){var b=[],d={};c(a,function(a,b){b.title&&(d[b.title]=d[b.title]||0,d[b.title]++),b.description&&(d[b.description]=d[b.description]||0,d[b.description]++),b.format&&(d[b.format]=d[b.format]||0,d[b.format]++),b.type&&(d[b.type]=d[b.type]||0,d[b.type]++)}),c(a,function(a,c){var e;e="string"==typeof c?c:c.title&&d[c.title]<=1?c.title:c.format&&d[c.format]<=1?c.format:c.type&&d[c.type]<=1?c.type:c.description&&d[c.description]<=1?c.descripton:c.title?c.title:c.format?c.format:c.type?c.type:c.description?c.description:JSON.stringify(c).length<50?JSON.stringify(c):"type",b.push(e)});var e={};return c(b,function(a,c){e[c]=e[c]||0,e[c]++,d[c]>1&&(b[a]=c+" "+e[c])}),b},showValidationErrors:function(){}}),f.defaults.editors.null=f.AbstractEditor.extend({getValue:function(){return null},setValue:function(){this.jsoneditor.notifyWatchers(this.path)},getNumColumns:function(){return 2}}),f.defaults.editors.string=f.AbstractEditor.extend({getDefault:function(){return this.schema.default||""},register:function(){this._super(),this.input&&this.input.setAttribute("name",this.formname)},unregister:function(){this._super(),this.input&&this.input.removeAttribute("name")},setValue:function(a,b,c){var d=this;if((!this.template||c)&&(a=a||"","object"==typeof a&&(a=JSON.stringify(a)),"string"!=typeof a&&(a=""+a),a!==this.serialized)){var e=this.sanitize(a);if(this.select_options&&this.select_options.indexOf(e)<0&&(e=this.select_options[0]),this.input.value!==e){this.input.value=e,this.sceditor_instance?this.sceditor_instance.val(e):this.epiceditor?this.epiceditor.importFile(null,e):this.ace_editor&&this.ace_editor.setValue(e);var f=c||this.getValue()!==a;this.refreshValue(),f&&(d.parent?d.parent.onChildEditorChange(d):d.jsoneditor.onChange()),this.watch_listener(),this.jsoneditor.notifyWatchers(this.path)}}},removeProperty:function(){this._super(),this.input.style.display="none",this.description&&(this.description.style.display="none"),this.theme.disableLabel(this.label)},addProperty:function(){this._super(),this.input.style.display="",this.description&&(this.description.style.display=""),this.theme.enableLabel(this.label)},getNumColumns:function(){var a,b=Math.ceil(this.getTitle().length/5);return a="textarea"===this.input_type?6:["text","email"].indexOf(this.input_type)>=0?4:2,Math.min(12,Math.max(b,a))},build:function(){var a,c=this;if(this.getOption("compact",!1)||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.schema.description)),this.format=this.schema.format,!this.format&&this.schema.media&&this.schema.media.type&&(this.format=this.schema.media.type.replace(/(^(application|text)\/(x-)?(script\.)?)|(-source$)/g,"")),this.schema.enum)this.input_type="select",this.select_options=this.schema.enum,this.input=this.theme.getSelectInput(this.select_options);else if(this.schema.enumSource){if(this.input_type="select",this.input=this.theme.getSelectInput([]),this.enumSource=[],this.schema.enumSource instanceof Array)for(a=0;a<this.schema.enumSource.length;a++)this.enumSource[a]="string"==typeof this.schema.enumSource[a]?{source:this.schema.enumSource[a]}:this.schema.enumSource[a]instanceof Array?this.schema.enumSource[a]:b({},this.schema.enumSource[a]);else this.enumSource=this.schema.enumValue?[{source:this.schema.enumSource,value:this.schema.enumValue}]:[{source:this.schema.enumSource}];for(a=0;a<this.enumSource.length;a++)this.enumSource[a]&&(this.enumSource[a].value=this.jsoneditor.compileTemplate(this.enumSource[a].value,this.template_engine)),this.enumSource[a].title&&(this.enumSource[a].title=this.jsoneditor.compileTemplate(this.enumSource[a].title,this.template_engine)),this.enumSource[a].fillter&&(this.enumSource[a].filter=this.jsoneditor.compileTemplate(this.enumSource[a].filter,this.template_engine))}else if(this.format)if("textarea"===this.format)this.input_type="textarea",this.input=this.theme.getTextareaInput();else if("range"===this.format){this.input_type="range";var d=this.schema.minimum||0,e=this.schema.maximum||Math.max(100,d+1),f=1;this.schema.multipleOf&&(d%this.schema.multipleOf&&(d=Math.ceil(d/this.schema.multipleOf)*this.schema.multipleOf),e%this.schema.multipleOf&&(e=Math.floor(e/this.schema.multipleOf)*this.schema.multipleOf),f=this.schema.multipleOf),this.input=this.theme.getRangeInput(d,e,f)}else["actionscript","batchfile","bbcode","c","c++","cpp","coffee","csharp","css","dart","django","ejs","erlang","golang","handlebars","haskell","haxe","html","ini","jade","java","javascript","json","less","lisp","lua","makefile","markdown","matlab","mysql","objectivec","pascal","perl","pgsql","php","python","r","ruby","sass","scala","scss","smarty","sql","stylus","svg","twig","vbscript","xml","yaml"].indexOf(this.format)>=0?(this.input_type=this.format,this.source_code=!0,this.input=this.theme.getTextareaInput()):(this.input_type=this.format,this.input=this.theme.getFormInputField(this.input_type));else this.input_type="text",this.input=this.theme.getFormInputField(this.input_type);"undefined"!=typeof this.schema.maxLength&&this.input.setAttribute("maxlength",this.schema.maxLength),"undefined"!=typeof this.schema.pattern?this.input.setAttribute("pattern",this.schema.pattern):"undefined"!=typeof this.schema.minLength&&this.input.setAttribute("pattern",".{"+this.schema.minLength+",}"),this.getOption("compact")&&this.container.setAttribute("class",this.container.getAttribute("class")+" compact"),(this.schema.readOnly||this.schema.readonly||this.schema.template)&&(this.always_disabled=!0,this.input.disabled=!0),this.input.addEventListener("change",function(a){if(a.preventDefault(),a.stopPropagation(),c.schema.template)return void(this.value=c.value);var b=this.value,d=c.sanitize(b);b!==d&&(this.value=d),c.refreshValue(),c.watch_listener(),c.jsoneditor.notifyWatchers(c.path),c.parent?c.parent.onChildEditorChange(c):c.jsoneditor.onChange()}),this.format&&this.input.setAttribute("data-schemaformat",this.format),this.control=this.getTheme().getFormControl(this.label,this.input,this.description),this.container.appendChild(this.control),"select"===this.input_type&&window.$&&$.fn&&$.fn.select2&&$(this.input).select2(),requestAnimationFrame(function(){c.input.parentNode&&c.afterInputReady()}),this.register(),this.schema.template?(this.template=this.jsoneditor.compileTemplate(this.schema.template,this.template_engine),this.refreshValue(),this.jsoneditor.notifyWatchers(this.path)):(this.refreshValue(),this.jsoneditor.notifyWatchers(this.path))},enable:function(){this.always_disabled||(this.input.disabled=!1),this._super()},disable:function(){this.input.disabled=!0,this._super()},afterInputReady:function(){var a,c=this;if(this.source_code)if(this.options.wysiwyg&&["html","bbcode"].indexOf(this.input_type)>=0&&window.$&&$.fn&&$.fn.sceditor)a=b({},{plugins:"html"===c.input_type?"xhtml":"bbcode",emoticonsEnabled:!1,width:"100%",height:300},f.plugins.sceditor),$(c.input).sceditor(a),c.sceditor_instance=$(c.input).sceditor("instance"),c.sceditor_instance.blur(function(){var a=$("<div>"+c.sceditor_instance.val()+"</div>");$("#sceditor-start-marker,#sceditor-end-marker,.sceditor-nlf",a).remove(),c.input.value=a.html(),c.value=c.input.value,c.parent?c.parent.onChildEditorChange(c):c.jsoneditor.onChange(),c.jsoneditor.notifyWatchers(c.path)});else if("markdown"===this.input_type&&window.EpicEditor)this.epiceditor_container=document.createElement("div"),this.input.parentNode.insertBefore(this.epiceditor_container,this.input),this.input.style.display="none",a=b({},f.plugins.epiceditor,{container:this.epiceditor_container,clientSideStorage:!1}),this.epiceditor=new EpicEditor(a).load(),this.epiceditor.importFile(null,this.getValue()),this.epiceditor.on("update",function(){var a=c.epiceditor.exportFile();c.input.value=a,c.value=a,c.parent?c.parent.onChildEditorChange(c):c.jsoneditor.onChange(),c.jsoneditor.notifyWatchers(c.path)});else if(window.ace){var d=this.input_type;("cpp"===d||"c++"===d||"c"===d)&&(d="c_cpp"),this.ace_container=document.createElement("div"),this.ace_container.style.width="100%",this.ace_container.style.position="relative",this.ace_container.style.height="400px",this.input.parentNode.insertBefore(this.ace_container,this.input),this.input.style.display="none",this.ace_editor=ace.edit(this.ace_container),this.ace_editor.setValue(this.getValue()),f.plugins.ace.theme&&this.ace_editor.setTheme("ace/theme/"+f.plugins.ace.theme),d=ace.require("ace/mode/"+d),d&&this.ace_editor.getSession().setMode(new d.Mode),this.ace_editor.on("change",function(){var a=c.ace_editor.getValue();c.input.value=a,c.refreshValue(),c.parent?c.parent.onChildEditorChange(c):c.jsoneditor.onChange(),c.jsoneditor.notifyWatchers(c.path)})}c.theme.afterInputReady(c.input)},refreshValue:function(){this.value=this.input.value,"string"!=typeof this.value&&(this.value=""),this.serialized=this.value},destroy:function(){this.sceditor_instance?this.sceditor_instance.destroy():this.epiceditor?this.epiceditor.unload():this.ace_editor&&this.ace_editor.destroy(),this.template=null,this.input.parentNode&&this.input.parentNode.removeChild(this.input),this.label&&this.label.parentNode&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode&&this.description.parentNode.removeChild(this.description),this._super()},sanitize:function(a){return a},onWatchedFieldChange:function(){var a,b;if(this.template&&(a=this.getWatchedFieldValues(),this.setValue(this.template(a),!1,!0)),this.enumSource){a=this.getWatchedFieldValues();for(var c=[],d=[],e=0;e<this.enumSource.length;e++)if(this.enumSource[e]instanceof Array)c=c.concat(this.enumSource[e]),d=d.concat(this.enumSource[e]);else if(a[this.enumSource[e].source]){var f=a[this.enumSource[e].source];if(this.enumSource[e].slice&&(f=Array.prototype.slice.apply(f,this.enumSource[e].slice)),this.enumSource[e].filter){var g=[];for(b=0;b<f.length;b++)filter({i:b,item:f[b]})&&g.push(f[b]);f=g}var h=[],i=[];for(b=0;b<f.length;b++){var j=f[b];i[b]=this.enumSource[e].value?this.enumSource[e].value({i:b,item:j}):f[b],h[b]=this.enumSource[e].title?this.enumSource[e].title({i:b,item:j}):i[b]}c=c.concat(i),d=d.concat(h)}this.theme.setSelectOptions(this.input,c,d),this.select_options=c,-1!==c.indexOf(this.value)?this.input.value=this.value:(this.input.value=c[0],this.value=c[0]||"",this.parent?this.parent.onChildEditorChange(this):this.jsoneditor.onChange(),this.jsoneditor.notifyWatchers(this.path))}this._super()},showValidationErrors:function(a){var b=this,d=[];c(a,function(a,c){c.path===b.path&&d.push(c.message)}),d.length?this.theme.addInputError(this.input,d.join(". ")+"."):this.theme.removeInputError(this.input)}}),f.defaults.editors.number=f.defaults.editors.string.extend({getDefault:function(){return this.schema.default||0},sanitize:function(a){return(a+"").replace(/[^0-9\.\-]/g,"")},getNumColumns:function(){return 2},getValue:function(){return 1*this.value}}),f.defaults.editors.integer=f.defaults.editors.number.extend({sanitize:function(a){return a+="",a.replace(/[^0-9\-]/g,"")},getNumColumns:function(){return 2}}),f.defaults.editors.object=f.AbstractEditor.extend({getDefault:function(){return b({},this.schema.default||{})},getChildEditors:function(){return this.editors},register:function(){if(this._super(),this.editors)for(var a in this.editors)this.editors.hasOwnProperty(a)&&this.editors[a].register()},unregister:function(){if(this._super(),this.editors)for(var a in this.editors)this.editors.hasOwnProperty(a)&&this.editors[a].unregister()},getNumColumns:function(){return Math.max(Math.min(12,this.maxwidth),3)},enable:function(){if(this.editjson_button&&(this.editjson_button.disabled=!1),this.addproperty_button&&(this.addproperty_button.disabled=!1),this._super(),this.editors)for(var a in this.editors)this.editors.hasOwnProperty(a)&&this.editors[a].enable()},disable:function(){if(this.editjson_button&&(this.editjson_button.disabled=!0),this.addproperty_button&&(this.addproperty_button.disabled=!0),this.hideEditJSON(),this._super(),this.editors)for(var a in this.editors)this.editors.hasOwnProperty(a)&&this.editors[a].disable()},layoutEditors:function(){var a,b,d=this;if(this.row_container){var e;if("grid"===this.format){var f=[];for(c(this.editors,function(a,b){if(!b.property_removed){for(var c=!1,d=b.options.hidden?0:b.getNumColumns(),e=b.options.hidden?0:b.container.offsetHeight,g=0;g<f.length;g++)f[g].width+d<=12&&(!e||.5*f[g].minh<e&&2*f[g].maxh>e)&&(c=g);c===!1&&(f.push({width:0,minh:999999,maxh:0,editors:[]}),c=f.length-1),f[c].editors.push({key:a,width:d,height:e}),f[c].width+=d,f[c].minh=Math.min(f[c].minh,e),f[c].maxh=Math.max(f[c].maxh,e)}}),a=0;a<f.length;a++)if(f[a].width<12){var g=!1,h=0;for(b=0;b<f[a].editors.length;b++)g===!1?g=b:f[a].editors[b].width>f[a].editors[g].width&&(g=b),f[a].editors[b].width*=12/f[a].width,f[a].editors[b].width=Math.floor(f[a].editors[b].width),h+=f[a].editors[b].width;12>h&&(f[a].editors[g].width+=12-h),f[a].width=12}if(this.layout===JSON.stringify(f))return!1;for(this.layout=JSON.stringify(f),e=document.createElement("div"),a=0;a<f.length;a++){var i=this.theme.getGridRow();for(e.appendChild(i),b=0;b<f[a].editors.length;b++){var j=this.editors[f[a].editors[b].key];j.options.hidden?j.container.style.display="none":this.theme.setGridColumnSize(j.container,f[a].editors[b].width),i.appendChild(j.container)}}}else e=document.createElement("div"),c(this.editors,function(a,b){if(!b.property_removed){var c=d.theme.getGridRow();e.appendChild(c),b.options.hidden?b.container.style.display="none":d.theme.setGridColumnSize(b.container,12),c.appendChild(b.container)}});this.row_container.innerHTML="",this.row_container.appendChild(e)}},build:function(){this.editors={};var a=this;if(this.format=this.getOption("layout")||this.getOption("object_layout")||this.schema.format||this.jsoneditor.options.object_layout||"normal",this.schema.properties=this.schema.properties||{},this.minwidth=0,this.maxwidth=0,this.getOption("table_row",!1))this.editor_holder=this.container,c(this.schema.properties,function(b,c){var d=a.jsoneditor.getEditorClass(c,a.jsoneditor),e=a.editor_holder.appendChild(a.getTheme().getTableCell());a.editors[b]=a.jsoneditor.createEditor(d,{jsoneditor:a.jsoneditor,schema:c,container:e,path:a.path+"."+b,parent:a,compact:!0,required:!0});var f=a.editors[b].options.hidden?0:a.editors[b].getNumColumns();a.minwidth+=f,a.maxwidth+=f,a.editors[b].options.hidden&&(e.style.display="none")}),this.no_link_holder=!0;else{if(this.getOption("table",!1))throw"Not supported yet";this.header=document.createElement("span"),this.header.textContent=this.getTitle(),this.title=this.getTheme().getHeader(this.header),this.container.appendChild(this.title),this.container.style.position="relative",this.editjson_holder=this.theme.getModal(),this.editjson_textarea=this.theme.getTextareaInput(),this.editjson_textarea.style.height="170px",this.editjson_textarea.style.width="300px",this.editjson_textarea.style.display="block",this.editjson_save=this.getButton("Save","save","Save"),this.editjson_save.addEventListener("click",function(){a.saveJSON()}),this.editjson_cancel=this.getButton("Cancel","cancel","Cancel"),this.editjson_cancel.addEventListener("click",function(){a.hideEditJSON()}),this.editjson_holder.appendChild(this.editjson_textarea),this.editjson_holder.appendChild(this.editjson_save),this.editjson_holder.appendChild(this.editjson_cancel),this.addproperty_holder=this.theme.getModal(),this.addproperty_list=document.createElement("div"),this.addproperty_list.style.width="295px",this.addproperty_list.style.maxHeight="160px",this.addproperty_list.style.padding="5px 0",this.addproperty_list.style.overflowY="auto",this.addproperty_list.style.overflowX="hidden",this.addproperty_list.style.paddingLeft="5px",this.addproperty_add=this.getButton("add","add","add"),this.addproperty_input=this.theme.getFormInputField("text"),this.addproperty_input.setAttribute("placeholder","Property name..."),this.addproperty_input.style.width="220px",this.addproperty_input.style.marginBottom="0",this.addproperty_input.style.display="inline-block",this.addproperty_add.addEventListener("click",function(){if(a.addproperty_input.value){if(a.editors[a.addproperty_input.value])return void alert("there is already a property with that name");a.addObjectProperty(a.addproperty_input.value),a.addPropertyCheckbox(a.addproperty_input.value),a.editors[a.addproperty_input.value]&&a.editors[a.addproperty_input.value].disable()}}),this.addproperty_holder.appendChild(this.addproperty_list),this.addproperty_holder.appendChild(this.addproperty_input),this.addproperty_holder.appendChild(this.addproperty_add);var b=document.createElement("div");b.style.clear="both",this.addproperty_holder.appendChild(b),this.schema.description&&(this.description=this.getTheme().getDescription(this.schema.description),this.container.appendChild(this.description)),this.error_holder=document.createElement("div"),this.container.appendChild(this.error_holder),this.editor_holder=this.getTheme().getIndentedPanel(),this.editor_holder.style.paddingBottom="0",this.container.appendChild(this.editor_holder),this.row_container=this.theme.getGridContainer(),this.editor_holder.appendChild(this.row_container),c(this.schema.properties,function(b,c){var d=a.jsoneditor.getEditorClass(c,a.jsoneditor),e=a.getTheme().getGridColumn();a.row_container.appendChild(e);var f;a.schema.required&&a.schema.required instanceof Array&&(f=a.schema.required.indexOf(b)>=0),a.editors[b]=a.jsoneditor.createEditor(d,{jsoneditor:a.jsoneditor,schema:c,container:e,path:a.path+"."+b,parent:a,required:f}),a.minwidth=Math.max(a.minwidth,a.editors[b].getNumColumns()),a.maxwidth+=a.editors[b].getNumColumns()}),this.title_controls=this.getTheme().getHeaderButtonHolder(),this.editjson_controls=this.getTheme().getHeaderButtonHolder(),this.addproperty_controls=this.getTheme().getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.title.appendChild(this.editjson_controls),this.title.appendChild(this.addproperty_controls),this.collapsed=!1,this.toggle_button=this.getButton("","collapse","Collapse"),this.title_controls.appendChild(this.toggle_button),this.toggle_button.addEventListener("click",function(){a.collapsed?(a.editor_holder.style.display="",a.collapsed=!1,a.setButtonText(a.toggle_button,"","collapse","Collapse")):(a.editor_holder.style.display="none",a.collapsed=!0,a.setButtonText(a.toggle_button,"","expand","Expand"))}),this.options.collapsed&&d(this.toggle_button,"click"),this.schema.options&&"undefined"!=typeof this.schema.options.disable_collapse?this.schema.options.disable_collapse&&(this.toggle_button.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.toggle_button.style.display="none"),this.editjson_button=this.getButton("JSON","edit","Edit JSON"),this.editjson_button.addEventListener("click",function(){a.toggleEditJSON()}),this.editjson_controls.appendChild(this.editjson_button),this.editjson_controls.appendChild(this.editjson_holder),this.schema.options&&"undefined"!=typeof this.schema.options.disable_edit_json?this.schema.options.disable_edit_json&&(this.editjson_button.style.display="none"):this.jsoneditor.options.disable_edit_json&&(this.editjson_button.style.display="none"),this.addproperty_button=this.getButton("Properties","edit","Object Properties"),this.addproperty_button.addEventListener("click",function(){a.toggleAddProperty()}),this.addproperty_controls.appendChild(this.addproperty_button),this.addproperty_controls.appendChild(this.addproperty_holder),this.refreshAddProperties()}var e={},f=Object.keys(this.editors);f=f.sort(function(b,c){var d=a.editors[b].schema.propertyOrder,e=a.editors[c].schema.propertyOrder;return"number"!=typeof d&&(d=1e3),"number"!=typeof e&&(e=1e3),d-e});for(var g=0;g<f.length;g++)e[f[g]]=this.editors[f[g]];this.editors=e,this.getOption("table_row",!1)?(this.editor_holder=this.container,c(this.editors,function(b,c){a.editor_holder.appendChild(c.container)})):(this.layoutEditors(),this.layoutEditors()),this.jsoneditor.notifyWatchers(this.path)},showEditJSON:function(){this.editjson_holder&&(this.hideAddProperty(),this.editjson_holder.style.left=this.editjson_button.offsetLeft+"px",this.editjson_holder.style.top=this.editjson_button.offsetTop+this.editjson_button.offsetHeight+"px",this.editjson_textarea.value=JSON.stringify(this.getValue(),null,2),this.disable(),this.editjson_holder.style.display="",this.editjson_button.disabled=!1,this.editing_json=!0)},hideEditJSON:function(){this.editjson_holder&&this.editing_json&&(this.editjson_holder.style.display="none",this.enable(),this.editing_json=!1)},saveJSON:function(){if(this.editjson_holder)try{var a=JSON.parse(this.editjson_textarea.value);this.setValue(a),this.hideEditJSON()}catch(b){throw alert("invalid JSON"),b}},toggleEditJSON:function(){this.editing_json?this.hideEditJSON():this.showEditJSON()},addPropertyCheckbox:function(a){var b=this.editors[a];if(b){var c,d,e,f=this;return c=f.theme.getCheckbox(),c.style.width="auto",d=f.theme.getCheckboxLabel(a),e=f.theme.getFormControl(d,c),e.style.paddingBottom=e.style.marginBottom=e.style.paddingTop=e.style.marginTop=0,e.style.height="auto",f.addproperty_list.appendChild(e),c.checked=!b.property_removed,b.isRequired()&&(c.disabled=!0),c.addEventListener("change",function(){c.checked?f.addObjectProperty(a):f.removeObjectProperty(a)}),c}},showAddProperty:function(){if(this.addproperty_holder){this.hideEditJSON(),this.addproperty_holder.style.left=this.addproperty_button.offsetLeft+"px",this.addproperty_holder.style.top=this.addproperty_button.offsetTop+this.addproperty_button.offsetHeight+"px",this.addproperty_list.innerHTML="";var a=this;this.addproperty_checkboxes={},c(this.editors,function(b){a.addproperty_checkboxes[b]=a.addPropertyCheckbox(b)}),this.disable(),this.adding_property=!0,this.addproperty_button.disabled=!1,this.addproperty_holder.style.display="",this.refreshAddProperties()}},hideAddProperty:function(){this.addproperty_holder&&this.adding_property&&(this.addproperty_holder.style.display="none",this.enable(),this.adding_property=!1)},toggleAddProperty:function(){this.adding_property?this.hideAddProperty():this.showAddProperty()},removeObjectProperty:function(a){this.editors[a]&&(this.editors[a].property_removed=!0,this.editors[a].unregister(),this.refreshValue(),this.layoutEditors(),this.jsoneditor.notifyWatchers(this.path),this.parent?this.parent.onChildEditorChange(this):this.jsoneditor.onChange())},addObjectProperty:function(a){var d=this;if(this.editors[a]){if(!this.editors[a].property_removed)return;this.editors[a].property_removed=!1,this.editors[a].register(),this.jsoneditor.notifyWatchers(this.editors[a].path)}else{var e={},f=!1;d.schema.patternProperties&&c(d.schema.patternProperties,function(c,d){var g=new RegExp(c);g.test(a)&&(f=!0,e=b(e,d))}),f||"object"!=typeof d.schema.additionalProperties||(e=b(e,d.schema.additionalProperties));var g=d.jsoneditor.getEditorClass(e,d.jsoneditor),h=d.getTheme().getChildEditorHolder();d.editor_holder.appendChild(h),d.editors[a]=d.jsoneditor.createEditor(g,{jsoneditor:d.jsoneditor,schema:e,container:h,path:d.path+"."+a,parent:d,required:!1}),d.editors[a].not_core=!0}d.refreshValue(),d.jsoneditor.notifyWatchers(d.path),d.parent?d.parent.onChildEditorChange(d):d.jsoneditor.onChange(),d.layoutEditors()},onChildEditorChange:function(a){this.refreshValue(),this._super(a)},canHaveAdditionalProperties:function(){return this.schema.additionalProperties!==!1&&!this.jsoneditor.options.no_additional_properties},destroy:function(){c(this.editors,function(a,b){b.destroy()}),this.editor_holder.innerHTML="",this.title&&this.title.parentNode.removeChild(this.title),this.error_holder&&this.error_holder.parentNode.removeChild(this.error_holder),this.editors=null,this.editor_holder.parentNode.removeChild(this.editor_holder),this.editor_holder=null,this._super()},refreshValue:function(){this.value={},this.serialized="";var a=this,b=0,d=!1,e=this.editors;c(this.editors,function(a,b){b.property_removed&&b.not_core&&(e={},d=!0)}),c(this.editors,function(c,f){if(f.property_removed){if(!f.not_core&&d)e[c]=f;else if(f.not_core){var g=f.container;f.destroy(),g.parentNode&&g.parentNode.removeChild(g)}}else d&&(e[c]=f),b++,a.value[c]=f.getValue()}),this.editors=e,this.adding_property&&this.refreshAddProperties()},refreshAddProperties:function(){if(this.options.disable_properties||this.jsoneditor.options.disable_properties)return void(this.addproperty_controls.style.display="none");var a,b=!1,c=!1,d=0,e=!1;for(a in this.editors)this.editors.hasOwnProperty(a)&&(this.editors[a].property_removed||d++);b=this.canHaveAdditionalProperties()&&!("undefined"!=typeof this.schema.maxProperties&&d>=this.schema.maxProperties);for(a in this.editors)this.editors.hasOwnProperty(a)&&(this.editors[a].isRequired()?this.addproperty_checkboxes&&this.addproperty_checkboxes[a]&&(this.addproperty_checkboxes[a].disabled=!0):"undefined"!=typeof this.schema.minProperties&&d<=this.schema.minProperties?this.addproperty_checkboxes&&this.addproperty_checkboxes[a]?(this.addproperty_checkboxes[a].disabled=this.addproperty_checkboxes[a].checked,this.addproperty_checkboxes[a].checked||(e=!0)):this.editors[a].property_removed&&b&&(e=!0):this.editors[a].property_removed?this.addproperty_checkboxes&&this.addproperty_checkboxes[a]?b?(this.addproperty_checkboxes[a].disabled=!1,e=!0):this.addproperty_checkboxes[a].disabled=!0:b&&(e=!0):(this.addproperty_checkboxes&&this.addproperty_checkboxes[a]&&(this.addproperty_checkboxes[a].disabled=!1),e=!0,c=!0));if(this.canHaveAdditionalProperties()&&(e=!0),this.addproperty_checkboxes)for(a in this.addproperty_checkboxes)this.addproperty_checkboxes.hasOwnProperty(a)&&(this.editors[a]||(e=!0,this.addproperty_checkboxes[a].disabled=!b&&!c));e?this.canHaveAdditionalProperties()?this.addproperty_add.disabled=b?!1:!0:(this.addproperty_add.style.display="none",this.addproperty_input.style.display="none"):(this.hideAddProperty(),this.addproperty_controls.style.display="none")},setValue:function(a,b){var d=this;a=a||{},("object"!=typeof a||a instanceof Array)&&(a={}),c(this.editors,function(c,e){if("undefined"!=typeof a[c])e.property_removed&&d.addObjectProperty(c),e.setValue(a[c],b);else{if(!b&&!e.property_removed&&!e.isRequired())return void d.removeObjectProperty(c);e.setValue(e.getDefault(),b)}}),this.canHaveAdditionalProperties()&&c(a,function(a,c){d.editors[a]||(d.addObjectProperty(a),d.editors[a]&&d.editors[a].setValue(c,b))}),this.refreshValue(),this.jsoneditor.notifyWatchers(this.path)},showValidationErrors:function(a){var b=this,d=[],e=[];c(a,function(a,c){c.path===b.path?d.push(c):e.push(c)}),this.error_holder&&(d.length?(this.error_holder.innerHTML="",this.error_holder.style.display="",c(d,function(a,c){b.error_holder.appendChild(b.theme.getErrorMessage(c.message))})):this.error_holder.style.display="none"),this.getOption("table_row")&&(d.length?this.theme.addTableRowError(this.container):this.theme.removeTableRowError(this.container)),c(this.editors,function(a,b){b.showValidationErrors(e)})}}),f.defaults.editors.array=f.AbstractEditor.extend({getDefault:function(){return this.schema.default||[]},register:function(){if(this._super(),this.rows)for(var a=0;a<this.rows.length;a++)this.rows[a].register()},unregister:function(){if(this._super(),this.rows)for(var a=0;a<this.rows.length;a++)this.rows[a].unregister()},getNumColumns:function(){var a=this.getItemInfo(0);return this.tabs_holder?Math.max(Math.min(12,a.width+2),4):a.width},addProperty:function(){this._super(),this.row_holder.style.display="",this.tabs_holder&&(this.tabs_holder.style.display=""),this.collapsed||(this.controls.style.display=""),this.title_controls.style.display="",this.theme.enableHeader(this.title)},removeProperty:function(){this._super(),this.row_holder.style.display="none",this.tabs_holder&&(this.tabs_holder.style.display="none"),this.controls.style.display="none",this.title_controls.style.display="none",this.theme.disableHeader(this.title)},enable:function(){if(this.add_row_button&&(this.add_row_button.disabled=!1),this.remove_all_rows_button&&(this.remove_all_rows_button.disabled=!1),this.delete_last_row_button&&(this.delete_last_row_button.disabled=!1),this.rows)for(var a=0;a<this.rows.length;a++)this.rows[a].enable(),this.rows[a].moveup_button&&(this.rows[a].moveup_button.disabled=!1),this.rows[a].movedown_button&&(this.rows[a].movedown_button.disabled=!1),this.rows[a].delete_button&&(this.rows[a].delete_button.disabled=!1);this._super()},disable:function(){if(this.add_row_button&&(this.add_row_button.disabled=!0),this.remove_all_rows_button&&(this.remove_all_rows_button.disabled=!0),this.delete_last_row_button&&(this.delete_last_row_button.disabled=!0),this.rows)for(var a=0;a<this.rows.length;a++)this.rows[a].disable(),this.rows[a].moveup_button&&(this.rows[a].moveup_button.disabled=!0),this.rows[a].movedown_button&&(this.rows[a].movedown_button.disabled=!0),this.rows[a].delete_button&&(this.rows[a].delete_button.disabled=!0);this._super()},build:function(){this.rows=[],this.row_cache=[];var a=this;this.hide_delete_buttons=this.options.disable_array_delete||this.jsoneditor.options.disable_array_delete,this.hide_move_buttons=this.options.disable_array_reorder||this.jsoneditor.options.disable_array_reorder,this.hide_add_button=this.options.disable_array_add||this.jsoneditor.options.disable_array_add,this.getOption("compact",!1)?(this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.controls=this.theme.getButtonHolder(),this.panel.appendChild(this.controls),this.row_holder=document.createElement("div"),this.panel.appendChild(this.row_holder)):(this.header=document.createElement("span"),this.header.textContent=this.getTitle(),this.title=this.theme.getHeader(this.header),this.container.appendChild(this.title),this.title_controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.schema.description&&(this.description=this.theme.getDescription(this.schema.description),this.container.appendChild(this.description)),this.error_holder=document.createElement("div"),this.container.appendChild(this.error_holder),"tabs"===this.schema.format?(this.controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.controls),this.tabs_holder=this.theme.getTabHolder(),this.container.appendChild(this.tabs_holder),this.row_holder=this.theme.getTabContentHolder(this.tabs_holder),this.active_tab=null):(this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.row_holder=document.createElement("div"),this.panel.appendChild(this.row_holder),this.controls=this.theme.getButtonHolder(),this.panel.appendChild(this.controls))),this.row_holder.addEventListener("change_header_text",function(){a.refreshTabs(!0)
}),this.addControls(),this.jsoneditor.notifyWatchers(this.path)},onChildEditorChange:function(a){this.refreshValue(),this._super(a)},getItemTitle:function(){return this.schema.items&&this.schema.items.title||"item"},getItemSchema:function(a){return this.schema.items instanceof Array?a>=this.schema.items.length?this.schema.additionalItems===!0?{}:this.schema.additionalItems?b({},this.schema.additionalItems):void 0:b({},this.schema.items[a]):this.schema.items?b({},this.schema.items):{}},getItemInfo:function(a){var b=this.getItemSchema(a);this.item_info=this.item_info||{};var c=JSON.stringify(b);if("undefined"!=typeof this.item_info[c])return this.item_info[c];var d=document.createElement("div");this.container.appendChild(d),d.addEventListener("change_header_text",function(a){a.preventDefault(),a.stopPropagation()});var e=this.jsoneditor.getEditorClass(b,this.jsoneditor);return e=this.jsoneditor.createEditor(e,{jsoneditor:this.jsoneditor,schema:b,container:d,path:this.path+"."+a,parent:this,required:!0}),this.item_info[c]={child_editors:e.getChildEditors()?!0:!1,title:b.title||"item",width:e.getNumColumns(),"default":e.getDefault()},e.destroy(),d.parentNode&&d.parentNode.removeChild(d),this.item_info[c]},getElementEditor:function(a){var b=this.getItemInfo(a),c=this.getItemSchema(a);c.title=b.title+" "+a;var d,e=this.jsoneditor.getEditorClass(c,this.jsoneditor);d=this.tabs_holder?this.theme.getTabContent():b.child_editors?this.theme.getChildEditorHolder():this.theme.getIndentedPanel(),this.row_holder.appendChild(d);var f=this.jsoneditor.createEditor(e,{jsoneditor:this.jsoneditor,schema:c,container:d,path:this.path+"."+a,parent:this,required:!0});return f.title_controls||(f.array_controls=this.theme.getButtonHolder(),d.appendChild(f.array_controls)),f},destroy:function(){this.empty(!0),this.title&&this.title.parentNode.removeChild(this.title),this.description&&this.description.parentNode.removeChild(this.description),this.row_holder&&this.row_holder.parentNode.removeChild(this.row_holder),this.controls&&this.controls.parentNode.removeChild(this.controls),this.panel&&this.panel.parentNode.removeChild(this.panel),this.rows=this.row_cache=this.title=this.description=this.row_holder=this.panel=this.controls=null,this._super()},empty:function(a){if(this.rows){var b=this;c(this.rows,function(c,d){a&&(d.tab&&d.tab.parentNode&&d.tab.parentNode.removeChild(d.tab),b.destroyRow(d,!0),b.row_cache[c]=null),b.rows[c]=null}),b.rows=[],a&&(b.row_cache=[])}},destroyRow:function(a,b){var c=a.container;b?(a.destroy(),c.parentNode&&c.parentNode.removeChild(c),a.tab&&a.tab.parentNode&&a.tab.parentNode.removeChild(a.tab)):(a.tab&&(a.tab.style.display="none"),c.style.display="none",a.unregister())},getMax:function(){return this.schema.items instanceof Array&&this.schema.additionalItems===!1?Math.min(this.schema.items.length,this.schema.maxItems||1/0):this.schema.maxItems||1/0},refreshTabs:function(a){var b=this;c(this.rows,function(c,d){d.tab&&(a?d.tab_text.textContent=d.getHeaderText():d.tab===b.active_tab?(b.theme.markTabActive(d.tab),d.container.style.display=""):(b.theme.markTabInactive(d.tab),d.container.style.display="none"))})},setValue:function(a,b){a=a||[],a instanceof Array||(a=[a]);var d=JSON.stringify(a);if(d!==this.serialized){if(this.schema.minItems)for(;a.length<this.schema.minItems;)a.push(this.getItemInfo(a.length).default);this.getMax()&&a.length>this.getMax()&&(a=a.slice(0,this.getMax()));var e=this;c(a,function(a,b){e.rows[a]?e.rows[a].setValue(b):e.row_cache[a]?(e.rows[a]=e.row_cache[a],e.rows[a].setValue(b),e.rows[a].container.style.display="",e.rows[a].tab&&(e.rows[a].tab.style.display=""),e.rows[a].register()):e.addRow(b)});for(var f=a.length;f<e.rows.length;f++)e.destroyRow(e.rows[f]),e.rows[f]=null;e.rows=e.rows.slice(0,a.length);var g=null;c(e.rows,function(a,b){return b.tab===e.active_tab?(g=b.tab,!1):void 0}),!g&&e.rows.length&&(g=e.rows[0].tab),e.active_tab=g,e.refreshValue(b),e.refreshTabs(),e.jsoneditor.notifyWatchers(e.path)}},refreshValue:function(a){var b=this,d=this.value?this.value.length:0;if(this.value=[],c(this.rows,function(a,c){b.value[a]=c.getValue()}),d!==this.value.length||a){var e=this.schema.minItems&&this.schema.minItems>=this.rows.length;c(this.rows,function(a,c){c.movedown_buttons&&(c.movedown_button.style.display=a===b.rows.length-1?"none":""),c.delete_button&&(c.delete_button.style.display=e?"none":""),b.value[a]=c.getValue()});var f=!1;this.value.length?1===this.value.length?(this.remove_all_rows_button.style.display="none",e||this.hide_delete_buttons?this.delete_last_row_button.style.display="none":(this.delete_last_row_button.style.display="",f=!0)):e||this.hide_delete_buttons?(this.delete_last_row_button.style.display="none",this.remove_all_rows_button.style.display="none"):(this.delete_last_row_button.style.display="",this.remove_all_rows_button.style.display="",f=!0):(this.delete_last_row_button.style.display="none",this.remove_all_rows_button.style.display="none"),this.getMax()&&this.getMax()<=this.rows.length||this.hide_add_button?this.add_row_button.style.display="none":(this.add_row_button.style.display="",f=!0),this.controls.style.display=!this.collapsed&&f?"":"none"}},addRow:function(a){var b=this,d=this.rows.length;b.rows[d]=this.getElementEditor(d),b.row_cache[d]=b.rows[d],b.tabs_holder&&(b.rows[d].tab_text=document.createElement("span"),b.rows[d].tab_text.textContent=b.rows[d].getHeaderText(),b.rows[d].tab=b.theme.getTab(b.rows[d].tab_text),b.rows[d].tab.addEventListener("click",function(a){b.active_tab=b.rows[d].tab,b.refreshTabs(),a.preventDefault(),a.stopPropagation()}),b.theme.addTab(b.tabs_holder,b.rows[d].tab));var e=b.rows[d].title_controls||b.rows[d].array_controls;b.hide_delete_buttons||(b.rows[d].delete_button=this.getButton(b.getItemTitle(),"delete","Delete "+b.getItemTitle()),b.rows[d].delete_button.className+=" delete",b.rows[d].delete_button.setAttribute("data-i",d),b.rows[d].delete_button.addEventListener("click",function(){var a=1*this.getAttribute("data-i"),d=b.getValue(),e=[],f=null;c(d,function(c,d){return c===a?void(b.rows[c].tab===b.active_tab&&(b.rows[c+1]?f=b.rows[c+1].tab:c&&(f=b.rows[c-1].tab))):void e.push(d)}),b.setValue(e),f&&(b.active_tab=f,b.refreshTabs()),b.parent?b.parent.onChildEditorChange(b):b.jsoneditor.onChange()}),e&&e.appendChild(b.rows[d].delete_button)),d&&!b.hide_move_buttons&&(b.rows[d].moveup_button=this.getButton("","moveup","Move up"),b.rows[d].moveup_button.className+=" moveup",b.rows[d].moveup_button.setAttribute("data-i",d),b.rows[d].moveup_button.addEventListener("click",function(){var a=1*this.getAttribute("data-i");if(!(0>=a)){var c=b.getValue(),d=c[a-1];c[a-1]=c[a],c[a]=d,b.setValue(c),b.active_tab=b.rows[a-1].tab,b.refreshTabs(),b.parent?b.parent.onChildEditorChange(b):b.jsoneditor.onChange()}}),e&&e.appendChild(b.rows[d].moveup_button)),b.hide_move_buttons||(b.rows[d].movedown_button=this.getButton("","movedown","Move down"),b.rows[d].movedown_button.className+=" movedown",b.rows[d].movedown_button.setAttribute("data-i",d),b.rows[d].movedown_button.addEventListener("click",function(){var a=1*this.getAttribute("data-i"),c=b.getValue();if(!(a>=c.length-1)){var d=c[a+1];c[a+1]=c[a],c[a]=d,b.setValue(c),b.active_tab=b.rows[a+1].tab,b.refreshTabs(),b.parent?b.parent.onChildEditorChange(b):b.jsoneditor.onChange()}}),e&&e.appendChild(b.rows[d].movedown_button)),a&&b.rows[d].setValue(a),b.refreshTabs()},addControls:function(){var a=this;this.collapsed=!1,this.toggle_button=this.getButton("","collapse","Collapse"),this.title_controls.appendChild(this.toggle_button);var b=a.row_holder.style.display,c=a.controls.style.display;this.toggle_button.addEventListener("click",function(){a.collapsed?(a.collapsed=!1,a.panel&&(a.panel.style.display=""),a.row_holder.style.display=b,a.tabs_holder&&(a.tabs_holder.style.display=""),a.controls.style.display=c,a.setButtonText(this,"","collapse","Collapse")):(a.collapsed=!0,a.row_holder.style.display="none",a.tabs_holder&&(a.tabs_holder.style.display="none"),a.controls.style.display="none",a.panel&&(a.panel.style.display="none"),a.setButtonText(this,"","expand","Expand"))}),this.options.collapsed&&d(this.toggle_button,"click"),this.schema.options&&"undefined"!=typeof this.schema.options.disable_collapse?this.schema.options.disable_collapse&&(this.toggle_button.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.toggle_button.style.display="none"),this.add_row_button=this.getButton(this.getItemTitle(),"add","Add "+this.getItemTitle()),this.add_row_button.addEventListener("click",function(){var b=a.rows.length;a.row_cache[b]?(a.rows[b]=a.row_cache[b],a.rows[b].container.style.display="",a.rows[b].tab&&(a.rows[b].tab.style.display=""),a.rows[b].register()):a.addRow(),a.active_tab=a.rows[b].tab,a.refreshTabs(),a.refreshValue(),a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange(),a.jsoneditor.notifyWatchers(a.path)}),a.controls.appendChild(this.add_row_button),this.delete_last_row_button=this.getButton("Last "+this.getItemTitle(),"delete","Delete Last "+this.getItemTitle()),this.delete_last_row_button.addEventListener("click",function(){var b=a.getValue(),c=null;a.rows.length>1&&a.rows[a.rows.length-1].tab===a.active_tab&&(c=a.rows[a.rows.length-2].tab),b.pop(),a.setValue(b),c&&(a.active_tab=c,a.refreshTabs()),a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange()}),a.controls.appendChild(this.delete_last_row_button),this.remove_all_rows_button=this.getButton("All","delete","Delete All"),this.remove_all_rows_button.addEventListener("click",function(){a.setValue([]),a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange()}),a.controls.appendChild(this.remove_all_rows_button),a.tabs&&(this.add_row_button.style.width="100%",this.add_row_button.style.textAlign="left",this.add_row_button.style.marginBottom="3px",this.delete_last_row_button.style.width="100%",this.delete_last_row_button.style.textAlign="left",this.delete_last_row_button.style.marginBottom="3px",this.remove_all_rows_button.style.width="100%",this.remove_all_rows_button.style.textAlign="left",this.remove_all_rows_button.style.marginBottom="3px")},showValidationErrors:function(a){var b=this,d=[],e=[];c(a,function(a,c){c.path===b.path?d.push(c):e.push(c)}),this.error_holder&&(d.length?(this.error_holder.innerHTML="",this.error_holder.style.display="",c(d,function(a,c){b.error_holder.appendChild(b.theme.getErrorMessage(c.message))})):this.error_holder.style.display="none"),c(this.rows,function(a,b){b.showValidationErrors(e)})}}),f.defaults.editors.table=f.defaults.editors.array.extend({addProperty:function(){this._super(),this.value.length&&(this.table.style.display="")},removeProperty:function(){this._super(),this.table.style.display="none"},register:function(){if(this._super(),this.rows)for(var a=0;a<this.rows.length;a++)this.rows[a].register()},unregister:function(){if(this._super(),this.rows)for(var a=0;a<this.rows.length;a++)this.rows[a].unregister()},getNumColumns:function(){return Math.max(Math.min(12,this.width),3)},build:function(){this.rows=[];var a=this;this.schema.items=this.schema.items||[],this.hide_delete_buttons=this.options.disable_array_delete||this.jsoneditor.options.disable_array_delete,this.hide_move_buttons=this.options.disable_array_reorder||this.jsoneditor.options.disable_array_reorder,this.hide_add_button=this.options.disable_array_add||this.jsoneditor.options.disable_array_add,this.table=this.theme.getTable(),this.container.appendChild(this.table),this.thead=this.theme.getTableHead(),this.table.appendChild(this.thead),this.header_row=this.theme.getTableRow(),this.thead.appendChild(this.header_row),this.row_holder=this.theme.getTableBody(),this.table.appendChild(this.row_holder);var b=this.getElementEditor(0,!0);this.item_default=b.getDefault(),this.item_title=this.schema.items.title||"row",this.width=b.getNumColumns(),b.getChildEditors()&&(this.item_has_child_editors=!0),this.getOption("compact",!1)?(this.panel=document.createElement("div"),this.container.appendChild(this.panel)):(this.title=this.theme.getHeader(this.getTitle()),this.container.appendChild(this.title),this.title_controls=this.theme.getHeaderButtonHolder(),this.title.appendChild(this.title_controls),this.panel=this.theme.getIndentedPanel(),this.container.appendChild(this.panel),this.schema.description&&(this.description=this.theme.getDescription(this.schema.description),this.panel.appendChild(this.description)),this.error_holder=document.createElement("div"),this.panel.appendChild(this.error_holder)),this.panel.appendChild(this.table),this.controls=this.theme.getButtonHolder(),this.panel.appendChild(this.controls),this.item_has_child_editors?c(b.getChildEditors(),function(b,c){var d=a.theme.getTableHeaderCell(c.getTitle());c.options.hidden&&(d.style.display="none"),a.header_row.appendChild(d)}):a.header_row.appendChild(a.theme.getTableHeaderCell(this.item_title)),b.destroy(),this.row_holder.innerHTML="",this.controls_header_cell=a.theme.getTableHeaderCell(" "),a.header_row.appendChild(this.controls_header_cell),this.addControls(),this.jsoneditor.notifyWatchers(this.path)},onChildEditorChange:function(){this.refreshValue(),this._super()},getItemDefault:function(){return b({},{"default":this.item_default}).default},getItemTitle:function(){return this.item_title},getElementEditor:function(a,c){var d=b({},this.schema.items),e=this.jsoneditor.getEditorClass(d,this.jsoneditor),f=this.row_holder.appendChild(this.theme.getTableRow()),g=f;this.item_has_child_editors||(g=this.theme.getTableCell(),f.appendChild(g)),c&&g.addEventListener("change_header_text",function(a){a.preventDefault(),a.stopPropagation()});var h=this.jsoneditor.createEditor(e,{jsoneditor:this.jsoneditor,schema:d,container:g,path:this.path+"."+a,parent:this,compact:!0,table_row:!0});return h.controls_cell=f.appendChild(this.theme.getTableCell()),h.row=f,h.table_controls=this.theme.getButtonHolder(),h.controls_cell.appendChild(h.table_controls),h.table_controls.style.margin=0,h.table_controls.style.padding=0,h},destroy:function(){this.innerHTML="",this.title&&this.title.parentNode.removeChild(this.title),this.description&&this.description.parentNode.removeChild(this.description),this.row_holder&&this.row_holder.parentNode&&this.row_holder.parentNode.removeChild(this.row_holder),this.table.parentNode.removeChild(this.table),this.panel&&this.panel.parentNode.removeChild(this.panel),this.rows=this.title=this.description=this.row_holder=this.table=this.panel=null,this._super()},empty:function(){if(this.rows){var a=this;c(this.rows,function(b,c){a.item_has_child_editors||c.row.parentNode.removeChild(c.row),c.destroy(),a.rows[b]=null}),a.rows=[]}},setValue:function(a,b){if(a=a||[],this.schema.minItems)for(;a.length<this.schema.minItems;)a.push(this.getItemDefault());this.schema.maxItems&&a.length>this.schema.maxItems&&(a=a.slice(0,this.schema.maxItems));var d=JSON.stringify(a);if(d!==this.serialized){var e=!1,f=this;c(a,function(a,b){f.rows[a]?f.rows[a].setValue(b):(f.addRow(b),e=!0)});for(var g=a.length;g<f.rows.length;g++){var h=f.rows[g].container;f.item_has_child_editors||f.rows[g].row.parentNode.removeChild(f.rows[g].row),f.rows[g].destroy(),h.parentNode&&h.parentNode.removeChild(h),f.rows[g]=null,e=!0}f.rows=f.rows.slice(0,a.length),f.refreshValue(),(e||b)&&f.refreshRowButtons(),f.jsoneditor.notifyWatchers(f.path)}},refreshRowButtons:function(){var a=this,b=this.schema.minItems&&this.schema.minItems>=this.rows.length,d=!1;c(this.rows,function(c,e){e.movedown_button&&(c===a.rows.length-1?e.movedown_button.style.display="none":(d=!0,e.movedown_button.style.display="")),e.delete_button&&(b?e.delete_button.style.display="none":(d=!0,e.delete_button.style.display="")),e.moveup_button&&(d=!0)}),c(this.rows,function(a,b){b.controls_cell.style.display=d?"":"none"}),this.controls_header_cell.style.display=d?"":"none";var e=!1;this.value.length?1===this.value.length||this.hide_delete_buttons?(this.table.style.display="",this.remove_all_rows_button.style.display="none",b||this.hide_delete_buttons?this.delete_last_row_button.style.display="none":(this.delete_last_row_button.style.display="",e=!0)):(this.table.style.display="",b||this.hide_delete_buttons?(this.delete_last_row_button.style.display="none",this.remove_all_rows_button.style.display="none"):(this.delete_last_row_button.style.display="",this.remove_all_rows_button.style.display="",e=!0)):(this.delete_last_row_button.style.display="none",this.remove_all_rows_button.style.display="none",this.table.style.display="none"),this.schema.maxItems&&this.schema.maxItems<=this.rows.length||this.hide_add_button?this.add_row_button.style.display="none":(this.add_row_button.style.display="",e=!0),this.controls.style.display=e?"":"none"},refreshValue:function(){var a=this;this.value=[],c(this.rows,function(b,c){a.value[b]=c.getValue()}),this.serialized=JSON.stringify(this.value)},addRow:function(a){var b=this,d=this.rows.length;b.rows[d]=this.getElementEditor(d);var e=b.rows[d].table_controls;this.hide_delete_buttons||(b.rows[d].delete_button=this.getButton("","delete","Delete"),b.rows[d].delete_button.className+=" delete",b.rows[d].delete_button.setAttribute("data-i",d),b.rows[d].delete_button.addEventListener("click",function(){var a=1*this.getAttribute("data-i"),d=b.getValue(),e=[];c(d,function(b,c){b!==a&&e.push(c)}),b.setValue(e),b.parent?b.parent.onChildEditorChange(b):b.jsoneditor.onChange()}),e.appendChild(b.rows[d].delete_button)),d&&!this.hide_move_buttons&&(b.rows[d].moveup_button=this.getButton("","moveup","Move up"),b.rows[d].moveup_button.className+=" moveup",b.rows[d].moveup_button.setAttribute("data-i",d),b.rows[d].moveup_button.addEventListener("click",function(){var a=1*this.getAttribute("data-i");if(!(0>=a)){var c=b.getValue(),d=c[a-1];c[a-1]=c[a],c[a]=d,b.setValue(c),b.parent?b.parent.onChildEditorChange(b):b.jsoneditor.onChange()}}),e.appendChild(b.rows[d].moveup_button)),this.hide_move_buttons||(b.rows[d].movedown_button=this.getButton("","movedown","Move down"),b.rows[d].movedown_button.className+=" movedown",b.rows[d].movedown_button.setAttribute("data-i",d),b.rows[d].movedown_button.addEventListener("click",function(){var a=1*this.getAttribute("data-i"),c=b.getValue();if(!(a>=c.length-1)){var d=c[a+1];c[a+1]=c[a],c[a]=d,b.setValue(c),b.parent?b.parent.onChildEditorChange(b):b.jsoneditor.onChange()}}),e.appendChild(b.rows[d].movedown_button)),a&&b.rows[d].setValue(a),b.jsoneditor.notifyWatchers(b.path)},addControls:function(){var a=this;this.collapsed=!1,this.toggle_button=this.getButton("","collapse","Collapse"),this.title_controls.appendChild(this.toggle_button),this.toggle_button.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation(),a.collapsed?(a.collapsed=!1,a.panel.style.display="",a.setButtonText(this,"","collapse","Collapse")):(a.collapsed=!0,a.panel.style.display="none",a.setButtonText(this,"","expand","Expand"))}),this.options.collapsed&&d(this.toggle_button,"click"),this.schema.options&&"undefined"!=typeof this.schema.options.disable_collapse?this.schema.options.disable_collapse&&(this.toggle_button.style.display="none"):this.jsoneditor.options.disable_collapse&&(this.toggle_button.style.display="none"),this.add_row_button=this.getButton(this.getItemTitle(),"add","Add "+this.getItemTitle()),this.add_row_button.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation(),a.addRow(),a.refreshValue(),a.refreshRowButtons(),a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange()}),a.controls.appendChild(this.add_row_button),this.delete_last_row_button=this.getButton("Last "+this.getItemTitle(),"delete","Delete Last "+this.getItemTitle()),this.delete_last_row_button.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation();var c=a.getValue();c.pop(),a.setValue(c),a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange()}),a.controls.appendChild(this.delete_last_row_button),this.remove_all_rows_button=this.getButton("All","delete","Delete All"),this.remove_all_rows_button.addEventListener("click",function(b){b.preventDefault(),b.stopPropagation(),a.setValue([]),a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange()}),a.controls.appendChild(this.remove_all_rows_button)}}),f.defaults.editors.multiple=f.AbstractEditor.extend({getDefault:function(){return this.schema.default||null},register:function(){if(this.editors){for(var a=0;a<this.editors.length;a++)this.editors[a]&&this.editors[a].unregister();this.editors[this.type]&&this.editors[this.type].register()}this._super()},getNumColumns:function(){return Math.max(this.editors[this.type].getNumColumns(),4)},enable:function(){if(this.editors)for(var a=0;a<this.editors.length;a++)this.editors[a]&&this.editors[a].enable();this.switcher.disabled=!1,this._super()},disable:function(){if(this.editors)for(var a=0;a<this.editors.length;a++)this.editors[a]&&this.editors[a].disable();this.switcher.disabled=!0,this._super()},unregister:function(){if(this._super(),this.editors)for(var a=0;a<this.editors.length;a++)this.editors[a]&&this.editors[a].unregister()},switchEditor:function(a){var b=this;this.editors[a]||this.buildChildEditor(a),b.type=a,b.register();var d=b.getValue();c(b.editors,function(a,c){c&&(b.type===a?(c.setValue(d,!0),c.container.style.display=""):c.container.style.display="none")}),b.refreshValue(),b.parent?b.parent.onChildEditorChange(b):b.jsoneditor.onChange()},buildChildEditor:function(a){var c=this,d=this.types[a],e=c.theme.getChildEditorHolder();c.editor_holder.appendChild(e);var f;"string"==typeof d?(f=b({},c.schema),f.type=d):(f=b({},c.schema,d),d.required&&d.required instanceof Array&&c.schema.required&&c.schema.required instanceof Array&&(f.required=c.schema.required.concat(d.required)));var g=c.jsoneditor.getEditorClass(f,c.jsoneditor);c.editors[a]=c.jsoneditor.createEditor(g,{jsoneditor:c.jsoneditor,schema:f,container:e,path:c.path,parent:c,required:!0}),c.editors[a].header&&(c.editors[a].header.style.display="none"),c.editors[a].option=c.switcher_options[a],e.addEventListener("change_header_text",function(){c.refreshHeaderText()}),a!==c.type&&(e.style.display="none")},build:function(){var a=this,d=this.container;if(this.header=this.label=this.theme.getFormInputLabel(this.getTitle()),this.container.appendChild(this.header),this.types=[],this.schema.oneOf)this.oneOf=!0,this.types=this.schema.oneOf,delete this.schema.oneOf;else{if(this.schema.type&&"any"!==this.schema.type)this.types=this.schema.type instanceof Array?this.schema.type:[this.schema.type];else if(this.types=["string","number","integer","boolean","object","array","null"],this.schema.disallow){var e=this.schema.disallow;"object"==typeof schema.disallow&&schema.disallow instanceof Array||(e=[this.schema.disallow]);var g=[];c(this.types,function(a,b){-1===e.indexOf(b)&&g.push(b)}),this.types=g}delete this.schema.type}this.display_text=this.getDisplayText(this.types),this.switcher=this.theme.getSwitcher(this.display_text),d.appendChild(this.switcher),this.switcher.addEventListener("change",function(b){b.preventDefault(),b.stopPropagation(),a.switchEditor(a.display_text.indexOf(this.value))}),this.switcher.style.marginBottom=0,this.switcher.style.width="auto",this.switcher.style.display="inline-block",this.switcher.style.marginLeft="5px",this.editor_holder=document.createElement("div"),d.appendChild(this.editor_holder),this.type=0,this.editors=[],this.validators=[],this.switcher_options=this.theme.getSwitcherOptions(this.switcher),c(this.types,function(c,d){a.editors[c]=!1;var e;"string"==typeof d?(e=b({},a.schema),e.type=d):(e=b({},a.schema,d),d.required&&d.required instanceof Array&&a.schema.required&&a.schema.required instanceof Array&&(e.required=a.schema.required.concat(d.required))),a.validators[c]=new f.Validator(e,{required_by_default:a.jsoneditor.options.required_by_default,no_additional_properties:a.jsoneditor.options.no_additional_properties})}),this.switchEditor(0),this.refreshValue(),this.refreshHeaderText(),this.register()},onChildEditorChange:function(){this.editors[this.type]&&(this.refreshHeaderText(),this.refreshValue()),this._super()},refreshHeaderText:function(){var a=[];c(this.validators,function(b,c){a.push(c.schema)});var b=this.getDisplayText(a);c(this.switcher_options,function(a,c){c.textContent=b[a]})},refreshValue:function(){this.value=this.editors[this.type].getValue()},setValue:function(a,b){var d=this;c(this.validators,function(b,c){return c.validate(a).length?void 0:(d.type=b,d.switcher.value=d.display_text[b],!1)}),this.switchEditor(this.type),this.editors[this.type].setValue(a,b),this.refreshValue(),this.jsoneditor.notifyWatchers(this.path)},destroy:function(){c(this.editors,function(a,b){b&&b.destroy()}),this.editor_holder.parentNode.removeChild(this.editor_holder),this.switcher.parentNode.removeChild(this.switcher),this._super()},showValidationErrors:function(a){var d=this;this.oneOf?c(this.editors,function(e,f){if(f){var g=d.path+".oneOf["+e+"]",h=[];c(a,function(a,c){if(c.path.substr(0,g.length)===g){var e=b({},c);e.path=d.path+e.path.substr(g.length),h.push(e)}}),f.showValidationErrors(h)}}):c(this.editors,function(b,c){c&&c.showValidationErrors(a)})}}),f.defaults.editors.enum=f.AbstractEditor.extend({getDefault:function(){return this.schema.enum[0]},addProperty:function(){this._super(),this.display_area.style.display="",this.theme.enableHeader(this.title)},removeProperty:function(){this._super(),this.display_area.style.display="none",this.theme.disableHeader(this.title)},getNumColumns:function(){return 4},build:function(){this.getContainer(),this.title=this.header=this.label=this.getTheme().getFormInputLabel(this.getTitle()),this.container.appendChild(this.title),this.options.enum_titles=this.options.enum_titles||[],this.enum=this.schema.enum,this.selected=0,this.select_options=[],this.html_values=[];for(var a=this,b=0;b<this.enum.length;b++)this.select_options[b]=this.options.enum_titles[b]||"Value "+(b+1),this.html_values[b]=this.getHTML(this.enum[b]);this.switcher=this.theme.getSwitcher(this.select_options),this.container.appendChild(this.switcher),this.switcher.style.width="auto",this.switcher.style.display="inline-block",this.switcher.style.marginLeft="5px",this.switcher.style.marginBottom=0,this.display_area=this.theme.getIndentedPanel(),this.display_area.style.paddingTop=0,this.display_area.style.paddingBottom=0,this.container.appendChild(this.display_area),this.switcher.addEventListener("change",function(){a.selected=a.select_options.indexOf(this.value),a.value=a.enum[a.selected],a.refreshValue(),a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange()}),this.value=this.enum[0],this.refreshValue(),this.jsoneditor.notifyWatchers(this.path),1===this.enum.length&&(this.switcher.style.display="none")},refreshValue:function(){var a=this;a.selected=-1;var b=JSON.stringify(this.value);return c(this.enum,function(c,d){return b===JSON.stringify(d)?(a.selected=c,!1):void 0}),a.selected<0?void a.setValue(a.enum[0]):(this.switcher.value=this.select_options[this.selected],void(this.display_area.innerHTML=this.html_values[this.selected]))},enable:function(){this.always_disabled||(this.switcher.disabled=!1),this._super()},disable:function(){this.switcher.disabled=!0,this._super()},getHTML:function(a){var b=this;if(null===a)return"<em>null</em>";if("object"==typeof a){var d="";return c(a,function(c,e){var f=b.getHTML(e);a instanceof Array||(f="<div><em>"+c+"</em>: "+f+"</div>"),d+="<li>"+f+"</li>"}),d=a instanceof Array?"<ol>"+d+"</ol>":"<ul style='margin-top:0;margin-bottom:0;padding-top:0;padding-bottom:0;'>"+d+"</ul>"}return"boolean"==typeof a?a?"true":"false":"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a},setValue:function(a){this.value!==a&&(this.value=a,this.refreshValue(),this.jsoneditor.notifyWatchers(this.path))},destroy:function(){this.display_area.parentNode.removeChild(this.display_area),this.title.parentNode.removeChild(this.title),this.switcher.parentNode.removeChild(this.switcher),this._super()}}),f.defaults.editors.select=f.AbstractEditor.extend({getDefault:function(){return this.schema.default||""},setValue:function(a){a=this.typecast(a||"");var b=a;this.enum_values.indexOf(b)<0&&(b=this.enum_values[0]),this.value!==b&&(this.input.value=this.enum_options[this.enum_values.indexOf(b)],this.value=b,this.jsoneditor.notifyWatchers(this.path))},register:function(){this._super(),this.input&&this.input.setAttribute("name",this.formname)},unregister:function(){this._super(),this.input&&this.input.removeAttribute("name")},getNumColumns:function(){for(var a=this.getTitle().length,b=0;b<this.enum_options.length;b++)a=Math.max(a,this.enum_options[b].length+4);return Math.min(12,Math.max(a/7,2))},typecast:function(a){return"boolean"===this.schema.type?!!a:"number"===this.schema.type?1*a:"integer"===this.schema.type?Math.floor(1*a):""+a},getValue:function(){return this.value},removeProperty:function(){this._super(),this.input.style.display="none",this.description&&(this.description.style.display="none"),this.theme.disableLabel(this.label)},addProperty:function(){this._super(),this.input.style.display="",this.description&&(this.description.style.display=""),this.theme.enableLabel(this.label)},build:function(){var a=this;if(this.getOption("compact",!1)||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.schema.description)),this.input_type="select",this.enum_options=[],this.enum_values=[],this.enum_display=[],this.schema.enum)c(this.schema.enum,function(b,c){a.enum_options[b]=""+c,a.enum_display[b]=""+c,a.enum_values[b]=a.typecast(c)});else{if("boolean"!==this.schema.type)throw"'select' editor requires the enum property to be set.";a.enum_display=["true","false"],a.enum_options=["1",""],a.enum_values=[!0,!1]}this.getOption("compact")&&this.container.setAttribute("class",this.container.getAttribute("class")+" compact"),this.input=this.theme.getSelectInput(this.enum_options),this.theme.setSelectOptions(this.input,this.enum_options,this.enum_display),(this.schema.readOnly||this.schema.readonly)&&(this.always_disabled=!0,this.input.disabled=!0),this.input.addEventListener("change",function(b){b.preventDefault(),b.stopPropagation();var c=this.value,d=c;-1===a.enum_options.indexOf(c)&&(d=a.enum_options[0]),a.value=a.enum_values[a.enum_options.indexOf(c)],a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange(),a.jsoneditor.notifyWatchers(a.path)}),this.control=this.getTheme().getFormControl(this.label,this.input,this.description),this.container.appendChild(this.control),this.value=this.enum_values[0],window.$&&$.fn&&$.fn.select2&&this.enum_options.length>2&&$(this.input).select2(),this.register(),a.theme.afterInputReady(a.input),this.jsoneditor.notifyWatchers(this.path)},enable:function(){this.always_disabled||(this.input.disabled=!1),this._super()},disable:function(){this.input.disabled=!0,this._super()},destroy:function(){this.label&&this.label.parentNode.removeChild(this.label),this.description&&this.description.parentNode.removeChild(this.description),this.input.parentNode.removeChild(this.input),this._super()}}),f.defaults.editors.multiselect=f.AbstractEditor.extend({getDefault:function(){return[]},build:function(){var a,b=this;this.getOption("compact",!1)||(this.header=this.label=this.theme.getFormInputLabel(this.getTitle())),this.schema.description&&(this.description=this.theme.getFormInputDescription(this.schema.description)),this.select_options={},this.select_values={};var c=this.schema.items.enum||[],d=[];for(a=0;a<c.length;a++)this.sanitize(c[a])===c[a]&&(d.push(c[a]+""),this.select_values[c[a]+""]=c[a]);if(!this.schema.format&&d.length<8||"checkbox"===this.schema.format){for(this.input_type="checkboxes",this.inputs={},this.controls={},a=0;a<d.length;a++){this.inputs[d[a]]=this.theme.getCheckbox(),this.select_options[d[a]]=this.inputs[d[a]];var e=this.theme.getCheckboxLabel(d[a]);
this.controls[d[a]]=this.theme.getFormControl(e,this.inputs[d[a]])}this.control=this.theme.getMultiCheckboxHolder(this.controls,this.label,this.description)}else{for(this.input_type="select",this.input=this.theme.getSelectInput(d),this.input.multiple=!0,this.input.size=Math.min(10,d.length),a=0;a<d.length;a++)this.select_options[d[a]]=this.input.children[a];(this.schema.readOnly||this.schema.readonly)&&(this.always_disabled=!0,this.input.disabled=!0),this.control=this.getTheme().getFormControl(this.label,this.input,this.description)}this.container.appendChild(this.control),this.control.addEventListener("change",function(c){c.preventDefault(),c.stopPropagation();var e=[];for(a=0;a<d.length;a++)(b.select_options[d[a]].selected||b.select_options[d[a]].checked)&&e.push(b.select_values[d[a]]);b.updateValue(e),b.parent?b.parent.onChildEditorChange(b):b.jsoneditor.onChange(),b.jsoneditor.notifyWatchers(b.path)})},setValue:function(a){var b;for(a=a||[],"object"!=typeof a?a=[a]:a instanceof Array||(a=[]),b=0;b<a.length;b++)"string"!=typeof a[b]&&(a[b]+="");for(b in this.select_options)this.select_options.hasOwnProperty(b)&&(this.select_options[b]["select"===this.input_type?"selected":"checked"]=-1!==a.indexOf(b));this.updateValue(a)&&(this.parent?this.onChildEditorChange(this):this.jsoneditor.onChange()),this.jsoneditor.notifyWatchers(this.path)},register:function(){this._super(),this.input&&this.input.setAttribute("name",this.formname)},unregister:function(){this._super(),this.input&&this.input.removeAttribute("name")},getNumColumns:function(){var a=this.getTitle().length;for(var b in this.select_values)this.select_values.hasOwnProperty(b)&&(a=Math.max(a,(this.select_values[b]+"").length+4));return Math.min(12,Math.max(a/7,2))},updateValue:function(a){for(var b=!1,c=[],d=0;d<a.length;d++)if(this.select_options[a[d]+""]){var e=this.sanitize(this.select_values[a[d]]);c.push(e),e!==a[d]&&(b=!0)}else b=!0;return this.value=c,b},sanitize:function(a){return"number"===this.schema.items.type?1*a:"integer"===this.schema.items.type?Math.floor(1*a):""+a},enable:function(){if(!this.always_disabled)if(this.input)this.input.disabled=!1;else if(this.inputs)for(var a in this.inputs)this.inputs.hasOwnProperty(a)&&(this.inputs[a].disabled=!1);this._super()},disable:function(){if(this.input)this.input.disabled=!0;else if(this.inputs)for(var a in this.inputs)this.inputs.hasOwnProperty(a)&&(this.inputs[a].disabled=!0);this._super()}}),f.defaults.editors.base64=f.AbstractEditor.extend({getDefault:function(){return this.schema.default||""},getNumColumns:function(){return 4},build:function(){var a=this;if(this.title=this.header=this.label=this.getTheme().getFormInputLabel(this.getTitle()),this.input=this.theme.getFormInputField("hidden"),this.container.appendChild(this.input),!this.schema.readOnly&&!this.schema.readonly){if(!window.FileReader)throw"FileReader required for base64 editor";this.uploader=this.theme.getFormInputField("file"),this.uploader.addEventListener("change",function(b){if(b.preventDefault(),b.stopPropagation(),this.files&&this.files.length){var c=new FileReader;c.onload=function(b){a.value=b.target.result,a.refreshPreview(),a.watch_listener(),a.jsoneditor.notifyWatchers(a.path),a.parent?a.parent.onChildEditorChange(a):a.jsoneditor.onChange(),c=null},c.readAsDataURL(this.files[0])}})}this.preview=this.theme.getFormInputDescription(this.schema.description),this.container.appendChild(this.preview),this.control=this.getTheme().getFormControl(this.label,this.uploader||this.input,this.preview),this.container.appendChild(this.control),this.register()},refreshPreview:function(){if(this.last_preview!==this.value&&(this.last_preview=this.value,this.preview.innerHTML="",this.value)){var a=this.value.match(/^data:([^;,]+)[;,]/);if(a&&(a=a[1]),a){if(this.preview.innerHTML="<strong>Type:</strong> "+a+", <strong>Size:</strong> "+Math.floor((this.value.length-this.value.split(",")[0].length-1)/1.33333)+" bytes","image"===a.substr(0,5)){this.preview.innerHTML+="<br>";var b=document.createElement("img");b.style.maxWidth="100%",b.style.maxHeight="100px",b.src=this.value,this.preview.appendChild(b)}}else this.preview.innerHTML="<em>Invalid data URI</em>"}},enable:function(){this.uploader&&(this.uploader.disabled=!1),this._super()},disable:function(){this.uploader&&(this.uploader.disabled=!0),this._super()},setValue:function(a){this.value!==a&&(this.value=a,this.input.value=this.value,this.refreshPreview(),this.watch_listener(),this.jsoneditor.notifyWatchers(this.path))},destroy:function(){this.preview.parentNode.removeChild(this.preview),this.title.parentNode.removeChild(this.title),this.input.parentNode.removeChild(this.input),this.uploader&&this.uploader.parentNode.removeChild(this.uploader),this._super()}}),f.AbstractTheme=Class.extend({getContainer:function(){return document.createElement("div")},getFloatRightLinkHolder:function(){var a=document.createElement("div");return a.style=a.style||{},a.style.float="right",a.style["margin-left"]="10px",a},getModal:function(){var a=document.createElement("div");return a.style.backgroundColor="white",a.style.border="1px solid black",a.style.boxShadow="3px 3px black",a.style.position="absolute",a.style.zIndex="10",a.style.display="none",a},getGridContainer:function(){var a=document.createElement("div");return a},getGridRow:function(){var a=document.createElement("div");return a.className="row",a},getGridColumn:function(){var a=document.createElement("div");return a},setGridColumnSize:function(){},getLink:function(a){var b=document.createElement("a");return b.setAttribute("href","#"),b.appendChild(document.createTextNode(a)),b},disableHeader:function(a){a.style.color="#ccc"},disableLabel:function(a){a.style.color="#ccc"},enableHeader:function(a){a.style.color=""},enableLabel:function(a){a.style.color=""},getFormInputLabel:function(a){var b=document.createElement("label");return b.appendChild(document.createTextNode(a)),b},getCheckboxLabel:function(a){var b=this.getFormInputLabel(a);return b.style.fontWeight="normal",b},getHeader:function(a){var b=document.createElement("h3");return"string"==typeof a?b.textContent=a:b.appendChild(a),b},getCheckbox:function(){var a=this.getFormInputField("checkbox");return a.style.display="inline-block",a.style.width="auto",a},getMultiCheckboxHolder:function(a,b,c){var d=document.createElement("div");b&&(b.style.display="block",d.appendChild(b));for(var e in a)a.hasOwnProperty(e)&&(a[e].style.display="inline-block",a[e].style.marginRight="20px",d.appendChild(a[e]));return c&&d.appendChild(c),d},getSelectInput:function(a){var b=document.createElement("select");return a&&this.setSelectOptions(b,a),b},getSwitcher:function(a){var b=this.getSelectInput(a);return b.style.backgroundColor="transparent",b.style.height="auto",b.style.fontStyle="italic",b.style.fontWeight="normal",b.style.padding="0 0 0 3px",b},getSwitcherOptions:function(a){return a.getElementsByTagName("option")},setSwitcherOptions:function(a,b,c){this.setSelectOptions(a,b,c)},setSelectOptions:function(a,b,c){c=c||[],a.innerHTML="";for(var d=0;d<b.length;d++){var e=document.createElement("option");e.setAttribute("value",b[d]),e.textContent=c[d]||b[d],a.appendChild(e)}},getTextareaInput:function(){var a=document.createElement("textarea");return a.style=a.style||{},a.style.width="100%",a.style.height="300px",a.style.boxSizing="border-box",a},getRangeInput:function(a,b,c){var d=this.getFormInputField("range");return d.setAttribute("min",a),d.setAttribute("max",b),d.setAttribute("step",c),d},getFormInputField:function(a){var b=document.createElement("input");return b.setAttribute("type",a),b},afterInputReady:function(){},getFormControl:function(a,b,c){var d=document.createElement("div");return d.className="form-control",a&&d.appendChild(a),"checkbox"===b.type?a.insertBefore(b,a.firstChild):d.appendChild(b),c&&d.appendChild(c),d},getIndentedPanel:function(){var a=document.createElement("div");return a.style=a.style||{},a.style.paddingLeft="10px",a.style.marginLeft="10px",a.style.borderLeft="1px solid #ccc",a},getChildEditorHolder:function(){return document.createElement("div")},getDescription:function(a){var b=document.createElement("p");return b.appendChild(document.createTextNode(a)),b},getCheckboxDescription:function(a){return this.getDescription(a)},getFormInputDescription:function(a){return this.getDescription(a)},getHeaderButtonHolder:function(){return this.getButtonHolder()},getButtonHolder:function(){return document.createElement("div")},getButton:function(a,b,c){var d=document.createElement("button");return this.setButtonText(d,a,b,c),d},setButtonText:function(a,b,c,d){a.innerHTML="",c&&(a.appendChild(c),a.innerHTML+=" "),a.appendChild(document.createTextNode(b)),d&&a.setAttribute("title",d)},getTable:function(){return document.createElement("table")},getTableRow:function(){return document.createElement("tr")},getTableHead:function(){return document.createElement("thead")},getTableBody:function(){return document.createElement("tbody")},getTableHeaderCell:function(a){var b=document.createElement("th");return b.textContent=a,b},getTableCell:function(){var a=document.createElement("td");return a},getErrorMessage:function(a){var b=document.createElement("p");return b.style=b.style||{},b.style.color="red",b.appendChild(document.createTextNode(a)),b},addInputError:function(){},removeInputError:function(){},addTableRowError:function(){},removeTableRowError:function(){},getTabHolder:function(){var a=document.createElement("div");return a.innerHTML="<div style='float: left; width: 130px;' class='tabs'></div><div class='content' style='margin-left: 130px;'></div><div style='clear:both;'></div>",a},applyStyles:function(a,b){a.style=a.style||{};for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])},closest:function(a,b){for(var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;a&&a!==document;)try{var d=c.bind(a);if(d(b))return a;a=a.parentNode}catch(e){return!1}return!1},getTab:function(a){var b=document.createElement("div");return b.appendChild(a),b.style=b.style||{},this.applyStyles(b,{border:"1px solid #ccc",borderWidth:"1px 0 1px 1px",textAlign:"center",lineHeight:"30px",borderRadius:"5px",borderBottomRightRadius:0,borderTopRightRadius:0,fontWeight:"bold",cursor:"pointer"}),b},getTabContentHolder:function(a){return a.children[1]},getTabContent:function(){return this.getIndentedPanel()},markTabActive:function(a){this.applyStyles(a,{opacity:1,background:"white"})},markTabInactive:function(a){this.applyStyles(a,{opacity:.5,background:""})},addTab:function(a,b){a.children[0].appendChild(b)},getBlockLink:function(){var a=document.createElement("a");return a.style.display="block",a},getBlockLinkHolder:function(){var a=document.createElement("div");return a},getLinksHolder:function(){var a=document.createElement("div");return a},createMediaLink:function(a,b,c){a.appendChild(b),c.style.width="100%",a.appendChild(c)},createImageLink:function(a,b,c){a.appendChild(b),b.appendChild(c)}}),f.defaults.themes.bootstrap2=f.AbstractTheme.extend({getRangeInput:function(a,b,c){return this._super(a,b,c)},getGridContainer:function(){var a=document.createElement("div");return a.className="container-fluid",a},getGridRow:function(){var a=document.createElement("div");return a.className="row-fluid",a},getFormInputLabel:function(a){var b=this._super(a);return b.style.display="inline-block",b.style.fontWeight="bold",b},setGridColumnSize:function(a,b){a.className="span"+b},getSelectInput:function(a){var b=this._super(a);return b.style.width="auto",b.style.maxWidth="98%",b},getFormInputField:function(a){var b=this._super(a);return b.style.width="98%",b},afterInputReady:function(a){a.controlgroup||(a.controlgroup=this.closest(a,".control-group"),a.controls=this.closest(a,".controls"),this.closest(a,".compact")&&(a.controlgroup.className=a.controlgroup.className.replace(/control-group/g,"").replace(/[ ]{2,}/g," "),a.controls.className=a.controlgroup.className.replace(/controls/g,"").replace(/[ ]{2,}/g," "),a.style.marginBottom=0))},getIndentedPanel:function(){var a=document.createElement("div");return a.className="well well-small",a},getFormInputDescription:function(a){var b=document.createElement("p");return b.className="help-inline",b.textContent=a,b},getFormControl:function(a,b,c){var d=document.createElement("div");d.className="control-group";var e=document.createElement("div");return e.className="controls",a&&"checkbox"===b.getAttribute("type")?(d.appendChild(e),a.className+=" checkbox",a.appendChild(b),e.appendChild(a),e.style.height="30px"):(a&&(a.className+=" control-label",d.appendChild(a)),e.appendChild(b),d.appendChild(e)),c&&e.appendChild(c),d},getHeaderButtonHolder:function(){var a=this.getButtonHolder();return a.style.marginLeft="10px",a},getButtonHolder:function(){var a=document.createElement("div");return a.className="btn-group",a},getButton:function(a,b,c){var d=this._super(a,b,c);return d.className+=" btn btn-default",d},getTable:function(){var a=document.createElement("table");return a.className="table table-bordered",a.style.width="auto",a.style.maxWidth="none",a},addInputError:function(a,b){a.controlgroup&&a.controls&&(a.controlgroup.className+=" error",a.errmsg?a.errmsg.style.display="":(a.errmsg=document.createElement("p"),a.errmsg.className="help-block errormsg",a.controls.appendChild(a.errmsg)),a.errmsg.textContent=b)},removeInputError:function(a){a.errmsg&&(a.errmsg.style.display="none",a.controlgroup.className=a.controlgroup.className.replace(/\s?error/g,""))},getTabHolder:function(){var a=document.createElement("div");return a.className="tabbable tabs-left",a.innerHTML="<ul class='nav nav-tabs span2' style='margin-right: 0;'></ul><div class='tab-content span10' style='overflow:visible;'></div>",a},getTab:function(a){var b=document.createElement("li"),c=document.createElement("a");return c.setAttribute("href","#"),c.appendChild(a),b.appendChild(c),b},getTabContentHolder:function(a){return a.children[1]},getTabContent:function(){var a=document.createElement("div");return a.className="tab-pane active",a},markTabActive:function(a){a.className+=" active"},markTabInactive:function(a){a.className=a.className.replace(/\s?active/g,"")},addTab:function(a,b){a.children[0].appendChild(b)}}),f.defaults.themes.bootstrap3=f.AbstractTheme.extend({getSelectInput:function(a){var b=this._super(a);return b.className+="form-control",b},setGridColumnSize:function(a,b){a.className="col-md-"+b},afterInputReady:function(a){a.controlgroup||(a.controlgroup=this.closest(a,".form-group"),this.closest(a,".compact")&&(a.controlgroup.style.marginBottom=0))},getTextareaInput:function(){var a=document.createElement("textarea");return a.className="form-control",a},getRangeInput:function(a,b,c){return this._super(a,b,c)},getFormInputField:function(a){var b=this._super(a);return"checkbox"!==a&&(b.className+="form-control"),b},getFormControl:function(a,b,c){var d=document.createElement("div");return a&&"checkbox"===b.type?(d.className+=" checkbox",a.appendChild(b),a.style.fontSize="14px",d.style.marginTop="0",d.appendChild(a)):(d.className+=" form-group",a&&(a.className+=" control-label",d.appendChild(a)),d.appendChild(b)),c&&d.appendChild(c),d},getIndentedPanel:function(){var a=document.createElement("div");return a.className="well well-sm",a},getFormInputDescription:function(a){var b=document.createElement("p");return b.className="help-block",b.textContent=a,b},getHeaderButtonHolder:function(){var a=this.getButtonHolder();return a.style.marginLeft="10px",a},getButtonHolder:function(){var a=document.createElement("div");return a.className="btn-group",a},getButton:function(a,b,c){var d=this._super(a,b,c);return d.className+="btn btn-default",d},getTable:function(){var a=document.createElement("table");return a.className="table table-bordered",a.style.width="auto",a.style.maxWidth="none",a},addInputError:function(a,b){a.controlgroup&&(a.controlgroup.className+=" has-error",a.errmsg?a.errmsg.style.display="":(a.errmsg=document.createElement("p"),a.errmsg.className="help-block errormsg",a.controlgroup.appendChild(a.errmsg)),a.errmsg.textContent=b)},removeInputError:function(a){a.errmsg&&(a.errmsg.style.display="none",a.controlgroup.className=a.controlgroup.className.replace(/\s?has-error/g,""))},getTabHolder:function(){var a=document.createElement("div");return a.innerHTML="<div class='tabs list-group col-md-2'></div><div class='col-md-10'></div>",a.className="rows",a},getTab:function(a){var b=document.createElement("a");return b.className="list-group-item",b.setAttribute("href","#"),b.appendChild(a),b},markTabActive:function(a){a.className+=" active"},markTabInactive:function(a){a.className=a.className.replace(/\s?active/g,"")}}),f.defaults.themes.foundation=f.AbstractTheme.extend({getChildEditorHolder:function(){var a=document.createElement("div");return a.style.marginBottom="15px",a},getSelectInput:function(a){var b=this._super(a);return b.style.minWidth="none",b.style.padding="5px",b.style.marginTop="3px",b},getSwitcher:function(a){var b=this._super(a);return b.style.paddingRight="8px",b},afterInputReady:function(a){this.closest(a,".compact")&&(a.style.marginBottom=0),a.group=this.closest(a,".form-control")},getFormInputLabel:function(a){var b=this._super(a);return b.style.display="inline-block",b},getFormInputField:function(a){var b=this._super(a);return b.style.width="100%",b.style.marginBottom="checkbox"===a?"0":"12px",b},getFormInputDescription:function(a){var b=document.createElement("p");return b.textContent=a,b.style.marginTop="-10px",b.style.fontStyle="italic",b},getIndentedPanel:function(){var a=document.createElement("div");return a.className="panel",a},getHeaderButtonHolder:function(){var a=this.getButtonHolder();return a.style.display="inline-block",a.style.marginLeft="10px",a.style.verticalAlign="middle",a},getButtonHolder:function(){var a=document.createElement("div");return a.className="button-group",a},getButton:function(a,b,c){var d=this._super(a,b,c);return d.className+=" small button",d},addInputError:function(a,b){a.group&&(a.group.className+=" error",a.errmsg?a.errmsg.style.display="":(a.insertAdjacentHTML("afterend",'<small class="errormsg"></small>'),a.errmsg=a.parentNode.getElementsByClassName("errormsg")[0]),a.errmsg.textContent=b)},removeInputError:function(a){a.errmsg&&(a.group.className=a.group.className.replace(/ error/g,""),a.errmsg.style.display="none")}}),f.defaults.themes.foundation3=f.defaults.themes.foundation.extend({getHeaderButtonHolder:function(){var a=this._super();return a.style.fontSize=".6em",a},getFormInputLabel:function(a){var b=this._super(a);return b.style.fontWeight="bold",b},getTabHolder:function(){var a=document.createElement("div");return a.className="row",a.innerHTML="<dl class='tabs vertical two columns'></dl><div class='tabs-content ten columns'></div>",a},setGridColumnSize:function(a,b){var c=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve"];a.className="columns "+c[b]},getTab:function(a){var b=document.createElement("dd"),c=document.createElement("a");return c.setAttribute("href","#"),c.appendChild(a),b.appendChild(c),b},getTabContentHolder:function(a){return a.children[1]},getTabContent:function(){var a=document.createElement("div");return a.className="content active",a.style.paddingLeft="5px",a},markTabActive:function(a){a.className+=" active"},markTabInactive:function(a){a.className=a.className.replace(/\s*active/g,"")},addTab:function(a,b){a.children[0].appendChild(b)}}),f.defaults.themes.foundation4=f.defaults.themes.foundation.extend({getHeaderButtonHolder:function(){var a=this._super();return a.style.fontSize=".6em",a},setGridColumnSize:function(a,b){a.className="columns large-"+b},getFormInputDescription:function(a){var b=this._super(a);return b.style.fontSize=".8rem",b},getFormInputLabel:function(a){var b=this._super(a);return b.style.fontWeight="bold",b}}),f.defaults.themes.foundation5=f.defaults.themes.foundation.extend({getFormInputDescription:function(a){var b=this._super(a);return b.style.fontSize=".8rem",b},setGridColumnSize:function(a,b){a.className="columns medium-"+b},getButton:function(a,b,c){var d=this._super(a,b,c);return d.className=d.className.replace(/\s*small/g,"")+" tiny",d},getTabHolder:function(){var a=document.createElement("div");return a.innerHTML="<dl class='tabs vertical'></dl><div class='tabs-content'></div>",a},getTab:function(a){var b=document.createElement("dd"),c=document.createElement("a");return c.setAttribute("href","#"),c.appendChild(a),b.appendChild(c),b},getTabContentHolder:function(a){return a.children[1]},getTabContent:function(){var a=document.createElement("div");return a.className="content active",a.style.paddingLeft="5px",a},markTabActive:function(a){a.className+=" active"},markTabInactive:function(a){a.className=a.className.replace(/\s*active/g,"")},addTab:function(a,b){a.children[0].appendChild(b)}}),f.defaults.themes.html=f.AbstractTheme.extend({getFormInputLabel:function(a){var b=this._super(a);return b.style.display="block",b.style.marginBottom="3px",b.style.fontWeight="bold",b},getFormInputDescription:function(a){var b=this._super(a);return b.style.fontSize=".8em",b.style.margin=0,b.style.display="inline-block",b.style.fontStyle="italic",b},getIndentedPanel:function(){var a=this._super();return a.style.border="1px solid #ddd",a.style.padding="5px",a.style.margin="5px",a.style.borderRadius="3px",a},getChildEditorHolder:function(){var a=this._super();return a.style.marginBottom="8px",a},getHeaderButtonHolder:function(){var a=this.getButtonHolder();return a.style.display="inline-block",a.style.marginLeft="10px",a.style.fontSize=".8em",a.style.verticalAlign="middle",a},getTable:function(){var a=this._super();return a.style.borderBottom="1px solid #ccc",a.style.marginBottom="5px",a},addInputError:function(a,b){if(a.style.borderColor="red",a.errmsg)a.errmsg.style.display="block";else{var c=this.closest(a,".form-control");a.errmsg=document.createElement("div"),a.errmsg.setAttribute("class","errmsg"),a.errmsg.style=a.errmsg.style||{},a.errmsg.style.color="red",c.appendChild(a.errmsg)}a.errmsg.innerHTML="",a.errmsg.appendChild(document.createTextNode(b))},removeInputError:function(a){a.style.borderColor="",a.errmsg&&(a.errmsg.style.display="none")}}),f.defaults.themes.jqueryui=f.AbstractTheme.extend({getTable:function(){var a=this._super();return a.setAttribute("cellpadding",5),a.setAttribute("cellspacing",0),a},getTableHeaderCell:function(a){var b=this._super(a);return b.className="ui-state-active",b.style.fontWeight="bold",b},getTableCell:function(){var a=this._super();return a.className="ui-widget-content",a},getHeaderButtonHolder:function(){var a=this.getButtonHolder();return a.style.marginLeft="10px",a.style.fontSize=".6em",a.style.display="inline-block",a},getFormInputDescription:function(a){var b=this.getDescription(a);return b.style.marginLeft="10px",b.style.display="inline-block",b},getFormControl:function(a,b,c){var d=this._super(a,b,c);return"checkbox"===b.type?(d.style.lineHeight="25px",d.style.padding="3px 0"):d.style.padding="4px 0 8px 0",d},getDescription:function(a){var b=document.createElement("span");return b.style.fontSize=".8em",b.style.fontStyle="italic",b.textContent=a,b},getButtonHolder:function(){var a=document.createElement("div");return a.className="ui-buttonset",a.style.fontSize=".7em",a},getFormInputLabel:function(a){var b=document.createElement("label");return b.style.fontWeight="bold",b.style.display="block",b.textContent=a,b},getButton:function(a,b,c){var d=document.createElement("button");d.className="ui-button ui-widget ui-state-default ui-corner-all",b&&!a?(d.className+=" ui-button-icon-only",b.className+=" ui-button-icon-primary ui-icon-primary",d.appendChild(b)):b?(d.className+=" ui-button-text-icon-primary",b.className+=" ui-button-icon-primary ui-icon-primary",d.appendChild(b)):d.className+=" ui-button-text-only";var e=document.createElement("span");return e.className="ui-button-text",e.textContent=a||c||".",d.appendChild(e),d.setAttribute("title",c),d},setButtonText:function(a,b,c,d){a.innerHTML="",a.className="ui-button ui-widget ui-state-default ui-corner-all",c&&!b?(a.className+=" ui-button-icon-only",c.className+=" ui-button-icon-primary ui-icon-primary",a.appendChild(c)):c?(a.className+=" ui-button-text-icon-primary",c.className+=" ui-button-icon-primary ui-icon-primary",a.appendChild(c)):a.className+=" ui-button-text-only";var e=document.createElement("span");e.className="ui-button-text",e.textContent=b||d||".",a.appendChild(e),a.setAttribute("title",d)},getIndentedPanel:function(){var a=document.createElement("div");return a.className="ui-widget-content ui-corner-all",a.style.padding="1em 1.4em",a.style.marginBottom="20px",a},afterInputReady:function(a){a.controls||(a.controls=this.closest(a,".form-control"))},addInputError:function(a,b){a.controls&&(a.errmsg?a.errmsg.style.display="":(a.errmsg=document.createElement("div"),a.errmsg.className="ui-state-error",a.controls.appendChild(a.errmsg)),a.errmsg.textContent=b)},removeInputError:function(a){a.errmsg&&(a.errmsg.style.display="none")},markTabActive:function(a){a.className=a.className.replace(/\s*ui-widget-header/g,"")+" ui-state-active"},markTabInactive:function(a){a.className=a.className.replace(/\s*ui-state-active/g,"")+" ui-widget-header"}}),f.AbstractIconLib=Class.extend({mapping:{collapse:"",expand:"","delete":"",edit:"",add:"",cancel:"",save:"",moveup:"",movedown:""},icon_prefix:"",getIconClass:function(a){return this.mapping[a]?this.icon_prefix+this.mapping[a]:null},getIcon:function(a){var b=this.getIconClass(a);if(!b)return null;var c=document.createElement("i");return c.className=b,c}}),f.defaults.iconlibs.bootstrap2=f.AbstractIconLib.extend({mapping:{collapse:"chevron-down",expand:"chevron-up","delete":"trash",edit:"pencil",add:"plus",cancel:"ban-circle",save:"ok",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"icon-"}),f.defaults.iconlibs.bootstrap3=f.AbstractIconLib.extend({mapping:{collapse:"chevron-down",expand:"chevron-right","delete":"remove",edit:"pencil",add:"plus",cancel:"floppy-remove",save:"floppy-saved",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"glyphicon glyphicon-"}),f.defaults.iconlibs.fontawesome3=f.AbstractIconLib.extend({mapping:{collapse:"chevron-down",expand:"chevron-right","delete":"remove",edit:"pencil",add:"plus",cancel:"ban-circle",save:"save",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"icon-"}),f.defaults.iconlibs.fontawesome4=f.AbstractIconLib.extend({mapping:{collapse:"caret-square-o-down",expand:"caret-square-o-right","delete":"times",edit:"pencil",add:"plus",cancel:"ban",save:"save",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"fa fa-"}),f.defaults.iconlibs.foundation2=f.AbstractIconLib.extend({mapping:{collapse:"minus",expand:"plus","delete":"remove",edit:"edit",add:"add-doc",cancel:"error",save:"checkmark",moveup:"up-arrow",movedown:"down-arrow"},icon_prefix:"foundicon-"}),f.defaults.iconlibs.foundation3=f.AbstractIconLib.extend({mapping:{collapse:"minus",expand:"plus","delete":"x",edit:"pencil",add:"page-add",cancel:"x-circle",save:"save",moveup:"arrow-up",movedown:"arrow-down"},icon_prefix:"fi-"}),f.defaults.iconlibs.jqueryui=f.AbstractIconLib.extend({mapping:{collapse:"triangle-1-s",expand:"triangle-1-e","delete":"trash",edit:"pencil",add:"plusthick",cancel:"closethick",save:"disk",moveup:"arrowthick-1-n",movedown:"arrowthick-1-s"},icon_prefix:"ui-icon ui-icon-"}),f.defaults.templates.default=function(){var a=function(d){var e={};return c(d,function(d,f){if("object"==typeof f&&null!==f){var g={};c(f,function(a,b){g[d+"."+a]=b}),b(e,a(g))}else e[d]=f}),e};return{compile:function(b){return function(d){var e=a(d),f=b+"";return c(e,function(a,b){f=f.replace(new RegExp("{{\\s*"+a+"\\s*}}","g"),b)}),f}}}},f.defaults.templates.ejs=function(){return window.EJS?{compile:function(a){var b=new EJS({text:a});return function(a){return b.render(a)}}}:!1},f.defaults.templates.handlebars=function(){return window.Handlebars},f.defaults.templates.hogan=function(){return window.Hogan?{compile:function(a){var b=Hogan.compile(a);return function(a){return b.render(a)}}}:!1},f.defaults.templates.markup=function(){return window.Mark&&window.Mark.up?{compile:function(a){return function(b){return Mark.up(a,b)}}}:!1},f.defaults.templates.mustache=function(){return window.Mustache?{compile:function(a){return function(b){return Mustache.render(a,b)}}}:!1},f.defaults.templates.swig=function(){return window.swig},f.defaults.templates.underscore=function(){return window._?{compile:function(a){return function(b){return _.template(a,b)}}}:!1},f.defaults.theme="html",f.defaults.template="default",f.defaults.options={},f.plugins={ace:{theme:""},epiceditor:{},sceditor:{}};for(var g in f.defaults.editors)f.defaults.editors.hasOwnProperty(g)&&(f.defaults.editors[g].options=f.defaults.editors.options||{});f.defaults.resolvers.unshift(function(a){return"string"!=typeof a.type?"multiple":void 0}),f.defaults.resolvers.unshift(function(a){return"string"==typeof a.type?a.type:void 0}),f.defaults.resolvers.unshift(function(a){return"boolean"===a.type?"select":void 0}),f.defaults.resolvers.unshift(function(a){return"any"===a.type?"multiple":void 0}),f.defaults.resolvers.unshift(function(a){return"string"===a.type&&a.media&&"base64"===a.media.binaryEncoding?"base64":void 0}),f.defaults.resolvers.unshift(function(a){return"array"==a.type&&"table"==a.format?"table":void 0}),f.defaults.resolvers.unshift(function(a){if(a.enum){if("array"===a.type||"object"===a.type)return"enum";if("number"===a.type||"integer"===a.type||"string"===a.type)return"select"}}),f.defaults.resolvers.unshift(function(a){return"array"===a.type&&a.items&&!(a.items instanceof Array)&&a.uniqueItems&&a.items.enum&&["string","number","integer"].indexOf(a.items.type)>=0?"multiselect":void 0}),f.defaults.resolvers.unshift(function(a){return a.oneOf?"multiple":void 0}),(window.jQuery||window.Zepto)&&(window.$=window.$||{},$.jsoneditor=f.defaults,(window.jQuery||window.Zepto).fn.jsoneditor=function(a){var b=this,c=this.data("jsoneditor");if("value"===a){if(!c)throw"Must initialize jsoneditor before getting/setting the value";if(!(arguments.length>1))return c.getValue();c.setValue(arguments[1])}else{if("validate"===a){if(!c)throw"Must initialize jsoneditor before validating";return arguments.length>1?c.validate(arguments[1]):c.validate()}"destroy"===a?c&&(c.destroy(),this.data("jsoneditor",null)):(c&&c.destroy(),c=new f(this.get(0),a),this.data("jsoneditor",c),c.on("change",function(){b.trigger("change")}),c.on("ready",function(){b.trigger("ready")}))}return this}),window.JSONEditor=f}(),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if(b=a.event.fix(g),b.type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(m=-1*g.deltaY,j=m),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||f>n)&&(f=n,d(g,n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[j>=1?"floor":"ceil"](j/f),l=Math[l>=1?"floor":"ceil"](l/f),m=Math[m>=1?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120===0
}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b)["offsetParent"in a.fn?"offsetParent":"parent"]();return c.length||(c=a("body")),parseInt(c.css("fontSize"),10)},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),function(a,b){"function"==typeof define&&define.amd?define(b):a.Dragdealer=b()}(this,function(){var a=function(a,b){this.bindMethods(),this.options=this.applyDefaults(b||{}),this.wrapper=this.getWrapperElement(a),this.wrapper&&(this.handle=this.getHandleElement(this.wrapper,this.options.handleClass),this.handle&&(this.init(),this.bindEventListeners()))};a.prototype={defaults:{disabled:!1,horizontal:!0,vertical:!1,slide:!0,steps:0,snap:!1,loose:!1,speed:.1,xPrecision:0,yPrecision:0,handleClass:"handle"},init:function(){this.value={prev:[-1,-1],current:[this.options.x||0,this.options.y||0],target:[this.options.x||0,this.options.y||0]},this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]},this.change=[0,0],this.stepRatios=this.calculateStepRatios(),this.activity=!1,this.dragging=!1,this.tapping=!1,this.reflow(),this.options.disabled&&this.disable()},applyDefaults:function(a){for(var b in this.defaults)a.hasOwnProperty(b)||(a[b]=this.defaults[b]);return a},getWrapperElement:function(a){return"string"==typeof a?document.getElementById(a):a},getHandleElement:function(a,b){var c,d=a.getElementsByTagName("div"),e=new RegExp("(^|\\s)"+b+"(\\s|$)");for(c=0;c<d.length;c++)if(e.test(d[c].className))return d[c]},calculateStepRatios:function(){var a=[];if(this.options.steps>1)for(var b=0;b<=this.options.steps-1;b++)a[b]=b/(this.options.steps-1);return a},setWrapperOffset:function(){this.offset.wrapper=h.get(this.wrapper)},calculateBounds:function(){var a={top:this.options.top||0,bottom:-(this.options.bottom||0)+this.wrapper.offsetHeight,left:this.options.left||0,right:-(this.options.right||0)+this.wrapper.offsetWidth};return a.availWidth=a.right-a.left-this.handle.offsetWidth,a.availHeight=a.bottom-a.top-this.handle.offsetHeight,a},calculateValuePrecision:function(){var a=this.options.xPrecision||Math.abs(this.bounds.availWidth),b=this.options.yPrecision||Math.abs(this.bounds.availHeight);return[a?1/a:0,b?1/b:0]},bindMethods:function(){this.onHandleMouseDown=b(this.onHandleMouseDown,this),this.onHandleTouchStart=b(this.onHandleTouchStart,this),this.onDocumentMouseMove=b(this.onDocumentMouseMove,this),this.onWrapperTouchMove=b(this.onWrapperTouchMove,this),this.onWrapperMouseDown=b(this.onWrapperMouseDown,this),this.onWrapperTouchStart=b(this.onWrapperTouchStart,this),this.onDocumentMouseUp=b(this.onDocumentMouseUp,this),this.onDocumentTouchEnd=b(this.onDocumentTouchEnd,this),this.onHandleClick=b(this.onHandleClick,this),this.onWindowResize=b(this.onWindowResize,this)},bindEventListeners:function(){c(this.handle,"mousedown",this.onHandleMouseDown),c(this.handle,"touchstart",this.onHandleTouchStart),c(document,"mousemove",this.onDocumentMouseMove),c(this.wrapper,"touchmove",this.onWrapperTouchMove),c(this.wrapper,"mousedown",this.onWrapperMouseDown),c(this.wrapper,"touchstart",this.onWrapperTouchStart),c(document,"mouseup",this.onDocumentMouseUp),c(document,"touchend",this.onDocumentTouchEnd),c(this.handle,"click",this.onHandleClick),c(window,"resize",this.onWindowResize);var a=this;this.interval=setInterval(function(){a.animate()},25),this.animate(!1,!0)},unbindEventListeners:function(){d(this.handle,"mousedown",this.onHandleMouseDown),d(this.handle,"touchstart",this.onHandleTouchStart),d(document,"mousemove",this.onDocumentMouseMove),d(this.wrapper,"touchmove",this.onWrapperTouchMove),d(this.wrapper,"mousedown",this.onWrapperMouseDown),d(this.wrapper,"touchstart",this.onWrapperTouchStart),d(document,"mouseup",this.onDocumentMouseUp),d(document,"touchend",this.onDocumentTouchEnd),d(this.handle,"click",this.onHandleClick),d(window,"resize",this.onWindowResize),clearInterval(this.interval)},onHandleMouseDown:function(a){g.refresh(a),e(a),f(a),this.activity=!1,this.startDrag()},onHandleTouchStart:function(a){g.refresh(a),f(a),this.activity=!1,this.startDrag()},onDocumentMouseMove:function(a){g.refresh(a),this.dragging&&(this.activity=!0)},onWrapperTouchMove:function(a){return g.refresh(a),!this.activity&&this.draggingOnDisabledAxis()?void(this.dragging&&this.stopDrag()):(e(a),void(this.activity=!0))},onWrapperMouseDown:function(a){g.refresh(a),e(a),this.startTap()},onWrapperTouchStart:function(a){g.refresh(a),e(a),this.startTap()},onDocumentMouseUp:function(){this.stopDrag(),this.stopTap()},onDocumentTouchEnd:function(){this.stopDrag(),this.stopTap()},onHandleClick:function(a){this.activity&&(e(a),f(a))},onWindowResize:function(){this.reflow()},enable:function(){this.disabled=!1,this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=!0,this.handle.className+=" disabled"},reflow:function(){this.setWrapperOffset(),this.bounds=this.calculateBounds(),this.valuePrecision=this.calculateValuePrecision(),this.updateOffsetFromValue()},getStep:function(){return[this.getStepNumber(this.value.target[0]),this.getStepNumber(this.value.target[1])]},getValue:function(){return this.value.target},setStep:function(a,b,c){this.setValue(this.options.steps&&a>1?(a-1)/(this.options.steps-1):0,this.options.steps&&b>1?(b-1)/(this.options.steps-1):0,c)},setValue:function(a,b,c){this.setTargetValue([a,b||0]),c&&(this.groupCopy(this.value.current,this.value.target),this.updateOffsetFromValue(),this.callAnimationCallback())},startTap:function(){this.disabled||(this.tapping=!0,this.setWrapperOffset(),this.setTargetValueByOffset([g.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,g.y-this.offset.wrapper[1]-this.handle.offsetHeight/2]))},stopTap:function(){!this.disabled&&this.tapping&&(this.tapping=!1,this.setTargetValue(this.value.current))},startDrag:function(){this.disabled||(this.dragging=!0,this.setWrapperOffset(),this.offset.mouse=[g.x-h.get(this.handle)[0],g.y-h.get(this.handle)[1]])},stopDrag:function(){if(!this.disabled&&this.dragging){this.dragging=!1;var a=this.groupClone(this.value.current);if(this.options.slide){var b=this.change;a[0]+=4*b[0],a[1]+=4*b[1]}this.setTargetValue(a)}},callAnimationCallback:function(){var a=this.value.current;this.options.snap&&this.options.steps>1&&(a=this.getClosestSteps(a)),this.groupCompare(a,this.value.prev)||("function"==typeof this.options.animationCallback&&this.options.animationCallback.call(this,a[0],a[1]),this.groupCopy(this.value.prev,a))},callTargetCallback:function(){"function"==typeof this.options.callback&&this.options.callback.call(this,this.value.target[0],this.value.target[1])},animate:function(a,b){if(!a||this.dragging){if(this.dragging){var c=this.groupClone(this.value.target),d=[g.x-this.offset.wrapper[0]-this.offset.mouse[0],g.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetValueByOffset(d,this.options.loose),this.change=[this.value.target[0]-c[0],this.value.target[1]-c[1]]}(this.dragging||b)&&this.groupCopy(this.value.current,this.value.target),(this.dragging||this.glide()||b)&&(this.updateOffsetFromValue(),this.callAnimationCallback())}},glide:function(){var a=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];return a[0]||a[1]?(Math.abs(a[0])>this.valuePrecision[0]||Math.abs(a[1])>this.valuePrecision[1]?(this.value.current[0]+=a[0]*this.options.speed,this.value.current[1]+=a[1]*this.options.speed):this.groupCopy(this.value.current,this.value.target),!0):!1},updateOffsetFromValue:function(){this.offset.current=this.getOffsetsByRatios(this.options.snap?this.getClosestSteps(this.value.current):this.value.current),this.groupCompare(this.offset.current,this.offset.prev)||(this.renderHandlePosition(),this.groupCopy(this.offset.prev,this.offset.current))},renderHandlePosition:function(){this.options.horizontal&&(this.handle.style.left=String(this.offset.current[0])+"px"),this.options.vertical&&(this.handle.style.top=String(this.offset.current[1])+"px")},setTargetValue:function(a,b){var c=b?this.getLooseValue(a):this.getProperValue(a);this.groupCopy(this.value.target,c),this.offset.target=this.getOffsetsByRatios(c),this.callTargetCallback()},setTargetValueByOffset:function(a,b){var c=this.getRatiosByOffsets(a),d=b?this.getLooseValue(c):this.getProperValue(c);this.groupCopy(this.value.target,d),this.offset.target=this.getOffsetsByRatios(d)},getLooseValue:function(a){var b=this.getProperValue(a);return[b[0]+(a[0]-b[0])/4,b[1]+(a[1]-b[1])/4]},getProperValue:function(a){var b=this.groupClone(a);return b[0]=Math.max(b[0],0),b[1]=Math.max(b[1],0),b[0]=Math.min(b[0],1),b[1]=Math.min(b[1],1),(!this.dragging&&!this.tapping||this.options.snap)&&this.options.steps>1&&(b=this.getClosestSteps(b)),b},getRatiosByOffsets:function(a){return[this.getRatioByOffset(a[0],this.bounds.availWidth,this.bounds.left),this.getRatioByOffset(a[1],this.bounds.availHeight,this.bounds.top)]},getRatioByOffset:function(a,b,c){return b?(a-c)/b:0},getOffsetsByRatios:function(a){return[this.getOffsetByRatio(a[0],this.bounds.availWidth,this.bounds.left),this.getOffsetByRatio(a[1],this.bounds.availHeight,this.bounds.top)]},getOffsetByRatio:function(a,b,c){return Math.round(a*b)+c},getStepNumber:function(a){return this.getClosestStep(a)*(this.options.steps-1)+1},getClosestSteps:function(a){return[this.getClosestStep(a[0]),this.getClosestStep(a[1])]},getClosestStep:function(a){for(var b=0,c=1,d=0;d<=this.options.steps-1;d++)Math.abs(this.stepRatios[d]-a)<c&&(c=Math.abs(this.stepRatios[d]-a),b=d);return this.stepRatios[b]},groupCompare:function(a,b){return a[0]==b[0]&&a[1]==b[1]},groupCopy:function(a,b){a[0]=b[0],a[1]=b[1]},groupClone:function(a){return[a[0],a[1]]},draggingOnDisabledAxis:function(){return!this.options.horizontal&&g.xDiff>g.yDiff||!this.options.vertical&&g.yDiff>g.xDiff}};var b=function(a,b){return function(){return a.apply(b,arguments)}},c=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},d=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)},e=function(a){a||(a=window.event),a.preventDefault&&a.preventDefault(),a.returnValue=!1},f=function(a){a||(a=window.event),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},g={x:0,y:0,xDiff:0,yDiff:0,refresh:function(a){a||(a=window.event),"mousemove"==a.type?this.set(a):a.touches&&this.set(a.touches[0])},set:function(a){var b=this.x,c=this.y;a.pageX||a.pageY?(this.x=a.pageX,this.y=a.pageY):(a.clientX||a.clientY)&&(this.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),this.xDiff=Math.abs(this.x-b),this.yDiff=Math.abs(this.y-c)}},h={get:function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return[b,c]}};return a});var UndoManager=function(){"use strict";function a(a,b){return a&&"function"==typeof a[b]?(e=!0,a[b](),e=!1,this):this}var b,c=[],d=-1,e=!1;return{register:function(a,b,c,d,e,f,g){this.add({undo:function(){b.apply(a,c)},redo:function(){f.apply(e,g)}})},add:function(a){return e?this:(c.splice(d+1,c.length-d),c.push(a),d=c.length-1,b&&b(),this)},setCallback:function(a){b=a},undo:function(){var e=c[d];return e?(a(e,"undo"),d-=1,b&&b(),this):this},redo:function(){var e=c[d+1];return e?(a(e,"redo"),d+=1,b&&b(),this):this},clear:function(){var a=c.length;c=[],d=-1,b&&a>0&&b()},hasUndo:function(){return-1!==d},hasRedo:function(){return d<c.length-1},getCommands:function(){return c}}};!function(a,b){function c(a,b){return(p?b.originalEvent.touches[0]:b)["page"+a.toUpperCase()]}function d(b,c,d){var e=a.Event(c,w);a.event.trigger(e,{originalEvent:b},b.target),e.isDefaultPrevented()&&b.preventDefault(),d&&(a.event.remove(u,s+"."+t,f),a.event.remove(u,r+"."+t,g))}function e(b){var e=b.timeStamp||+new Date;j!=e&&(j=e,v.x=w.x=c("x",b),v.y=w.y=c("y",b),v.time=e,v.target=b.target,w.orientation=null,w.end=!1,h=!1,i=!1,k=setTimeout(function(){i=!0,d(b,"press")},a.Finger.pressDuration),a.event.add(u,s+"."+t,f),a.event.add(u,r+"."+t,g),x.preventDefault&&b.preventDefault())}function f(b){return w.x=c("x",b),w.y=c("y",b),w.dx=w.x-v.x,w.dy=w.y-v.y,w.adx=Math.abs(w.dx),w.ady=Math.abs(w.dy),(h=w.adx>x.motionThreshold||w.ady>x.motionThreshold)?(clearTimeout(k),w.orientation||(w.adx>w.ady?(w.orientation="horizontal",w.direction=w.dx>0?1:-1):(w.orientation="vertical",w.direction=w.dy>0?1:-1)),b.target!==v.target?(b.target=v.target,void g.call(this,a.Event(r+"."+t,b))):void d(b,"drag")):void 0}function g(a){var b,c=a.timeStamp||+new Date,e=c-v.time;if(clearTimeout(k),a.target===v.target){if(h||i)x.flickDuration>e&&d(a,"flick"),w.end=!0,b="drag";else{var f=l===a.target&&x.doubleTapInterval>c-m;b=f?"doubletap":"tap",l=f?null:v.target,m=c}d(a,b,!0)}}var h,i,j,k,l,m,n=/chrome/i.exec(b),o=/android/i.exec(b),p="ontouchstart"in window&&!(n&&!o),q=p?"touchstart":"mousedown",r=p?"touchend touchcancel":"mouseup mouseleave",s=p?"touchmove":"mousemove",t="finger",u=a("html")[0],v={},w={},x=a.Finger={pressDuration:300,doubleTapInterval:300,flickDuration:150,motionThreshold:5};a.event.add(u,q+"."+t,e)}(jQuery,navigator.userAgent),!function(a){!function(a){"use strict";function b(){}function c(a){function c(b){b.prototype.option||(b.prototype.option=function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))})}function e(b,c){a.fn[b]=function(e){if("string"==typeof e){for(var g=d.call(arguments,1),h=0,i=this.length;i>h;h++){var j=this[h],k=a.data(j,b);if(k)if(a.isFunction(k[e])&&"_"!==e.charAt(0)){var l=k[e].apply(k,g);if(void 0!==l&&l!==k)return l}else f("no such method '"+e+"' for "+b+" instance");else f("cannot call methods on "+b+" prior to initialization; attempted to call '"+e+"'")}return this}var m=this.map(function(){var d=a.data(this,b);return d?(d.option(e),d._init()):(d=new c(this,e),a.data(this,b,d)),a(this)});return!m||m.length>1?m:m[0]}}if(a){var f="undefined"==typeof console?b:function(a){console.error(a)};return a.bridget=function(a,b){c(b),e(a,b)},a.bridget}}var d=Array.prototype.slice;c(a)}(a),function(a){function b(b,c){function d(a,b){var c="data-slider-"+b,d=a.getAttribute(c);try{return JSON.parse(d)}catch(e){return d}}"string"==typeof b?this.element=document.querySelector(b):b instanceof HTMLElement&&(this.element=b);var e,f,g,h=this.element.style.width,i=!1,j=this.element.parentNode;if(this.sliderElem)i=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var k=document.createElement("div");k.className="slider-track",e=document.createElement("div"),e.className="slider-selection",f=document.createElement("div"),f.className="slider-handle min-slider-handle",g=document.createElement("div"),g.className="slider-handle max-slider-handle",k.appendChild(e),k.appendChild(f),k.appendChild(g);var l=function(a){var b=document.createElement("div");b.className="tooltip-arrow";var c=document.createElement("div");c.className="tooltip-inner",a.appendChild(b),a.appendChild(c)},m=document.createElement("div");m.className="tooltip tooltip-main",l(m);var n=document.createElement("div");n.className="tooltip tooltip-min",l(n);var o=document.createElement("div");o.className="tooltip tooltip-max",l(o),this.sliderElem.appendChild(k),this.sliderElem.appendChild(m),this.sliderElem.appendChild(n),this.sliderElem.appendChild(o),j.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}a&&(this.$element=a(this.element),this.$sliderElem=a(this.sliderElem)),c=c?c:{};for(var p=Object.keys(this.defaultOptions),q=0;q<p.length;q++){var r=p[q],s=c[r];s="undefined"!=typeof s?s:d(this.element,r),s=null!==s?s:this.defaultOptions[r],this.options||(this.options={}),this.options[r]=s}this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),i===!0&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","top","width","height"].forEach(function(a){this._removeProperty(this.trackSelection,a)},this),[this.handle1,this.handle2].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top")},this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top"),this._removeProperty(a,"margin-left"),this._removeProperty(a,"margin-top"),this._removeClass(a,"right"),this._removeClass(a,"top")},this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this._addClass(this.tooltip,"right"),this.tooltip.style.left="100%",this._addClass(this.tooltip_min,"right"),this.tooltip_min.style.left="100%",this._addClass(this.tooltip_max,"right"),this.tooltip_max.style.left="100%"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=h,this.options.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this._addClass(this.tooltip,"top"),this.tooltip.style.top=-this.tooltip.outerHeight-14+"px",this._addClass(this.tooltip_min,"top"),this.tooltip_min.style.top=-this.tooltip_min.outerHeight-14+"px",this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=-this.tooltip_max.outerHeight-14+"px"),this.options.value instanceof Array?this.options.range=!0:this.options.range&&(this.options.value=[this.options.value,this.options.max]),this.trackSelection=e||this.trackSelection,"none"===this.options.selection&&this._addClass(this.trackSelection,"hide"),this.handle1=f||this.handle1,this.handle2=g||this.handle2,i===!0&&(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"));var t=["round","triangle","custom"],u=-1!==t.indexOf(this.options.handle);u&&(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle)),this.offset=this._offset(this.sliderElem),this.size=this.sliderElem[this.sizePos],this.setValue(this.options.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,0),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.touchCapable?(this.mousedown=this._mousedown.bind(this),this.sliderElem.addEventListener("touchstart",this.mousedown,!1)):(this.mousedown=this._mousedown.bind(this),this.sliderElem.addEventListener("mousedown",this.mousedown,!1)),"hide"===this.options.tooltip?(this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide")):"always"===this.options.tooltip?(this._showTooltip(),this._alwaysShowTooltip=!0):(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1),this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)),this.options.enabled?this.enable():this.disable()}var c={formatInvalidInputErrorMsg:function(a){return"Invalid input value '"+a+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"},d=function(a,c){return b.call(this,a,c),this};if(d.prototype={_init:function(){},constructor:d,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,enabled:!0,formatter:function(a){return a instanceof Array?a[0]+" : "+a[1]:a},natural_arrow_keys:!1},over:!1,inDrag:!1,getValue:function(){return this.options.range?this.options.value:this.options.value[0]},setValue:function(a,b){a||(a=0),this.options.value=this._validateInputValue(a);var c=this._applyPrecision.bind(this);if(this.options.range?(this.options.value[0]=c(this.options.value[0]),this.options.value[1]=c(this.options.value[1]),this.options.value[0]=Math.max(this.options.min,Math.min(this.options.max,this.options.value[0])),this.options.value[1]=Math.max(this.options.min,Math.min(this.options.max,this.options.value[1]))):(this.options.value=c(this.options.value),this.options.value=[Math.max(this.options.min,Math.min(this.options.max,this.options.value))],this._addClass(this.handle2,"hide"),this.options.value[1]="after"===this.selection?this.options.max:this.options.min),this.diff=this.options.max-this.options.min,this.percentage=this.diff>0?[100*(this.options.value[0]-this.options.min)/this.diff,100*(this.options.value[1]-this.options.min)/this.diff,100*this.options.step/this.diff]:[0,0,100],this._layout(),b===!0){var d=this.options.range?this.options.value:this.options.value[0];this._trigger("slide",d),this._setDataVal(d)}return this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),a&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this.options.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this.options.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this.options.enabled?this.disable():this.enable(),this},isEnabled:function(){return this.options.enabled},on:function(b,c){return a?(this.$element.on(b,c),this.$sliderElem.on(b,c)):this._bindNonQueryEventHandler(b,c),this},getAttribute:function(a){return a?this.options[a]:this.options},setAttribute:function(a,b){return this.options[a]=b,this},refresh:function(){return this._removeSliderEventHandlers(),b.call(this,this.element,this.options),a&&a.data(this.element,"slider",this),this},_removeSliderEventHandlers:function(){this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.handle2.removeEventListener("focus",this.handle2Keydown,!1),this.handle2.removeEventListener("blur",this.handle2Keydown,!1),this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.mousedown,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1)},_bindNonQueryEventHandler:function(a,b){var c=this.eventToCallbackMap[a];c?c.push(b):this.eventToCallbackMap[a]=[]},_cleanUpEventCallbacksMap:function(){for(var a=Object.keys(this.eventToCallbackMap),b=0;b<a.length;b++){var c=a[b];this.eventToCallbackMap[c]=null}},_showTooltip:function(){this.options.tooltip_split===!1?this._addClass(this.tooltip,"in"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in")),this.over=!0},_hideTooltip:function(){this.inDrag===!1&&this.alwaysShowTooltip!==!0&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this.over=!1},_layout:function(){var a;if(a=this.options.reversed?[100-this.percentage[0],this.percentage[1]]:[this.percentage[0],this.percentage[1]],this.handle1.style[this.stylePos]=a[0]+"%",this.handle2.style[this.stylePos]=a[1]+"%","vertical"===this.options.orientation)this.trackSelection.style.top=Math.min(a[0],a[1])+"%",this.trackSelection.style.height=Math.abs(a[0]-a[1])+"%";else{this.trackSelection.style.left=Math.min(a[0],a[1])+"%",this.trackSelection.style.width=Math.abs(a[0]-a[1])+"%";var b=this.tooltip_min.getBoundingClientRect(),c=this.tooltip_max.getBoundingClientRect();b.right>c.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top="-30px")}var d;if(this.options.range){d=this.options.formatter(this.options.value),this._setText(this.tooltipInner,d),this.tooltip.style[this.stylePos]=(a[1]+a[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px"),"vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");var e=this.options.formatter(this.options.value[0]);this._setText(this.tooltipInner_min,e);var f=this.options.formatter(this.options.value[1]);this._setText(this.tooltipInner_max,f),this.tooltip_min.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-top",-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-left",-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=a[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-top",-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-left",-this.tooltip_max.offsetWidth/2+"px")}else d=this.options.formatter(this.options.value[0]),this._setText(this.tooltipInner,d),this.tooltip.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px")},_removeProperty:function(a,b){a.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(b)},_mousedown:function(a){if(!this.options.enabled)return!1;this.touchCapable&&"touchstart"===a.type&&(a=a.originalEvent),this._triggerFocusOnHandle(),this.offset=this._offset(this.sliderElem),this.size=this.sliderElem[this.sizePos];var b=this._getPercentage(a);if(this.options.range){var c=Math.abs(this.percentage[0]-b),d=Math.abs(this.percentage[1]-b);this.dragged=d>c?0:1}else this.dragged=0;this.percentage[this.dragged]=this.options.reversed?100-b:b,this._layout(),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable?(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)):(document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1)),this.inDrag=!0;var e=this._calculateValue();return this._trigger("slideStart",e),this._setDataVal(e),this.setValue(e),this._pauseEvent(a),!0},_triggerFocusOnHandle:function(a){0===a&&this.handle1.focus(),1===a&&this.handle2.focus()},_keydown:function(a,b){if(!this.options.enabled)return!1;var c;switch(b.keyCode){case 37:case 40:c=-1;break;case 39:case 38:c=1}if(c){if(this.options.natural_arrow_keys){var d="vertical"===this.options.orientation&&!this.options.reversed,e="horizontal"===this.options.orientation&&this.options.reversed;(d||e)&&(c=-1*c)}var f=c*this.percentage[2],g=this.percentage[a]+f;g>100?g=100:0>g&&(g=0),this.dragged=a,this._adjustPercentageForRangeSliders(g),this.percentage[this.dragged]=g,this._layout();var h=this._calculateValue();return this._trigger("slideStart",h),this._setDataVal(h),this.setValue(h,!0),this._trigger("slideStop",h),this._setDataVal(h),this._pauseEvent(b),!1}},_pauseEvent:function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1},_mousemove:function(a){if(!this.options.enabled)return!1;this.touchCapable&&"touchmove"===a.type&&(a=a.originalEvent);var b=this._getPercentage(a);this._adjustPercentageForRangeSliders(b),this.percentage[this.dragged]=this.options.reversed?100-b:b,this._layout();var c=this._calculateValue();return this.setValue(c,!0),!1},_adjustPercentageForRangeSliders:function(a){this.options.range&&(0===this.dragged&&this.percentage[1]<a?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>a&&(this.percentage[1]=this.percentage[0],this.dragged=0))},_mouseup:function(){if(!this.options.enabled)return!1;this.touchCapable?(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)):(document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1)),this.inDrag=!1,this.over===!1&&this._hideTooltip();var a=this._calculateValue();return this._layout(),this._setDataVal(a),this._trigger("slideStop",a),!1},_calculateValue:function(){var a;return this.options.range?(a=[this.options.min,this.options.max],0!==this.percentage[0]&&(a[0]=Math.max(this.options.min,this.options.min+Math.round(this.diff*this.percentage[0]/100/this.options.step)*this.options.step),a[0]=this._applyPrecision(a[0])),100!==this.percentage[1]&&(a[1]=Math.min(this.options.max,this.options.min+Math.round(this.diff*this.percentage[1]/100/this.options.step)*this.options.step),a[1]=this._applyPrecision(a[1])),this.options.value=a):(a=this.options.min+Math.round(this.diff*this.percentage[0]/100/this.options.step)*this.options.step,a<this.options.min?a=this.options.min:a>this.options.max&&(a=this.options.max),a=parseFloat(a),a=this._applyPrecision(a),this.options.value=[a,this.options.value[1]]),a},_applyPrecision:function(a){var b=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.step);return this._applyToFixedAndParseFloat(a,b)},_getNumDigitsAfterDecimalPlace:function(a){var b=(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return b?Math.max(0,(b[1]?b[1].length:0)-(b[2]?+b[2]:0)):0},_applyToFixedAndParseFloat:function(a,b){var c=a.toFixed(b);return parseFloat(c)},_getPercentage:function(a){!this.touchCapable||"touchstart"!==a.type&&"touchmove"!==a.type||(a=a.touches[0]);var b=100*(a[this.mousePos]-this.offset[this.stylePos])/this.size;return b=Math.round(b/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,b))
},_validateInputValue:function(a){if("number"==typeof a)return a;if(a instanceof Array)return this._validateArray(a),a;throw new Error(c.formatInvalidInputErrorMsg(a))},_validateArray:function(a){for(var b=0;b<a.length;b++){var d=a[b];if("number"!=typeof d)throw new Error(c.formatInvalidInputErrorMsg(d))}},_setDataVal:function(a){var b="value: '"+a+"'";this.element.setAttribute("data",b)},_trigger:function(b,c){c=c||void 0;var d=this.eventToCallbackMap[b];if(d&&d.length)for(var e=0;e<d.length;e++){var f=d[e];f(c)}a&&this._triggerJQueryEvent(b,c)},_triggerJQueryEvent:function(a,b){var c={type:a,value:b};this.$element.trigger(c),this.$sliderElem.trigger(c)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(a,b){"undefined"!=typeof a.innerText?a.innerText=b:"undefined"!=typeof a.textContent&&(a.textContent=b)},_removeClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)");d=d.replace(g," ")}a.className=d.trim()},_addClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)"),h=g.test(d);h||(d+=" "+f)}a.className=d.trim()},_offset:function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{left:b,top:c}},_css:function(a,b,c){a.style[b]=c}},a){var e=a.fn.slider?"bootstrapSlider":"slider";a.bridget(e,d)}else window.Slider=d}(a)}(window.jQuery),function(a,b,c){function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return q[a.which]?q[a.which]:r[a.which]?r[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a){a=a||{};var b,c=!1;for(b in w)a[b]?c=!0:w[b]=0;c||(z=!1)}function g(a,b,c,d,e,f){var g,h,i=[],j=c.type;if(!u[a])return[];for("keyup"==j&&k(a)&&(b=[a]),g=0;g<u[a].length;++g)if(h=u[a][g],!(!d&&h.seq&&w[h.seq]!=h.level||j!=h.action||("keypress"!=j||c.metaKey||c.ctrlKey)&&b.sort().join(",")!==h.modifiers.sort().join(","))){var l=d&&h.seq==d&&h.level==f;(!d&&h.combo==e||l)&&u[a].splice(g,1),i.push(h)}return i}function h(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function i(a,b,c,d){A.stopCallback(b,b.target||b.srcElement,c,d)||!1!==a(b,c)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function j(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);b&&("keyup"==a.type&&x===b?x=!1:A.handleKey(b,h(a),a))}function k(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function l(a,b,c,d){function g(b){return function(){z=b,++w[a],clearTimeout(p),p=setTimeout(f,1e3)}}function h(b){i(c,b,a),"keyup"!==d&&(x=e(b)),setTimeout(f,10)}for(var j=w[a]=0;j<b.length;++j){var k=j+1===b.length?h:g(d||m(b[j+1]).action);n(b[j],k,d,a,j)}}function m(a,b){var c,d,e,f=[];for(c="+"===a?["+"]:a.split("+"),e=0;e<c.length;++e)d=c[e],t[d]&&(d=t[d]),b&&"keypress"!=b&&s[d]&&(d=s[d],f.push("shift")),k(d)&&f.push(d);if(c=d,e=b,!e){if(!o){o={};for(var g in q)g>95&&112>g||q.hasOwnProperty(g)&&(o[q[g]]=g)}e=o[c]?"keydown":"keypress"}return"keypress"==e&&f.length&&(e="keydown"),{key:d,modifiers:f,action:e}}function n(a,b,c,d,e){v[a+":"+c]=b,a=a.replace(/\s+/g," ");var f=a.split(" ");1<f.length?l(a,f,b,c):(c=m(a,c),u[c.key]=u[c.key]||[],g(c.key,c.modifiers,{type:c.action},d,a,e),u[c.key][d?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:d,level:e,combo:a}))}var o,p,q={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},t={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u={},v={},w={},x=!1,y=!1,z=!1;for(c=1;20>c;++c)q[111+c]="f"+c;for(c=0;9>=c;++c)q[c+96]=c;d(b,"keypress",j),d(b,"keydown",j),d(b,"keyup",j);var A={bind:function(a,b,c){a=a instanceof Array?a:[a];for(var d=0;d<a.length;++d)n(a[d],b,c);return this},unbind:function(a,b){return A.bind(a,function(){},b)},trigger:function(a,b){return v[a+":"+b]&&v[a+":"+b]({},a),this},reset:function(){return u={},v={},this},stopCallback:function(a,b){return-1<(" "+b.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},handleKey:function(a,b,c){var d,e=g(a,b,c);b={};var h=0,j=!1;for(d=0;d<e.length;++d)e[d].seq&&(h=Math.max(h,e[d].level));for(d=0;d<e.length;++d)e[d].seq?e[d].level==h&&(j=!0,b[e[d].seq]=1,i(e[d].callback,c,e[d].combo,e[d].seq)):j||i(e[d].callback,c,e[d].combo);e="keypress"==c.type&&y,c.type!=z||k(a)||e||f(b),y=j&&"keydown"==c.type}};a.Mousetrap=A,"function"==typeof define&&define.amd&&define(A)}(window,document),function(a){"use strict";var b=function(b,c){this.options=c,this.$select=a(b),this._init()};b.prototype={constructor:b,_init:function(){var b=this.options.callback,c=this.$select.val(),d=this.$select.find("option:selected").data("color"),e=a("<ul>").addClass("dropdown-menu").addClass("dropdown-caret"),f=a("<div>").addClass("dropdown").addClass("dropdown-colorselector"),g=a("<span>").addClass("btn-colorselector").css("background-color",d),h=a("<a>").attr("data-toggle","dropdown").addClass("dropdown-toggle").attr("href","#").append(g);a("option",this.$select).each(function(){var b=a(this),d=b.attr("value"),f=b.data("color"),g=b.text(),h=a("<a>").addClass("color-btn");(b.prop("selected")===!0||c===f)&&h.addClass("selected"),h.css("background-color",f),h.attr("href","#").attr("data-color",f).attr("data-value",d).attr("title",g),e.append(a("<li>").append(h))}),f.append(h),f.append(e),this.$select.hide(),this.$selector=a(f).insertAfter(this.$select),this.$select.on("change",function(){var c=a(this).val(),d=a(this).find("option[value='"+c+"']").data("color"),e=a(this).find("option[value='"+c+"']").text();a(this).next().find("ul").find("li").find(".selected").removeClass("selected"),a(this).next().find("ul").find("li").find("a[data-color='"+d+"']").addClass("selected"),a(this).next().find(".btn-colorselector").css("background-color",d),b(c,d,e)}),e.on("click.colorselector",a.proxy(this._clickColor,this))},_clickColor:function(b){var c=a(b.target);return c.is(".color-btn")?(this.$select.val(c.data("value")).change(),b.preventDefault(),!0):!1},setColor:function(b){var c=a(this.$selector).find("li").find("a[data-color='"+b+"']").data("value");this.setValue(c)},setValue:function(a){this.$select.val(a).change()}},a.fn.colorselector=function(c){var d=Array.apply(null,arguments);return d.shift(),this.each(function(){var e=a(this),f=e.data("colorselector"),g=a.extend({},a.fn.colorselector.defaults,e.data(),"object"==typeof c&&c);f||e.data("colorselector",f=new b(this,g)),"string"==typeof c&&f[c].apply(f,d)})},a.fn.colorselector.defaults={callback:function(){},colorsPerRow:8},a.fn.colorselector.Constructor=b}(jQuery,window,document),function(){function a(a,b,c){r.biginteger_used=1,null!=a&&("number"==typeof a&&"undefined"==typeof b?this.fromInt(a):"number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function b(){return new a(null)}function c(a,b,c,d,e,f){for(;0<=--f;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e}function d(a,b,c,d,e,f){var g=32767&b;for(b>>=15;0<=--f;){var h=32767&this[a],i=this[a++]>>15,j=b*h+i*g,h=g*h+((32767&j)<<15)+c[d]+(1073741823&e);e=(h>>>30)+(j>>>15)+b*i+(e>>>30),c[d++]=1073741823&h}return e}function e(a,b,c,d,e,f){var g=16383&b;for(b>>=14;0<=--f;){var h=16383&this[a],i=this[a++]>>14,j=b*h+i*g,h=g*h+((16383&j)<<14)+c[d]+e;e=(h>>28)+(j>>14)+b*i,c[d++]=268435455&h}return e}function f(a,b){var c=C[a.charCodeAt(b)];return null==c?-1:c}function g(a){var c=b();return c.fromInt(a),c}function h(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=a>>1&&(c+=1),c}function i(a){this.m=a}function j(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function k(a,b){return a&b}function l(a,b){return a|b}function m(a,b){return a^b}function n(a,b){return a&~b}function o(){}function p(a){return a}function q(c){this.r2=b(),this.q3=b(),a.ONE.dlShiftTo(2*c.t,this.r2),this.mu=this.r2.divide(c),this.m=c}var r={},s=!1;"undefined"!=typeof module&&module.exports?(module.exports=r,s=!0):"undefined"!=typeof document?window.ClipperLib=r:self.ClipperLib=r;var t;if(s)u="chrome",t="Netscape";else{var u=navigator.userAgent.toString().toLowerCase();t=navigator.appName}var v,w,x,y,z,A;v=-1!=u.indexOf("chrome")&&-1==u.indexOf("chromium")?1:0,s=-1!=u.indexOf("chromium")?1:0,w=-1!=u.indexOf("safari")&&-1==u.indexOf("chrome")&&-1==u.indexOf("chromium")?1:0,x=-1!=u.indexOf("firefox")?1:0,u.indexOf("firefox/17"),u.indexOf("firefox/15"),u.indexOf("firefox/3"),y=-1!=u.indexOf("opera")?1:0,u.indexOf("msie 10"),u.indexOf("msie 9"),z=-1!=u.indexOf("msie 8")?1:0,A=-1!=u.indexOf("msie 7")?1:0,u=-1!=u.indexOf("msie ")?1:0,r.biginteger_used=null,"Microsoft Internet Explorer"==t?(a.prototype.am=d,t=30):"Netscape"!=t?(a.prototype.am=c,t=26):(a.prototype.am=e,t=28),a.prototype.DB=t,a.prototype.DM=(1<<t)-1,a.prototype.DV=1<<t,a.prototype.FV=Math.pow(2,52),a.prototype.F1=52-t,a.prototype.F2=2*t-52;var B,C=[];for(t=48,B=0;9>=B;++B)C[t++]=B;for(t=97,B=10;36>B;++B)C[t++]=B;for(t=65,B=10;36>B;++B)C[t++]=B;i.prototype.convert=function(a){return 0>a.s||0<=a.compareTo(this.m)?a.mod(this.m):a},i.prototype.revert=function(a){return a},i.prototype.reduce=function(a){a.divRemTo(this.m,null,a)},i.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c),this.reduce(c)},i.prototype.sqrTo=function(a,b){a.squareTo(b),this.reduce(b)},j.prototype.convert=function(c){var d=b();return c.abs().dlShiftTo(this.m.t,d),d.divRemTo(this.m,null,d),0>c.s&&0<d.compareTo(a.ZERO)&&this.m.subTo(d,d),d},j.prototype.revert=function(a){var c=b();return a.copyTo(c),this.reduce(c),c},j.prototype.reduce=function(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM,c=b+this.m.t;for(a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),0<=a.compareTo(this.m)&&a.subTo(this.m,a)},j.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c),this.reduce(c)},j.prototype.sqrTo=function(a,b){a.squareTo(b),this.reduce(b)},a.prototype.copyTo=function(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s},a.prototype.fromInt=function(a){this.t=1,this.s=0>a?-1:0,a>0?this[0]=a:-1>a?this[0]=a+this.DV:this.t=0},a.prototype.fromString=function(b,c){var d;if(16==c)d=4;else if(8==c)d=3;else if(256==c)d=8;else if(2==c)d=1;else if(32==c)d=5;else{if(4!=c)return void this.fromRadix(b,c);d=2}this.s=this.t=0;for(var e=b.length,g=!1,h=0;0<=--e;){var i=8==d?255&b[e]:f(b,e);0>i?"-"==b.charAt(e)&&(g=!0):(g=!1,0==h?this[this.t++]=i:h+d>this.DB?(this[this.t-1]|=(i&(1<<this.DB-h)-1)<<h,this[this.t++]=i>>this.DB-h):this[this.t-1]|=i<<h,h+=d,h>=this.DB&&(h-=this.DB))}8==d&&0!=(128&b[0])&&(this.s=-1,h>0&&(this[this.t-1]|=(1<<this.DB-h)-1<<h)),this.clamp(),g&&a.ZERO.subTo(this,this)},a.prototype.clamp=function(){for(var a=this.s&this.DM;0<this.t&&this[this.t-1]==a;)--this.t},a.prototype.dlShiftTo=function(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s},a.prototype.drShiftTo=function(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s},a.prototype.lShiftTo=function(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()},a.prototype.rShiftTo=function(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)b.t=0;else{var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}},a.prototype.subTo=function(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0,-1>d?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()},a.prototype.multiplyTo=function(b,c){var d=this.abs(),e=b.abs(),f=d.t;for(c.t=f+e.t;0<=--f;)c[f]=0;for(f=0;f<e.t;++f)c[f+d.t]=d.am(0,e[f],c,f,0,d.t);c.s=0,c.clamp(),this.s!=b.s&&a.ZERO.subTo(c,c)},a.prototype.squareTo=function(a){for(var b=this.abs(),c=a.t=2*b.t;0<=--c;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}0<a.t&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()},a.prototype.divRemTo=function(c,d,e){var f=c.abs();if(!(0>=f.t)){var g=this.abs();if(g.t<f.t)null!=d&&d.fromInt(0),null!=e&&this.copyTo(e);else{null==e&&(e=b());var i=b(),j=this.s;c=c.s;var k=this.DB-h(f[f.t-1]);if(k>0?(f.lShiftTo(k,i),g.lShiftTo(k,e)):(f.copyTo(i),g.copyTo(e)),f=i.t,g=i[f-1],0!=g){var l=g*(1<<this.F1)+(f>1?i[f-2]>>this.F2:0),m=this.FV/l,l=(1<<this.F1)/l,n=1<<this.F2,o=e.t,p=o-f,q=null==d?b():d;for(i.dlShiftTo(p,q),0<=e.compareTo(q)&&(e[e.t++]=1,e.subTo(q,e)),a.ONE.dlShiftTo(f,q),q.subTo(i,i);i.t<f;)i[i.t++]=0;for(;0<=--p;){var r=e[--o]==g?this.DM:Math.floor(e[o]*m+(e[o-1]+n)*l);if((e[o]+=i.am(0,r,e,p,0,f))<r)for(i.dlShiftTo(p,q),e.subTo(q,e);e[o]<--r;)e.subTo(q,e)}null!=d&&(e.drShiftTo(f,d),j!=c&&a.ZERO.subTo(d,d)),e.t=f,e.clamp(),k>0&&e.rShiftTo(k,e),0>j&&a.ZERO.subTo(e,e)}}}},a.prototype.invDigit=function(){if(1>this.t)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a,b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV;return b>0?this.DV-b:-b},a.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},a.prototype.exp=function(c,d){if(c>4294967295||1>c)return a.ONE;var e=b(),f=b(),g=d.convert(this),i=h(c)-1;for(g.copyTo(e);0<=--i;)if(d.sqrTo(e,f),(c&1<<i)>0)d.mulTo(f,g,e);else var j=e,e=f,f=j;return d.revert(e)},a.prototype.toString=function(a){if(0>this.s)return"-"+this.negate().toString(a);if(16==a)a=4;else if(8==a)a=3;else if(2==a)a=1;else if(32==a)a=5;else{if(4!=a)return this.toRadix(a);a=2}var b,c=(1<<a)-1,d=!1,e="",f=this.t,g=this.DB-f*this.DB%a;if(0<f--)for(g<this.DB&&0<(b=this[f]>>g)&&(d=!0,e="0123456789abcdefghijklmnopqrstuvwxyz".charAt(b));f>=0;)a>g?(b=(this[f]&(1<<g)-1)<<a-g,b|=this[--f]>>(g+=this.DB-a)):(b=this[f]>>(g-=a)&c,0>=g&&(g+=this.DB,--f)),b>0&&(d=!0),d&&(e+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(b));return d?e:"0"},a.prototype.negate=function(){var c=b();return a.ZERO.subTo(this,c),c},a.prototype.abs=function(){return 0>this.s?this.negate():this},a.prototype.compareTo=function(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t,b=c-a.t;if(0!=b)return 0>this.s?-b:b;for(;0<=--c;)if(0!=(b=this[c]-a[c]))return b;return 0},a.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+h(this[this.t-1]^this.s&this.DM)},a.prototype.mod=function(c){var d=b();return this.abs().divRemTo(c,null,d),0>this.s&&0<d.compareTo(a.ZERO)&&c.subTo(d,d),d},a.prototype.modPowInt=function(a,b){var c;return c=256>a||b.isEven()?new i(b):new j(b),this.exp(a,c)},a.ZERO=g(0),a.ONE=g(1),o.prototype.convert=p,o.prototype.revert=p,o.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c)},o.prototype.sqrTo=function(a,b){a.squareTo(b)},q.prototype.convert=function(a){if(0>a.s||a.t>2*this.m.t)return a.mod(this.m);if(0>a.compareTo(this.m))return a;var c=b();return a.copyTo(c),this.reduce(c),c},q.prototype.revert=function(a){return a},q.prototype.reduce=function(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>a.compareTo(this.r2);)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);0<=a.compareTo(this.m);)a.subTo(this.m,a)},q.prototype.mulTo=function(a,b,c){a.multiplyTo(b,c),this.reduce(c)},q.prototype.sqrTo=function(a,b){a.squareTo(b),this.reduce(b)};var D=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],E=67108864/D[D.length-1];a.prototype.chunkSize=function(a){return Math.floor(Math.LN2*this.DB/Math.log(a))},a.prototype.toRadix=function(a){if(null==a&&(a=10),0==this.signum()||2>a||a>36)return"0";var c=this.chunkSize(a),c=Math.pow(a,c),d=g(c),e=b(),f=b(),h="";for(this.divRemTo(d,e,f);0<e.signum();)h=(c+f.intValue()).toString(a).substr(1)+h,e.divRemTo(d,e,f);return f.intValue().toString(a)+h},a.prototype.fromRadix=function(b,c){this.fromInt(0),null==c&&(c=10);for(var d=this.chunkSize(c),e=Math.pow(c,d),g=!1,h=0,i=0,j=0;j<b.length;++j){var k=f(b,j);0>k?"-"==b.charAt(j)&&0==this.signum()&&(g=!0):(i=c*i+k,++h>=d&&(this.dMultiply(e),this.dAddOffset(i,0),i=h=0))}h>0&&(this.dMultiply(Math.pow(c,h)),this.dAddOffset(i,0)),g&&a.ZERO.subTo(this,this)},a.prototype.fromNumber=function(b,c,d){if("number"==typeof c)if(2>b)this.fromInt(1);else for(this.fromNumber(b,d),this.testBit(b-1)||this.bitwiseTo(a.ONE.shiftLeft(b-1),l,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(a.ONE.shiftLeft(b-1),this);else{d=[];var e=7&b;d.length=(b>>3)+1,c.nextBytes(d),d[0]=e>0?d[0]&(1<<e)-1:0,this.fromString(d,256)}},a.prototype.bitwiseTo=function(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;f>d;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){for(e=a.s&this.DM,d=f;d<this.t;++d)c[d]=b(this[d],e);c.t=this.t}else{for(e=this.s&this.DM,d=f;d<a.t;++d)c[d]=b(e,a[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()},a.prototype.changeBit=function(b,c){var d=a.ONE.shiftLeft(b);return this.bitwiseTo(d,c,d),d},a.prototype.addTo=function(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0,d>0?b[c++]=d:-1>d&&(b[c++]=this.DV+d),b.t=c,b.clamp()},a.prototype.dMultiply=function(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()},a.prototype.dAddOffset=function(a,b){if(0!=a){for(;this.t<=b;)this[this.t++]=0;for(this[b]+=a;this[b]>=this.DV;)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}},a.prototype.multiplyLowerTo=function(a,b,c){var d=Math.min(this.t+a.t,b);for(c.s=0,c.t=d;d>0;)c[--d]=0;var e;for(e=c.t-this.t;e>d;++d)c[d+this.t]=this.am(0,a[d],c,d,0,this.t);for(e=Math.min(a.t,b);e>d;++d)this.am(0,a[d],c,d,0,b-d);c.clamp()},a.prototype.multiplyUpperTo=function(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;0<=--d;)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)},a.prototype.modInt=function(a){if(0>=a)return 0;var b=this.DV%a,c=0>this.s?a-1:0;if(0<this.t)if(0==b)c=this[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this[d])%a;return c},a.prototype.millerRabin=function(c){var d=this.subtract(a.ONE),e=d.getLowestSetBit();if(0>=e)return!1;var f=d.shiftRight(e);c=c+1>>1,c>D.length&&(c=D.length);for(var g=b(),h=0;c>h;++h){g.fromInt(D[Math.floor(Math.random()*D.length)]);var i=g.modPow(f,this);if(0!=i.compareTo(a.ONE)&&0!=i.compareTo(d)){for(var j=1;j++<e&&0!=i.compareTo(d);)if(i=i.modPowInt(2,this),0==i.compareTo(a.ONE))return!1;if(0!=i.compareTo(d))return!1}}return!0},a.prototype.clone=function(){var a=b();return this.copyTo(a),a},a.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},a.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},a.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},a.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?0:1},a.prototype.toByteArray=function(){var a=this.t,b=[];b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(0<a--)for(d<this.DB&&(c=this[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);a>=0;)8>d?(c=(this[a]&(1<<d)-1)<<8-d,c|=this[--a]>>(d+=this.DB-8)):(c=this[a]>>(d-=8)&255,0>=d&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&&++e,(e>0||c!=this.s)&&(b[e++]=c);return b},a.prototype.equals=function(a){return 0==this.compareTo(a)},a.prototype.min=function(a){return 0>this.compareTo(a)?this:a},a.prototype.max=function(a){return 0<this.compareTo(a)?this:a},a.prototype.and=function(a){var c=b();return this.bitwiseTo(a,k,c),c},a.prototype.or=function(a){var c=b();return this.bitwiseTo(a,l,c),c},a.prototype.xor=function(a){var c=b();return this.bitwiseTo(a,m,c),c},a.prototype.andNot=function(a){var c=b();return this.bitwiseTo(a,n,c),c},a.prototype.not=function(){for(var a=b(),c=0;c<this.t;++c)a[c]=this.DM&~this[c];return a.t=this.t,a.s=~this.s,a},a.prototype.shiftLeft=function(a){var c=b();return 0>a?this.rShiftTo(-a,c):this.lShiftTo(a,c),c},a.prototype.shiftRight=function(a){var c=b();return 0>a?this.lShiftTo(-a,c):this.rShiftTo(a,c),c},a.prototype.getLowestSetBit=function(){for(var a=0;a<this.t;++a)if(0!=this[a]){var b=a*this.DB;if(a=this[a],0==a)a=-1;else{var c=0;0==(65535&a)&&(a>>=16,c+=16),0==(255&a)&&(a>>=8,c+=8),0==(15&a)&&(a>>=4,c+=4),0==(3&a)&&(a>>=2,c+=2),0==(1&a)&&++c,a=c}return b+a}return 0>this.s?this.t*this.DB:-1},a.prototype.bitCount=function(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c){for(var d=this[c]^b,e=0;0!=d;)d&=d-1,++e;a+=e}return a},a.prototype.testBit=function(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this[b]&1<<a%this.DB)},a.prototype.setBit=function(a){return this.changeBit(a,l)},a.prototype.clearBit=function(a){return this.changeBit(a,n)},a.prototype.flipBit=function(a){return this.changeBit(a,m)},a.prototype.add=function(a){var c=b();return this.addTo(a,c),c},a.prototype.subtract=function(a){var c=b();return this.subTo(a,c),c},a.prototype.multiply=function(a){var c=b();return this.multiplyTo(a,c),c},a.prototype.divide=function(a){var c=b();return this.divRemTo(a,c,null),c},a.prototype.remainder=function(a){var c=b();return this.divRemTo(a,null,c),c},a.prototype.divideAndRemainder=function(a){var c=b(),d=b();return this.divRemTo(a,c,d),[c,d]},a.prototype.modPow=function(a,c){var d,e,f=a.bitLength(),k=g(1);if(0>=f)return k;d=18>f?1:48>f?3:144>f?4:768>f?5:6,e=8>f?new i(c):c.isEven()?new q(c):new j(c);var l=[],m=3,n=d-1,o=(1<<d)-1;if(l[1]=e.convert(this),d>1)for(f=b(),e.sqrTo(l[1],f);o>=m;)l[m]=b(),e.mulTo(f,l[m-2],l[m]),m+=2;for(var p,r=a.t-1,s=!0,t=b(),f=h(a[r])-1;r>=0;){for(f>=n?p=a[r]>>f-n&o:(p=(a[r]&(1<<f+1)-1)<<n-f,r>0&&(p|=a[r-1]>>this.DB+f-n)),m=d;0==(1&p);)p>>=1,--m;if(0>(f-=m)&&(f+=this.DB,--r),s)l[p].copyTo(k),s=!1;else{for(;m>1;)e.sqrTo(k,t),e.sqrTo(t,k),m-=2;m>0?e.sqrTo(k,t):(m=k,k=t,t=m),e.mulTo(t,l[p],k)}for(;r>=0&&0==(a[r]&1<<f);)e.sqrTo(k,t),m=k,k=t,t=m,0>--f&&(f=this.DB-1,--r)}return e.revert(k)},a.prototype.modInverse=function(b){var c=b.isEven();if(this.isEven()&&c||0==b.signum())return a.ZERO;for(var d=b.clone(),e=this.clone(),f=g(1),h=g(0),i=g(0),j=g(1);0!=d.signum();){for(;d.isEven();)d.rShiftTo(1,d),c?(f.isEven()&&h.isEven()||(f.addTo(this,f),h.subTo(b,h)),f.rShiftTo(1,f)):h.isEven()||h.subTo(b,h),h.rShiftTo(1,h);for(;e.isEven();)e.rShiftTo(1,e),c?(i.isEven()&&j.isEven()||(i.addTo(this,i),j.subTo(b,j)),i.rShiftTo(1,i)):j.isEven()||j.subTo(b,j),j.rShiftTo(1,j);0<=d.compareTo(e)?(d.subTo(e,d),c&&f.subTo(i,f),h.subTo(j,h)):(e.subTo(d,e),c&&i.subTo(f,i),j.subTo(h,j))}return 0!=e.compareTo(a.ONE)?a.ZERO:0<=j.compareTo(b)?j.subtract(b):0>j.signum()?(j.addTo(b,j),0>j.signum()?j.add(b):j):j},a.prototype.pow=function(a){return this.exp(a,new o)},a.prototype.gcd=function(a){var b=0>this.s?this.negate():this.clone();if(a=0>a.s?a.negate():a.clone(),0>b.compareTo(a)){var c=b,b=a;a=c}var c=b.getLowestSetBit(),d=a.getLowestSetBit();if(0>d)return b;for(d>c&&(d=c),d>0&&(b.rShiftTo(d,b),a.rShiftTo(d,a));0<b.signum();)0<(c=b.getLowestSetBit())&&b.rShiftTo(c,b),0<(c=a.getLowestSetBit())&&a.rShiftTo(c,a),0<=b.compareTo(a)?(b.subTo(a,b),b.rShiftTo(1,b)):(a.subTo(b,a),a.rShiftTo(1,a));return d>0&&a.lShiftTo(d,a),a},a.prototype.isProbablePrime=function(a){var b,c=this.abs();if(1==c.t&&c[0]<=D[D.length-1]){for(b=0;b<D.length;++b)if(c[0]==D[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<D.length;){for(var d=D[b],e=b+1;e<D.length&&E>d;)d*=D[e++];for(d=c.modInt(d);e>b;)if(0==d%D[b++])return!1}return c.millerRabin(a)},a.prototype.square=function(){var a=b();return this.squareTo(a),a};var F=a;if(F.prototype.IsNegative=function(){return-1==this.compareTo(F.ZERO)?!0:!1},F.op_Equality=function(a,b){return 0==a.compareTo(b)?!0:!1},F.op_Inequality=function(a,b){return 0!=a.compareTo(b)?!0:!1},F.op_GreaterThan=function(a,b){return 0<a.compareTo(b)?!0:!1},F.op_LessThan=function(a,b){return 0>a.compareTo(b)?!0:!1},F.op_Addition=function(a,b){return new F(a).add(new F(b))},F.op_Subtraction=function(a,b){return new F(a).subtract(new F(b))},F.Int128Mul=function(a,b){return new F(a).multiply(new F(b))},F.op_Division=function(a,b){return a.divide(b)},F.prototype.ToDouble=function(){return parseFloat(this.toString())},"undefined"==typeof G)var G=function(a,b){var c;if("undefined"==typeof Object.getOwnPropertyNames)for(c in b.prototype)("undefined"==typeof a.prototype[c]||a.prototype[c]==Object.prototype[c])&&(a.prototype[c]=b.prototype[c]);else for(var d=Object.getOwnPropertyNames(b.prototype),e=0;e<d.length;e++)"undefined"==typeof Object.getOwnPropertyDescriptor(a.prototype,d[e])&&Object.defineProperty(a.prototype,d[e],Object.getOwnPropertyDescriptor(b.prototype,d[e]));for(c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);a.$baseCtor=b};r.Path=function(){return[]},r.Paths=function(){return[]},r.DoublePoint=function(){var a=arguments;this.Y=this.X=0,1==a.length?(this.X=a[0].X,this.Y=a[0].Y):2==a.length&&(this.X=a[0],this.Y=a[1])},r.DoublePoint0=function(){this.Y=this.X=0},r.DoublePoint1=function(a){this.X=a.X,this.Y=a.Y},r.DoublePoint2=function(a,b){this.X=a,this.Y=b},r.PolyNode=function(){this.m_Parent=null,this.m_polygon=new r.Path,this.m_endtype=this.m_jointype=this.m_Index=0,this.m_Childs=[],this.IsOpen=!1},r.PolyNode.prototype.IsHoleNode=function(){for(var a=!0,b=this.m_Parent;null!==b;)a=!a,b=b.m_Parent;return a},r.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},r.PolyNode.prototype.Contour=function(){return this.m_polygon},r.PolyNode.prototype.AddChild=function(a){var b=this.m_Childs.length;this.m_Childs.push(a),a.m_Parent=this,a.m_Index=b},r.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()},r.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},r.PolyNode.prototype.Childs=function(){return this.m_Childs},r.PolyNode.prototype.Parent=function(){return this.m_Parent},r.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},r.PolyTree=function(){this.m_AllPolys=[],r.PolyNode.call(this)},r.PolyTree.prototype.Clear=function(){for(var a=0,b=this.m_AllPolys.length;b>a;a++)this.m_AllPolys[a]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},r.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null},r.PolyTree.prototype.Total=function(){return this.m_AllPolys.length},G(r.PolyTree,r.PolyNode),r.Math_Abs_Int64=r.Math_Abs_Int32=r.Math_Abs_Double=function(a){return Math.abs(a)},r.Math_Max_Int32_Int32=function(a,b){return Math.max(a,b)},r.Cast_Int32=u||y||w?function(a){return 0|a}:function(a){return~~a},r.Cast_Int64=v?function(a){return-2147483648>a||a>2147483647?0>a?Math.ceil(a):Math.floor(a):~~a}:x&&"function"==typeof Number.toInteger?function(a){return Number.toInteger(a)}:A||z?function(a){return parseInt(a,10)}:u?function(a){return-2147483648>a||a>2147483647?0>a?Math.ceil(a):Math.floor(a):0|a}:function(a){return 0>a?Math.ceil(a):Math.floor(a)},r.Clear=function(a){a.length=0},r.PI=3.141592653589793,r.PI2=6.283185307179586,r.IntPoint=function(){var a;a=arguments;var b=a.length;this.Y=this.X=0,2==b?(this.X=a[0],this.Y=a[1]):1==b?a[0]instanceof r.DoublePoint?(a=a[0],this.X=r.Clipper.Round(a.X),this.Y=r.Clipper.Round(a.Y)):(a=a[0],this.X=a.X,this.Y=a.Y):this.Y=this.X=0},r.IntPoint.op_Equality=function(a,b){return a.X==b.X&&a.Y==b.Y},r.IntPoint.op_Inequality=function(a,b){return a.X!=b.X||a.Y!=b.Y},r.IntPoint0=function(){this.Y=this.X=0},r.IntPoint1=function(a){this.X=a.X,this.Y=a.Y},r.IntPoint1dp=function(a){this.X=r.Clipper.Round(a.X),this.Y=r.Clipper.Round(a.Y)},r.IntPoint2=function(a,b){this.X=a,this.Y=b},r.IntRect=function(){var a=arguments,b=a.length;4==b?(this.left=a[0],this.top=a[1],this.right=a[2],this.bottom=a[3]):1==b?(this.left=ir.left,this.top=ir.top,this.right=ir.right,this.bottom=ir.bottom):this.bottom=this.right=this.top=this.left=0},r.IntRect0=function(){this.bottom=this.right=this.top=this.left=0},r.IntRect1=function(a){this.left=a.left,this.top=a.top,this.right=a.right,this.bottom=a.bottom},r.IntRect4=function(a,b,c,d){this.left=a,this.top=b,this.right=c,this.bottom=d},r.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},r.PolyType={ptSubject:0,ptClip:1},r.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},r.JoinType={jtSquare:0,jtRound:1,jtMiter:2},r.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},r.EdgeSide={esLeft:0,esRight:1},r.Direction={dRightToLeft:0,dLeftToRight:1},r.TEdge=function(){this.Bot=new r.IntPoint,this.Curr=new r.IntPoint,this.Top=new r.IntPoint,this.Delta=new r.IntPoint,this.Dx=0,this.PolyTyp=r.PolyType.ptSubject,this.Side=r.EdgeSide.esLeft,this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0,this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null},r.IntersectNode=function(){this.Edge2=this.Edge1=null,this.Pt=new r.IntPoint},r.MyIntersectNodeSort=function(){},r.MyIntersectNodeSort.Compare=function(a,b){return b.Pt.Y-a.Pt.Y},r.LocalMinima=function(){this.Y=0,this.Next=this.RightBound=this.LeftBound=null},r.Scanbeam=function(){this.Y=0,this.Next=null},r.OutRec=function(){this.Idx=0,this.IsOpen=this.IsHole=!1,this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null},r.OutPt=function(){this.Idx=0,this.Pt=new r.IntPoint,this.Prev=this.Next=null},r.Join=function(){this.OutPt2=this.OutPt1=null,this.OffPt=new r.IntPoint},r.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null,this.m_edges=[],this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1,this.m_CurrentLM=this.m_MinimaList=null,this.m_HasOpenPaths=this.m_UseFullRange=!1},r.ClipperBase.horizontal=-9007199254740992,r.ClipperBase.Skip=-2,r.ClipperBase.Unassigned=-1,r.ClipperBase.tolerance=1e-20,r.ClipperBase.loRange=47453132,r.ClipperBase.hiRange=0xfffffffffffff,r.ClipperBase.near_zero=function(a){return a>-r.ClipperBase.tolerance&&a<r.ClipperBase.tolerance
},r.ClipperBase.IsHorizontal=function(a){return 0===a.Delta.Y},r.ClipperBase.prototype.PointIsVertex=function(a,b){var c=b;do{if(r.IntPoint.op_Equality(c.Pt,a))return!0;c=c.Next}while(c!=b);return!1},r.ClipperBase.prototype.PointOnLineSegment=function(a,b,c,d){return d?a.X==b.X&&a.Y==b.Y||a.X==c.X&&a.Y==c.Y||a.X>b.X==a.X<c.X&&a.Y>b.Y==a.Y<c.Y&&F.op_Equality(F.Int128Mul(a.X-b.X,c.Y-b.Y),F.Int128Mul(c.X-b.X,a.Y-b.Y)):a.X==b.X&&a.Y==b.Y||a.X==c.X&&a.Y==c.Y||a.X>b.X==a.X<c.X&&a.Y>b.Y==a.Y<c.Y&&(a.X-b.X)*(c.Y-b.Y)==(c.X-b.X)*(a.Y-b.Y)},r.ClipperBase.prototype.PointOnPolygon=function(a,b,c){for(var d=b;;){if(this.PointOnLineSegment(a,d.Pt,d.Next.Pt,c))return!0;if(d=d.Next,d==b)break}return!1},r.ClipperBase.prototype.SlopesEqual=r.ClipperBase.SlopesEqual=function(){var a,b,c,d=arguments,e=d.length;return 3==e?(e=d[0],a=d[1],(d=d[2])?F.op_Equality(F.Int128Mul(e.Delta.Y,a.Delta.X),F.Int128Mul(e.Delta.X,a.Delta.Y)):r.Cast_Int64(e.Delta.Y*a.Delta.X)==r.Cast_Int64(e.Delta.X*a.Delta.Y)):4==e?(e=d[0],a=d[1],b=d[2],(d=d[3])?F.op_Equality(F.Int128Mul(e.Y-a.Y,a.X-b.X),F.Int128Mul(e.X-a.X,a.Y-b.Y)):0===r.Cast_Int64((e.Y-a.Y)*(a.X-b.X))-r.Cast_Int64((e.X-a.X)*(a.Y-b.Y))):(e=d[0],a=d[1],b=d[2],c=d[3],(d=d[4])?F.op_Equality(F.Int128Mul(e.Y-a.Y,b.X-c.X),F.Int128Mul(e.X-a.X,b.Y-c.Y)):0===r.Cast_Int64((e.Y-a.Y)*(b.X-c.X))-r.Cast_Int64((e.X-a.X)*(b.Y-c.Y)))},r.ClipperBase.SlopesEqual3=function(a,b,c){return c?F.op_Equality(F.Int128Mul(a.Delta.Y,b.Delta.X),F.Int128Mul(a.Delta.X,b.Delta.Y)):r.Cast_Int64(a.Delta.Y*b.Delta.X)==r.Cast_Int64(a.Delta.X*b.Delta.Y)},r.ClipperBase.SlopesEqual4=function(a,b,c,d){return d?F.op_Equality(F.Int128Mul(a.Y-b.Y,b.X-c.X),F.Int128Mul(a.X-b.X,b.Y-c.Y)):0===r.Cast_Int64((a.Y-b.Y)*(b.X-c.X))-r.Cast_Int64((a.X-b.X)*(b.Y-c.Y))},r.ClipperBase.SlopesEqual5=function(a,b,c,d,e){return e?F.op_Equality(F.Int128Mul(a.Y-b.Y,c.X-d.X),F.Int128Mul(a.X-b.X,c.Y-d.Y)):0===r.Cast_Int64((a.Y-b.Y)*(c.X-d.X))-r.Cast_Int64((a.X-b.X)*(c.Y-d.Y))},r.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var a=0,b=this.m_edges.length;b>a;++a){for(var c=0,d=this.m_edges[a].length;d>c;++c)this.m_edges[a][c]=null;r.Clear(this.m_edges[a])}r.Clear(this.m_edges),this.m_HasOpenPaths=this.m_UseFullRange=!1},r.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var a=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=a}this.m_CurrentLM=null},r.ClipperBase.prototype.RangeTest=function(a,b){b.Value?(a.X>r.ClipperBase.hiRange||a.Y>r.ClipperBase.hiRange||-a.X>r.ClipperBase.hiRange||-a.Y>r.ClipperBase.hiRange)&&r.Error("Coordinate outside allowed range in RangeTest()."):(a.X>r.ClipperBase.loRange||a.Y>r.ClipperBase.loRange||-a.X>r.ClipperBase.loRange||-a.Y>r.ClipperBase.loRange)&&(b.Value=!0,this.RangeTest(a,b))},r.ClipperBase.prototype.InitEdge=function(a,b,c,d){a.Next=b,a.Prev=c,a.Curr.X=d.X,a.Curr.Y=d.Y,a.OutIdx=-1},r.ClipperBase.prototype.InitEdge2=function(a,b){a.Curr.Y>=a.Next.Curr.Y?(a.Bot.X=a.Curr.X,a.Bot.Y=a.Curr.Y,a.Top.X=a.Next.Curr.X,a.Top.Y=a.Next.Curr.Y):(a.Top.X=a.Curr.X,a.Top.Y=a.Curr.Y,a.Bot.X=a.Next.Curr.X,a.Bot.Y=a.Next.Curr.Y),this.SetDx(a),a.PolyTyp=b},r.ClipperBase.prototype.FindNextLocMin=function(a){for(var b;;){for(;r.IntPoint.op_Inequality(a.Bot,a.Prev.Bot)||r.IntPoint.op_Equality(a.Curr,a.Top);)a=a.Next;if(a.Dx!=r.ClipperBase.horizontal&&a.Prev.Dx!=r.ClipperBase.horizontal)break;for(;a.Prev.Dx==r.ClipperBase.horizontal;)a=a.Prev;for(b=a;a.Dx==r.ClipperBase.horizontal;)a=a.Next;if(a.Top.Y!=a.Prev.Bot.Y){b.Prev.Bot.X<a.Bot.X&&(a=b);break}}return a},r.ClipperBase.prototype.ProcessBound=function(a,b){var c,d=a,e=a;if(a.Dx==r.ClipperBase.horizontal&&(c=b?a.Prev.Bot.X:a.Next.Bot.X,a.Bot.X!=c&&this.ReverseHorizontal(a)),e.OutIdx!=r.ClipperBase.Skip)if(b){for(;e.Top.Y==e.Next.Bot.Y&&e.Next.OutIdx!=r.ClipperBase.Skip;)e=e.Next;if(e.Dx==r.ClipperBase.horizontal&&e.Next.OutIdx!=r.ClipperBase.Skip){for(c=e;c.Prev.Dx==r.ClipperBase.horizontal;)c=c.Prev;c.Prev.Top.X==e.Next.Top.X?b||(e=c.Prev):c.Prev.Top.X>e.Next.Top.X&&(e=c.Prev)}for(;a!=e;)a.NextInLML=a.Next,a.Dx==r.ClipperBase.horizontal&&a!=d&&a.Bot.X!=a.Prev.Top.X&&this.ReverseHorizontal(a),a=a.Next;a.Dx==r.ClipperBase.horizontal&&a!=d&&a.Bot.X!=a.Prev.Top.X&&this.ReverseHorizontal(a),e=e.Next}else{for(;e.Top.Y==e.Prev.Bot.Y&&e.Prev.OutIdx!=r.ClipperBase.Skip;)e=e.Prev;if(e.Dx==r.ClipperBase.horizontal&&e.Prev.OutIdx!=r.ClipperBase.Skip){for(c=e;c.Next.Dx==r.ClipperBase.horizontal;)c=c.Next;c.Next.Top.X==e.Prev.Top.X?b||(e=c.Next):c.Next.Top.X>e.Prev.Top.X&&(e=c.Next)}for(;a!=e;)a.NextInLML=a.Prev,a.Dx==r.ClipperBase.horizontal&&a!=d&&a.Bot.X!=a.Next.Top.X&&this.ReverseHorizontal(a),a=a.Prev;a.Dx==r.ClipperBase.horizontal&&a!=d&&a.Bot.X!=a.Next.Top.X&&this.ReverseHorizontal(a),e=e.Prev}if(e.OutIdx==r.ClipperBase.Skip){if(a=e,b){for(;a.Top.Y==a.Next.Bot.Y;)a=a.Next;for(;a!=e&&a.Dx==r.ClipperBase.horizontal;)a=a.Prev}else{for(;a.Top.Y==a.Prev.Bot.Y;)a=a.Prev;for(;a!=e&&a.Dx==r.ClipperBase.horizontal;)a=a.Next}a==e?e=b?a.Next:a.Prev:(a=b?e.Next:e.Prev,d=new r.LocalMinima,d.Next=null,d.Y=a.Bot.Y,d.LeftBound=null,d.RightBound=a,d.RightBound.WindDelta=0,e=this.ProcessBound(d.RightBound,b),this.InsertLocalMinima(d))}return e},r.ClipperBase.prototype.AddPath=function(a,b,c){c||b!=r.PolyType.ptClip||r.Error("AddPath: Open paths must be subject.");var d=a.length-1;if(c)for(;d>0&&r.IntPoint.op_Equality(a[d],a[0]);)--d;for(;d>0&&r.IntPoint.op_Equality(a[d],a[d-1]);)--d;if(c&&2>d||!c&&1>d)return!1;for(var e=[],f=0;d>=f;f++)e.push(new r.TEdge);var g=!0;e[1].Curr.X=a[1].X,e[1].Curr.Y=a[1].Y;var h={Value:this.m_UseFullRange};for(this.RangeTest(a[0],h),this.m_UseFullRange=h.Value,h.Value=this.m_UseFullRange,this.RangeTest(a[d],h),this.m_UseFullRange=h.Value,this.InitEdge(e[0],e[1],e[d],a[0]),this.InitEdge(e[d],e[0],e[d-1],a[d]),f=d-1;f>=1;--f)h.Value=this.m_UseFullRange,this.RangeTest(a[f],h),this.m_UseFullRange=h.Value,this.InitEdge(e[f],e[f+1],e[f-1],a[f]);for(f=a=d=e[0];;)if(r.IntPoint.op_Equality(a.Curr,a.Next.Curr)){if(a==a.Next)break;a==d&&(d=a.Next),f=a=this.RemoveEdge(a)}else{if(a.Prev==a.Next)break;if(c&&r.ClipperBase.SlopesEqual(a.Prev.Curr,a.Curr,a.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(a.Prev.Curr,a.Curr,a.Next.Curr))){a==d&&(d=a.Next),a=this.RemoveEdge(a),f=a=a.Prev;continue}if(a=a.Next,a==f)break}if(!c&&a==a.Next||c&&a.Prev==a.Next)return!1;c||(this.m_HasOpenPaths=!0,d.Prev.OutIdx=r.ClipperBase.Skip),a=d;do this.InitEdge2(a,b),a=a.Next,g&&a.Curr.Y!=d.Curr.Y&&(g=!1);while(a!=d);if(g){if(c)return!1;for(a.Prev.OutIdx=r.ClipperBase.Skip,a.Prev.Bot.X<a.Prev.Top.X&&this.ReverseHorizontal(a.Prev),b=new r.LocalMinima,b.Next=null,b.Y=a.Bot.Y,b.LeftBound=null,b.RightBound=a,b.RightBound.Side=r.EdgeSide.esRight,b.RightBound.WindDelta=0;a.Next.OutIdx!=r.ClipperBase.Skip;)a.NextInLML=a.Next,a.Bot.X!=a.Prev.Top.X&&this.ReverseHorizontal(a),a=a.Next;return this.InsertLocalMinima(b),this.m_edges.push(e),!0}for(this.m_edges.push(e),g=null;a=this.FindNextLocMin(a),a!=g;)null==g&&(g=a),b=new r.LocalMinima,b.Next=null,b.Y=a.Bot.Y,a.Dx<a.Prev.Dx?(b.LeftBound=a.Prev,b.RightBound=a,e=!1):(b.LeftBound=a,b.RightBound=a.Prev,e=!0),b.LeftBound.Side=r.EdgeSide.esLeft,b.RightBound.Side=r.EdgeSide.esRight,b.LeftBound.WindDelta=c?b.LeftBound.Next==b.RightBound?-1:1:0,b.RightBound.WindDelta=-b.LeftBound.WindDelta,a=this.ProcessBound(b.LeftBound,e),d=this.ProcessBound(b.RightBound,!e),b.LeftBound.OutIdx==r.ClipperBase.Skip?b.LeftBound=null:b.RightBound.OutIdx==r.ClipperBase.Skip&&(b.RightBound=null),this.InsertLocalMinima(b),e||(a=d);return!0},r.ClipperBase.prototype.AddPaths=function(a,b,c){for(var d=!1,e=0,f=a.length;f>e;++e)this.AddPath(a[e],b,c)&&(d=!0);return d},r.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(a,b,c){return r.IntPoint.op_Equality(a,c)||r.IntPoint.op_Equality(a,b)||r.IntPoint.op_Equality(c,b)?!1:a.X!=c.X?b.X>a.X==b.X<c.X:b.Y>a.Y==b.Y<c.Y},r.ClipperBase.prototype.RemoveEdge=function(a){a.Prev.Next=a.Next,a.Next.Prev=a.Prev;var b=a.Next;return a.Prev=null,b},r.ClipperBase.prototype.SetDx=function(a){a.Delta.X=a.Top.X-a.Bot.X,a.Delta.Y=a.Top.Y-a.Bot.Y,a.Dx=0===a.Delta.Y?r.ClipperBase.horizontal:a.Delta.X/a.Delta.Y},r.ClipperBase.prototype.InsertLocalMinima=function(a){if(null===this.m_MinimaList)this.m_MinimaList=a;else if(a.Y>=this.m_MinimaList.Y)a.Next=this.m_MinimaList,this.m_MinimaList=a;else{for(var b=this.m_MinimaList;null!==b.Next&&a.Y<b.Next.Y;)b=b.Next;a.Next=b.Next,b.Next=a}},r.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)},r.ClipperBase.prototype.ReverseHorizontal=function(a){var b=a.Top.X;a.Top.X=a.Bot.X,a.Bot.X=b},r.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!=this.m_CurrentLM)for(var a=this.m_MinimaList;null!=a;){var b=a.LeftBound;null!=b&&(b.Curr.X=b.Bot.X,b.Curr.Y=b.Bot.Y,b.Side=r.EdgeSide.esLeft,b.OutIdx=r.ClipperBase.Unassigned),b=a.RightBound,null!=b&&(b.Curr.X=b.Bot.X,b.Curr.Y=b.Bot.Y,b.Side=r.EdgeSide.esRight,b.OutIdx=r.ClipperBase.Unassigned),a=a.Next}},r.Clipper=function(a){"undefined"==typeof a&&(a=0),this.m_PolyOuts=null,this.m_ClipType=r.ClipType.ctIntersection,this.m_IntersectNodeComparer=this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null,this.m_ExecuteLocked=!1,this.m_SubjFillType=this.m_ClipFillType=r.PolyFillType.pftEvenOdd,this.m_GhostJoins=this.m_Joins=null,this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1,r.ClipperBase.call(this),this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null,this.m_IntersectList=[],this.m_IntersectNodeComparer=r.MyIntersectNodeSort.Compare,this.m_UsingPolyTree=this.m_ExecuteLocked=!1,this.m_PolyOuts=[],this.m_Joins=[],this.m_GhostJoins=[],this.ReverseSolution=0!==(1&a),this.StrictlySimple=0!==(2&a),this.PreserveCollinear=0!==(4&a)},r.Clipper.ioReverseSolution=1,r.Clipper.ioStrictlySimple=2,r.Clipper.ioPreserveCollinear=4,r.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),r.ClipperBase.prototype.Clear.call(this))},r.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var a=this.m_Scanbeam.Next;this.m_Scanbeam=null,this.m_Scanbeam=a}},r.Clipper.prototype.Reset=function(){r.ClipperBase.prototype.Reset.call(this),this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;for(var a=this.m_MinimaList;null!==a;)this.InsertScanbeam(a.Y),a=a.Next},r.Clipper.prototype.InsertScanbeam=function(a){if(null===this.m_Scanbeam)this.m_Scanbeam=new r.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=a;else if(a>this.m_Scanbeam.Y){var b=new r.Scanbeam;b.Y=a,b.Next=this.m_Scanbeam,this.m_Scanbeam=b}else{for(var c=this.m_Scanbeam;null!==c.Next&&a<=c.Next.Y;)c=c.Next;a!=c.Y&&(b=new r.Scanbeam,b.Y=a,b.Next=c.Next,c.Next=b)}},r.Clipper.prototype.Execute=function(){var a=arguments,b=a.length,c=a[1]instanceof r.PolyTree;if(4==b&&!c){if(b=a[0],e=a[1],c=a[2],a=a[3],this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&r.Error("Error: PolyTree struct is need for open path clipping."),this.m_ExecuteLocked=!0,r.Clear(e),this.m_SubjFillType=c,this.m_ClipFillType=a,this.m_ClipType=b,this.m_UsingPolyTree=!1;try{var d=this.ExecuteInternal();d&&this.BuildResult(e)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return d}if(4==b&&c){var b=a[0],e=a[1],c=a[2],a=a[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=c,this.m_ClipFillType=a,this.m_ClipType=b,this.m_UsingPolyTree=!0;try{(d=this.ExecuteInternal())&&this.BuildResult2(e)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return d}return 2==b&&!c||2==b&&c?(b=a[0],e=a[1],this.Execute(b,e,r.PolyFillType.pftEvenOdd,r.PolyFillType.pftEvenOdd)):void 0},r.Clipper.prototype.FixHoleLinkage=function(a){if(null!==a.FirstLeft&&(a.IsHole==a.FirstLeft.IsHole||null===a.FirstLeft.Pts)){for(var b=a.FirstLeft;null!==b&&(b.IsHole==a.IsHole||null===b.Pts);)b=b.FirstLeft;a.FirstLeft=b}},r.Clipper.prototype.ExecuteInternal=function(){try{if(this.Reset(),null===this.m_CurrentLM)return!1;var a=this.PopScanbeam();do{if(this.InsertLocalMinimaIntoAEL(a),r.Clear(this.m_GhostJoins),this.ProcessHorizontals(!1),null===this.m_Scanbeam)break;var b=this.PopScanbeam();if(!this.ProcessIntersections(a,b))return!1;this.ProcessEdgesAtTopOfScanbeam(b),a=b}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var a=0,c=this.m_PolyOuts.length;c>a;a++){var d=this.m_PolyOuts[a];null===d.Pts||d.IsOpen||(d.IsHole^this.ReverseSolution)==0<this.Area(d)&&this.ReversePolyPtLinks(d.Pts)}for(this.JoinCommonEdges(),a=0,c=this.m_PolyOuts.length;c>a;a++)d=this.m_PolyOuts[a],null===d.Pts||d.IsOpen||this.FixupOutPolygon(d);return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{r.Clear(this.m_Joins),r.Clear(this.m_GhostJoins)}},r.Clipper.prototype.PopScanbeam=function(){var a=this.m_Scanbeam.Y;return this.m_Scanbeam=this.m_Scanbeam.Next,a},r.Clipper.prototype.DisposeAllPolyPts=function(){for(var a=0,b=this.m_PolyOuts.length;b>a;++a)this.DisposeOutRec(a);r.Clear(this.m_PolyOuts)},r.Clipper.prototype.DisposeOutRec=function(a){var b=this.m_PolyOuts[a];null!==b.Pts&&this.DisposeOutPts(b.Pts),this.m_PolyOuts[a]=null},r.Clipper.prototype.DisposeOutPts=function(a){if(null!==a)for(a.Prev.Next=null;null!==a;)a=a.Next},r.Clipper.prototype.AddJoin=function(a,b,c){var d=new r.Join;d.OutPt1=a,d.OutPt2=b,d.OffPt.X=c.X,d.OffPt.Y=c.Y,this.m_Joins.push(d)},r.Clipper.prototype.AddGhostJoin=function(a,b){var c=new r.Join;c.OutPt1=a,c.OffPt.X=b.X,c.OffPt.Y=b.Y,this.m_GhostJoins.push(c)},r.Clipper.prototype.InsertLocalMinimaIntoAEL=function(a){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==a;){var b=this.m_CurrentLM.LeftBound,c=this.m_CurrentLM.RightBound;this.PopLocalMinima();var d=null;if(null===b?(this.InsertEdgeIntoAEL(c,null),this.SetWindingCount(c),this.IsContributing(c)&&(d=this.AddOutPt(c,c.Bot))):(null==c?(this.InsertEdgeIntoAEL(b,null),this.SetWindingCount(b),this.IsContributing(b)&&(d=this.AddOutPt(b,b.Bot))):(this.InsertEdgeIntoAEL(b,null),this.InsertEdgeIntoAEL(c,b),this.SetWindingCount(b),c.WindCnt=b.WindCnt,c.WindCnt2=b.WindCnt2,this.IsContributing(b)&&(d=this.AddLocalMinPoly(b,c,b.Bot))),this.InsertScanbeam(b.Top.Y)),null!=c&&(r.ClipperBase.IsHorizontal(c)?this.AddEdgeToSEL(c):this.InsertScanbeam(c.Top.Y)),null!=b&&null!=c){if(null!==d&&r.ClipperBase.IsHorizontal(c)&&0<this.m_GhostJoins.length&&0!==c.WindDelta)for(var e=0,f=this.m_GhostJoins.length;f>e;e++){var g=this.m_GhostJoins[e];this.HorzSegmentsOverlap(g.OutPt1.Pt,g.OffPt,c.Bot,c.Top)&&this.AddJoin(g.OutPt1,d,g.OffPt)}if(0<=b.OutIdx&&null!==b.PrevInAEL&&b.PrevInAEL.Curr.X==b.Bot.X&&0<=b.PrevInAEL.OutIdx&&r.ClipperBase.SlopesEqual(b.PrevInAEL,b,this.m_UseFullRange)&&0!==b.WindDelta&&0!==b.PrevInAEL.WindDelta&&(e=this.AddOutPt(b.PrevInAEL,b.Bot),this.AddJoin(d,e,b.Top)),b.NextInAEL!=c&&(0<=c.OutIdx&&0<=c.PrevInAEL.OutIdx&&r.ClipperBase.SlopesEqual(c.PrevInAEL,c,this.m_UseFullRange)&&0!==c.WindDelta&&0!==c.PrevInAEL.WindDelta&&(e=this.AddOutPt(c.PrevInAEL,c.Bot),this.AddJoin(d,e,c.Top)),d=b.NextInAEL,null!==d))for(;d!=c;)this.IntersectEdges(c,d,b.Curr,!1),d=d.NextInAEL}}},r.Clipper.prototype.InsertEdgeIntoAEL=function(a,b){if(null===this.m_ActiveEdges)a.PrevInAEL=null,a.NextInAEL=null,this.m_ActiveEdges=a;else if(null===b&&this.E2InsertsBeforeE1(this.m_ActiveEdges,a))a.PrevInAEL=null,a.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=a;else{for(null===b&&(b=this.m_ActiveEdges);null!==b.NextInAEL&&!this.E2InsertsBeforeE1(b.NextInAEL,a);)b=b.NextInAEL;a.NextInAEL=b.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=a),a.PrevInAEL=b,b.NextInAEL=a}},r.Clipper.prototype.E2InsertsBeforeE1=function(a,b){return b.Curr.X==a.Curr.X?b.Top.Y>a.Top.Y?b.Top.X<r.Clipper.TopX(a,b.Top.Y):a.Top.X>r.Clipper.TopX(b,a.Top.Y):b.Curr.X<a.Curr.X},r.Clipper.prototype.IsEvenOddFillType=function(a){return a.PolyTyp==r.PolyType.ptSubject?this.m_SubjFillType==r.PolyFillType.pftEvenOdd:this.m_ClipFillType==r.PolyFillType.pftEvenOdd},r.Clipper.prototype.IsEvenOddAltFillType=function(a){return a.PolyTyp==r.PolyType.ptSubject?this.m_ClipFillType==r.PolyFillType.pftEvenOdd:this.m_SubjFillType==r.PolyFillType.pftEvenOdd},r.Clipper.prototype.IsContributing=function(a){var b,c;switch(a.PolyTyp==r.PolyType.ptSubject?(b=this.m_SubjFillType,c=this.m_ClipFillType):(b=this.m_ClipFillType,c=this.m_SubjFillType),b){case r.PolyFillType.pftEvenOdd:if(0===a.WindDelta&&1!=a.WindCnt)return!1;break;case r.PolyFillType.pftNonZero:if(1!=Math.abs(a.WindCnt))return!1;break;case r.PolyFillType.pftPositive:if(1!=a.WindCnt)return!1;break;default:if(-1!=a.WindCnt)return!1}switch(this.m_ClipType){case r.ClipType.ctIntersection:switch(c){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0!==a.WindCnt2;case r.PolyFillType.pftPositive:return 0<a.WindCnt2;default:return 0>a.WindCnt2}case r.ClipType.ctUnion:switch(c){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0===a.WindCnt2;case r.PolyFillType.pftPositive:return 0>=a.WindCnt2;default:return 0<=a.WindCnt2}case r.ClipType.ctDifference:if(a.PolyTyp==r.PolyType.ptSubject)switch(c){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0===a.WindCnt2;case r.PolyFillType.pftPositive:return 0>=a.WindCnt2;default:return 0<=a.WindCnt2}else switch(c){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0!==a.WindCnt2;case r.PolyFillType.pftPositive:return 0<a.WindCnt2;default:return 0>a.WindCnt2}case r.ClipType.ctXor:if(0===a.WindDelta)switch(c){case r.PolyFillType.pftEvenOdd:case r.PolyFillType.pftNonZero:return 0===a.WindCnt2;case r.PolyFillType.pftPositive:return 0>=a.WindCnt2;default:return 0<=a.WindCnt2}}return!0},r.Clipper.prototype.SetWindingCount=function(a){for(var b=a.PrevInAEL;null!==b&&(b.PolyTyp!=a.PolyTyp||0===b.WindDelta);)b=b.PrevInAEL;if(null===b)a.WindCnt=0===a.WindDelta?1:a.WindDelta,a.WindCnt2=0,b=this.m_ActiveEdges;else{if(0===a.WindDelta&&this.m_ClipType!=r.ClipType.ctUnion)a.WindCnt=1;else if(this.IsEvenOddFillType(a))if(0===a.WindDelta){for(var c=!0,d=b.PrevInAEL;null!==d;)d.PolyTyp==b.PolyTyp&&0!==d.WindDelta&&(c=!c),d=d.PrevInAEL;a.WindCnt=c?0:1}else a.WindCnt=a.WindDelta;else a.WindCnt=0>b.WindCnt*b.WindDelta?1<Math.abs(b.WindCnt)?0>b.WindDelta*a.WindDelta?b.WindCnt:b.WindCnt+a.WindDelta:0===a.WindDelta?1:a.WindDelta:0===a.WindDelta?0>b.WindCnt?b.WindCnt-1:b.WindCnt+1:0>b.WindDelta*a.WindDelta?b.WindCnt:b.WindCnt+a.WindDelta;a.WindCnt2=b.WindCnt2,b=b.NextInAEL}if(this.IsEvenOddAltFillType(a))for(;b!=a;)0!==b.WindDelta&&(a.WindCnt2=0===a.WindCnt2?1:0),b=b.NextInAEL;else for(;b!=a;)a.WindCnt2+=b.WindDelta,b=b.NextInAEL},r.Clipper.prototype.AddEdgeToSEL=function(a){null===this.m_SortedEdges?(this.m_SortedEdges=a,a.PrevInSEL=null,a.NextInSEL=null):(a.NextInSEL=this.m_SortedEdges,a.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=a)},r.Clipper.prototype.CopyAELToSEL=function(){var a=this.m_ActiveEdges;for(this.m_SortedEdges=a;null!==a;)a.PrevInSEL=a.PrevInAEL,a=a.NextInSEL=a.NextInAEL},r.Clipper.prototype.SwapPositionsInAEL=function(a,b){if(a.NextInAEL!=a.PrevInAEL&&b.NextInAEL!=b.PrevInAEL){if(a.NextInAEL==b){var c=b.NextInAEL;null!==c&&(c.PrevInAEL=a);var d=a.PrevInAEL;null!==d&&(d.NextInAEL=b),b.PrevInAEL=d,b.NextInAEL=a,a.PrevInAEL=b,a.NextInAEL=c}else b.NextInAEL==a?(c=a.NextInAEL,null!==c&&(c.PrevInAEL=b),d=b.PrevInAEL,null!==d&&(d.NextInAEL=a),a.PrevInAEL=d,a.NextInAEL=b,b.PrevInAEL=a,b.NextInAEL=c):(c=a.NextInAEL,d=a.PrevInAEL,a.NextInAEL=b.NextInAEL,null!==a.NextInAEL&&(a.NextInAEL.PrevInAEL=a),a.PrevInAEL=b.PrevInAEL,null!==a.PrevInAEL&&(a.PrevInAEL.NextInAEL=a),b.NextInAEL=c,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=d,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=b));null===a.PrevInAEL?this.m_ActiveEdges=a:null===b.PrevInAEL&&(this.m_ActiveEdges=b)}},r.Clipper.prototype.SwapPositionsInSEL=function(a,b){if(!(null===a.NextInSEL&&null===a.PrevInSEL||null===b.NextInSEL&&null===b.PrevInSEL)){if(a.NextInSEL==b){var c=b.NextInSEL;null!==c&&(c.PrevInSEL=a);var d=a.PrevInSEL;null!==d&&(d.NextInSEL=b),b.PrevInSEL=d,b.NextInSEL=a,a.PrevInSEL=b,a.NextInSEL=c}else b.NextInSEL==a?(c=a.NextInSEL,null!==c&&(c.PrevInSEL=b),d=b.PrevInSEL,null!==d&&(d.NextInSEL=a),a.PrevInSEL=d,a.NextInSEL=b,b.PrevInSEL=a,b.NextInSEL=c):(c=a.NextInSEL,d=a.PrevInSEL,a.NextInSEL=b.NextInSEL,null!==a.NextInSEL&&(a.NextInSEL.PrevInSEL=a),a.PrevInSEL=b.PrevInSEL,null!==a.PrevInSEL&&(a.PrevInSEL.NextInSEL=a),b.NextInSEL=c,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=d,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b));null===a.PrevInSEL?this.m_SortedEdges=a:null===b.PrevInSEL&&(this.m_SortedEdges=b)}},r.Clipper.prototype.AddLocalMaxPoly=function(a,b,c){this.AddOutPt(a,c),0==b.WindDelta&&this.AddOutPt(b,c),a.OutIdx==b.OutIdx?(a.OutIdx=-1,b.OutIdx=-1):a.OutIdx<b.OutIdx?this.AppendPolygon(a,b):this.AppendPolygon(b,a)},r.Clipper.prototype.AddLocalMinPoly=function(a,b,c){var d,e;return r.ClipperBase.IsHorizontal(b)||a.Dx>b.Dx?(d=this.AddOutPt(a,c),b.OutIdx=a.OutIdx,a.Side=r.EdgeSide.esLeft,b.Side=r.EdgeSide.esRight,e=a,a=e.PrevInAEL==b?b.PrevInAEL:e.PrevInAEL):(d=this.AddOutPt(b,c),a.OutIdx=b.OutIdx,a.Side=r.EdgeSide.esRight,b.Side=r.EdgeSide.esLeft,e=b,a=e.PrevInAEL==a?a.PrevInAEL:e.PrevInAEL),null!==a&&0<=a.OutIdx&&r.Clipper.TopX(a,c.Y)==r.Clipper.TopX(e,c.Y)&&r.ClipperBase.SlopesEqual(e,a,this.m_UseFullRange)&&0!==e.WindDelta&&0!==a.WindDelta&&(c=this.AddOutPt(a,c),this.AddJoin(d,c,e.Top)),d},r.Clipper.prototype.CreateOutRec=function(){var a=new r.OutRec;return a.Idx=-1,a.IsHole=!1,a.IsOpen=!1,a.FirstLeft=null,a.Pts=null,a.BottomPt=null,a.PolyNode=null,this.m_PolyOuts.push(a),a.Idx=this.m_PolyOuts.length-1,a},r.Clipper.prototype.AddOutPt=function(a,b){var c=a.Side==r.EdgeSide.esLeft;if(0>a.OutIdx){var d=this.CreateOutRec();d.IsOpen=0===a.WindDelta;var e=new r.OutPt;d.Pts=e,e.Idx=d.Idx,e.Pt.X=b.X,e.Pt.Y=b.Y,e.Next=e,e.Prev=e,d.IsOpen||this.SetHoleState(a,d),a.OutIdx=d.Idx}else{var d=this.m_PolyOuts[a.OutIdx],f=d.Pts;if(c&&r.IntPoint.op_Equality(b,f.Pt))return f;if(!c&&r.IntPoint.op_Equality(b,f.Prev.Pt))return f.Prev;e=new r.OutPt,e.Idx=d.Idx,e.Pt.X=b.X,e.Pt.Y=b.Y,e.Next=f,e.Prev=f.Prev,e.Prev.Next=e,f.Prev=e,c&&(d.Pts=e)}return e},r.Clipper.prototype.SwapPoints=function(a,b){var c=new r.IntPoint(a.Value);a.Value.X=b.Value.X,a.Value.Y=b.Value.Y,b.Value.X=c.X,b.Value.Y=c.Y},r.Clipper.prototype.HorzSegmentsOverlap=function(a,b,c,d){return a.X>c.X==a.X<d.X?!0:b.X>c.X==b.X<d.X?!0:c.X>a.X==c.X<b.X?!0:d.X>a.X==d.X<b.X?!0:a.X==c.X&&b.X==d.X?!0:a.X==d.X&&b.X==c.X?!0:!1},r.Clipper.prototype.InsertPolyPtBetween=function(a,b,c){var d=new r.OutPt;return d.Pt.X=c.X,d.Pt.Y=c.Y,b==a.Next?(a.Next=d,b.Prev=d,d.Next=b,d.Prev=a):(b.Next=d,a.Prev=d,d.Next=a,d.Prev=b),d},r.Clipper.prototype.SetHoleState=function(a,b){for(var c=!1,d=a.PrevInAEL;null!==d;)0<=d.OutIdx&&0!=d.WindDelta&&(c=!c,null===b.FirstLeft&&(b.FirstLeft=this.m_PolyOuts[d.OutIdx])),d=d.PrevInAEL;c&&(b.IsHole=!0)},r.Clipper.prototype.GetDx=function(a,b){return a.Y==b.Y?r.ClipperBase.horizontal:(b.X-a.X)/(b.Y-a.Y)},r.Clipper.prototype.FirstIsBottomPt=function(a,b){for(var c=a.Prev;r.IntPoint.op_Equality(c.Pt,a.Pt)&&c!=a;)c=c.Prev;for(var d=Math.abs(this.GetDx(a.Pt,c.Pt)),c=a.Next;r.IntPoint.op_Equality(c.Pt,a.Pt)&&c!=a;)c=c.Next;for(var e=Math.abs(this.GetDx(a.Pt,c.Pt)),c=b.Prev;r.IntPoint.op_Equality(c.Pt,b.Pt)&&c!=b;)c=c.Prev;for(var f=Math.abs(this.GetDx(b.Pt,c.Pt)),c=b.Next;r.IntPoint.op_Equality(c.Pt,b.Pt)&&c!=b;)c=c.Next;return c=Math.abs(this.GetDx(b.Pt,c.Pt)),d>=f&&d>=c||e>=f&&e>=c},r.Clipper.prototype.GetBottomPt=function(a){for(var b=null,c=a.Next;c!=a;)c.Pt.Y>a.Pt.Y?(a=c,b=null):c.Pt.Y==a.Pt.Y&&c.Pt.X<=a.Pt.X&&(c.Pt.X<a.Pt.X?(b=null,a=c):c.Next!=a&&c.Prev!=a&&(b=c)),c=c.Next;if(null!==b)for(;b!=c;)for(this.FirstIsBottomPt(c,b)||(a=b),b=b.Next;r.IntPoint.op_Inequality(b.Pt,a.Pt);)b=b.Next;return a},r.Clipper.prototype.GetLowermostRec=function(a,b){null===a.BottomPt&&(a.BottomPt=this.GetBottomPt(a.Pts)),null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));var c=a.BottomPt,d=b.BottomPt;return c.Pt.Y>d.Pt.Y?a:c.Pt.Y<d.Pt.Y?b:c.Pt.X<d.Pt.X?a:c.Pt.X>d.Pt.X?b:c.Next==c?b:d.Next==d?a:this.FirstIsBottomPt(c,d)?a:b},r.Clipper.prototype.Param1RightOfParam2=function(a,b){do if(a=a.FirstLeft,a==b)return!0;while(null!==a);return!1},r.Clipper.prototype.GetOutRec=function(a){for(a=this.m_PolyOuts[a];a!=this.m_PolyOuts[a.Idx];)a=this.m_PolyOuts[a.Idx];return a},r.Clipper.prototype.AppendPolygon=function(a,b){var c,d=this.m_PolyOuts[a.OutIdx],e=this.m_PolyOuts[b.OutIdx];c=this.Param1RightOfParam2(d,e)?e:this.Param1RightOfParam2(e,d)?d:this.GetLowermostRec(d,e);var f=d.Pts,g=f.Prev,h=e.Pts,i=h.Prev;for(a.Side==r.EdgeSide.esLeft?(b.Side==r.EdgeSide.esLeft?(this.ReversePolyPtLinks(h),h.Next=f,f.Prev=h,g.Next=i,i.Prev=g,d.Pts=i):(i.Next=f,f.Prev=i,h.Prev=g,g.Next=h,d.Pts=h),f=r.EdgeSide.esLeft):(b.Side==r.EdgeSide.esRight?(this.ReversePolyPtLinks(h),g.Next=i,i.Prev=g,h.Next=f,f.Prev=h):(g.Next=h,h.Prev=g,f.Prev=i,i.Next=f),f=r.EdgeSide.esRight),d.BottomPt=null,c==e&&(e.FirstLeft!=d&&(d.FirstLeft=e.FirstLeft),d.IsHole=e.IsHole),e.Pts=null,e.BottomPt=null,e.FirstLeft=d,c=a.OutIdx,g=b.OutIdx,a.OutIdx=-1,b.OutIdx=-1,h=this.m_ActiveEdges;null!==h;){if(h.OutIdx==g){h.OutIdx=c,h.Side=f;break}h=h.NextInAEL}e.Idx=d.Idx},r.Clipper.prototype.ReversePolyPtLinks=function(a){if(null!==a){var b,c;b=a;do c=b.Next,b.Next=b.Prev,b=b.Prev=c;while(b!=a)}},r.Clipper.SwapSides=function(a,b){var c=a.Side;a.Side=b.Side,b.Side=c},r.Clipper.SwapPolyIndexes=function(a,b){var c=a.OutIdx;a.OutIdx=b.OutIdx,b.OutIdx=c},r.Clipper.prototype.IntersectEdges=function(a,b,c,d){var e=!d&&null===a.NextInLML&&a.Top.X==c.X&&a.Top.Y==c.Y;d=!d&&null===b.NextInLML&&b.Top.X==c.X&&b.Top.Y==c.Y;var f=0<=a.OutIdx,g=0<=b.OutIdx;if(0===a.WindDelta||0===b.WindDelta)0===a.WindDelta&&0===b.WindDelta?(e||d)&&f&&g&&this.AddLocalMaxPoly(a,b,c):a.PolyTyp==b.PolyTyp&&a.WindDelta!=b.WindDelta&&this.m_ClipType==r.ClipType.ctUnion?0===a.WindDelta?g&&(this.AddOutPt(a,c),f&&(a.OutIdx=-1)):f&&(this.AddOutPt(b,c),g&&(b.OutIdx=-1)):a.PolyTyp!=b.PolyTyp&&(0!==a.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==r.ClipType.ctUnion&&0!==b.WindCnt2?0!==b.WindDelta||1!=Math.abs(a.WindCnt)||this.m_ClipType==r.ClipType.ctUnion&&0!==a.WindCnt2||(this.AddOutPt(b,c),g&&(b.OutIdx=-1)):(this.AddOutPt(a,c),f&&(a.OutIdx=-1))),e&&(0>a.OutIdx?this.DeleteFromAEL(a):r.Error("Error intersecting polylines")),d&&(0>b.OutIdx?this.DeleteFromAEL(b):r.Error("Error intersecting polylines"));else{if(a.PolyTyp==b.PolyTyp)if(this.IsEvenOddFillType(a)){var h=a.WindCnt;a.WindCnt=b.WindCnt,b.WindCnt=h}else a.WindCnt=0===a.WindCnt+b.WindDelta?-a.WindCnt:a.WindCnt+b.WindDelta,b.WindCnt=0===b.WindCnt-a.WindDelta?-b.WindCnt:b.WindCnt-a.WindDelta;else this.IsEvenOddFillType(b)?a.WindCnt2=0===a.WindCnt2?1:0:a.WindCnt2+=b.WindDelta,this.IsEvenOddFillType(a)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2-=a.WindDelta;var i,j,k;switch(a.PolyTyp==r.PolyType.ptSubject?(i=this.m_SubjFillType,k=this.m_ClipFillType):(i=this.m_ClipFillType,k=this.m_SubjFillType),b.PolyTyp==r.PolyType.ptSubject?(j=this.m_SubjFillType,h=this.m_ClipFillType):(j=this.m_ClipFillType,h=this.m_SubjFillType),i){case r.PolyFillType.pftPositive:i=a.WindCnt;break;case r.PolyFillType.pftNegative:i=-a.WindCnt;break;default:i=Math.abs(a.WindCnt)}switch(j){case r.PolyFillType.pftPositive:j=b.WindCnt;break;case r.PolyFillType.pftNegative:j=-b.WindCnt;break;default:j=Math.abs(b.WindCnt)}if(f&&g)e||d||0!==i&&1!=i||0!==j&&1!=j||a.PolyTyp!=b.PolyTyp&&this.m_ClipType!=r.ClipType.ctXor?this.AddLocalMaxPoly(a,b,c):(this.AddOutPt(a,c),this.AddOutPt(b,c),r.Clipper.SwapSides(a,b),r.Clipper.SwapPolyIndexes(a,b));else if(f)(0===j||1==j)&&(this.AddOutPt(a,c),r.Clipper.SwapSides(a,b),r.Clipper.SwapPolyIndexes(a,b));else if(g)(0===i||1==i)&&(this.AddOutPt(b,c),r.Clipper.SwapSides(a,b),r.Clipper.SwapPolyIndexes(a,b));else if(!(0!==i&&1!=i||0!==j&&1!=j||e||d)){switch(k){case r.PolyFillType.pftPositive:f=a.WindCnt2;break;case r.PolyFillType.pftNegative:f=-a.WindCnt2;break;default:f=Math.abs(a.WindCnt2)}switch(h){case r.PolyFillType.pftPositive:g=b.WindCnt2;break;case r.PolyFillType.pftNegative:g=-b.WindCnt2;break;default:g=Math.abs(b.WindCnt2)}if(a.PolyTyp!=b.PolyTyp)this.AddLocalMinPoly(a,b,c);else if(1==i&&1==j)switch(this.m_ClipType){case r.ClipType.ctIntersection:f>0&&g>0&&this.AddLocalMinPoly(a,b,c);break;case r.ClipType.ctUnion:0>=f&&0>=g&&this.AddLocalMinPoly(a,b,c);break;case r.ClipType.ctDifference:(a.PolyTyp==r.PolyType.ptClip&&f>0&&g>0||a.PolyTyp==r.PolyType.ptSubject&&0>=f&&0>=g)&&this.AddLocalMinPoly(a,b,c);break;case r.ClipType.ctXor:this.AddLocalMinPoly(a,b,c)}else r.Clipper.SwapSides(a,b)}e!=d&&(e&&0<=a.OutIdx||d&&0<=b.OutIdx)&&(r.Clipper.SwapSides(a,b),r.Clipper.SwapPolyIndexes(a,b)),e&&this.DeleteFromAEL(a),d&&this.DeleteFromAEL(b)}},r.Clipper.prototype.DeleteFromAEL=function(a){var b=a.PrevInAEL,c=a.NextInAEL;(null!==b||null!==c||a==this.m_ActiveEdges)&&(null!==b?b.NextInAEL=c:this.m_ActiveEdges=c,null!==c&&(c.PrevInAEL=b),a.NextInAEL=null,a.PrevInAEL=null)},r.Clipper.prototype.DeleteFromSEL=function(a){var b=a.PrevInSEL,c=a.NextInSEL;(null!==b||null!==c||a==this.m_SortedEdges)&&(null!==b?b.NextInSEL=c:this.m_SortedEdges=c,null!==c&&(c.PrevInSEL=b),a.NextInSEL=null,a.PrevInSEL=null)},r.Clipper.prototype.UpdateEdgeIntoAEL=function(a){null===a.NextInLML&&r.Error("UpdateEdgeIntoAEL: invalid call");var b=a.PrevInAEL,c=a.NextInAEL;return a.NextInLML.OutIdx=a.OutIdx,null!==b?b.NextInAEL=a.NextInLML:this.m_ActiveEdges=a.NextInLML,null!==c&&(c.PrevInAEL=a.NextInLML),a.NextInLML.Side=a.Side,a.NextInLML.WindDelta=a.WindDelta,a.NextInLML.WindCnt=a.WindCnt,a.NextInLML.WindCnt2=a.WindCnt2,a=a.NextInLML,a.Curr.X=a.Bot.X,a.Curr.Y=a.Bot.Y,a.PrevInAEL=b,a.NextInAEL=c,r.ClipperBase.IsHorizontal(a)||this.InsertScanbeam(a.Top.Y),a},r.Clipper.prototype.ProcessHorizontals=function(a){for(var b=this.m_SortedEdges;null!==b;)this.DeleteFromSEL(b),this.ProcessHorizontal(b,a),b=this.m_SortedEdges},r.Clipper.prototype.GetHorzDirection=function(a,b){a.Bot.X<a.Top.X?(b.Left=a.Bot.X,b.Right=a.Top.X,b.Dir=r.Direction.dLeftToRight):(b.Left=a.Top.X,b.Right=a.Bot.X,b.Dir=r.Direction.dRightToLeft)},r.Clipper.prototype.PrepareHorzJoins=function(a,b){var c=this.m_PolyOuts[a.OutIdx].Pts;a.Side!=r.EdgeSide.esLeft&&(c=c.Prev),b&&(r.IntPoint.op_Equality(c.Pt,a.Top)?this.AddGhostJoin(c,a.Bot):this.AddGhostJoin(c,a.Top))},r.Clipper.prototype.ProcessHorizontal=function(a,b){var c={Dir:null,Left:null,Right:null};this.GetHorzDirection(a,c);for(var d=c.Dir,e=c.Left,f=c.Right,g=a,h=null;null!==g.NextInLML&&r.ClipperBase.IsHorizontal(g.NextInLML);)g=g.NextInLML;for(null===g.NextInLML&&(h=this.GetMaximaPair(g));;){for(var i=a==g,j=this.GetNextInAEL(a,d);null!==j&&!(j.Curr.X==a.Top.X&&null!==a.NextInLML&&j.Dx<a.NextInLML.Dx);){if(c=this.GetNextInAEL(j,d),d==r.Direction.dLeftToRight&&j.Curr.X<=f||d==r.Direction.dRightToLeft&&j.Curr.X>=e){if(0<=a.OutIdx&&0!=a.WindDelta&&this.PrepareHorzJoins(a,b),j==h&&i)return d==r.Direction.dLeftToRight?this.IntersectEdges(a,j,j.Top,!1):this.IntersectEdges(j,a,j.Top,!1),void(0<=h.OutIdx&&r.Error("ProcessHorizontal error"));if(d==r.Direction.dLeftToRight){var k=new r.IntPoint(j.Curr.X,a.Curr.Y);this.IntersectEdges(a,j,k,!0)}else k=new r.IntPoint(j.Curr.X,a.Curr.Y),this.IntersectEdges(j,a,k,!0);this.SwapPositionsInAEL(a,j)}else if(d==r.Direction.dLeftToRight&&j.Curr.X>=f||d==r.Direction.dRightToLeft&&j.Curr.X<=e)break;j=c}if(0<=a.OutIdx&&0!==a.WindDelta&&this.PrepareHorzJoins(a,b),null===a.NextInLML||!r.ClipperBase.IsHorizontal(a.NextInLML))break;a=this.UpdateEdgeIntoAEL(a),0<=a.OutIdx&&this.AddOutPt(a,a.Bot),c={Dir:d,Left:e,Right:f},this.GetHorzDirection(a,c),d=c.Dir,e=c.Left,f=c.Right}null!==a.NextInLML?0<=a.OutIdx?(d=this.AddOutPt(a,a.Top),a=this.UpdateEdgeIntoAEL(a),0!==a.WindDelta&&(e=a.PrevInAEL,c=a.NextInAEL,null!==e&&e.Curr.X==a.Bot.X&&e.Curr.Y==a.Bot.Y&&0!==e.WindDelta&&0<=e.OutIdx&&e.Curr.Y>e.Top.Y&&r.ClipperBase.SlopesEqual(a,e,this.m_UseFullRange)?(c=this.AddOutPt(e,a.Bot),this.AddJoin(d,c,a.Top)):null!==c&&c.Curr.X==a.Bot.X&&c.Curr.Y==a.Bot.Y&&0!==c.WindDelta&&0<=c.OutIdx&&c.Curr.Y>c.Top.Y&&r.ClipperBase.SlopesEqual(a,c,this.m_UseFullRange)&&(c=this.AddOutPt(c,a.Bot),this.AddJoin(d,c,a.Top)))):this.UpdateEdgeIntoAEL(a):null!==h?0<=h.OutIdx?(d==r.Direction.dLeftToRight?this.IntersectEdges(a,h,a.Top,!1):this.IntersectEdges(h,a,a.Top,!1),0<=h.OutIdx&&r.Error("ProcessHorizontal error")):(this.DeleteFromAEL(a),this.DeleteFromAEL(h)):(0<=a.OutIdx&&this.AddOutPt(a,a.Top),this.DeleteFromAEL(a))
},r.Clipper.prototype.GetNextInAEL=function(a,b){return b==r.Direction.dLeftToRight?a.NextInAEL:a.PrevInAEL},r.Clipper.prototype.IsMinima=function(a){return null!==a&&a.Prev.NextInLML!=a&&a.Next.NextInLML!=a},r.Clipper.prototype.IsMaxima=function(a,b){return null!==a&&a.Top.Y==b&&null===a.NextInLML},r.Clipper.prototype.IsIntermediate=function(a,b){return a.Top.Y==b&&null!==a.NextInLML},r.Clipper.prototype.GetMaximaPair=function(a){var b=null;return r.IntPoint.op_Equality(a.Next.Top,a.Top)&&null===a.Next.NextInLML?b=a.Next:r.IntPoint.op_Equality(a.Prev.Top,a.Top)&&null===a.Prev.NextInLML&&(b=a.Prev),null===b||-2!=b.OutIdx&&(b.NextInAEL!=b.PrevInAEL||r.ClipperBase.IsHorizontal(b))?b:null},r.Clipper.prototype.ProcessIntersections=function(a,b){if(null==this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(a,b),0==this.m_IntersectList.length)return!0;if(1!=this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(c){this.m_SortedEdges=null,this.m_IntersectList.length=0,r.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},r.Clipper.prototype.BuildIntersectList=function(a,b){if(null!==this.m_ActiveEdges){var c=this.m_ActiveEdges;for(this.m_SortedEdges=c;null!==c;)c.PrevInSEL=c.PrevInAEL,c.NextInSEL=c.NextInAEL,c.Curr.X=r.Clipper.TopX(c,b),c=c.NextInAEL;for(var d=!0;d&&null!==this.m_SortedEdges;){for(d=!1,c=this.m_SortedEdges;null!==c.NextInSEL;){var e=c.NextInSEL,f=new r.IntPoint;c.Curr.X>e.Curr.X?(!this.IntersectPoint(c,e,f)&&c.Curr.X>e.Curr.X+1&&r.Error("Intersection error"),f.Y>a&&(f.Y=a,f.X=Math.abs(c.Dx)>Math.abs(e.Dx)?r.Clipper.TopX(e,a):r.Clipper.TopX(c,a)),d=new r.IntersectNode,d.Edge1=c,d.Edge2=e,d.Pt.X=f.X,d.Pt.Y=f.Y,this.m_IntersectList.push(d),this.SwapPositionsInSEL(c,e),d=!0):c=e}if(null===c.PrevInSEL)break;c.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},r.Clipper.prototype.EdgesAdjacent=function(a){return a.Edge1.NextInSEL==a.Edge2||a.Edge1.PrevInSEL==a.Edge2},r.Clipper.IntersectNodeSort=function(a,b){return b.Pt.Y-a.Pt.Y},r.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var a=this.m_IntersectList.length,b=0;a>b;b++){if(!this.EdgesAdjacent(this.m_IntersectList[b])){for(var c=b+1;a>c&&!this.EdgesAdjacent(this.m_IntersectList[c]);)c++;if(c==a)return!1;var d=this.m_IntersectList[b];this.m_IntersectList[b]=this.m_IntersectList[c],this.m_IntersectList[c]=d}this.SwapPositionsInSEL(this.m_IntersectList[b].Edge1,this.m_IntersectList[b].Edge2)}return!0},r.Clipper.prototype.ProcessIntersectList=function(){for(var a=0,b=this.m_IntersectList.length;b>a;a++){var c=this.m_IntersectList[a];this.IntersectEdges(c.Edge1,c.Edge2,c.Pt,!0),this.SwapPositionsInAEL(c.Edge1,c.Edge2)}this.m_IntersectList.length=0},v=function(a){return 0>a?Math.ceil(a-.5):Math.round(a)},x=function(a){return 0>a?Math.ceil(a-.5):Math.floor(a+.5)},y=function(a){return 0>a?-Math.round(Math.abs(a)):Math.round(a)},z=function(a){return 0>a?(a-=.5,-2147483648>a?Math.ceil(a):0|a):(a+=.5,a>2147483647?Math.floor(a):0|a)},r.Clipper.Round=u?v:s?y:w?z:x,r.Clipper.TopX=function(a,b){return b==a.Top.Y?a.Top.X:a.Bot.X+r.Clipper.Round(a.Dx*(b-a.Bot.Y))},r.Clipper.prototype.IntersectPoint=function(a,b,c){c.X=0,c.Y=0;var d,e;if(r.ClipperBase.SlopesEqual(a,b,this.m_UseFullRange)||a.Dx==b.Dx)return b.Bot.Y>a.Bot.Y?(c.X=b.Bot.X,c.Y=b.Bot.Y):(c.X=a.Bot.X,c.Y=a.Bot.Y),!1;if(0===a.Delta.X)c.X=a.Bot.X,r.ClipperBase.IsHorizontal(b)?c.Y=b.Bot.Y:(e=b.Bot.Y-b.Bot.X/b.Dx,c.Y=r.Clipper.Round(c.X/b.Dx+e));else if(0===b.Delta.X)c.X=b.Bot.X,r.ClipperBase.IsHorizontal(a)?c.Y=a.Bot.Y:(d=a.Bot.Y-a.Bot.X/a.Dx,c.Y=r.Clipper.Round(c.X/a.Dx+d));else{d=a.Bot.X-a.Bot.Y*a.Dx,e=b.Bot.X-b.Bot.Y*b.Dx;var f=(e-d)/(a.Dx-b.Dx);c.Y=r.Clipper.Round(f),c.X=r.Clipper.Round(Math.abs(a.Dx)<Math.abs(b.Dx)?a.Dx*f+d:b.Dx*f+e)}if(c.Y<a.Top.Y||c.Y<b.Top.Y){if(a.Top.Y>b.Top.Y)return c.Y=a.Top.Y,c.X=r.Clipper.TopX(b,a.Top.Y),c.X<a.Top.X;c.Y=b.Top.Y,c.X=Math.abs(a.Dx)<Math.abs(b.Dx)?r.Clipper.TopX(a,c.Y):r.Clipper.TopX(b,c.Y)}return!0},r.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(a){for(var b=this.m_ActiveEdges;null!==b;){var c=this.IsMaxima(b,a);if(c&&(c=this.GetMaximaPair(b),c=null===c||!r.ClipperBase.IsHorizontal(c)),c){var d=b.PrevInAEL;this.DoMaxima(b),b=null===d?this.m_ActiveEdges:d.NextInAEL}else this.IsIntermediate(b,a)&&r.ClipperBase.IsHorizontal(b.NextInLML)?(b=this.UpdateEdgeIntoAEL(b),0<=b.OutIdx&&this.AddOutPt(b,b.Bot),this.AddEdgeToSEL(b)):(b.Curr.X=r.Clipper.TopX(b,a),b.Curr.Y=a),this.StrictlySimple&&(d=b.PrevInAEL,0<=b.OutIdx&&0!==b.WindDelta&&null!==d&&0<=d.OutIdx&&d.Curr.X==b.Curr.X&&0!==d.WindDelta&&(c=this.AddOutPt(d,b.Curr),d=this.AddOutPt(b,b.Curr),this.AddJoin(c,d,b.Curr))),b=b.NextInAEL}for(this.ProcessHorizontals(!0),b=this.m_ActiveEdges;null!==b;){if(this.IsIntermediate(b,a)){c=null,0<=b.OutIdx&&(c=this.AddOutPt(b,b.Top));var b=this.UpdateEdgeIntoAEL(b),d=b.PrevInAEL,e=b.NextInAEL;null!==d&&d.Curr.X==b.Bot.X&&d.Curr.Y==b.Bot.Y&&null!==c&&0<=d.OutIdx&&d.Curr.Y>d.Top.Y&&r.ClipperBase.SlopesEqual(b,d,this.m_UseFullRange)&&0!==b.WindDelta&&0!==d.WindDelta?(d=this.AddOutPt(d,b.Bot),this.AddJoin(c,d,b.Top)):null!==e&&e.Curr.X==b.Bot.X&&e.Curr.Y==b.Bot.Y&&null!==c&&0<=e.OutIdx&&e.Curr.Y>e.Top.Y&&r.ClipperBase.SlopesEqual(b,e,this.m_UseFullRange)&&0!==b.WindDelta&&0!==e.WindDelta&&(d=this.AddOutPt(e,b.Bot),this.AddJoin(c,d,b.Top))}b=b.NextInAEL}},r.Clipper.prototype.DoMaxima=function(a){var b=this.GetMaximaPair(a);if(null===b)0<=a.OutIdx&&this.AddOutPt(a,a.Top),this.DeleteFromAEL(a);else{for(var c=a.NextInAEL;null!==c&&c!=b;)this.IntersectEdges(a,c,a.Top,!0),this.SwapPositionsInAEL(a,c),c=a.NextInAEL;-1==a.OutIdx&&-1==b.OutIdx?(this.DeleteFromAEL(a),this.DeleteFromAEL(b)):0<=a.OutIdx&&0<=b.OutIdx?this.IntersectEdges(a,b,a.Top,!1):0===a.WindDelta?(0<=a.OutIdx&&(this.AddOutPt(a,a.Top),a.OutIdx=-1),this.DeleteFromAEL(a),0<=b.OutIdx&&(this.AddOutPt(b,a.Top),b.OutIdx=-1),this.DeleteFromAEL(b)):r.Error("DoMaxima error")}},r.Clipper.ReversePaths=function(a){for(var b=0,c=a.length;c>b;b++)a[b].reverse()},r.Clipper.Orientation=function(a){return 0<=r.Clipper.Area(a)},r.Clipper.prototype.PointCount=function(a){if(null===a)return 0;var b=0,c=a;do b++,c=c.Next;while(c!=a);return b},r.Clipper.prototype.BuildResult=function(a){r.Clear(a);for(var b=0,c=this.m_PolyOuts.length;c>b;b++){var d=this.m_PolyOuts[b];if(null!==d.Pts){var d=d.Pts.Prev,e=this.PointCount(d);if(!(2>e)){for(var f=Array(e),g=0;e>g;g++)f[g]=d.Pt,d=d.Prev;a.push(f)}}}},r.Clipper.prototype.BuildResult2=function(a){a.Clear();for(var b=0,c=this.m_PolyOuts.length;c>b;b++){var d=this.m_PolyOuts[b],e=this.PointCount(d.Pts);if(!(d.IsOpen&&2>e||!d.IsOpen&&3>e)){this.FixHoleLinkage(d);var f=new r.PolyNode;a.m_AllPolys.push(f),d.PolyNode=f,f.m_polygon.length=e;for(var d=d.Pts.Prev,g=0;e>g;g++)f.m_polygon[g]=d.Pt,d=d.Prev}}for(b=0,c=this.m_PolyOuts.length;c>b;b++)d=this.m_PolyOuts[b],null!==d.PolyNode&&(d.IsOpen?(d.PolyNode.IsOpen=!0,a.AddChild(d.PolyNode)):null!==d.FirstLeft&&null!=d.FirstLeft.PolyNode?d.FirstLeft.PolyNode.AddChild(d.PolyNode):a.AddChild(d.PolyNode))},r.Clipper.prototype.FixupOutPolygon=function(a){var b=null;a.BottomPt=null;for(var c=a.Pts;;){if(c.Prev==c||c.Prev==c.Next)return this.DisposeOutPts(c),void(a.Pts=null);if(r.IntPoint.op_Equality(c.Pt,c.Next.Pt)||r.IntPoint.op_Equality(c.Pt,c.Prev.Pt)||r.ClipperBase.SlopesEqual(c.Prev.Pt,c.Pt,c.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(c.Prev.Pt,c.Pt,c.Next.Pt)))b=null,c.Prev.Next=c.Next,c=c.Next.Prev=c.Prev;else{if(c==b)break;null===b&&(b=c),c=c.Next}}a.Pts=c},r.Clipper.prototype.DupOutPt=function(a,b){var c=new r.OutPt;return c.Pt.X=a.Pt.X,c.Pt.Y=a.Pt.Y,c.Idx=a.Idx,b?(c.Next=a.Next,c.Prev=a,a.Next.Prev=c,a.Next=c):(c.Prev=a.Prev,c.Next=a,a.Prev.Next=c,a.Prev=c),c},r.Clipper.prototype.GetOverlap=function(a,b,c,d,e){return b>a?d>c?(e.Left=Math.max(a,c),e.Right=Math.min(b,d)):(e.Left=Math.max(a,d),e.Right=Math.min(b,c)):d>c?(e.Left=Math.max(b,c),e.Right=Math.min(a,d)):(e.Left=Math.max(b,d),e.Right=Math.min(a,c)),e.Left<e.Right},r.Clipper.prototype.JoinHorz=function(a,b,c,d,e,f){var g=a.Pt.X>b.Pt.X?r.Direction.dRightToLeft:r.Direction.dLeftToRight;if(d=c.Pt.X>d.Pt.X?r.Direction.dRightToLeft:r.Direction.dLeftToRight,g==d)return!1;if(g==r.Direction.dLeftToRight){for(;a.Next.Pt.X<=e.X&&a.Next.Pt.X>=a.Pt.X&&a.Next.Pt.Y==e.Y;)a=a.Next;f&&a.Pt.X!=e.X&&(a=a.Next),b=this.DupOutPt(a,!f),r.IntPoint.op_Inequality(b.Pt,e)&&(a=b,a.Pt.X=e.X,a.Pt.Y=e.Y,b=this.DupOutPt(a,!f))}else{for(;a.Next.Pt.X>=e.X&&a.Next.Pt.X<=a.Pt.X&&a.Next.Pt.Y==e.Y;)a=a.Next;f||a.Pt.X==e.X||(a=a.Next),b=this.DupOutPt(a,f),r.IntPoint.op_Inequality(b.Pt,e)&&(a=b,a.Pt.X=e.X,a.Pt.Y=e.Y,b=this.DupOutPt(a,f))}if(d==r.Direction.dLeftToRight){for(;c.Next.Pt.X<=e.X&&c.Next.Pt.X>=c.Pt.X&&c.Next.Pt.Y==e.Y;)c=c.Next;f&&c.Pt.X!=e.X&&(c=c.Next),d=this.DupOutPt(c,!f),r.IntPoint.op_Inequality(d.Pt,e)&&(c=d,c.Pt.X=e.X,c.Pt.Y=e.Y,d=this.DupOutPt(c,!f))}else{for(;c.Next.Pt.X>=e.X&&c.Next.Pt.X<=c.Pt.X&&c.Next.Pt.Y==e.Y;)c=c.Next;f||c.Pt.X==e.X||(c=c.Next),d=this.DupOutPt(c,f),r.IntPoint.op_Inequality(d.Pt,e)&&(c=d,c.Pt.X=e.X,c.Pt.Y=e.Y,d=this.DupOutPt(c,f))}return g==r.Direction.dLeftToRight==f?(a.Prev=c,c.Next=a,b.Next=d,d.Prev=b):(a.Next=c,c.Prev=a,b.Prev=d,d.Next=b),!0},r.Clipper.prototype.JoinPoints=function(a,b,c){var d=a.OutPt1,e=new r.OutPt,f=a.OutPt2,g=new r.OutPt;if((g=a.OutPt1.Pt.Y==a.OffPt.Y)&&r.IntPoint.op_Equality(a.OffPt,a.OutPt1.Pt)&&r.IntPoint.op_Equality(a.OffPt,a.OutPt2.Pt)){for(e=a.OutPt1.Next;e!=d&&r.IntPoint.op_Equality(e.Pt,a.OffPt);)e=e.Next;for(e=e.Pt.Y>a.OffPt.Y,g=a.OutPt2.Next;g!=f&&r.IntPoint.op_Equality(g.Pt,a.OffPt);)g=g.Next;return e==g.Pt.Y>a.OffPt.Y?!1:(e?(e=this.DupOutPt(d,!1),g=this.DupOutPt(f,!0),d.Prev=f,f.Next=d,e.Next=g,g.Prev=e):(e=this.DupOutPt(d,!0),g=this.DupOutPt(f,!1),d.Next=f,f.Prev=d,e.Prev=g,g.Next=e),a.OutPt1=d,a.OutPt2=e,!0)}if(g){for(e=d;d.Prev.Pt.Y==d.Pt.Y&&d.Prev!=e&&d.Prev!=f;)d=d.Prev;for(;e.Next.Pt.Y==e.Pt.Y&&e.Next!=d&&e.Next!=f;)e=e.Next;if(e.Next==d||e.Next==f)return!1;for(g=f;f.Prev.Pt.Y==f.Pt.Y&&f.Prev!=g&&f.Prev!=e;)f=f.Prev;for(;g.Next.Pt.Y==g.Pt.Y&&g.Next!=f&&g.Next!=d;)g=g.Next;if(g.Next==f||g.Next==d)return!1;if(c={Left:null,Right:null},!this.GetOverlap(d.Pt.X,e.Pt.X,f.Pt.X,g.Pt.X,c))return!1;b=c.Left;var h=c.Right;return c=new r.IntPoint,d.Pt.X>=b&&d.Pt.X<=h?(c.X=d.Pt.X,c.Y=d.Pt.Y,b=d.Pt.X>e.Pt.X):f.Pt.X>=b&&f.Pt.X<=h?(c.X=f.Pt.X,c.Y=f.Pt.Y,b=f.Pt.X>g.Pt.X):e.Pt.X>=b&&e.Pt.X<=h?(c.X=e.Pt.X,c.Y=e.Pt.Y,b=e.Pt.X>d.Pt.X):(c.X=g.Pt.X,c.Y=g.Pt.Y,b=g.Pt.X>f.Pt.X),a.OutPt1=d,a.OutPt2=f,this.JoinHorz(d,e,f,g,c,b)}for(e=d.Next;r.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Next;if(h=e.Pt.Y>d.Pt.Y||!r.ClipperBase.SlopesEqual(d.Pt,e.Pt,a.OffPt,this.m_UseFullRange)){for(e=d.Prev;r.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Prev;if(e.Pt.Y>d.Pt.Y||!r.ClipperBase.SlopesEqual(d.Pt,e.Pt,a.OffPt,this.m_UseFullRange))return!1}for(g=f.Next;r.IntPoint.op_Equality(g.Pt,f.Pt)&&g!=f;)g=g.Next;var i=g.Pt.Y>f.Pt.Y||!r.ClipperBase.SlopesEqual(f.Pt,g.Pt,a.OffPt,this.m_UseFullRange);if(i){for(g=f.Prev;r.IntPoint.op_Equality(g.Pt,f.Pt)&&g!=f;)g=g.Prev;if(g.Pt.Y>f.Pt.Y||!r.ClipperBase.SlopesEqual(f.Pt,g.Pt,a.OffPt,this.m_UseFullRange))return!1}return e==d||g==f||e==g||b==c&&h==i?!1:(h?(e=this.DupOutPt(d,!1),g=this.DupOutPt(f,!0),d.Prev=f,f.Next=d,e.Next=g,g.Prev=e):(e=this.DupOutPt(d,!0),g=this.DupOutPt(f,!1),d.Next=f,f.Prev=d,e.Prev=g,g.Next=e),a.OutPt1=d,a.OutPt2=e,!0)},r.Clipper.GetBounds=function(a){for(var b=0,c=a.length;c>b&&0==a[b].length;)b++;if(b==c)return new r.IntRect(0,0,0,0);var d=new r.IntRect;for(d.left=a[b][0].X,d.right=d.left,d.top=a[b][0].Y,d.bottom=d.top;c>b;b++)for(var e=0,f=a[b].length;f>e;e++)a[b][e].X<d.left?d.left=a[b][e].X:a[b][e].X>d.right&&(d.right=a[b][e].X),a[b][e].Y<d.top?d.top=a[b][e].Y:a[b][e].Y>d.bottom&&(d.bottom=a[b][e].Y);return d},r.Clipper.prototype.GetBounds2=function(a){var b=a,c=new r.IntRect;for(c.left=a.Pt.X,c.right=a.Pt.X,c.top=a.Pt.Y,c.bottom=a.Pt.Y,a=a.Next;a!=b;)a.Pt.X<c.left&&(c.left=a.Pt.X),a.Pt.X>c.right&&(c.right=a.Pt.X),a.Pt.Y<c.top&&(c.top=a.Pt.Y),a.Pt.Y>c.bottom&&(c.bottom=a.Pt.Y),a=a.Next;return c},r.Clipper.PointInPolygon=function(a,b){var c=0,d=b.length;if(3>d)return 0;for(var e=b[0],f=1;d>=f;++f){var g=f==d?b[0]:b[f];if(g.Y==a.Y&&(g.X==a.X||e.Y==a.Y&&g.X>a.X==e.X<a.X))return-1;if(e.Y<a.Y!=g.Y<a.Y)if(e.X>=a.X)if(g.X>a.X)c=1-c;else{var h=(e.X-a.X)*(g.Y-a.Y)-(g.X-a.X)*(e.Y-a.Y);if(0==h)return-1;h>0==g.Y>e.Y&&(c=1-c)}else if(g.X>a.X){if(h=(e.X-a.X)*(g.Y-a.Y)-(g.X-a.X)*(e.Y-a.Y),0==h)return-1;h>0==g.Y>e.Y&&(c=1-c)}e=g}return c},r.Clipper.prototype.PointInPolygon=function(a,b){for(var c=0,d=b;;){var e=b.Pt.X,f=b.Pt.Y,g=b.Next.Pt.X,h=b.Next.Pt.Y;if(h==a.Y&&(g==a.X||f==a.Y&&g>a.X==e<a.X))return-1;if(f<a.Y!=h<a.Y)if(e>=a.X)if(g>a.X)c=1-c;else{if(e=(e-a.X)*(h-a.Y)-(g-a.X)*(f-a.Y),0==e)return-1;e>0==h>f&&(c=1-c)}else if(g>a.X){if(e=(e-a.X)*(h-a.Y)-(g-a.X)*(f-a.Y),0==e)return-1;e>0==h>f&&(c=1-c)}if(b=b.Next,d==b)break}return c},r.Clipper.prototype.Poly2ContainsPoly1=function(a,b){var c=a;do{var d=this.PointInPolygon(c.Pt,b);if(d>=0)return 0!=d;c=c.Next}while(c!=a);return!0},r.Clipper.prototype.FixupFirstLefts1=function(a,b){for(var c=0,d=this.m_PolyOuts.length;d>c;c++){var e=this.m_PolyOuts[c];null!==e.Pts&&e.FirstLeft==a&&this.Poly2ContainsPoly1(e.Pts,b.Pts)&&(e.FirstLeft=b)}},r.Clipper.prototype.FixupFirstLefts2=function(a,b){for(var c=0,d=this.m_PolyOuts,e=d.length,f=d[c];e>c;c++,f=d[c])f.FirstLeft==a&&(f.FirstLeft=b)},r.Clipper.ParseFirstLeft=function(a){for(;null!=a&&null==a.Pts;)a=a.FirstLeft;return a},r.Clipper.prototype.JoinCommonEdges=function(){for(var a=0,b=this.m_Joins.length;b>a;a++){var c=this.m_Joins[a],d=this.GetOutRec(c.OutPt1.Idx),e=this.GetOutRec(c.OutPt2.Idx);if(null!=d.Pts&&null!=e.Pts){var f;if(f=d==e?d:this.Param1RightOfParam2(d,e)?e:this.Param1RightOfParam2(e,d)?d:this.GetLowermostRec(d,e),this.JoinPoints(c,d,e))if(d==e){if(d.Pts=c.OutPt1,d.BottomPt=null,e=this.CreateOutRec(),e.Pts=c.OutPt2,this.UpdateOutPtIdxs(e),this.m_UsingPolyTree){f=0;for(var g=this.m_PolyOuts.length;g-1>f;f++){var h=this.m_PolyOuts[f];null!=h.Pts&&r.Clipper.ParseFirstLeft(h.FirstLeft)==d&&h.IsHole!=d.IsHole&&this.Poly2ContainsPoly1(h.Pts,c.OutPt2)&&(h.FirstLeft=e)}}this.Poly2ContainsPoly1(e.Pts,d.Pts)?(e.IsHole=!d.IsHole,e.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,d),(e.IsHole^this.ReverseSolution)==0<this.Area(e)&&this.ReversePolyPtLinks(e.Pts)):this.Poly2ContainsPoly1(d.Pts,e.Pts)?(e.IsHole=d.IsHole,d.IsHole=!e.IsHole,e.FirstLeft=d.FirstLeft,d.FirstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(d,e),(d.IsHole^this.ReverseSolution)==0<this.Area(d)&&this.ReversePolyPtLinks(d.Pts)):(e.IsHole=d.IsHole,e.FirstLeft=d.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(d,e))}else e.Pts=null,e.BottomPt=null,e.Idx=d.Idx,d.IsHole=f.IsHole,f==e&&(d.FirstLeft=e.FirstLeft),e.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,d)}}},r.Clipper.prototype.UpdateOutPtIdxs=function(a){var b=a.Pts;do b.Idx=a.Idx,b=b.Prev;while(b!=a.Pts)},r.Clipper.prototype.DoSimplePolygons=function(){for(var a=0;a<this.m_PolyOuts.length;){var b=this.m_PolyOuts[a++],c=b.Pts;if(null!==c)do{for(var d=c.Next;d!=b.Pts;){if(r.IntPoint.op_Equality(c.Pt,d.Pt)&&d.Next!=c&&d.Prev!=c){var e=c.Prev,f=d.Prev;c.Prev=f,f.Next=c,d.Prev=e,e.Next=d,b.Pts=c,e=this.CreateOutRec(),e.Pts=d,this.UpdateOutPtIdxs(e),this.Poly2ContainsPoly1(e.Pts,b.Pts)?(e.IsHole=!b.IsHole,e.FirstLeft=b):this.Poly2ContainsPoly1(b.Pts,e.Pts)?(e.IsHole=b.IsHole,b.IsHole=!e.IsHole,e.FirstLeft=b.FirstLeft,b.FirstLeft=e):(e.IsHole=b.IsHole,e.FirstLeft=b.FirstLeft),d=c}d=d.Next}c=c.Next}while(c!=b.Pts)}},r.Clipper.Area=function(a){var b=a.length;if(3>b)return 0;for(var c=0,d=0,e=b-1;b>d;++d)c+=(a[e].X+a[d].X)*(a[e].Y-a[d].Y),e=d;return.5*-c},r.Clipper.prototype.Area=function(a){var b=a.Pts;if(null==b)return 0;var c=0;do c+=(b.Prev.Pt.X+b.Pt.X)*(b.Prev.Pt.Y-b.Pt.Y),b=b.Next;while(b!=a.Pts);return.5*c},r.Clipper.SimplifyPolygon=function(a,b){var c=[],d=new r.Clipper(0);return d.StrictlySimple=!0,d.AddPath(a,r.PolyType.ptSubject,!0),d.Execute(r.ClipType.ctUnion,c,b,b),c},r.Clipper.SimplifyPolygons=function(a,b){"undefined"==typeof b&&(b=r.PolyFillType.pftEvenOdd);var c=[],d=new r.Clipper(0);return d.StrictlySimple=!0,d.AddPaths(a,r.PolyType.ptSubject,!0),d.Execute(r.ClipType.ctUnion,c,b,b),c},r.Clipper.DistanceSqrd=function(a,b){var c=a.X-b.X,d=a.Y-b.Y;return c*c+d*d},r.Clipper.DistanceFromLineSqrd=function(a,b,c){var d=b.Y-c.Y;return c=c.X-b.X,b=d*b.X+c*b.Y,b=d*a.X+c*a.Y-b,b*b/(d*d+c*c)},r.Clipper.SlopesNearCollinear=function(a,b,c,d){return r.Clipper.DistanceFromLineSqrd(b,a,c)<d},r.Clipper.PointsAreClose=function(a,b,c){var d=a.X-b.X;return a=a.Y-b.Y,c>=d*d+a*a},r.Clipper.ExcludeOp=function(a){var b=a.Prev;return b.Next=a.Next,a.Next.Prev=b,b.Idx=0,b},r.Clipper.CleanPolygon=function(a,b){"undefined"==typeof b&&(b=1.415);var c=a.length;if(0==c)return[];for(var d=Array(c),e=0;c>e;++e)d[e]=new r.OutPt;for(e=0;c>e;++e)d[e].Pt=a[e],d[e].Next=d[(e+1)%c],d[e].Next.Prev=d[e],d[e].Idx=0;for(e=b*b,d=d[0];0==d.Idx&&d.Next!=d.Prev;)r.Clipper.PointsAreClose(d.Pt,d.Prev.Pt,e)?(d=r.Clipper.ExcludeOp(d),c--):r.Clipper.PointsAreClose(d.Prev.Pt,d.Next.Pt,e)?(r.Clipper.ExcludeOp(d.Next),d=r.Clipper.ExcludeOp(d),c-=2):r.Clipper.SlopesNearCollinear(d.Prev.Pt,d.Pt,d.Next.Pt,e)?(d=r.Clipper.ExcludeOp(d),c--):(d.Idx=1,d=d.Next);3>c&&(c=0);for(var f=Array(c),e=0;c>e;++e)f[e]=new r.IntPoint(d.Pt),d=d.Next;return f},r.Clipper.CleanPolygons=function(a,b){for(var c=Array(a.length),d=0,e=a.length;e>d;d++)c[d]=r.Clipper.CleanPolygon(a[d],b);return c},r.Clipper.Minkowski=function(a,b,c,d){var e=d?1:0,f=a.length,g=b.length;if(d=[],c)for(c=0;g>c;c++){for(var h=Array(f),i=0,j=a.length,k=a[i];j>i;i++,k=a[i])h[i]=new r.IntPoint(b[c].X+k.X,b[c].Y+k.Y);d.push(h)}else for(c=0;g>c;c++){for(h=Array(f),i=0,j=a.length,k=a[i];j>i;i++,k=a[i])h[i]=new r.IntPoint(b[c].X-k.X,b[c].Y-k.Y);d.push(h)}for(a=[],c=0;g-1+e>c;c++)for(i=0;f>i;i++)b=[],b.push(d[c%g][i%f]),b.push(d[(c+1)%g][i%f]),b.push(d[(c+1)%g][(i+1)%f]),b.push(d[c%g][(i+1)%f]),r.Clipper.Orientation(b)||b.reverse(),a.push(b);return e=new r.Clipper(0),e.AddPaths(a,r.PolyType.ptSubject,!0),e.Execute(r.ClipType.ctUnion,d,r.PolyFillType.pftNonZero,r.PolyFillType.pftNonZero),d},r.Clipper.MinkowskiSum=function(){var a=arguments,b=a.length;if(3==b){var c=a[0],d=a[2];return r.Clipper.Minkowski(c,a[1],!0,d)}if(4==b){for(var e,c=a[0],f=a[1],b=a[2],d=a[3],a=new r.Clipper,g=0,h=f.length;h>g;++g)e=r.Clipper.Minkowski(c,f[g],!0,d),a.AddPaths(e,r.PolyType.ptSubject,!0);return d&&a.AddPaths(f,r.PolyType.ptClip,!0),c=new r.Paths,a.Execute(r.ClipType.ctUnion,c,b,b),c}},r.Clipper.MinkowskiDiff=function(a,b,c){return r.Clipper.Minkowski(a,b,!1,c)},r.Clipper.PolyTreeToPaths=function(a){var b=[];return r.Clipper.AddPolyNodeToPaths(a,r.Clipper.NodeType.ntAny,b),b},r.Clipper.AddPolyNodeToPaths=function(a,b,c){var d=!0;switch(b){case r.Clipper.NodeType.ntOpen:return;case r.Clipper.NodeType.ntClosed:d=!a.IsOpen}0<a.m_polygon.length&&d&&c.push(a.m_polygon),d=0,a=a.Childs();for(var e=a.length,f=a[d];e>d;d++,f=a[d])r.Clipper.AddPolyNodeToPaths(f,b,c)},r.Clipper.OpenPathsFromPolyTree=function(a){for(var b=new r.Paths,c=0,d=a.ChildCount();d>c;c++)a.Childs()[c].IsOpen&&b.push(a.Childs()[c].m_polygon);return b},r.Clipper.ClosedPathsFromPolyTree=function(a){var b=new r.Paths;return r.Clipper.AddPolyNodeToPaths(a,r.Clipper.NodeType.ntClosed,b),b},G(r.Clipper,r.ClipperBase),r.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},r.ClipperOffset=function(a,b){"undefined"==typeof a&&(a=2),"undefined"==typeof b&&(b=r.ClipperOffset.def_arc_tolerance),this.m_destPolys=new r.Paths,this.m_srcPoly=new r.Path,this.m_destPoly=new r.Path,this.m_normals=[],this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0,this.m_lowest=new r.IntPoint,this.m_polyNodes=new r.PolyNode,this.MiterLimit=a,this.ArcTolerance=b,this.m_lowest.X=-1},r.ClipperOffset.two_pi=6.28318530717959,r.ClipperOffset.def_arc_tolerance=.25,r.ClipperOffset.prototype.Clear=function(){r.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},r.ClipperOffset.Round=r.Clipper.Round,r.ClipperOffset.prototype.AddPath=function(a,b,c){var d=a.length-1;if(!(0>d)){var e=new r.PolyNode;if(e.m_jointype=b,e.m_endtype=c,c==r.EndType.etClosedLine||c==r.EndType.etClosedPolygon)for(;d>0&&r.IntPoint.op_Equality(a[0],a[d]);)d--;e.m_polygon.push(a[0]);var f=0;b=0;for(var g=1;d>=g;g++)r.IntPoint.op_Inequality(e.m_polygon[f],a[g])&&(f++,e.m_polygon.push(a[g]),a[g].Y>e.m_polygon[b].Y||a[g].Y==e.m_polygon[b].Y&&a[g].X<e.m_polygon[b].X)&&(b=f);c==r.EndType.etClosedPolygon&&2>f||c!=r.EndType.etClosedPolygon&&0>f||(this.m_polyNodes.AddChild(e),c!=r.EndType.etClosedPolygon)||(0>this.m_lowest.X?this.m_lowest=new r.IntPoint(0,b):(a=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],(e.m_polygon[b].Y>a.Y||e.m_polygon[b].Y==a.Y&&e.m_polygon[b].X<a.X)&&(this.m_lowest=new r.IntPoint(this.m_polyNodes.ChildCount()-1,b))))}},r.ClipperOffset.prototype.AddPaths=function(a,b,c){for(var d=0,e=a.length;e>d;d++)this.AddPath(a[d],b,c)},r.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!r.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var a=0;a<this.m_polyNodes.ChildCount();a++){var b=this.m_polyNodes.Childs()[a];(b.m_endtype==r.EndType.etClosedPolygon||b.m_endtype==r.EndType.etClosedLine&&r.Clipper.Orientation(b.m_polygon))&&b.m_polygon.reverse()}else for(a=0;a<this.m_polyNodes.ChildCount();a++)b=this.m_polyNodes.Childs()[a],b.m_endtype!=r.EndType.etClosedLine||r.Clipper.Orientation(b.m_polygon)||b.m_polygon.reverse()},r.ClipperOffset.GetUnitNormal=function(a,b){var c=b.X-a.X,d=b.Y-a.Y;if(0==c&&0==d)return new r.DoublePoint(0,0);var e=1/Math.sqrt(c*c+d*d);return new r.DoublePoint(d*e,-(c*e))},r.ClipperOffset.prototype.DoOffset=function(a){if(this.m_destPolys=[],this.m_delta=a,r.ClipperBase.near_zero(a))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];c.m_endtype==r.EndType.etClosedPolygon&&this.m_destPolys.push(c.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var b=0>=this.ArcTolerance?r.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(a)*r.ClipperOffset.def_arc_tolerance?Math.abs(a)*r.ClipperOffset.def_arc_tolerance:this.ArcTolerance,d=3.14159265358979/Math.acos(1-b/Math.abs(a));for(this.m_sin=Math.sin(r.ClipperOffset.two_pi/d),this.m_cos=Math.cos(r.ClipperOffset.two_pi/d),this.m_StepsPerRad=d/r.ClipperOffset.two_pi,0>a&&(this.m_sin=-this.m_sin),b=0;b<this.m_polyNodes.ChildCount();b++){c=this.m_polyNodes.Childs()[b],this.m_srcPoly=c.m_polygon;var e=this.m_srcPoly.length;if(!(0==e||0>=a&&(3>e||c.m_endtype!=r.EndType.etClosedPolygon))){if(this.m_destPoly=[],1==e)if(c.m_jointype==r.JoinType.jtRound)for(var c=1,e=0,f=1;d>=f;f++){this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[0].X+c*a),r.ClipperOffset.Round(this.m_srcPoly[0].Y+e*a)));var g=c,c=c*this.m_cos-this.m_sin*e,e=g*this.m_sin+e*this.m_cos}else for(e=c=-1,f=0;4>f;++f)this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[0].X+c*a),r.ClipperOffset.Round(this.m_srcPoly[0].Y+e*a))),0>c?c=1:0>e?e=1:c=-1;else{for(f=this.m_normals.length=0;e-1>f;f++)this.m_normals.push(r.ClipperOffset.GetUnitNormal(this.m_srcPoly[f],this.m_srcPoly[f+1]));if(this.m_normals.push(c.m_endtype==r.EndType.etClosedLine||c.m_endtype==r.EndType.etClosedPolygon?r.ClipperOffset.GetUnitNormal(this.m_srcPoly[e-1],this.m_srcPoly[0]):new r.DoublePoint(this.m_normals[e-2])),c.m_endtype==r.EndType.etClosedPolygon)for(g=e-1,f=0;e>f;f++)g=this.OffsetPoint(f,g,c.m_jointype);else if(c.m_endtype==r.EndType.etClosedLine){for(g=e-1,f=0;e>f;f++)g=this.OffsetPoint(f,g,c.m_jointype);for(this.m_destPolys.push(this.m_destPoly),this.m_destPoly=[],g=this.m_normals[e-1],f=e-1;f>0;f--)this.m_normals[f]=new r.DoublePoint(-this.m_normals[f-1].X,-this.m_normals[f-1].Y);for(this.m_normals[0]=new r.DoublePoint(-g.X,-g.Y),g=0,f=e-1;f>=0;f--)g=this.OffsetPoint(f,g,c.m_jointype)}else{for(g=0,f=1;e-1>f;++f)g=this.OffsetPoint(f,g,c.m_jointype);for(c.m_endtype==r.EndType.etOpenButt?(f=e-1,g=new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[f].X+this.m_normals[f].X*a),r.ClipperOffset.Round(this.m_srcPoly[f].Y+this.m_normals[f].Y*a)),this.m_destPoly.push(g),g=new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[f].X-this.m_normals[f].X*a),r.ClipperOffset.Round(this.m_srcPoly[f].Y-this.m_normals[f].Y*a)),this.m_destPoly.push(g)):(f=e-1,g=e-2,this.m_sinA=0,this.m_normals[f]=new r.DoublePoint(-this.m_normals[f].X,-this.m_normals[f].Y),c.m_endtype==r.EndType.etOpenSquare?this.DoSquare(f,g):this.DoRound(f,g)),f=e-1;f>0;f--)this.m_normals[f]=new r.DoublePoint(-this.m_normals[f-1].X,-this.m_normals[f-1].Y);for(this.m_normals[0]=new r.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y),g=e-1,f=g-1;f>0;--f)g=this.OffsetPoint(f,g,c.m_jointype);c.m_endtype==r.EndType.etOpenButt?(g=new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*a),r.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*a)),this.m_destPoly.push(g),g=new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*a),r.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*a)),this.m_destPoly.push(g)):(this.m_sinA=0,c.m_endtype==r.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}},r.ClipperOffset.prototype.Execute=function(){var a=arguments;if(a[0]instanceof r.PolyTree)if(b=a[0],c=a[1],b.Clear(),this.FixOrientations(),this.DoOffset(c),a=new r.Clipper(0),a.AddPaths(this.m_destPolys,r.PolyType.ptSubject,!0),c>0)a.Execute(r.ClipType.ctUnion,b,r.PolyFillType.pftPositive,r.PolyFillType.pftPositive);else if(c=r.Clipper.GetBounds(this.m_destPolys),d=new r.Path,d.push(new r.IntPoint(c.left-10,c.bottom+10)),d.push(new r.IntPoint(c.right+10,c.bottom+10)),d.push(new r.IntPoint(c.right+10,c.top-10)),d.push(new r.IntPoint(c.left-10,c.top-10)),a.AddPath(d,r.PolyType.ptSubject,!0),a.ReverseSolution=!0,a.Execute(r.ClipType.ctUnion,b,r.PolyFillType.pftNegative,r.PolyFillType.pftNegative),1==b.ChildCount()&&0<b.Childs()[0].ChildCount())for(a=b.Childs()[0],b.Childs()[0]=a.Childs()[0],c=1;c<a.ChildCount();c++)b.AddChild(a.Childs()[c]);else b.Clear();else{var b=a[0],c=a[1];if(r.Clear(b),this.FixOrientations(),this.DoOffset(c),a=new r.Clipper(0),a.AddPaths(this.m_destPolys,r.PolyType.ptSubject,!0),c>0)a.Execute(r.ClipType.ctUnion,b,r.PolyFillType.pftPositive,r.PolyFillType.pftPositive);else{var c=r.Clipper.GetBounds(this.m_destPolys),d=new r.Path;d.push(new r.IntPoint(c.left-10,c.bottom+10)),d.push(new r.IntPoint(c.right+10,c.bottom+10)),d.push(new r.IntPoint(c.right+10,c.top-10)),d.push(new r.IntPoint(c.left-10,c.top-10)),a.AddPath(d,r.PolyType.ptSubject,!0),a.ReverseSolution=!0,a.Execute(r.ClipType.ctUnion,b,r.PolyFillType.pftNegative,r.PolyFillType.pftNegative),0<b.length&&b.splice(0,1)}}},r.ClipperOffset.prototype.OffsetPoint=function(a,b,c){if(this.m_sinA=this.m_normals[b].X*this.m_normals[a].Y-this.m_normals[a].X*this.m_normals[b].Y,5e-5>this.m_sinA&&-5e-5<this.m_sinA)return b;if(1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1),0>this.m_sinA*this.m_delta)this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[b].X*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[b].Y*this.m_delta))),this.m_destPoly.push(new r.IntPoint(this.m_srcPoly[a])),this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[a].X*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*this.m_delta)));else switch(c){case r.JoinType.jtMiter:c=1+(this.m_normals[a].X*this.m_normals[b].X+this.m_normals[a].Y*this.m_normals[b].Y),c>=this.m_miterLim?this.DoMiter(a,b,c):this.DoSquare(a,b);break;case r.JoinType.jtSquare:this.DoSquare(a,b);break;case r.JoinType.jtRound:this.DoRound(a,b)}return a},r.ClipperOffset.prototype.DoSquare=function(a,b){var c=Math.tan(Math.atan2(this.m_sinA,this.m_normals[b].X*this.m_normals[a].X+this.m_normals[b].Y*this.m_normals[a].Y)/4);this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_delta*(this.m_normals[b].X-this.m_normals[b].Y*c)),r.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_delta*(this.m_normals[b].Y+this.m_normals[b].X*c)))),this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_delta*(this.m_normals[a].X+this.m_normals[a].Y*c)),r.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_delta*(this.m_normals[a].Y-this.m_normals[a].X*c))))},r.ClipperOffset.prototype.DoMiter=function(a,b,c){c=this.m_delta/c,this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[a].X+(this.m_normals[b].X+this.m_normals[a].X)*c),r.ClipperOffset.Round(this.m_srcPoly[a].Y+(this.m_normals[b].Y+this.m_normals[a].Y)*c)))},r.ClipperOffset.prototype.DoRound=function(a,b){for(var c,d=Math.atan2(this.m_sinA,this.m_normals[b].X*this.m_normals[a].X+this.m_normals[b].Y*this.m_normals[a].Y),d=r.Cast_Int32(r.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(d))),e=this.m_normals[b].X,f=this.m_normals[b].Y,g=0;d>g;++g)this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[a].X+e*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[a].Y+f*this.m_delta))),c=e,e=e*this.m_cos-this.m_sin*f,f=c*this.m_sin+f*this.m_cos;this.m_destPoly.push(new r.IntPoint(r.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[a].X*this.m_delta),r.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*this.m_delta)))},r.Error=function(a){try{throw Error(a)}catch(b){alert(b.message)}},r.JS={},r.JS.AreaOfPolygon=function(a,b){return b||(b=1),r.Clipper.Area(a)/(b*b)},r.JS.AreaOfPolygons=function(a,b){b||(b=1);for(var c=0,d=0;d<a.length;d++)c+=r.Clipper.Area(a[d]);return c/(b*b)},r.JS.BoundsOfPath=function(a,b){return r.JS.BoundsOfPaths([a],b)},r.JS.BoundsOfPaths=function(a,b){b||(b=1);var c=r.Clipper.GetBounds(a);return c.left/=b,c.bottom/=b,c.right/=b,c.top/=b,c},r.JS.Clean=function(a,b){if(!(a instanceof Array))return[];var c=a[0]instanceof Array;if(a=r.JS.Clone(a),"number"!=typeof b||null===b)return r.Error("Delta is not a number in Clean()."),a;if(0===a.length||1==a.length&&0===a[0].length||0>b)return a;c||(a=[a]);for(var d,e,f,g,h,i,j,k=a.length,l=[],m=0;k>m;m++)if(e=a[m],d=e.length,0!==d)if(3>d)f=e,l.push(f);else{for(f=e,g=b*b,h=e[0],j=i=1;d>j;j++)(e[j].X-h.X)*(e[j].X-h.X)+(e[j].Y-h.Y)*(e[j].Y-h.Y)<=g||(f[i]=e[j],h=e[j],i++);h=e[i-1],(e[0].X-h.X)*(e[0].X-h.X)+(e[0].Y-h.Y)*(e[0].Y-h.Y)<=g&&i--,d>i&&f.splice(i,d-i),f.length&&l.push(f)}return!c&&l.length?l=l[0]:c||0!==l.length?c&&0===l.length&&(l=[[]]):l=[],l},r.JS.Clone=function(a){if(!(a instanceof Array)||0===a.length)return[];if(1==a.length&&0===a[0].length)return[[]];var b=a[0]instanceof Array;b||(a=[a]);var c,d,e,f,g=a.length,h=Array(g);for(d=0;g>d;d++){for(c=a[d].length,f=Array(c),e=0;c>e;e++)f[e]={X:a[d][e].X,Y:a[d][e].Y};h[d]=f}return b||(h=h[0]),h},r.JS.Lighten=function(a,b){if(!(a instanceof Array))return[];if("number"!=typeof b||null===b)return r.Error("Tolerance is not a number in Lighten()."),r.JS.Clone(a);if(0===a.length||1==a.length&&0===a[0].length||0>b)return r.JS.Clone(a);a[0]instanceof Array||(a=[a]);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,s=a.length,t=b*b,u=[];for(c=0;s>c;c++)if(e=a[c],h=e.length,0!=h){for(f=0;1e6>f;f++){for(g=[],h=e.length,e[h-1].X!=e[0].X||e[h-1].Y!=e[0].Y?(m=1,e.push({X:e[0].X,Y:e[0].Y}),h=e.length):m=0,l=[],d=0;h-2>d;d++)i=e[d],k=e[d+1],j=e[d+2],p=i.X,q=i.Y,i=j.X-p,n=j.Y-q,(0!==i||0!==n)&&(o=((k.X-p)*i+(k.Y-q)*n)/(i*i+n*n),o>1?(p=j.X,q=j.Y):o>0&&(p+=i*o,q+=n*o)),i=k.X-p,n=k.Y-q,j=i*i+n*n,t>=j&&(l[d+1]=1,d++);for(g.push({X:e[0].X,Y:e[0].Y}),d=1;h-1>d;d++)l[d]||g.push({X:e[d].X,Y:e[d].Y});if(g.push({X:e[h-1].X,Y:e[h-1].Y}),m&&e.pop(),!l.length)break;e=g}h=g.length,g[h-1].X==g[0].X&&g[h-1].Y==g[0].Y&&g.pop(),2<g.length&&u.push(g)
}return!a[0]instanceof Array&&(u=u[0]),"undefined"==typeof u&&(u=[[]]),u},r.JS.PerimeterOfPath=function(a,b,c){if("undefined"==typeof a)return 0;var d,e,f=Math.sqrt,g=0,h=0,i=d=0;e=0;var j=a.length;if(2>j)return 0;for(b&&(a[j]=a[0],j++);--j;)d=a[j],h=d.X,d=d.Y,e=a[j-1],i=e.X,e=e.Y,g+=f((h-i)*(h-i)+(d-e)*(d-e));return b&&a.pop(),g/c},r.JS.PerimeterOfPaths=function(a,b,c){c||(c=1);for(var d=0,e=0;e<a.length;e++)d+=r.JS.PerimeterOfPath(a[e],b,c);return d},r.JS.ScaleDownPath=function(a,b){var c,d;for(b||(b=1),c=a.length;c--;)d=a[c],d.X/=b,d.Y/=b},r.JS.ScaleDownPaths=function(a,b){var c,d,e;for(b||(b=1),c=a.length;c--;)for(d=a[c].length;d--;)e=a[c][d],e.X/=b,e.Y/=b},r.JS.ScaleUpPath=function(a,b){var c,d,e=Math.round;for(b||(b=1),c=a.length;c--;)d=a[c],d.X=e(d.X*b),d.Y=e(d.Y*b)},r.JS.ScaleUpPaths=function(a,b){var c,d,e,f=Math.round;for(b||(b=1),c=a.length;c--;)for(d=a[c].length;d--;)e=a[c][d],e.X=f(e.X*b),e.Y=f(e.Y*b)},r.ExPolygons=function(){return[]},r.ExPolygon=function(){this.holes=this.outer=null},r.JS.AddOuterPolyNodeToExPolygons=function(a,b){var c=new r.ExPolygon;c.outer=a.Contour();var d=a.Childs(),e=d.length;c.holes=Array(e);var f,g,h,i,j;for(g=0;e>g;g++)for(f=d[g],c.holes[g]=f.Contour(),h=0,i=f.Childs(),j=i.length;j>h;h++)f=i[h],r.JS.AddOuterPolyNodeToExPolygons(f,b);b.push(c)},r.JS.ExPolygonsToPaths=function(a){var b,c,d,e,f=new r.Paths;for(b=0,d=a.length;d>b;b++)for(f.push(a[b].outer),c=0,e=a[b].holes.length;e>c;c++)f.push(a[b].holes[c]);return f},r.JS.PolyTreeToExPolygons=function(a){var b,c,d,e=new r.ExPolygons;for(b=0,c=a.Childs(),d=c.length;d>b;b++)a=c[b],r.JS.AddOuterPolyNodeToExPolygons(a,e);return e}}(),function(a){"use strict";var b,c,d,e;return e=function(a){return a.left=a.left||0,a.top=a.top||0,a},c=a.fabric||(a.fabric={}),b=c.util.object.extend,c.Shelf?void console.warn("fabric.Shelf is already defined"):(d=c.Object.prototype.stateProperties.concat(),d.push("id","count","side","top_cm","left_cm","eachWidth","eachHeight","label"),c.Shelf=c.util.createClass(c.Object,{stateProperties:d,type:"shelf",eachWidth:90,eachHeight:25,__width:function(){return this.__eachWidth()*this.count},__height:function(){return this.__eachHeight()*this.side},__eachWidth:function(){return this.eachWidth*haika.scaleFactor},__eachHeight:function(){return this.eachHeight*haika.scaleFactor},count:1,side:1,label:"",minScaleLimit:1,strokeDashArray:null,initialize:function(a){a=a||{},this.callSuper("initialize",a),this.width=this.__width(),this.height=this.__height()},_render:function(a){var b,c,d,e,f,g,h;return 1===this.width&&1===this.height?void a.fillRect(0,0,1,1):(a.scale(1/this.scaleX,1/this.scaleY),e=0,0===this.scaleX||"mr"!==this.__corner&&"tr"!==this.__corner&&"br"!==this.__corner||(e=(this.count*this.__eachWidth()-this.width*this.scaleX)/2),0===this.scaleX||"ml"!==this.__corner&&"tl"!==this.__corner&&"bl"!==this.__corner||(e=-1*(this.count*this.__eachWidth()-this.width*this.scaleX)/2),f=this.__eachWidth(),b=this.__eachHeight(),g=-f/2*this.count+e,h=-b/2*this.side,c=this.group&&"path-group"===this.group.type,a.globalAlpha=c?a.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&c&&a.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&c&&a.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y),1===this.side&&(this.__renderShelf(a,g,h,f,b),haika.scaleFactor>.5&&this.__renderSide(a,g,h,f,b)),2===this.side&&this.__renderShelf(a,g,h,f,b),this.active&&(a.font="13.5px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="rgba(0, 0, 0,1)",d=1===this.side?"":"",d="["+this.id+"] "+d+this.count+"",a.fillText(d,0,this.height*this.scaleY/2+15)),void a.scale(this.scaleX,this.scaleY))},__renderShelf:function(a,b,c,d,e){var f;return f=d*this.count,this.__renderRect(a,b,c,f,e),this.__renderPartitionLine(a,b,c,d,e),2===this.side?(this.__renderRect(a,b,c+e,f,e),this.__renderPartitionLine(a,b,c+e,d,e)):void 0},__renderRect:function(a,b,c,d,e){return a.lineWidth=1,a.beginPath(),a.moveTo(b,c),a.lineTo(b+d,c),a.lineTo(b+d,c+e),a.lineTo(b,c+e),a.lineTo(b,c),a.closePath(),this._renderFill(a),this._renderStroke(a)},__renderPartitionLine:function(a,b,c,d,e){var f;if(!(this.count<=1)){for(a.lineWidth=1,a.beginPath(),f=1;f<this.count;)a.moveTo(b+d*f,c),a.lineTo(b+d*f,c+e),f++;return a.closePath(),this._renderStroke(a)}},__renderSide:function(a,b,c,d,e){return a.lineWidth=5,a.beginPath(),a.moveTo(b,c+e-1),a.lineTo(b+d*this.count,c+e-1),a.closePath(),this._renderStroke(a)},__resizeShelf:function(){var a,b,c,d;return b=this.scaleX*this.currentWidth,a=this.scaleY*this.currentHeight,c=Math.floor(b/this.__eachWidth()),1>c&&(c=1),c>10&&(c=10),d=Math.round(a/this.__eachHeight()),1>d&&(d=1),d>2&&(d=2),this.set({count:c,side:d,minScaleLimit:.01,flipX:!1,flipY:!1})},__modifiedShelf:function(){var a;return this.angle=this.angle%360,(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280&&(this.angle=270),0===this.scaleX||"mr"!==this.__corner&&"tr"!==this.__corner&&"br"!==this.__corner||(a=this.angle*(Math.PI/180),this.top=this.top+Math.sin(a)*(this.count*this.__eachWidth()-this.width*this.scaleX)/2,this.left=this.left+Math.cos(a)*(this.count*this.__eachWidth()-this.width*this.scaleX)/2),0===this.scaleX||"ml"!==this.__corner&&"tl"!==this.__corner&&"bl"!==this.__corner||(a=this.angle*(Math.PI/180),this.top=this.top-Math.sin(a)*(this.count*this.__eachWidth()-this.width*this.scaleX)/2,this.left=this.left-Math.cos(a)*(this.count*this.__eachWidth()-this.width*this.scaleX)/2),this.scaleX=this.scaleY=1,this.width=this.__width(),this.height=this.__height(),this.setCoords()},_renderDashedStroke:function(a){var b,d,e,f;e=-this.width/2,f=-this.height/2,d=this.width,b=this.height,a.beginPath(),c.util.drawDashedLine(a,e,f,e+d,f,this.strokeDashArray),c.util.drawDashedLine(a,e+d,f,e+d,f+b,this.strokeDashArray),c.util.drawDashedLine(a,e+d,f+b,e,f+b,this.strokeDashArray),c.util.drawDashedLine(a,e,f+b,e,f,this.strokeDashArray),a.closePath()},_normalizeLeftTopProperties:function(a){return"left"in a&&this.set("left",a.left+this.getWidth()/2),this.set("x",a.left||0),"top"in a&&this.set("top",a.top+this.getHeight()/2),this.set("y",a.top||0),this},toObject:function(a){var c;return c=b(this.callSuper("toObject",a),{count:this.get("count"),side:this.get("side")}),this.includeDefaultValues||this._removeDefaultValues(c),c},toGeoJSON:function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o;for(i=this.eachWidth*this.count/100,f=this.eachHeight*this.side/100,j=-i/2+this.left_cm/100,k=-f/2+this.top_cm/100,d=[[[j,k],[j+i,k],[j+i,k+f],[j,k+f],[j,k]]],h=[],l=0,n=d.length;n>l;l++)for(a=d[l],m=0,o=a.length;o>m;m++)b=a[m],g=c.util.rotatePoint(new c.Point(b[0],b[1]),new c.Point(this.left_cm/100,this.top_cm/100),c.util.degreesToRadians(this.angle)),h.push([-g.x,g.y]);return e={type:"Feature",geometry:{type:"Polygon",coordinates:[h]},properties:{label:this.label?this.label:"",type:this.type,left_cm:this.left_cm,top_cm:this.top_cm,eachWidth:this.eachWidth,eachHeight:this.eachHeight,id:this.id,count:this.count,side:this.side,angle:this.angle,fill:this.fill,stroke:this.stroke}}},toSVG:function(a){var b,c,d,e,f,g,h,i,j;for(f=this._createBaseSVGMarkup(),f.push("<g>"),b=this.get("count"),g=this.get("side"),h=this.eachWidth,c=this.eachHeight,i=-h/2*this.count,j=-c/2*this.side,d=0,e=0;b>d;)f.push('<rect x="'+(-1*this.width/2+this.width/b*d)+'" y="'+-1*this.height/2+'" rx="'+this.get("rx")+'" ry="'+this.get("ry")+'" width="'+this.width/b+'" height="'+this.height/2+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'"/>'),d++;if(2===g)for(d=0;b>d;)f.push('<rect x="'+(-1*this.width/2+this.width/b*d)+'" y="'+(-1*this.height/2+this.eachHeight)+'" rx="'+this.get("rx")+'" ry="'+this.get("ry")+'" width="'+this.width/b+'" height="'+this.height/2+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'"/>'),d++;return f.push("</g>"),a?a(f.join("")):f.join("")},getJsonSchema:function(){var a;return a={title:"",type:"object",properties:{label:{title:"",type:"string","default":""},count:{title:"",type:"integer","default":3,minimum:1,maximum:10},side:{type:"integer","default":1,minimum:1,maximum:2},angle:{type:"integer","default":0,minimum:0,maximum:360},eachWidth:{type:"integer","default":90,minimum:1},eachHeight:{type:"integer","default":25,minimum:1}}}},complexity:function(){return 1}}),c.Shelf.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("width height count side".split(" ")),c.Shelf.fromElement=function(a,d){var f,g;return a?(f=c.parseAttributes(a,c.Shelf.ATTRIBUTE_NAMES),f=e(f),g=new c.Shelf(b(d?c.util.object.clone(d):{},f)),g._normalizeLeftTopProperties(f),g):null},void(c.Shelf.fromObject=function(a){return new c.Shelf(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b,c,d,e;return e=function(a){return a.left=a.left||0,a.top=a.top||0,a},c=a.fabric||(a.fabric={}),b=c.util.object.extend,c.curvedShelf?void console.warn("fabric.curvedShelf is already defined"):(d=c.Object.prototype.stateProperties.concat(),d.push("rx","ry","x","y"),c.curvedShelf=c.util.createClass(c.Object,{stateProperties:d,type:"curved_shelf",rx:0,ry:0,x:0,y:0,__width:function(){return this.__eachWidth()*this.count},__height:function(){return this.__eachHeight()*this.side},__eachWidth:function(){return 90*haika.scaleFactor},__eachHeight:function(){return 25*haika.scaleFactor},count:1,side:1,minScaleLimit:1,strokeDashArray:null,initialize:function(a){a=a||{},this.callSuper("initialize",a),this._initRxRy(),this.x=a.x||0,this.y=a.y||0,this.width=this.__width(),this.height=this.__height()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a){var b,c,d,e,f,g;return 1===this.width&&1===this.height?void a.fillRect(0,0,1,1):(a.scale(1/this.scaleX,1/this.scaleY),c=(180-30*this.count)/2*Math.PI/180,b=c+30*this.count*Math.PI/180,d=0,e=0,a.beginPath(),a.arc(d,e,this.height*this.scaleY/2,c,b,!1),g=this.height*this.scaleY/2-this.__eachHeight()*this.side,10>=g&&(g=10),30*this.count<360&&a.arc(d,e,g,b,c,!0),a.closePath(),this._renderFill(a),this._renderStroke(a),a.beginPath(),g=this.height*this.scaleY/2-1*this.__eachHeight(),10>=g&&(g=10),a.arc(d,e,g,c,b,!1),a.stroke(),this.active&&(a.font="13.5px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="rgba(0, 0, 0,1)",f=1===this.side?"":"",f="["+this.id+"] "+f+this.count+"",a.fillText(f,0,this.height*this.scaleY/2+15)),void a.scale(this.scaleX,this.scaleY))},__resizeShelf:function(){var a,b,c,d;return b=this.scaleX*this.currentWidth,a=this.scaleY*this.currentHeight,c=Math.floor(b/this.__eachWidth()),1>c&&(c=1),c>20&&(c=20),d=Math.round(a/this.__eachHeight()),1>d&&(d=1),d>2&&(d=2),this.set({count:c,side:d,minScaleLimit:.01,flipX:!1,flipY:!1})},__modifiedShelf:function(){return this.angle=this.angle%360,(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280&&(this.angle=270),this.height=this.height*this.scaleY,this.scaleX=this.scaleY=1,this.width=this.__width(),this.setCoords()},_normalizeLeftTopProperties:function(a){return"left"in a&&this.set("left",a.left+this.getWidth()/2),this.set("x",a.left||0),"top"in a&&this.set("top",a.top+this.getHeight()/2),this.set("y",a.top||0),this},toObject:function(a){var c;return c=b(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")}),this.includeDefaultValues||this._removeDefaultValues(c),c},toGeoJSON:function(){var a,b,c,d,e,f;return d=this.__eachWidth()*this.count,c=this.__eachHeight()*this.side,a=this.getCenterPoint(),e=-d/2+a.x,f=-c/2+a.y,e=haika.transformLeftX_px2cm(e),f=haika.transformTopY_px2cm(f),b={type:"Feature",geometry:{type:"Polygon",coordinates:[[[-e,f],[-(e+d),f],[-(e+d),f+c],[-e,f+c],[-e,f]]]},properties:{type:this.type,left_cm:this.left_cm,top_cm:this.top_cm,id:this.id,count:this.count,side:this.side,angle:this.angle,fill:this.fill,stroke:this.stroke}}},toSVG:function(a){var b,c,d,e,f;for(e=this._createBaseSVGMarkup(),e.push("<g>"),c=0,d=0,b=this.get("count"),f="one"===this.get("row")?1:2;b>c;)e.push('<rect x="'+(-1*this.width/2+this.width/b*c)+'" y="'+-1*this.height/2+'" rx="'+this.get("rx")+'" ry="'+this.get("ry")+'" width="'+this.width/b+'" height="'+this.height+'" style="'+this.getSvgStyles()+'" transform="'+this.getSvgTransform()+'"/>'),c++;return e.push("</g>"),a?a(e.join("")):e.join("")},getJsonSchema:function(){var a;return a={title:"",type:"object",properties:{count:{title:"",type:"integer","default":3,minimum:1,maximum:12},side:{type:"integer","default":1,minimum:1,maximum:2},angle:{type:"integer","default":0,minimum:0,maximum:360}}}},complexity:function(){return 1}}),c.curvedShelf.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height count side".split(" ")),c.curvedShelf.fromElement=function(a,d){var f,g;return a?(f=c.parseAttributes(a,c.Shelf.ATTRIBUTE_NAMES),f=e(f),g=new c.Shelf(b(d?c.util.object.clone(d):{},f)),g._normalizeLeftTopProperties(f),g):null},void(c.curvedShelf.fromObject=function(a){return new c.curvedShelf(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b,c;return c=a.fabric||(a.fabric={}),b=c.util.object.extend,c.Beacon?void console.warn("fabric.Beacon is already defined"):void(c.Beacon=c.util.createClass(c.Object,{type:"beacon",eachWidth:10,eachHeight:10,minor:0,__width:function(){return this.eachWidth*haika.scaleFactor},__height:function(){return this.eachHeight*haika.scaleFactor},initialize:function(a){a=a||{},this.callSuper("initialize",a),this.width=this.__width(),this.height=this.__height()},_render:function(a){return a.beginPath(),1===this.width&&1===this.height?void a.fillRect(0,0,1,1):(a.fillRect(this.width/2*-1,this.height/2*-1,this.width,this.height),this._renderFill(a),void this._renderStroke(a))},__resizeShelf:function(){return this.set({flipX:!1,flipY:!1})},__modifiedShelf:function(){return this.angle=this.angle%360,(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280&&(this.angle=270),this.width=this.__width(),this.height=this.__height(),this.setCoords(),this.__is_into()},__is_into:function(){var a,b,c,d,e,f,g,h,i,j,k;for(f=haika.canvas.getObjects(),k=[],i=0,j=f.length;j>i;i++)e=f[i],e.type.match(/shelf$/)?(c=e.__width()/2,d=e.left-c,g=e.left+c,b=e.__height()/2,h=e.top-b,a=e.top+b,k.push(this.left>d&&this.left<g&&this.top>h&&this.top<a?log("into:"+e.id):void 0)):k.push(void 0);return k},_normalizeLeftTopProperties:function(a){return"left"in a&&this.set("left",a.left+this.getWidth()/2),"top"in a&&this.set("top",a.top+this.getHeight()/2),this},toObject:function(a){var c;return c=b(this.callSuper("toObject",a)),this.includeDefaultValues||this._removeDefaultValues(c),c},toGeoJSON:function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o;for(i=this.__width()/100,f=this.__height()/100,j=-i/2+this.left_cm/100,k=-f/2+this.top_cm/100,d=[[[j,k],[j+i,k],[j+i,k+f],[j,k+f],[j,k]]],h=[],l=0,n=d.length;n>l;l++)for(a=d[l],m=0,o=a.length;o>m;m++)b=a[m],g=c.util.rotatePoint(new c.Point(b[0],b[1]),new c.Point(this.left_cm/100,this.top_cm/100),c.util.degreesToRadians(this.angle)),h.push([-g.x,g.y]);return e={type:"Feature",geometry:{type:"Polygon",coordinates:[h]},properties:{type:this.type,left_cm:this.left_cm,top_cm:this.top_cm,id:this.id,angle:this.angle,fill:this.fill,stroke:this.stroke,minor:this.minor}}},toSVG:function(){return""},getJsonSchema:function(){var a;return a={title:"",type:"object",properties:{angle:{type:"integer","default":0,minimum:0,maximum:360},minor:{type:"integer"}}}},complexity:function(){return 1}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b,c;return c=a.fabric||(a.fabric={}),b=c.util.object.extend,c.Wall?void console.warn("fabric.Wall is already defined"):void(c.Wall=c.util.createClass(c.Rect,{type:"wall",eachWidth:100,eachHeight:100,width_scale:1,height_scale:1,__width:function(){return this.eachWidth*this.width_scale*haika.scaleFactor},__height:function(){return this.eachHeight*this.height_scale*haika.scaleFactor},initialize:function(a){a=a||{},this.callSuper("initialize",a),this.width=this.__width(),this.height=this.__height()},__resizeShelf:function(){return this.set({flipX:!1,flipY:!1})},__modifiedShelf:function(){return this.angle=this.angle%360,(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280&&(this.angle=270),1!==this.sacleX&&(this.width=this.width*this.scaleX,this.width_scale=this.width/(this.eachWidth*haika.scaleFactor)),1!==this.sacleY&&(this.height=this.height*this.scaleY,this.height_scale=this.height/(this.eachHeight*haika.scaleFactor)),this.scaleX=this.scaleY=1,this.setCoords()},toGeoJSON:function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o;for(i=this.eachWidth*this.width_scale/100,f=this.eachHeight*this.height_scale/100,j=-i/2+this.left_cm/100,k=-f/2+this.top_cm/100,d=[[[j,k],[j+i,k],[j+i,k+f],[j,k+f],[j,k]]],h=[],l=0,n=d.length;n>l;l++)for(a=d[l],m=0,o=a.length;o>m;m++)b=a[m],g=c.util.rotatePoint(new c.Point(b[0],b[1]),new c.Point(this.left_cm/100,this.top_cm/100),c.util.degreesToRadians(this.angle)),h.push([-g.x,g.y]);return e={type:"Feature",geometry:{type:"Polygon",coordinates:[h]},properties:{type:this.type,left_cm:this.left_cm,top_cm:this.top_cm,id:this.id,angle:this.angle,fill:this.fill,stroke:this.stroke,width_scale:this.width_scale,height_scale:this.height_scale}}},toSVG:function(a){var b,c,d;return b=this._createBaseSVGMarkup(),c=this.left,d=this.top,this.group&&"path-group"===this.group.type||(c=-this.width/2,d=-this.height/2),b.push("<rect ",'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>\n'),a?a(b.join("")):b.join("")},getJsonSchema:function(){var a;return a={title:"",type:"object",properties:{angle:{type:"integer","default":0,minimum:0,maximum:360},width_scale:{type:"number","default":1},height_scale:{type:"number","default":1}}}},complexity:function(){return 1}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b,c;return c=a.fabric||(a.fabric={}),b=c.util.object.extend,c.Floor?void console.warn("fabric.Floor is already defined"):void(c.Floor=c.util.createClass(c.Rect,{type:"floor",eachWidth:1e3,eachHeight:1e3,width_scale:1,height_scale:1,__width:function(){return this.eachWidth*this.width_scale*haika.scaleFactor},__height:function(){return this.eachHeight*this.height_scale*haika.scaleFactor},initialize:function(a){a=a||{},this.callSuper("initialize",a),this.width=this.__width(),this.height=this.__height()},__resizeShelf:function(){return this.set({flipX:!1,flipY:!1})},__modifiedShelf:function(){return this.angle=this.angle%360,(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280&&(this.angle=270),1!==this.sacleX&&(this.width=this.width*this.scaleX,this.width_scale=this.width/(this.eachWidth*haika.scaleFactor)),1!==this.sacleY&&(this.height=this.height*this.scaleY,this.height_scale=this.height/(this.eachHeight*haika.scaleFactor)),this.scaleX=this.scaleY=1,this.setCoords()},toGeoJSON:function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o;for(i=this.eachWidth*this.width_scale/100,f=this.eachHeight*this.height_scale/100,j=-i/2+this.left_cm/100,k=-f/2+this.top_cm/100,d=[[[j,k],[j+i,k],[j+i,k+f],[j,k+f],[j,k]]],h=[],l=0,n=d.length;n>l;l++)for(a=d[l],m=0,o=a.length;o>m;m++)b=a[m],g=c.util.rotatePoint(new c.Point(b[0],b[1]),new c.Point(this.left_cm/100,this.top_cm/100),c.util.degreesToRadians(this.angle)),h.push([-g.x,g.y]);return e={type:"Feature",geometry:{type:"Polygon",coordinates:[h]},properties:{type:this.type,left_cm:this.left_cm,top_cm:this.top_cm,id:this.id,angle:this.angle,fill:this.fill,stroke:this.stroke,width_scale:this.width_scale,height_scale:this.height_scale}}},toSVG:function(){return""},getJsonSchema:function(){var a;return a={title:"",type:"object",properties:{angle:{type:"integer","default":0,minimum:0,maximum:360},width_scale:{type:"number","default":1},height_scale:{type:"number","default":1}}}},complexity:function(){return 1}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b;return b=a.fabric||(a.fabric={}),b.drawGridLines?void console.warn("fabric.drawGridLines is already defined"):void(b.drawGridLines=function(a){var b,c,d,e,f,g;for(g=a.canvas.width,b=a.canvas.height,d=100*haika.scaleFactor,50>d&&(d=500*haika.scaleFactor),50>d&&(d=1e3*haika.scaleFactor),a.save(),a.beginPath(),a.setLineDash([2,2]),a.lineWidth=1,a.strokeStyle="#999999",a.opacity=1,e=1e3*haika.transformLeftX_cm2px(0)%Math.floor(1e3*d)/1e3,f=1e3*haika.transformTopY_cm2px(0)%Math.floor(1e3*d)/1e3,c=0;c<Math.ceil(g/d)+1;)a.moveTo(Math.floor(c*d+e)+.5,0),a.lineTo(Math.floor(c*d+e)+.5,b),++c;for(c=0;c<Math.ceil(b/d)+1;)a.moveTo(0,Math.floor(c*d+f)+.5),a.lineTo(g,Math.floor(c*d+f)+.5),++c;a.closePath(),a.stroke(),a.restore()})}("undefined"!=typeof exports?exports:this);var haika,log;log=function(a){try{return console.log(a)}catch(b){}},haika={canvas:null,centerX:0,centerY:0,scaleFactor:1,backgroundImage:null,objects:[],state:"shelf",fillColor:"#CFE2F3",strokeColor:"#000000",backgroundUrl:null,backgroundOpacity:1,backgroundScaleFactor:1,xyLongitude:null,xyLatitude:null,xyAngle:0,xyScaleFactor:1.5,transformLeftX_cm2px:function(a){return this.canvas.getWidth()/2+(this.centerX-a)*this.scaleFactor},transformTopY_cm2px:function(a){return this.canvas.getHeight()/2+(this.centerY-a)*this.scaleFactor},transformLeftX_px2cm:function(a){return this.centerX-(a-this.canvas.getWidth()/2)/this.scaleFactor},transformTopY_px2cm:function(a){return this.centerY-(a-this.canvas.getHeight()/2)/this.scaleFactor},init:function(a){var b,c,d;if(null==a.canvasId)throw"CanvasID";if(b)throw"";return null==a.width&&(a.width=500),null==a.height&&(a.height=500),b=new fabric.Canvas(a.canvasId,{rotationCursor:'url("img/rotate.cur") 10 10, crosshair',width:a.width,height:a.height}),null!=a.scaleFactor&&(this.scaleFactor=a.scaleFactor),b._getActionFromCorner=function(a,b){var c;return c="drag",b&&("ml"===b||"mr"===b||"tr"===b||"tl"===b||"bl"===b||"br"===b?c="scaleX":"mt"===b||"mb"===b?c="scaleY":"mtr"===b&&(c="rotate")),c},b._renderBackground=function(a){return a.mozImageSmoothingEnabled=!1,this.backgroundImage&&this.backgroundImage.render(a),a.mozImageSmoothingEnabled=!0,fabric.drawGridLines(a)},initAligningGuidelines(b),this.canvas=b,this.bindEvent(),c=function(a){return alert(a)},d=function(){return this.render()},haika.openFromApi(2,null,d,c),$(this).trigger("haika:initialized")},bindEvent:function(){return this.canvas.on("object:selected",function(a){return function(b){var c;return c=b.target,null!=c._objects&&(c.lockScalingX=!0,c.lockScalingY=!0),a.prepareData(),a.setPropetyPanel()}}(this)),this.canvas.on("before:selection:cleared",function(a){return function(){return a.canvas.deactivateAll().renderAll(),a.saveDelay(),a.editor_change(),a.setPropetyPanel()}}(this)),this.canvas.on("object:scaling",function(){return function(a){var b;return b=a.target,null!=b.__resizeShelf?b.__resizeShelf():void 0}}(this)),this.canvas.on("object:modified",function(a){return function(b){var c;return c=b.target,null!=c.__modifiedShelf&&c.__modifiedShelf(),a.saveDelay(),a.setPropetyPanel()}}(this)),$(window).on("beforeunload",function(a){return function(){a.render(),a.save()}}(this))},loadBgFromUrl:function(a){return this.backgroundUrl=a,this.render()},resetBg:function(){return loadBgFromUrl("")},lastId:0,getId:function(){return 0===this.objects.length?0:(this.lastId+=1,this.lastId)},getCountFindById:function(a){var b;return b=null,$(this.objects).each(function(c,d){return d.id===a?b=c:void 0}),b},add:function(a){var b,c,d,e,f,g,h;""!==a.id&&a.id||(a.id=this.getId()),c={id:a.id},e=["type","width","height","scaleX","scaleY","left","top","angle","fill","stroke"],f=a.constructor.prototype.getJsonSchema();for(b in f.properties)e.push(b);for(g=0,h=e.length;h>g;g++)d=e[g],"top"!==d?"left"!==d?c[d]=a[d]:c.left_cm=this.transformLeftX_px2cm(a.left):c.top_cm=this.transformTopY_px2cm(a.top);return this.objects.push(c),$(this).trigger("haika:add"),c.id},setState:function(a){var b;return b=a.type.match(/shelf$/)?"shelf":"wall"===a.type?"wall":"floor"===a.type?"floor":"beacon",this.state=b,$(".nav a."+this.state).tab("show")},getObjects:function(a,b){var c,d,e,f,g,h,i;if(null==b&&(b=!0),f=this.canvas.getActiveObject(),f&&(d=a(f),d&&b&&$(this.canvas.getObjects()).each(function(a){return function(b,c){return c.id===d?a.canvas.setActiveObject(c):void 0}}(this))),c=this.canvas.getActiveGroup()){for(e=[],i=c.getObjects(),g=0,h=i.length;h>g;g++)f=i[g],d=a(f),e.push(d);return b?this.activeGroup(e):this.render()}},activeGroup:function(a){var b,c,d,e,f,g,h,i,j;for(d=[],j=this.canvas.getObjects(),f=0,h=j.length;h>f;f++)for(e=j[f],g=0,i=a.length;i>g;g++)c=a[g],e.id===c&&d.push(e);return d=d.map(function(a){return a.set("active",!0)}),b=new fabric.Group(d,{originX:"center",originY:"center"}),this.canvas._activeObject=null,this.canvas.setActiveGroup(b.setCoords()).renderAll()},remove:function(){return this.getObjects(function(a){return function(b){return a.__remove(b)}}(this),!1),$(this).trigger("haika:remove")},__remove:function(a){var b;return this.canvas.remove(a),b=this.getCountFindById(a.id),this.objects.splice(b,1),a},bringToFront:function(){return this.getObjects(function(a){return function(b){var c,d;return c=a.getCountFindById(b.id),b.bringToFront(),d=a.objects[c],a.objects.splice(c,1),a.objects.push(d),d.id}}(this))},duplicate:function(){var a,b,c,d,e,f,g,h;if(e=this.canvas.getActiveObject(),e&&(d=fabric.util.object.clone(e),d.id=this.getId(),d.top=this.transformTopY_cm2px(this.centerY),d.left=this.transformLeftX_cm2px(this.centerX),b=this.add(d)),a=this.canvas.getActiveGroup())for(c=[],h=a.getObjects(),f=0,g=h.length;g>f;f++)e=h[f],d=fabric.util.object.clone(e),d.id=this.getId(),d.top=this.transformTopY_cm2px(this.centerY)+e.top,d.left=this.transformLeftX_cm2px(this.centerX)+e.left,b=this.add(d),c.push(b);return this.saveDelay(),this.render(),e&&$(this.canvas.getObjects()).each(function(a){return function(c,d){return d.id===b?a.canvas.setActiveObject(d):void 0}}(this)),a&&this.activeGroup(c),$(this).trigger("haika:duplicate")},clipboard:[],clipboard_scale:0,copy:function(){var a,b,c,d,e;if(this.clipboard=[],b=this.canvas.getActiveObject(),b&&this.clipboard.push(fabric.util.object.clone(b)),a=this.canvas.getActiveGroup())for(e=a.getObjects(),c=0,d=e.length;d>c;c++)b=e[c],this.clipboard.push(fabric.util.object.clone(b));return this.clipboard_scale=this.scaleFactor,$(this).trigger("haika:copy")},paste:function(){var a,b,c,d,e,f,g;if(!(this.clipboard.length<=0)){if(1===this.clipboard.length)return d=this.clipboard[0],c=fabric.util.object.clone(d),c.id=this.getId(),c.top=this.transformTopY_cm2px(this.centerY),c.left=this.transformLeftX_cm2px(this.centerX),a=this.add(c),this.saveDelay(),this.render(),$(this.canvas.getObjects()).each(function(b){return function(c,d){return d.id===a?b.canvas.setActiveObject(d):void 0}}(this));for(b=[],g=this.clipboard,e=0,f=g.length;f>e;e++)d=g[e],c=fabric.util.object.clone(d),c.id=this.getId(),c.top=this.transformTopY_cm2px(this.centerY)+d.top*this.scaleFactor/this.clipboard_scale,c.left=this.transformLeftX_cm2px(this.centerX)+d.left*this.scaleFactor/this.clipboard_scale,a=this.add(c),b.push(a);return this.saveDelay(),log("pre render"+this.clipboard[0].top),this.render(),log("after render"+this.clipboard[0].top),this.activeGroup(b),$(this).trigger("haika:paste")}},selectAll:function(){var a,b;return this.canvas.discardActiveGroup(),b=this.canvas.getObjects().map(function(a){return a.set("active",!0)}),a=new fabric.Group(b,{originX:"center",originY:"center"}),this.canvas._activeObject=null,this.canvas.setActiveGroup(a.setCoords()).renderAll()},unselectAll:function(){return this.canvas.deactivateAll().renderAll()},unselect:function(){var a;return a=this.canvas.getActiveObject(),a||(a=this.canvas.getActiveGroup()),a?(this.canvas.fire("before:selection:cleared",{target:a}),this.canvas.fire("selection:cleared",{target:a})):void 0},getClass:function(a){return"shelf"===a?fabric.Shelf:"curved_shelf"===a?fabric.curvedShelf:"beacon"===a?fabric.Beacon:"wall"===a?fabric.Wall:"floor"===a?fabric.Floor:fabric.Shelf},render:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(!this.backgroundImage&&this.backgroundUrl&&fabric.Image.fromURL(this.backgroundUrl,function(a){return function(b){a.backgroundImage=b,a.render()}}(this)),this.canvas.renderOnAddRemove=!1,this.unselect(),this.canvas._objects.length=0,a=[],d=[],e=[],b=[],r=this.objects,f=0,j=r.length;j>f;f++)c=r[f],"beacon"===c.type&&a.push(c),"wall"===c.type&&e.push(c),"floor"===c.type&&b.push(c),c.type.match(/shelf$/)&&d.push(c);if("floor"!==this.state)for(g=0,k=b.length;k>g;g++)c=b[g],this.addObjectToCanvas(c);for(h=0,l=e.length;l>h;h++)c=e[h],this.addObjectToCanvas(c);if("floor"===this.state)for(i=0,m=b.length;m>i;i++)c=b[i],this.addObjectToCanvas(c);for(p=0,n=d.length;n>p;p++)c=d[p],this.addObjectToCanvas(c);for(q=0,o=a.length;o>q;q++)c=a[q],this.addObjectToCanvas(c);return this.backgroundImage?(this.canvas.setBackgroundImage(this.backgroundImage),this.backgroundImage.left=Math.floor(this.transformLeftX_cm2px(this.backgroundImage._originalElement.width/2*this.backgroundScaleFactor)),this.backgroundImage.top=Math.floor(this.transformTopY_cm2px(this.backgroundImage._originalElement.height/2*this.backgroundScaleFactor)),this.backgroundImage.width=Math.floor(this.backgroundImage._originalElement.width*this.backgroundScaleFactor*this.scaleFactor),this.backgroundImage.height=Math.floor(this.backgroundImage._originalElement.height*this.backgroundScaleFactor*this.scaleFactor),this.backgroundImage.opacity=this.backgroundOpacity):this.canvas.setBackgroundImage(null),this.canvas.renderAll(),this.canvas.renderOnAddRemove=!0,this.setCanvasProperty(),$(this).trigger("haika:render")},addObjectToCanvas:function(a){var b,c,d,e;c=this.getClass(a.type),d=new c,a.type.match(/shelf$/)&&(d.side=a.side,d.count=a.count,d.eachWidth=a.eachWidth,d.eachHeight=a.eachHeight),d.selectable=a.type.match(this.state),a.type.match(this.state)||(d.opacity=.5),d.id=a.id,d.scaleX=d.scaleY=1,("wall"===a.type||"floor"===a.type)&&(d.width_scale=a.width_scale,d.height_scale=a.height_scale),d.width=d.__width(),d.height=d.__height(),d.top=this.transformTopY_cm2px(a.top_cm),d.left=this.transformLeftX_cm2px(a.left_cm),d.top_cm=a.top_cm,d.left_cm=a.left_cm,d.angle=a.angle,d.originX="center",d.originY="center","beacon"===a.type?(d.fill="#000000",d.hasControls=!1,d.padding=10,d.borderColor="#0000ee"):"wall"===a.type?(d.fill="#000000",d.borderColor="#000000"):"floor"===a.type?(d.fill="",d.borderColor="#000000"):(d.borderColor="#000000",d.fill=a.fill,d.padding=0),d.stroke=a.stroke,d.transparentCorners=!1,d.cornerColor="#488BD4",d.borderOpacityWhenMoving=.8,d.cornerSize=10,e=d.constructor.prototype.getJsonSchema();for(b in e.properties)d[b]=a[b];return this.canvas.add(d)},setCanvasProperty:function(){return $("#canvas_width").html(this.canvas.getWidth()),$("#canvas_height").html(this.canvas.getHeight()),$("#canvas_centerX").html(this.centerX),$("#canvas_centerY").html(this.centerY),$("#canvas_bgscale").val(this.backgroundScaleFactor),$("#canvas_bgopacity").val(this.backgroundOpacity),$("#canvas_lon").val(this.xyLongitude),$("#canvas_lat").val(this.xyLatitude),$("#canvas_angle").val(this.canvas.angle),$(".zoom").html((100*this.scaleFactor).toFixed(0)+"%")},getMovePixel:function(a){return a.shiftKey?10:1
},up:function(a){var b;return b=this.canvas.getActiveObject(),b?(b.top=b.top-this.getMovePixel(a),this.canvas.renderAll()):void 0},down:function(a){var b;return b=this.canvas.getActiveObject(),b?(b.top=b.top+this.getMovePixel(a),this.canvas.renderAll()):void 0},left:function(a){var b;return b=this.canvas.getActiveObject(),b?(b.left=b.left-this.getMovePixel(a),this.canvas.renderAll()):void 0},right:function(a){var b;return b=this.canvas.getActiveObject(),b?(b.left=b.left+this.getMovePixel(a),this.canvas.renderAll()):void 0},alignLeft:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.canvas.getActiveGroup(),b._objects){for(c=0,i=b._objects,e=0,g=i.length;g>e;e++)d=i[e],a=d.getBoundingRect(),c=Math.min(a.left,c);for(j=b._objects,f=0,h=j.length;h>f;f++)d=j[f],a=d.getBoundingRect(),d.left=c+a.width/2;return this.saveDelay(),this.canvas.renderAll()}},alignRight:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.canvas.getActiveGroup(),b._objects){for(c=0,i=b._objects,e=0,g=i.length;g>e;e++)d=i[e],a=d.getBoundingRect(),c=Math.max(a.left+a.width,c);for(j=b._objects,f=0,h=j.length;h>f;f++)d=j[f],a=d.getBoundingRect(),d.left=c-a.width/2;return this.canvas.renderAll()}},alignCenter:function(){var a,b,c,d,e;if(a=this.canvas.getActiveGroup(),a._objects){for(e=a._objects,c=0,d=e.length;d>c;c++)b=e[c],b.left=0;return this.canvas.renderAll()}},alignTop:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.canvas.getActiveGroup(),b._objects){for(d=0,i=b._objects,e=0,g=i.length;g>e;e++)c=i[e],a=c.getBoundingRect(),d=Math.min(a.top,d);for(j=b._objects,f=0,h=j.length;h>f;f++)c=j[f],a=c.getBoundingRect(),c.top=d+a.height/2;return this.canvas.renderAll()}},alignBottom:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.canvas.getActiveGroup(),b._objects){for(d=0,i=b._objects,e=0,g=i.length;g>e;e++)c=i[e],a=c.getBoundingRect(),d=Math.max(a.top+a.height,d);for(j=b._objects,f=0,h=j.length;h>f;f++)c=j[f],a=c.getBoundingRect(),c.top=d-a.height/2;return this.canvas.renderAll()}},alignVcenter:function(){var a,b,c,d,e;if(a=this.canvas.getActiveGroup(),a._objects){for(e=a._objects,c=0,d=e.length;d>c;c++)b=e[c],b.top=0;return this.canvas.renderAll()}},zoomIn:function(){var a;return this.unselect(),a=this.scaleFactor,this.scaleFactor=this.scaleFactor+Math.pow(this.scaleFactor+1,2)/20,this.scaleFactor>=4&&(this.scaleFactor=4),1>a&&this.scaleFactor>1&&(this.scaleFactor=1),this.scaleFactor=(100*this.scaleFactor).toFixed(0)/100,this.render()},zoomOut:function(){var a;return this.unselect(),a=this.scaleFactor,this.scaleFactor=this.scaleFactor-Math.pow(this.scaleFactor+1,2)/20,this.scaleFactor<=.05&&(this.scaleFactor=.05),a>1&&this.scaleFactor<1&&(this.scaleFactor=1),this.scaleFactor=(100*this.scaleFactor).toFixed(0)/100,this.render()},zoomReset:function(){return this.unselect(),this.scaleFactor=1,this.render()},setPropetyPanel:function(a){var b,c,d,e,f;if($(".canvas_panel, .object_panel, .group_panel").hide(),a=this.canvas.getActiveObject(),a&&null!=a.getJsonSchema){this.editor.schema=a.getJsonSchema(),e={};for(c in this.editor.schema.properties)f="integer"===this.editor.schema.properties[c].type?parseInt(a[c]).toFixed(0):a[c],e[c]=f;return this.editor.setValue(e),null!=a.toGeoJSON&&$("#geojson").val(JSON.stringify(a.toGeoJSON(),null,4)),$(".object_panel").show(),void $("#object_id").html(a.id)}return(b=this.canvas.getActiveGroup())?(d=b._objects,$("#group_count").html(d.length),$(".group_panel").show(),void 0):$(".canvas_panel").show()}},$.extend(haika,{_api_load_endpoint:"/api/floor/load",_api_save_endpoint:"/api/floor/save",_dataId:null,_revision:null,_collision:null,_nowSaving:!1,_autoSaveTimerId:null,_geojson:{},close:function(){return this._dataId=null,this._revision=null,this._collision=null,this._geojson={},this.objects.length=0,this.backgroundImage=null},openFromApi:function(a,b,c,d){return null==b&&(b=null),null==c&&(c=null),null==d&&(d=null),this._dataId&&this.close(),this._nowSaving&&d&&d(""),$.ajax({url:this._api_load_endpoint,type:"POST",cache:!1,dataType:"json",data:{id:a,revision:b},error:function(){return function(){return d&&d("")}}(this),success:function(a){return function(b){return b.locked?d&&d(""):(a._dataId=b.id,a._revision=b.revision,a._collision=b.collision,a._geojson=b.data,a.loadFromGeoJson(),$(a).trigger("haika:load"),c&&c())}}(this)})},save:function(a,b){var c;return null==a&&(a=null),null==b&&(b=null),log("save"),this.prepareData(),this._autoSaveTimerId&&(clearTimeout(this._autoSaveTimerId),this._autoSaveTimerId=null),this._nowSaving?void setTimeout(function(c){return function(){return c.save(a,b)}}(this),500):(this._nowSaving=!0,c={id:this._dataId,revision:this._revision,collision:this._collision,data:JSON.stringify(this.toGeoJSON())},$.ajax({url:this._api_save_endpoint,type:"POST",data:c,dataType:"json",success:function(c){return function(d){return c._nowSaving=!1,d.success?(c._revision=d.revision,c._collision=d.collision,a&&a(),$(c).trigger("haika:save")):(b&&b(d.message),alert(d.message),void location.reload())}}(this),error:function(a){return function(){return a._nowSaving=!1,b&&b("")}}(this)}))},saveDelay:function(a){return null==a&&(a=2e3),log("save-delay"),this.prepareData(),this._autoSaveTimerId&&(clearTimeout(this._autoSaveTimerId),this._autoSaveTimerId=null),this._autoSaveTimerId=setTimeout(function(a){return function(){return a._autoSaveTimerId=null,a.save()}}(this),a)}}),$.extend(haika,{loadFromGeoJson:function(a){var b,c,d,e,f,g,h,i,j;if(null==a&&(a=null),a||(a=this._geojson),null!=a.haika.backgroundScaleFactor&&(this.backgroundScaleFactor=a.haika.backgroundScaleFactor),this.backgroundScaleFactor||(this.backgroundScaleFactor=1),null!=a.haika.backgroundOpacity&&(this.backgroundOpacity=a.haika.backgroundOpacity),this.backgroundOpacity||(this.backgroundOpacity=1),this.backgroundUrl=null!=a.haika.backgroundUrl?a.haika.backgroundUrl:"",null!=a.haika.xyAngle&&(this.xyAngle=a.haika.xyAngle),null!=a.haika.xyScaleFactor&&(this.xyScaleFactor=a.haika.xyScaleFactor),null!=a.haika.xyLongitude&&null!=a.haika.xyLatitude&&(this.xyLongitude=a.haika.xyLongitude,this.xyLatitude=a.haika.xyLatitude),a&&a.features.length>0){for(i=a.features,j=[],g=0,h=i.length;h>g;g++){d=i[g],d.properties.id>this.lastId&&(this.lastId=d.properties.id),c=this.getClass(d.properties.type),f=new c({id:d.properties.id,top:this.transformTopY_cm2px(d.properties.top_cm),left:this.transformLeftX_cm2px(d.properties.left_cm),top_cm:d.properties.top_cm,left_cm:d.properties.left_cm,fill:d.properties.fill,stroke:d.properties.stroke,angle:d.properties.angle}),e=f.constructor.prototype.getJsonSchema();for(b in e.properties)f[b]=d.properties[b];j.push(this.add(f))}return j}},toGeoJSON:function(){var a,b,c,d,e,f,g;for(b=[],g=this.canvas.getObjects(),e=0,f=g.length;f>e;e++)d=g[e],c=d.toGeoJSON(),b.push(c);return a={type:"FeatureCollection",features:b,haika:{backgroundUrl:this.backgroundUrl,backgroundScaleFactor:this.backgroundScaleFactor,backgroundOpacity:this.backgroundOpacity,xyLongitude:this.xyLongitude,xyLatitude:this.xyLatitude,xyAngle:this.xyAngle,xyScaleFactor:this.xyScaleFactor,version:1}}},prepareData:function(){var a,b,c,d,e,f,g,h;for(g=this.canvas.getObjects(),h=[],e=0,f=g.length;f>e;e++)c=g[e],a=this.getCountFindById(c.id),this.objects[a].id=c.id,this.objects[a].type=c.type,this.objects[a].top_cm=this.transformTopY_px2cm(c.top),this.objects[a].left_cm=this.transformLeftX_px2cm(c.left),this.objects[a].scaleX=c.scaleX/this.scaleFactor,this.objects[a].scaleY=c.scaleY/this.scaleFactor,this.objects[a].angle=c.angle,this.objects[a].fill=c.fill,this.objects[a].stroke=c.stroke,c.top_cm=this.objects[a].top_cm,c.left_cm=this.objects[a].left_cm,d=c.constructor.prototype.getJsonSchema(),h.push(function(){var e;e=[];for(b in d.properties)e.push(this.objects[a][b]=c[b]);return e}.call(this));return h},createGeoJson:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(f=this.translateGeoJSON(),e=[],f&&f.features.length>0)for(o=f.features,k=0,m=o.length;m>k;k++)if(h=o[k],"floor"!==h.properties.type){for(c=[],p=h.geometry.coordinates[0],l=0,n=p.length;n>l;l++)g=p[l],i=g[0],j=g[1],b=proj4("EPSG:3857","EPSG:4326",[i,j]),c.push(b);"merge_floor"===h.properties.type&&(log(h.properties),h.properties.type="floor"),d={type:"Feature",geometry:{type:"Polygon",coordinates:[c]},properties:h.properties},e.push(d)}return a={type:"FeatureCollection",features:e}},translateGeoJSON:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(d=this.toGeoJSON(),d=this.mergeGeoJson(d),c=[],o=d.features,k=0,m=o.length;m>k;k++){if(h=o[k],f=proj4("EPSG:4326","EPSG:3857",[this.xyLongitude,this.xyLatitude])){for(b=[],p=h.geometry.coordinates[0],l=0,n=p.length;n>l;l++)e=p[l],i=e[0]*this.xyScaleFactor,j=e[1]*this.xyScaleFactor,g=fabric.util.rotatePoint(new fabric.Point(i,j),new fabric.Point(0,0),fabric.util.degreesToRadians(-this.xyAngle)),a=[f[0]+g.x,f[1]+g.y],b.push(a);h.geometry.coordinates=[b]}c.push(h)}return d.features=c,d},mergeGeoJson:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(j=[],a&&a.features.length>0){for(w=a.features,m=0,q=w.length;q>m;m++)if(g=w[m],"floor"===g.properties.type){for(i=[],log(g.geometry.coordinates[0]),x=g.geometry.coordinates[0],n=0,r=x.length;r>n;n++)f=x[n],h={X:f[0],Y:f[1]},i.push(h);j.push([i])}for(log(j),c=new ClipperLib.Clipper,o=0,s=j.length;s>o;o++)i=j[o],c.AddPaths(i,ClipperLib.PolyType.ptSubject,!0);for(k=new ClipperLib.Paths,l=c.Execute(ClipperLib.ClipType.ctUnion,k,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero),log(k),p=0,t=k.length;t>p;p++){for(i=k[p],b=[],d=!0,v=0,u=i.length;u>v;v++)h=i[v],d&&(e=[h.X,h.Y],d=!1),b.push([h.X,h.Y]);b.push(e),a.features.push({type:"Feature",geometry:{type:"Polygon",coordinates:[b]},properties:{type:"merge_floor",fill:"#FFFFFF",stroke:"#FFFFFF"}})}}return a},toSVG:function(){var a,b,c,d,e,f,g,h,i;for(f=[],i=this.canvas.getObjects(),g=0,h=i.length;h>g;g++)c=i[g],e=c.toSVG(),f.push(e);return log(f),d='<svg viewBox="0 0 1024 768">',b="</svg>",a=[d,f.join(""),b].join(""),log(a),a},"import":function(){var a,b;return a=window.prompt("id",""),b="http://lab.calil.jp/haika_store/data/"+this.id+".json",$.ajax({url:b,type:"GET",cache:!1,dataType:"text",success:function(a){return function(b){var c,d;return d=JSON.parse(b),c=d.canvas,d.geojson.haika=d.canvas,a.loadRender(d.geojson)}}(this),error:function(){return function(){return alert("")}}(this)})}}),$(haika).on("haika:initialized",function(){var a,b,c,d,e,f,g;return g=5e3,b=haika.backgroundImage?haika.backgroundImage.width:2500,a=haika.backgroundImage?haika.backgroundImage.height:2500,e=b*haika.backgroundScaleFactor/2,f=a*haika.backgroundScaleFactor/2,c=-((haika.centerX-g)/1e4),d=-((haika.centerY-g)/1e4),new Dragdealer("horizontal-scroller",{x:c,animationCallback:function(a){var b;return haika.unselect(),b=1e4*a-g,b>e-haika.canvas.getWidth()/2&&(b=e-haika.canvas.getWidth()/2),b<-e+haika.canvas.getWidth()/2&&(b=-e+haika.canvas.getWidth()/2),haika.centerX=-b.toFixed(0),haika.render()}}),new Dragdealer("vertical-scroller",{y:d,horizontal:!1,vertical:!0,animationCallback:function(a,b){var c;return haika.unselect(),c=1e4*b-g,c>f-haika.canvas.getHeight()/2&&(c=f-haika.canvas.getHeight()/2),c<-f+haika.canvas.getHeight()/2&&(c=-f+haika.canvas.getHeight()/2),haika.centerY=-c.toFixed(0),haika.render()}})}),$.extend(haika,{setting:{navbar_height:function(){return $("#navbar").length>0?$("#navbar").height()+45:0},sidebar_width:function(){return $(".sidebar-collapse").length>0?$(".sidebar-collapse").width()+45:0},scrollbar_width:$("#vertical-scroller").width(),scrollbar_height:$("#horizontal-scroller").height(),toolbar_width:$(".toolbar_container").width()+14,property_panel_width:$(".property_panel").width(),getWidth:function(){return window.innerWidth-this.sidebar_width()-this.toolbar_width-this.scrollbar_width-this.property_panel_width-20},getHeight:function(){return window.innerHeight-this.navbar_height()-$(".header").height()-this.scrollbar_height},start:function(){return $(".main_container, .canvas_panel").css("width",this.getWidth()),$(".main_container").css("margin-left",this.toolbar_width),$("#vertical-scroller, #vertical-scroller .dragdealer").css("height",this.getHeight()),$(".toolbar_container,.property_panel").css("height",this.getHeight()+this.scrollbar_height),$(window).resize(function(a){return function(){return haika.canvas.setWidth(a.getWidth()),haika.canvas.setHeight(a.getHeight()),$(".main_container, .canvas_panel").css("width",a.getWidth()),$("#vertical-scroller, #vertical-scroller .dragdealer").css("height",a.getHeight()),$(".toolbar_container,.property_panel").css("height",a.getHeight()+a.scrollbar_height),haika.render()}}(this)),haika.init({canvasId:"canvas_area",width:this.getWidth(),height:this.getHeight()})}}}),$(function(){return $(".nav-tabs a").click(function(a){return a.preventDefault(),haika.state=$(a.target).attr("class"),haika.render(),haika.addbuttons.showAddButtons(haika.state),$(this).tab("show")})}),haika.setting.start(),$.extend(haika,{addbuttons:{add:function(a){var b,c,d;return log(a),c=haika.getClass(a.type),d=new c({top:haika.transformTopY_cm2px(haika.centerY),left:haika.transformLeftX_cm2px(haika.centerX),fill:haika.fillColor,stroke:haika.strokeColor,angle:null!=a.angle?a.angle:0}),null!=a.count&&(d.count=a.count),null!=a.side&&(d.side=a.side),a.type.match(/shelf$/)&&(d.eachWidth=a.eachWidth,d.eachHeight=a.eachHeight),b=haika.add(d),haika.setState(d),haika.render(),haika.undo.add(b),$(haika.canvas.getObjects()).each(function(){return function(a,b){return b.id===d.id?setTimeout(function(){return haika.canvas.setActiveObject(haika.canvas.item(a)),$(".add").blur()},10):void 0}}(this))},addmany:function(){var a,b;for(b=0;8>b;){for(a=0;22>a;)this.add(200+400*b,100+50*a,90),a++;b++}haika.render()},showAddButtons:function(a){return $(".toolbar_container ul:first>li").each(function(b,c){return $(c).attr("state")===a?$(c).show():$(c).hide()})}}}),$(function(){var a,b,c,d,e;a={shelf:{icon:"square-o",title:"",eachWidth:90,eachHeight:26,count:5,side:1,state:"shelf"},big_shelf:{icon:"square-o",title:"",eachWidth:90,eachHeight:33,count:5,side:1,state:"shelf"},magazine_shelf:{icon:"square-o",title:"",eachWidth:90,eachHeight:45,count:5,side:1,state:"shelf"},kamishibai_shelf:{icon:"square-o",title:"",eachWidth:90,eachHeight:90,count:1,side:1,state:"shelf"},booktrack_shelf:{icon:"square-o",title:"",eachWidth:60,eachHeight:40,count:1,side:1,angle:20,state:"shelf"},curved_shelf:{icon:"dot-circle-o",title:"",count:3,side:2,state:"shelf"},beacon:{icon:"square",title:"",state:"beacon"},wall:{icon:"square",title:"",state:"wall"},floor:{icon:"square",title:"",state:"floor"}},e=[];for(c in a)d=a[c],b='<li id="add_'+c+'" key="'+c+'" state="'+d.state+'"><i class="fa fa-'+d.icon+'"></i> '+d.title+"</li>",$(".toolbar_container ul:first").append(b),haika.addbuttons.showAddButtons("shelf"),e.push($("#add_"+c).click(function(b){var d;return c=$(b.target).attr("key"),d=a[c],d.type=c,haika.addbuttons.add(d),haika.render()}));return e}),$(haika).on("haika:initialized",function(){return haika.addbuttons.showAddButtons(haika.state)}),$.extend(haika,{colorpicker:{init:function(){var a,b,c,d,e,f,g,h,i;for(e="",c=new Array("f","c","9","6","3","0"),b=2,g=0;6>g;){for(h=0;6>h;){for(i=0;6>i;)d=c[g]+c[g]+c[h]+c[h]+c[i]+c[i],e+='<option data-color="#'+d+'" value="'+b+'"></option>',i++,b++;h++}g++}for(f=0;6>f;)d=c[f]+c[f]+c[f]+c[f]+c[f]+c[f],e+='<option data-color="#'+d+'" value="'+b+'"></option>',f++;return $("#fill-color").append(e),$("#stroke-color").append(e),a=function(a,b){var c,d,e,f,g,h;if(null==b&&(b=!0),d=haika.canvas.getActiveObject(),d&&a(d),c=haika.canvas.getActiveGroup()){for(g=c.getObjects(),h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(a(d));return h}},$("#fill-color").colorselector({callback:function(b,c){return haika.fillColor=c,a(function(a){return a.fill=c}),haika.canvas.renderAll()}}),$("#stroke-color").colorselector({callback:function(b,c){return haika.strokeColor=c,a(function(a){return a.stroke=c}),haika.canvas.renderAll()}})}}}),haika.colorpicker.init(),$("#bgimg").change(function(a){var b,c;return c=a.target.files,0!==c.length?(b=new FormData,b.append("id",haika.id),b.append("userfile",c[0]),$.ajax({url:"/haika_store/upload.php",data:b,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(){var a;return a="/haika_store/image/"+haika.id+"_"+c[0].name,haika.loadBgFromUrl(a)}})):void 0}),$(haika).on("haika:load",function(){return $(".add_custom_shelf").click(function(){return add("custom_shelf"),haika.render()}),$(".add_beacon").click(function(){return add("beacon"),haika.render()}),$(".remove").click(function(){var a;return a=haika.canvas.getActiveObject(),haika.remove(),a?haika.undo.remove(a):void 0}),$(".zoomin").click(function(){return haika.zoomIn()}),$(".zoomout").click(function(){return haika.zoomOut()}),$(".zoomreset").click(function(){return haika.zoomReset()}),$(".bringtofront").click(function(){return haika.bringToFront()}),$(".duplicate").click(function(){return haika.duplicate()}),$(".copy").click(function(){return haika.copy()}),$(".paste").click(function(){return haika.paste()}),$(".align-left").click(function(){return haika.alignLeft()}),$(".align-center").click(function(){return haika.alignCenter()}),$(".align-right").click(function(){return haika.alignRight()}),$(".align-top").click(function(){return haika.alignTop()}),$(".align-vcenter").click(function(){return haika.alignVcenter()}),$(".align-bottom").click(function(){return haika.alignBottom()})}),$(haika).on("haika:load",function(){var a,b;return b=!1,$("canvas").on("mousewheel",function(){return function(a){return b?void 0:(b=setTimeout(function(){return b=!1},100),a.deltaY>0&&haika.zoomIn(),a.deltaY<0?haika.zoomOut():void 0)}}(this)),$("#canvas_bgscale").change(function(){return haika.backgroundScaleFactor=parseFloat($(this).val()),haika.render()}),$("#bgreset").click(function(){return haika.resetBg()}),$("#bgopacity_slider").slider({step:1,min:1,max:100,value:100*haika.backgroundOpacity,formatter:function(a){return haika.backgroundOpacity=a/100,haika.render(),a/100}}),$(".undo").click(function(){return haika.undo.undoManager.undo()}),a=function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1},Mousetrap.bind("mod+o",function(){return $("#file").trigger("click"),!1}),Mousetrap.bind("mod+c",function(){return haika.copy(),!1}),Mousetrap.bind("mod+v",function(){return haika.paste(),!1}),Mousetrap.bind("mod+d",function(b){return a(b),haika.duplicate(),!1}),Mousetrap.bind("mod+a",function(b){return a(b),haika.selectAll(),!1}),Mousetrap.bind("mod+z",function(b){return a(b),haika.undo.undoManager.undo(),!1}),Mousetrap.bind(["esc","escape"],function(b){return a(b),haika.unselectAll(),!1}),Mousetrap.bind(["up","shift+up"],function(b){return a(b),haika.up(b),!1}),Mousetrap.bind(["down","shift+down"],function(b){return a(b),haika.down(b),!1}),Mousetrap.bind(["left","shift+left"],function(b){return a(b),haika.left(b),!1}),Mousetrap.bind(["right","shift+right"],function(b){return a(b),haika.right(b),!1}),$(document).unbind("keydown").bind("keydown",function(a){var b,c;c=!1,(8===a.keyCode||46===a.keyCode)&&(b=a.srcElement||a.target,c="INPUT"===b.tagName.toUpperCase()&&("TEXT"===b.type.toUpperCase()||"PASSWORD"===b.type.toUpperCase()||"FILE"===b.type.toUpperCase()||"EMAIL"===b.type.toUpperCase())||"TEXTAREA"===b.tagName.toUpperCase()?b.readOnly||b.disabled:!0),c&&(a.preventDefault(),haika.remove())})}),$.extend(haika,{undo:{undoManager:new UndoManager,states:[],set_selected:!0,add:function(a){return log("add set"),this.undoManager.add({undo:function(b){return function(){var c;return log("undo add "+a),c=b.getObject(a),log(c),haika.__remove(c)}}(this),redo:function(){return function(){}}(this)})},remove:function(a){return log("remove set"),this.undoManager.add({undo:function(){return function(){return log("undo remove "+a.id),log(a),haika.add(a),haika.render()}}(this),redo:function(){return function(){}}(this)})},init:function(){return haika.canvas.on("object:selected",function(a){return function(b){var c,d;return c=b.target,a.set_selected?0===a.states.length||c.id!==a.states[a.states.length-1].id?(c.saveState(),d=$.extend(!0,{},c.originalState),d.state_type="selected",a.states.push(d)):void 0:void(a.set_selected=!0)}}(this)),haika.canvas.on("selection:cleared",function(){return function(a){var b;return b=a.target}}(this)),haika.canvas.on("object:modified",function(a){return function(b){var c,d;c=b.target,c.saveState(),d=$.extend(!0,{},c.originalState),d.state_type="modified",a.states.push(d),a.undoManager.add({undo:function(){var b;return a.states.length>0?(haika.canvas.deactivateAll(),b=a.states[a.states.length-2],c=a.getObject(b.id),c&&(a.setState(c,b),a.states.pop(),"selected"===a.states[a.states.length-1].state_type&&a.states.pop(),a.set_selected=!1,haika.canvas.setActiveObject(c)),log(a.states)):void 0},redo:function(){}})}}(this))},getObject:function(a){var b,c,d,e,f;for(c=null,f=haika.canvas.getObjects(),d=0,e=f.length;e>d;d++)if(b=f[d],b.id===a){c=b;break}return c},setState:function(a,b){return a.setOptions(b),a.setCoords()}}}),haika.undo.init();var addPixel,loadComplete,loadImg;loadImg=function(a){var b;if(a.type.match(/image\/.+/)&&"image/svg+xml"!==a.type)return b=new FileReader,b.onload=function(){return loadComplete(this.result)},b.readAsDataURL(a)},$("#file").change(function(a){var b;return b=a.target.files,0!==b.length?loadImg(b[0]):void 0}),loadComplete=function(a){var b,c,d,e,f,g,h;return e=new Image,e.src=a,b=document.createElement("canvas"),c=b.getContext("2d"),b.width=e.width,b.height=e.height,c.translate(0,e.height),c.scale(1,-1),c.translate(e.width,0),c.scale(-1,1),c.drawImage(e,0,0),g=b.width,d=b.height,a=c.getImageData(0,0,g,d).data,f={image:a,w:g,h:d},h=new Worker("js/haika-image-worker.js"),h.onmessage=function(a){var b,c,d,e;switch(log(a.data),a.data.status){case"working":return log(a.data.count);case"end":for(c=a.data.result,d=0,e=c.length;e>d;d++)b=c[d],addPixel(b.x,b.y,b.color);return haika.render()}},h.postMessage(f)},addPixel=function(a,b,c){var d,e,f;return d=10,e=haika.getClass("shelf"),f=new e({top:haika.transformTopY_cm2px(b*d),left:haika.transformLeftX_cm2px(a*d),fill:c,stroke:c,angle:0,count:1,side:1,eachWidth:d,eachHeight:d}),haika.add(f)},$.extend(haika,{editor:new JSONEditor(document.getElementById("editor"),{theme:"bootstrap3",iconlib:"fontawesome4",disable_edit_json:!0,disable_properties:!0,schema:{title:"",type:"object",properties:{label:{title:"",type:"string"},count:{title:"",type:"integer","default":3,minimum:1,maximum:10},side:{title:"",type:"integer","default":1,minimum:1,maximum:2},angle:{title:"",type:"integer","default":0,minimum:0,maximum:360},eachWidth:{type:"integer","default":90,minimum:1},eachHeight:{type:"integer","default":25,minimum:1},minor:{type:"integer"}}}}),editor_change:function(){var a,b,c,d,e;if(c=haika.editor.validate(),c.length)log(c);else if(b=haika.editor.getValue(),log(b),e=haika.canvas.getActiveObject(),log(e),e){a=!1;for(d in haika.editor.schema.properties)log(d),log(b[d]),e[d]!==b[d]&&(e[d]=b[d],a=!0);a&&(log("change"),haika.save())}}}),haika.editor.on("change",function(){return log("onchange")}),$.extend(haika,{map:{map:null,created:!1,features:[],init:function(){return $(".map_setting").click(function(a){return function(){return"block"===$(".haika_container").css("display")?(a.created||(a.set(),a.created=!0),$(".haika_container").hide(),$(document.body).css("background","#333333"),a.redraw(),$(".map_container").show(),$("#map_query").focus()):($(document.body).css("background","#FFFFFF"),$(".haika_container").show(),$(".map_container").hide())}}(this))},redraw:function(){var a,b,c,d;if(this.features.length>0){for(d=this.features,b=0,c=d.length;c>b;b++)a=d[b],this.map.data.remove(a);return this.features=this.map.data.addGeoJson(haika.createGeoJson())}},save:function(a,b){return $("#canvas_lon").val(b),$("#canvas_lat").val(a),haika.xyLongitude=b,haika.xyLatitude=a,haika.save()},set:function(){var a;return this.map=new google.maps.Map(document.getElementById("map"),{zoom:20,maxZoom:28,center:{lat:haika.xyLatitude,lng:haika.xyLongitude}}),a={fillColor:"orange",strokeWeight:1},this.map.data.setStyle(a),this.features=this.map.data.addGeoJson(haika.createGeoJson()),google.maps.event.addListener(this.map,"dragend",function(a){return function(){var b,c;return log(a.map.getCenter()),c=a.map.getCenter().lng(),b=a.map.getCenter().lat(),a.save(b,c),a.redraw()}}(this)),$("#map_search").submit(function(a){return function(){var b,c;return b=$("#map_query").val(),c=new google.maps.Geocoder,c.geocode({address:b},function(b,c){return c===google.maps.GeocoderStatus.OK?(a.map.setCenter(b[0].geometry.location),a.save(b[0].geometry.location.lat(),b[0].geometry.location.lng()),a.redraw()):alert(": "+c)}),!1}}(this)),$("#canvas_lat").change(function(){return haika.xyLatitude=parseFloat($(this).val()),haika.save()}),$("#canvas_lon").change(function(){return haika.xyLongitude=parseFloat($(this).val()),haika.save()}),$("#canvas_angle").change(function(a){return function(){return a.redraw()}}(this)),$("#canvas_angle").slider({tooltip:"always",step:1,min:0,max:360,value:haika.xyAngle,formatter:function(a){return function(b){return haika.xyAngle=parseFloat(b),haika.saveDelay(),a.redraw(),b+""}}(this)}),$("#geojson_scale").slider({tooltip:"always",step:1,min:0,max:400,value:100*haika.xyScaleFactor,formatter:function(a){return function(b){return haika.xyScaleFactor=parseFloat(b)/100,haika.saveDelay(),a.redraw(),b+"%"}}(this)})}}}),haika.map.init();