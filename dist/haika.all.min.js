/*! haika.js 22-04-2015 */
function ConvexHullGrahamScan(){this.anchorPoint=void 0,this.reverse=!1,this.points=[]}var fabric=fabric||{version:"1.5.0"};"undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",function(){function a(a,b){this.__eventListeners[a]&&(b?fabric.util.removeFromArray(this.__eventListeners[a],b):this.__eventListeners[a].length=0)}function b(a,b){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var c in a)this.on(c,a[c]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(b);return this}function c(b,c){if(this.__eventListeners){if(0===arguments.length)this.__eventListeners={};else if(1===arguments.length&&"object"==typeof arguments[0])for(var d in b)a.call(this,d,b[d]);else a.call(this,b,c);return this}}function d(a,b){if(this.__eventListeners){var c=this.__eventListeners[a];if(c){for(var d=0,e=c.length;e>d;d++)c[d].call(this,b||{});return this}}}fabric.Observable={observe:b,stopObserving:c,fire:d,on:b,off:c,trigger:d}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=0,b=arguments.length;b>a;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(a,b,c){var d=this.getObjects();return c?d[b]=a:d.splice(b,0,a),this._onObjectAdded(a),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var a,b=this.getObjects(),c=0,d=arguments.length;d>c;c++)a=b.indexOf(arguments[c]),-1!==a&&(b.splice(a,1),this._onObjectRemoved(arguments[c]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(a,b){for(var c=this.getObjects(),d=c.length;d--;)a.call(b,c[d],d,c);return this},getObjects:function(a){return"undefined"==typeof a?this._objects:this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)}},function(a){var b=Math.sqrt,c=Math.atan2,d=Math.PI/180;fabric.util={removeFromArray:function(a,b){var c=a.indexOf(b);return-1!==c&&a.splice(c,1),a},getRandomInt:function(a,b){return Math.floor(Math.random()*(b-a+1))+a},degreesToRadians:function(a){return a*d},radiansToDegrees:function(a){return a/d},rotatePoint:function(a,b,c){var d=Math.sin(c),e=Math.cos(c);a.subtractEquals(b);var f=a.x*e-a.y*d,g=a.x*d+a.y*e;return new fabric.Point(f,g).addEquals(b)},transformPoint:function(a,b,c){return c?new fabric.Point(b[0]*a.x+b[2]*a.y,b[1]*a.x+b[3]*a.y):new fabric.Point(b[0]*a.x+b[2]*a.y+b[4],b[1]*a.x+b[3]*a.y+b[5])},invertTransform:function(a){var b=a.slice(),c=1/(a[0]*a[3]-a[1]*a[2]);b=[c*a[3],-c*a[1],-c*a[2],c*a[0],0,0];var d=fabric.util.transformPoint({x:a[4],y:a[5]},b);return b[4]=-d.x,b[5]=-d.y,b},toFixed:function(a,b){return parseFloat(Number(a).toFixed(b))},parseUnit:function(a,b){var c=/\D{0,2}$/.exec(a),d=parseFloat(a);switch(b||(b=fabric.Text.DEFAULT_SVG_FONT_SIZE),c[0]){case"mm":return d*fabric.DPI/25.4;case"cm":return d*fabric.DPI/2.54;case"in":return d*fabric.DPI;case"pt":return d*fabric.DPI/72;case"pc":return d*fabric.DPI/72*12;case"em":return d*b;default:return d}},falseFunction:function(){return!1},getKlass:function(a,b){return a=fabric.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),fabric.util.resolveNamespace(b)[a]},resolveNamespace:function(b){if(!b)return fabric;for(var c=b.split("."),d=c.length,e=a||fabric.window,f=0;d>f;++f)e=e[c[f]];return e},loadImage:function(a,b,c,d){if(!a)return void(b&&b.call(c,a));var e=fabric.util.createImage();e.onload=function(){b&&b.call(c,e),e=e.onload=e.onerror=null},e.onerror=function(){fabric.log("Error loading "+e.src),b&&b.call(c,null,!0),e=e.onload=e.onerror=null},0!==a.indexOf("data")&&"undefined"!=typeof d&&(e.crossOrigin=d),e.src=a},enlivenObjects:function(a,b,c,d){function e(){++g===h&&b&&b(f)}a=a||[];var f=[],g=0,h=a.length;return h?void a.forEach(function(a,b){if(!a||!a.type)return void e();var g=fabric.util.getKlass(a.type,c);g.async?g.fromObject(a,function(c,g){g||(f[b]=c,d&&d(a,f[b])),e()}):(f[b]=g.fromObject(a),d&&d(a,f[b]),e())}):void(b&&b(f))},groupSVGElements:function(a,b,c){var d;return d=new fabric.PathGroup(a,b),"undefined"!=typeof c&&d.setSourcePath(c),d},populateWithProperties:function(a,b,c){if(c&&"[object Array]"===Object.prototype.toString.call(c))for(var d=0,e=c.length;e>d;d++)c[d]in a&&(b[c[d]]=a[c[d]])},drawDashedLine:function(a,d,e,f,g,h){var i=f-d,j=g-e,k=b(i*i+j*j),l=c(j,i),m=h.length,n=0,o=!0;for(a.save(),a.translate(d,e),a.moveTo(0,0),a.rotate(l),d=0;k>d;)d+=h[n++%m],d>k&&(d=k),a[o?"lineTo":"moveTo"](d,0),o=!o;a.restore()},createCanvasElement:function(a){return a||(a=fabric.document.createElement("canvas")),a.getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a),a},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(a){for(var b=a.prototype,c=b.stateProperties.length;c--;){var d=b.stateProperties[c],e=d.charAt(0).toUpperCase()+d.slice(1),f="set"+e,g="get"+e;b[g]||(b[g]=function(a){return new Function('return this.get("'+a+'")')}(d)),b[f]||(b[f]=function(a){return new Function("value",'return this.set("'+a+'", value)')}(d))}},clipContext:function(a,b){b.save(),b.beginPath(),a.clipTo(b),b.clip()},multiplyTransformMatrices:function(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]},getFunctionBody:function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(a,b,c,d){d>0&&(b>d?b-=d:b=0,c>d?c-=d:c=0);for(var e=!0,f=a.getImageData(b,c,2*d||1,2*d||1),g=3,h=f.data.length;h>g;g+=4){var i=f.data[g];if(e=0>=i,e===!1)break}return f=null,e}}}("undefined"!=typeof exports?exports:this),function(){function a(a,d,f,g,i,j,k){var l=h.call(arguments);if(e[l])return e[l];var m=Math.PI,n=k*m/180,o=Math.sin(n),p=Math.cos(n),q=0,r=0;f=Math.abs(f),g=Math.abs(g);var s=-p*a*.5-o*d*.5,t=-p*d*.5+o*a*.5,u=f*f,v=g*g,w=t*t,x=s*s,y=u*v-u*w-v*x,z=0;if(0>y){var A=Math.sqrt(1-y/(u*v));f*=A,g*=A}else z=(i===j?-1:1)*Math.sqrt(y/(u*w+v*x));var B=z*f*t/g,C=-z*g*s/f,D=p*B-o*C+.5*a,E=o*B+p*C+.5*d,F=c(1,0,(s-B)/f,(t-C)/g),G=c((s-B)/f,(t-C)/g,(-s-B)/f,(-t-C)/g);0===j&&G>0?G-=2*m:1===j&&0>G&&(G+=2*m);for(var H=Math.ceil(Math.abs(G/m*2)),I=[],J=G/H,K=8/3*Math.sin(J/4)*Math.sin(J/4)/Math.sin(J/2),L=F+J,M=0;H>M;M++)I[M]=b(F,L,p,o,f,g,D,E,K,q,r),q=I[M][4],r=I[M][5],F=L,L+=J;return e[l]=I,I}function b(a,b,c,d,e,g,i,j,k,l,m){var n=h.call(arguments);if(f[n])return f[n];var o=Math.cos(a),p=Math.sin(a),q=Math.cos(b),r=Math.sin(b),s=c*e*q-d*g*r+i,t=d*e*q+c*g*r+j,u=l+k*(-c*e*p-d*g*o),v=m+k*(-d*e*p+c*g*o),w=s+k*(c*e*r+d*g*q),x=t+k*(d*e*r-c*g*q);return f[n]=[u,v,w,x,s,t],f[n]}function c(a,b,c,d){var e=Math.atan2(b,a),f=Math.atan2(d,c);return f>=e?f-e:2*Math.PI-(e-f)}function d(a,b,c,d,e,f,i,j){var k=h.call(arguments);if(g[k])return g[k];var l,m,n,o,p,q,r,s,t=Math.sqrt,u=Math.min,v=Math.max,w=Math.abs,x=[],y=[[],[]];m=6*a-12*c+6*e,l=-3*a+9*c-9*e+3*i,n=3*c-3*a;for(var z=0;2>z;++z)if(z>0&&(m=6*b-12*d+6*f,l=-3*b+9*d-9*f+3*j,n=3*d-3*b),w(l)<1e-12){if(w(m)<1e-12)continue;o=-n/m,o>0&&1>o&&x.push(o)}else r=m*m-4*n*l,0>r||(s=t(r),p=(-m+s)/(2*l),p>0&&1>p&&x.push(p),q=(-m-s)/(2*l),q>0&&1>q&&x.push(q));for(var A,B,C,D=x.length,E=D;D--;)o=x[D],C=1-o,A=C*C*C*a+3*C*C*o*c+3*C*o*o*e+o*o*o*i,y[0][D]=A,B=C*C*C*b+3*C*C*o*d+3*C*o*o*f+o*o*o*j,y[1][D]=B;y[0][E]=a,y[1][E]=b,y[0][E+1]=i,y[1][E+1]=j;var F=[{x:u.apply(null,y[0]),y:u.apply(null,y[1])},{x:v.apply(null,y[0]),y:v.apply(null,y[1])}];return g[k]=F,F}var e={},f={},g={},h=Array.prototype.join;fabric.util.drawArc=function(b,c,d,e){for(var f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=[[],[],[],[]],n=a(k-c,l-d,f,g,i,j,h),o=0,p=n.length;p>o;o++)m[o][0]=n[o][0]+c,m[o][1]=n[o][1]+d,m[o][2]=n[o][2]+c,m[o][3]=n[o][3]+d,m[o][4]=n[o][4]+c,m[o][5]=n[o][5]+d,b.bezierCurveTo.apply(b,m[o])},fabric.util.getBoundsOfArc=function(b,c,e,f,g,h,i,j,k){for(var l=0,m=0,n=[],o=[],p=a(j-b,k-c,e,f,h,i,g),q=[[],[]],r=0,s=p.length;s>r;r++)n=d(l,m,p[r][0],p[r][1],p[r][2],p[r][3],p[r][4],p[r][5]),q[0].x=n[0].x+b,q[0].y=n[0].y+c,q[1].x=n[1].x+b,q[1].y=n[1].y+c,o.push(q[0]),o.push(q[1]),l=p[r][4],m=p[r][5];return o},fabric.util.getBoundsOfCurve=d}(),function(){function a(a,b){for(var c=e.call(arguments,2),d=[],f=0,g=a.length;g>f;f++)d[f]=c.length?a[f][b].apply(a[f],c):a[f][b].call(a[f]);return d}function b(a,b){return d(a,b,function(a,b){return a>=b})}function c(a,b){return d(a,b,function(a,b){return b>a})}function d(a,b,c){if(a&&0!==a.length){var d=a.length-1,e=b?a[d][b]:a[d];if(b)for(;d--;)c(a[d][b],e)&&(e=a[d][b]);else for(;d--;)c(a[d],e)&&(e=a[d]);return e}}var e=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==Number.POSITIVE_INFINITY&&d!==Number.NEGATIVE_INFINITY&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)c in this&&a.call(b,this[c],c,this)}),Array.prototype.map||(Array.prototype.map=function(a,b){for(var c=[],d=0,e=this.length>>>0;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),Array.prototype.every||(Array.prototype.every=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(a,b){for(var c=0,d=this.length>>>0;d>c;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(a,b){for(var c,d=[],e=0,f=this.length>>>0;f>e;e++)e in this&&(c=this[e],a.call(b,c,e,this)&&d.push(c));return d}),Array.prototype.reduce||(Array.prototype.reduce=function(a){var b,c=this.length>>>0,d=0;if(arguments.length>1)b=arguments[1];else for(;;){if(d in this){b=this[d++];break}if(++d>=c)throw new TypeError}for(;c>d;d++)d in this&&(b=a.call(null,b,this[d],d,this));return b}),fabric.util.array={invoke:a,min:c,max:b}}(),function(){function a(a,b){for(var c in b)a[c]=b[c];return a}function b(b){return a({},b)}fabric.util.object={extend:a,clone:b}}(),function(){function a(a){return a.replace(/-+(.)?/g,function(a,b){return b?b.toUpperCase():""})}function b(a,b){return a.charAt(0).toUpperCase()+(b?a.slice(1):a.slice(1).toLowerCase())}function c(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:a,capitalize:b,escapeXml:c}}(),function(){var a=Array.prototype.slice,b=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(d){var e,f=this,g=a.call(arguments,1);return e=g.length?function(){return b.call(f,this instanceof c?this:d,g.concat(a.call(arguments)))}:function(){return b.call(f,this instanceof c?this:d,arguments)},c.prototype=this.prototype,e.prototype=new c,e})}(),function(){function a(){}function b(a){var b=this.constructor.superclass.prototype[a];return arguments.length>1?b.apply(this,d.call(arguments,1)):b.call(this)}function c(){function c(){this.initialize.apply(this,arguments)}var f=null,h=d.call(arguments,0);"function"==typeof h[0]&&(f=h.shift()),c.superclass=f,c.subclasses=[],f&&(a.prototype=f.prototype,c.prototype=new a,f.subclasses.push(c));for(var i=0,j=h.length;j>i;i++)g(c,h[i],f);return c.prototype.initialize||(c.prototype.initialize=e),c.prototype.constructor=c,c.prototype.callSuper=b,c}var d=Array.prototype.slice,e=function(){},f=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,b,c){for(var d in b)a.prototype[d]=d in a.prototype&&"function"==typeof a.prototype[d]&&(b[d]+"").indexOf("callSuper")>-1?function(a){return function(){var d=this.constructor.superclass;this.constructor.superclass=c;var e=b[a].apply(this,arguments);return this.constructor.superclass=d,"initialize"!==a?e:void 0}}(d):b[d],f&&(b.toString!==Object.prototype.toString&&(a.prototype.toString=b.toString),b.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=b.valueOf))};fabric.util.createClass=c}(),function(){function a(a){var b,c,d=Array.prototype.slice.call(arguments,1),e=d.length;for(c=0;e>c;c++)if(b=typeof a[d[c]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function b(a,b){return{handler:b,wrappedHandler:c(a,b)}}function c(a,b){return function(c){b.call(g(a),c||fabric.window.event)}}function d(a,b){return function(c){if(p[a]&&p[a][b])for(var d=p[a][b],e=0,f=d.length;f>e;e++)d[e].call(this,c||fabric.window.event)}}function e(a,b){a||(a=fabric.window.event);var c=a.target||(typeof a.srcElement!==i?a.srcElement:null),d=fabric.util.getScrollLeftTop(c,b);return{x:q(a)+d.left,y:r(a)+d.top}}function f(a,b,c){var d="touchend"===a.type?"changedTouches":"touches";return a[d]&&a[d][0]?a[d][0][b]-(a[d][0][b]-a[d][0][c])||a[c]:a[c]}var g,h,i="unknown",j=function(){var a=0;return function(b){return b.__uniqueID||(b.__uniqueID="uniqueID__"+a++)}}();!function(){var a={};g=function(b){return a[b]},h=function(b,c){a[b]=c}}();var k,l,m=a(fabric.document.documentElement,"addEventListener","removeEventListener")&&a(fabric.window,"addEventListener","removeEventListener"),n=a(fabric.document.documentElement,"attachEvent","detachEvent")&&a(fabric.window,"attachEvent","detachEvent"),o={},p={};m?(k=function(a,b,c){a.addEventListener(b,c,!1)},l=function(a,b,c){a.removeEventListener(b,c,!1)}):n?(k=function(a,c,d){var e=j(a);h(e,a),o[e]||(o[e]={}),o[e][c]||(o[e][c]=[]);var f=b(e,d);o[e][c].push(f),a.attachEvent("on"+c,f.wrappedHandler)},l=function(a,b,c){var d,e=j(a);if(o[e]&&o[e][b])for(var f=0,g=o[e][b].length;g>f;f++)d=o[e][b][f],d&&d.handler===c&&(a.detachEvent("on"+b,d.wrappedHandler),o[e][b][f]=null)}):(k=function(a,b,c){var e=j(a);if(p[e]||(p[e]={}),!p[e][b]){p[e][b]=[];var f=a["on"+b];f&&p[e][b].push(f),a["on"+b]=d(e,b)}p[e][b].push(c)},l=function(a,b,c){var d=j(a);if(p[d]&&p[d][b])for(var e=p[d][b],f=0,g=e.length;g>f;f++)e[f]===c&&e.splice(f,1)}),fabric.util.addListener=k,fabric.util.removeListener=l;var q=function(a){return typeof a.clientX!==i?a.clientX:0},r=function(a){return typeof a.clientY!==i?a.clientY:0};fabric.isTouchSupported&&(q=function(a){return f(a,"pageX","clientX")},r=function(a){return f(a,"pageY","clientY")}),fabric.util.getPointer=e,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function a(a,b){var c=a.style;if(!c)return a;if("string"==typeof b)return a.style.cssText+=";"+b,b.indexOf("opacity")>-1?f(a,b.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var d in b)if("opacity"===d)f(a,b[d]);else{var e="float"===d||"cssFloat"===d?"undefined"==typeof c.styleFloat?"cssFloat":"styleFloat":d;c[e]=b[d]}return a}var b=fabric.document.createElement("div"),c="string"==typeof b.style.opacity,d="string"==typeof b.style.filter,e=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};c?f=function(a,b){return a.style.opacity=b,a}:d&&(f=function(a,b){var c=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(c.zoom=1),e.test(c.filter)?(b=b>=.9999?"":"alpha(opacity="+100*b+")",c.filter=c.filter.replace(e,b)):c.filter+=" alpha(opacity="+100*b+")",a}),fabric.util.setStyle=a}(),function(){function a(a){return"string"==typeof a?fabric.document.getElementById(a):a}function b(a,b){var c=fabric.document.createElement(a);for(var d in b)"class"===d?c.className=b[d]:"for"===d?c.htmlFor=b[d]:c.setAttribute(d,b[d]);return c}function c(a,b){a&&-1===(" "+a.className+" ").indexOf(" "+b+" ")&&(a.className+=(a.className?" ":"")+b)}function d(a,c,d){return"string"==typeof c&&(c=b(c,d)),a.parentNode&&a.parentNode.replaceChild(c,a),c.appendChild(a),c}function e(a,b){var c,d,e=0,f=0,g=fabric.document.documentElement,h=fabric.document.body||{scrollLeft:0,scrollTop:0};for(d=a;a&&a.parentNode&&!c;)a=a.parentNode,1===a.nodeType&&"fixed"===fabric.util.getElementStyle(a,"position")&&(c=a),1===a.nodeType&&d!==b&&"absolute"===fabric.util.getElementStyle(a,"position")?(e=0,f=0):a===fabric.document?(e=h.scrollLeft||g.scrollLeft||0,f=h.scrollTop||g.scrollTop||0):(e+=a.scrollLeft||0,f+=a.scrollTop||0);return{left:e,top:f}}function f(a){var b,c,d=a&&a.ownerDocument,e={left:0,top:0},f={left:0,top:0},g={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!d)return{left:0,top:0};for(var h in g)f[g[h]]+=parseInt(k(a,h),10)||0;return b=d.documentElement,"undefined"!=typeof a.getBoundingClientRect&&(e=a.getBoundingClientRect()),c=fabric.util.getScrollLeftTop(a,null),{left:e.left+c.left-(b.clientLeft||0)+f.left,top:e.top+c.top-(b.clientTop||0)+f.top}}var g,h=Array.prototype.slice,i=function(a){return h.call(a,0)};try{g=i(fabric.document.childNodes)instanceof Array}catch(j){}g||(i=function(a){for(var b=new Array(a.length),c=a.length;c--;)b[c]=a[c];return b});var k;k=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(a,b){var c=fabric.document.defaultView.getComputedStyle(a,null);return c?c[b]:void 0}:function(a,b){var c=a.style[b];return!c&&a.currentStyle&&(c=a.currentStyle[b]),c},function(){function a(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction),d?a.style[d]="none":"string"==typeof a.unselectable&&(a.unselectable="on"),a}function b(a){return"undefined"!=typeof a.onselectstart&&(a.onselectstart=null),d?a.style[d]="":"string"==typeof a.unselectable&&(a.unselectable=""),a}var c=fabric.document.documentElement.style,d="userSelect"in c?"userSelect":"MozUserSelect"in c?"MozUserSelect":"WebkitUserSelect"in c?"WebkitUserSelect":"KhtmlUserSelect"in c?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=a,fabric.util.makeElementSelectable=b}(),function(){function a(a,b){var c=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),e=!0;d.onload=d.onreadystatechange=function(a){if(e){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;e=!1,b(a||fabric.window.event),d=d.onload=d.onreadystatechange=null}},d.src=a,c.appendChild(d)}fabric.util.getScript=a}(),fabric.util.getById=a,fabric.util.toArray=i,fabric.util.makeElement=b,fabric.util.addClass=c,fabric.util.wrapElement=d,fabric.util.getScrollLeftTop=e,fabric.util.getElementOffset=f,fabric.util.getElementStyle=k}(),function(){function a(a,b){return a+(/\?/.test(a)?"&":"?")+b}function b(){}function c(c,e){e||(e={});var f,g=e.method?e.method.toUpperCase():"GET",h=e.onComplete||function(){},i=d();return i.onreadystatechange=function(){4===i.readyState&&(h(i),i.onreadystatechange=b)},"GET"===g&&(f=null,"string"==typeof e.parameters&&(c=a(c,e.parameters))),i.open(g,c,!0),("POST"===g||"PUT"===g)&&i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(f),i}var d=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{var c=a[b]();if(c)return a[b]}catch(d){}}();fabric.util.request=c}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(a){"undefined"!=typeof console[a]&&"function"==typeof console[a].apply&&(fabric[a]=function(){return console[a].apply(console,arguments)})}),function(){function a(a){b(function(c){a||(a={});var d,e=c||+new Date,f=a.duration||500,g=e+f,h=a.onChange||function(){},i=a.abort||function(){return!1},j=a.easing||function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},k="startValue"in a?a.startValue:0,l="endValue"in a?a.endValue:100,m=a.byValue||l-k;a.onStart&&a.onStart(),function n(c){d=c||+new Date;var l=d>g?f:d-e;return i()?void(a.onComplete&&a.onComplete()):(h(j(l,k,m,f)),d>g?void(a.onComplete&&a.onComplete()):void b(n))}(e)})}function b(){return c.apply(fabric.window,arguments)}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1e3/60)};fabric.util.animate=a,fabric.util.requestAnimFrame=b}(),function(){function a(a,b,c,d){return a<Math.abs(b)?(a=b,d=c/4):d=c/(2*Math.PI)*Math.asin(b/a),{a:a,c:b,p:c,s:d}}function b(a,b,c){return a.a*Math.pow(2,10*(b-=1))*Math.sin(2*(b*c-a.s)*Math.PI/a.p)}function c(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b}function d(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b}function e(a,b,c,d){return c*(a/=d)*a*a*a+b}function f(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b}function g(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b}function h(a,b,c,d){return c*(a/=d)*a*a*a*a+b}function i(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b}function j(a,b,c,d){return a/=d/2,1>a?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b}function k(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b}function l(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b}function m(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}function n(a,b,c,d){return 0===a?b:c*Math.pow(2,10*(a/d-1))+b}function o(a,b,c,d){return a===d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b}function p(a,b,c,d){return 0===a?b:a===d?b+c:(a/=d/2,1>a?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b)}function q(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b}function r(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b}function s(a,b,c,d){return a/=d/2,1>a?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b}function t(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f,1===c)return d+e;h||(h=.3*f);var j=a(i,e,h,g);return-b(j,c,f)+d}function u(b,c,d,e){var f=1.70158,g=0,h=d;if(0===b)return c;if(b/=e,1===b)return c+d;g||(g=.3*e);var i=a(h,d,g,f);return i.a*Math.pow(2,-10*b)*Math.sin(2*(b*e-i.s)*Math.PI/i.p)+i.c+c}function v(c,d,e,f){var g=1.70158,h=0,i=e;if(0===c)return d;if(c/=f/2,2===c)return d+e;h||(h=.3*f*1.5);var j=a(i,e,h,g);return 1>c?-.5*b(j,c,f)+d:j.a*Math.pow(2,-10*(c-=1))*Math.sin(2*(c*f-j.s)*Math.PI/j.p)*.5+j.c+d}function w(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b}function x(a,b,c,d,e){return void 0===e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b}function y(a,b,c,d,e){return void 0===e&&(e=1.70158),a/=d/2,1>a?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b}function z(a,b,c,d){return c-A(d-a,0,c,d)+b}function A(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b}function B(a,b,c,d){return d/2>a?.5*z(2*a,0,c,d)+b:.5*A(2*a-d,0,c,d)+.5*c+b}fabric.util.ease={easeInQuad:function(a,b,c,d){return c*(a/=d)*a+b},easeOutQuad:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOutQuad:function(a,b,c,d){return a/=d/2,1>a?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOutCubic:c,easeInOutCubic:d,easeInQuart:e,easeOutQuart:f,easeInOutQuart:g,easeInQuint:h,easeOutQuint:i,easeInOutQuint:j,easeInSine:k,easeOutSine:l,easeInOutSine:m,easeInExpo:n,easeOutExpo:o,easeInOutExpo:p,easeInCirc:q,easeOutCirc:r,easeInOutCirc:s,easeInElastic:t,easeOutElastic:u,easeInOutElastic:v,easeInBack:w,easeOutBack:x,easeInOutBack:y,easeInBounce:z,easeOutBounce:A,easeInOutBounce:B}}(),function(a){"use strict";function b(a){return a in v?v[a]:a}function c(a,b,c,d){var e,f="[object Array]"===Object.prototype.toString.call(b);return"fill"!==a&&"stroke"!==a||"none"!==b?"strokeDashArray"===a?b=b.replace(/,/g," ").split(/\s+/).map(function(a){return parseFloat(a)}):"transformMatrix"===a?b=c&&c.transformMatrix?u(c.transformMatrix,o.parseTransformAttribute(b)):o.parseTransformAttribute(b):"visible"===a?(b="none"===b||"hidden"===b?!1:!0,c&&c.visible===!1&&(b=!1)):"originX"===a?b="start"===b?"left":"end"===b?"right":"center":e=f?b.map(t):t(b,d):b="",!f&&isNaN(e)?b:e}function d(a){for(var b in w)if(a[b]&&"undefined"!=typeof a[w[b]]&&0!==a[b].indexOf("url(")){var c=new o.Color(a[b]);a[b]=c.setAlpha(s(c.getAlpha()*a[w[b]],2)).toRgba()}return a}function e(a,d){var e,f;a.replace(/;$/,"").split(";").forEach(function(a){var g=a.split(":");e=b(g[0].trim().toLowerCase()),f=c(e,g[1].trim()),d[e]=f})}function f(a,d){var e,f;for(var g in a)"undefined"!=typeof a[g]&&(e=b(g.toLowerCase()),f=c(e,a[g]),d[e]=f)}function g(a,b){var c={};for(var d in o.cssRules[b])if(h(a,d.split(" ")))for(var e in o.cssRules[b][d])c[e]=o.cssRules[b][d][e];return c}function h(a,b){var c,d=!0;return c=j(a,b.pop()),c&&b.length&&(d=i(a,b)),c&&d&&0===b.length}function i(a,b){for(var c,d=!0;a.parentNode&&1===a.parentNode.nodeType&&b.length;)d&&(c=b.pop()),a=a.parentNode,d=j(a,c);return 0===b.length}function j(a,b){var c,d=a.nodeName,e=a.getAttribute("class"),f=a.getAttribute("id");if(c=new RegExp("^"+d,"i"),b=b.replace(c,""),f&&b.length&&(c=new RegExp("#"+f+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")),e&&b.length){e=e.split(" ");for(var g=e.length;g--;)c=new RegExp("\\."+e[g]+"(?![a-zA-Z\\-]+)","i"),b=b.replace(c,"")}return 0===b.length}function k(a){for(var b=a.getElementsByTagName("use");b.length;){for(var c,d=b[0],e=d.getAttribute("xlink:href").substr(1),f=d.getAttribute("x")||0,g=d.getAttribute("y")||0,h=a.getElementById(e).cloneNode(!0),i=(h.getAttribute("transform")||"")+" translate("+f+", "+g+")",j=0,k=d.attributes,l=k.length;l>j;j++){var m=k.item(j);"x"!==m.nodeName&&"y"!==m.nodeName&&"xlink:href"!==m.nodeName&&("transform"===m.nodeName?i=m.nodeValue+" "+i:h.setAttribute(m.nodeName,m.nodeValue))}h.setAttribute("transform",i),h.setAttribute("instantiated_by_use","1"),h.removeAttribute("id"),c=d.parentNode,c.replaceChild(h,d)}}function l(a,b,c){var d,e,f,g,h=a.getAttribute("viewBox"),i=1,j=1,k=0,l=0;if(h&&(h=h.match(x))&&(k=-parseFloat(h[1]),l=-parseFloat(h[2]),d=parseFloat(h[3]),e=parseFloat(h[4]),b&&b!==d&&(i=b/d),c&&c!==e&&(j=c/e),j=i=i>j?j:i,1!==i||1!==j||0!==k||0!==l)){if(f=" matrix("+i+" 0 0 "+j+" "+k*i+" "+l*j+") ","svg"===a.tagName){for(g=a.ownerDocument.createElement("g");null!=a.firstChild;)g.appendChild(a.firstChild);a.appendChild(g)}else g=a,f=g.getAttribute("transform")+f;g.setAttribute("transform",f)}}function m(a){var b=a.objects,c=a.options;return b=b.map(function(a){return o[q(a.type)].fromObject(a)}),{objects:b,options:c}}function n(a,b,c){b[c]&&b[c].toSVG&&a.push('<pattern x="0" y="0" id="',c,'Pattern" ','width="',b[c].source.width,'" height="',b[c].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',b[c].source.width,'" height="',b[c].source.height,'" xlink:href="',b[c].source.src,'"></image></pattern>')}var o=a.fabric||(a.fabric={}),p=o.util.object.extend,q=o.util.string.capitalize,r=o.util.object.clone,s=o.util.toFixed,t=o.util.parseUnit,u=o.util.multiplyTransformMatrices,v={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},w={stroke:"strokeOpacity",fill:"fillOpacity"};o.cssRules={},o.gradientDefs={},o.parseTransformAttribute=function(){function a(a,b){var c=b[0];a[0]=Math.cos(c),a[1]=Math.sin(c),a[2]=-Math.sin(c),a[3]=Math.cos(c)}function b(a,b){var c=b[0],d=2===b.length?b[1]:b[0];a[0]=c,a[3]=d}function c(a,b){a[2]=Math.tan(o.util.degreesToRadians(b[0]))}function d(a,b){a[1]=Math.tan(o.util.degreesToRadians(b[0]))}function e(a,b){a[4]=b[0],2===b.length&&(a[5]=b[1])}var f=[1,0,0,1,0,0],g=o.reNum,h="(?:\\s+,?\\s*|,\\s*)",i="(?:(skewX)\\s*\\(\\s*("+g+")\\s*\\))",j="(?:(skewY)\\s*\\(\\s*("+g+")\\s*\\))",k="(?:(rotate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+")"+h+"("+g+"))?\\s*\\))",l="(?:(scale)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",m="(?:(translate)\\s*\\(\\s*("+g+")(?:"+h+"("+g+"))?\\s*\\))",n="(?:(matrix)\\s*\\(\\s*("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")"+h+"("+g+")\\s*\\))",p="(?:"+n+"|"+m+"|"+l+"|"+k+"|"+i+"|"+j+")",q="(?:"+p+"(?:"+h+p+")*)",r="^\\s*(?:"+q+"?)\\s*$",s=new RegExp(r),t=new RegExp(p,"g");return function(g){var h=f.concat(),i=[];if(!g||g&&!s.test(g))return h;g.replace(t,function(g){var j=new RegExp(p).exec(g).filter(function(a){return""!==a&&null!=a}),k=j[1],l=j.slice(2).map(parseFloat);switch(k){case"translate":e(h,l);break;case"rotate":l[0]=o.util.degreesToRadians(l[0]),a(h,l);break;case"scale":b(h,l);break;case"skewX":c(h,l);break;case"skewY":d(h,l);break;case"matrix":h=l}i.push(h.concat()),h=f.concat()});for(var j=i[0];i.length>1;)i.shift(),j=o.util.multiplyTransformMatrices(j,i[0]);return j}}();var x=new RegExp("^\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*,?\\s*("+o.reNum+"+)\\s*$");o.parseSVGDocument=function(){function a(a,b){for(;a&&(a=a.parentNode);)if(b.test(a.nodeName)&&!a.getAttribute("instantiated_by_use"))return!0;return!1}var b=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,c=/^(symbol|image|marker|pattern|view)$/;return function(d,e,f){if(d){k(d);var g,h,i=new Date,j=o.Object.__uid++,m=!1;if(d.getAttribute("width")&&"100%"!==d.getAttribute("width")&&(g=t(d.getAttribute("width"))),d.getAttribute("height")&&"100%"!==d.getAttribute("height")&&(h=t(d.getAttribute("height"))),!g||!h){var n=d.getAttribute("viewBox");n&&(n=n.match(x))?(g=parseFloat(n[3]),h=parseFloat(n[4])):m=!0}l(d,g,h);var p=o.util.toArray(d.getElementsByTagName("*"));if(0===p.length&&o.isLikelyNode){p=d.selectNodes('//*[name(.)!="svg"]');for(var q=[],s=0,u=p.length;u>s;s++)q[s]=p[s];p=q}var v=p.filter(function(d){return c.test(d.tagName)&&l(d,0,0),b.test(d.tagName)&&!a(d,/^(?:pattern|defs|symbol)$/)});if(!v||v&&!v.length)return void(e&&e([],{}));var w={width:g,height:h,svgUid:j,toBeParsed:m};o.gradientDefs[j]=o.getGradientDefs(d),o.cssRules[j]=o.getCSSRules(d),o.parseElements(v,function(a){o.documentParsingTime=new Date-i,e&&e(a,w)},r(w),f)}}}();var y={has:function(a,b){b(!1)},get:function(){},set:function(){}},z=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+o.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+o.reNum+"))?\\s+(.*)");p(o,{parseFontDeclaration:function(a,b){var c=a.match(z);if(c){var d=c[1],e=c[3],f=c[4],g=c[5],h=c[6];d&&(b.fontStyle=d),e&&(b.fontWeight=isNaN(parseFloat(e))?e:parseFloat(e)),f&&(b.fontSize=t(f)),h&&(b.fontFamily=h),g&&(b.lineHeight="normal"===g?1:g)}},getGradientDefs:function(a){var b,c,d,e,f=a.getElementsByTagName("linearGradient"),g=a.getElementsByTagName("radialGradient"),h=0,i=[],j={},k={};

for(i.length=f.length+g.length,c=f.length;c--;)i[h++]=f[c];for(c=g.length;c--;)i[h++]=g[c];for(;h--;)b=i[h],e=b.getAttribute("xlink:href"),d=b.getAttribute("id"),e&&(k[d]=e.substr(1)),j[d]=b;for(d in k){var l=j[k[d]].cloneNode(!0);for(b=j[d];l.firstChild;)b.appendChild(l.firstChild)}return j},parseAttributes:function(a,e,f){if(a){var h,i,j={};"undefined"==typeof f&&(f=a.getAttribute("svgUid")),a.parentNode&&/^symbol|[g|a]$/i.test(a.parentNode.nodeName)&&(j=o.parseAttributes(a.parentNode,e,f)),i=j&&j.fontSize||a.getAttribute("font-size")||o.Text.DEFAULT_SVG_FONT_SIZE;var k=e.reduce(function(d,e){return h=a.getAttribute(e),h&&(e=b(e),h=c(e,h,j,i),d[e]=h),d},{});return k=p(k,p(g(a,f),o.parseStyleAttribute(a))),k.font&&o.parseFontDeclaration(k.font,k),d(p(j,k))}},parseElements:function(a,b,c,d){new o.ElementsParser(a,b,c,d).parse()},parseStyleAttribute:function(a){var b={},c=a.getAttribute("style");return c?("string"==typeof c?e(c,b):f(c,b),b):b},parsePointsAttribute:function(a){if(!a)return null;a=a.replace(/,/g," ").trim(),a=a.split(/\s+/);var b,c,d=[];for(b=0,c=a.length;c>b;b+=2)d.push({x:parseFloat(a[b]),y:parseFloat(a[b+1])});return d},getCSSRules:function(a){for(var d,e=a.getElementsByTagName("style"),f={},g=0,h=e.length;h>g;g++){var i=e[g].textContent;i=i.replace(/\/\*[\s\S]*?\*\//g,""),""!==i.trim()&&(d=i.match(/[^{]*\{[\s\S]*?\}/g),d=d.map(function(a){return a.trim()}),d.forEach(function(a){for(var d=a.match(/([\s\S]*?)\s*\{([^}]*)\}/),e={},g=d[2].trim(),h=g.replace(/;$/,"").split(/\s*;\s*/),i=0,j=h.length;j>i;i++){var k=h[i].split(/\s*:\s*/),l=b(k[0]),m=c(l,k[1],k[0]);e[l]=m}a=d[1],a.split(",").forEach(function(a){a=a.replace(/^svg/i,"").trim(),""!==a&&(f[a]=o.util.object.clone(e))})}))}return f},loadSVGFromURL:function(a,b,c){function d(d){var e=d.responseXML;e&&!e.documentElement&&o.window.ActiveXObject&&d.responseText&&(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(d.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e&&e.documentElement&&o.parseSVGDocument(e.documentElement,function(c,d){y.set(a,{objects:o.util.array.invoke(c,"toObject"),options:d}),b(c,d)},c)}a=a.replace(/^\n\s*/,"").trim(),y.has(a,function(c){c?y.get(a,function(a){var c=m(a);b(c.objects,c.options)}):new o.util.request(a,{method:"get",onComplete:d})})},loadSVGFromString:function(a,b,c){a=a.trim();var d;if("undefined"!=typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(d=e.parseFromString(a,"text/xml"))}else o.window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));o.parseSVGDocument(d.documentElement,function(a,c){b(a,c)},c)},createSVGFontFacesMarkup:function(a){for(var b="",c=0,d=a.length;d>c;c++)"text"===a[c].type&&a[c].path&&(b+=["@font-face {","font-family: ",a[c].fontFamily,"; ","src: url('",a[c].path,"')","}"].join(""));return b&&(b=['<style type="text/css">',"<![CDATA[",b,"]]>","</style>"].join("")),b},createSVGRefElementsMarkup:function(a){var b=[];return n(b,a,"backgroundColor"),n(b,a,"overlayColor"),b.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(a,b,c,d){this.elements=a,this.callback=b,this.options=c,this.reviver=d,this.svgUid=c&&c.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var a=0,b=this.elements.length;b>a;a++)this.elements[a].setAttribute("svgUid",this.svgUid),function(a,b){setTimeout(function(){a.createObject(a.elements[b],b)},0)}(this,a)},fabric.ElementsParser.prototype.createObject=function(a,b){var c=fabric[fabric.util.string.capitalize(a.tagName)];if(c&&c.fromElement)try{this._createObject(c,a,b)}catch(d){fabric.log(d)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(a,b,c){if(a.async)a.fromElement(b,this.createCallback(c,b),this.options);else{var d=a.fromElement(b,this.options);this.resolveGradient(d,"fill"),this.resolveGradient(d,"stroke"),this.reviver&&this.reviver(b,d),this.instances[c]=d,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(a,b){var c=this;return function(d){c.resolveGradient(d,"fill"),c.resolveGradient(d,"stroke"),c.reviver&&c.reviver(b,d),c.instances[a]=d,c.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(a,b){var c=a.get(b);if(/^url\(/.test(c)){var d=c.slice(5,c.length-1);fabric.gradientDefs[this.svgUid][d]&&a.set(b,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][d],a))}},fabric.ElementsParser.prototype.checkIfDone=function(){0===--this.numElements&&(this.instances=this.instances.filter(function(a){return null!=a}),this.callback(this.instances))},function(a){"use strict";function b(a,b){this.x=a,this.y=b}var c=a.fabric||(a.fabric={});return c.Point?void c.warn("fabric.Point is already defined"):(c.Point=b,void(b.prototype={constructor:b,add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){return this.x+=a.x,this.y+=a.y,this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){return this.x+=a,this.y+=a,this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){return this.x-=a.x,this.y-=a.y,this},scalarSubtract:function(a){return new b(this.x-a,this.y-a)},scalarSubtractEquals:function(a){return this.x-=a,this.y-=a,this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){return this.x*=a,this.y*=a,this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){return this.x/=a,this.y/=a,this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,c){return new b(this.x+(a.x-this.x)*c,this.y+(a.y-this.y)*c)},distanceFrom:function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},midPointFrom:function(a){return new b(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},setXY:function(a,b){this.x=a,this.y=b},setFromPoint:function(a){this.x=a.x,this.y=a.y},swap:function(a){var b=this.x,c=this.y;this.x=a.x,this.y=a.y,a.x=b,a.y=c}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){this.status=a,this.points=[]}var c=a.fabric||(a.fabric={});return c.Intersection?void c.warn("fabric.Intersection is already defined"):(c.Intersection=b,c.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},c.Intersection.intersectLineLine=function(a,d,e,f){var g,h=(f.x-e.x)*(a.y-e.y)-(f.y-e.y)*(a.x-e.x),i=(d.x-a.x)*(a.y-e.y)-(d.y-a.y)*(a.x-e.x),j=(f.y-e.y)*(d.x-a.x)-(f.x-e.x)*(d.y-a.y);if(0!==j){var k=h/j,l=i/j;k>=0&&1>=k&&l>=0&&1>=l?(g=new b("Intersection"),g.points.push(new c.Point(a.x+k*(d.x-a.x),a.y+k*(d.y-a.y)))):g=new b}else g=new b(0===h||0===i?"Coincident":"Parallel");return g},c.Intersection.intersectLinePolygon=function(a,c,d){for(var e=new b,f=d.length,g=0;f>g;g++){var h=d[g],i=d[(g+1)%f],j=b.intersectLineLine(a,c,h,i);e.appendPoints(j.points)}return e.points.length>0&&(e.status="Intersection"),e},c.Intersection.intersectPolygonPolygon=function(a,c){for(var d=new b,e=a.length,f=0;e>f;f++){var g=a[f],h=a[(f+1)%e],i=b.intersectLinePolygon(g,h,c);d.appendPoints(i.points)}return d.points.length>0&&(d.status="Intersection"),d},void(c.Intersection.intersectPolygonRectangle=function(a,d,e){var f=d.min(e),g=d.max(e),h=new c.Point(g.x,f.y),i=new c.Point(f.x,g.y),j=b.intersectLinePolygon(f,h,a),k=b.intersectLinePolygon(h,g,a),l=b.intersectLinePolygon(g,i,a),m=b.intersectLinePolygon(i,f,a),n=new b;return n.appendPoints(j.points),n.appendPoints(k.points),n.appendPoints(l.points),n.appendPoints(m.points),n.points.length>0&&(n.status="Intersection"),n}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function c(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}var d=a.fabric||(a.fabric={});return d.Color?void d.warn("fabric.Color is already defined."):(d.Color=b,d.Color.prototype={_tryParsingColor:function(a){var c;return a in b.colorNameMap&&(a=b.colorNameMap[a]),"transparent"===a?void this.setSource([255,255,255,0]):(c=b.sourceFromHex(a),c||(c=b.sourceFromRgb(a)),c||(c=b.sourceFromHsl(a)),void(c&&this.setSource(c)))},_rgbToHsl:function(a,b,c){a/=255,b/=255,c/=255;var e,f,g,h=d.util.array.max([a,b,c]),i=d.util.array.min([a,b,c]);if(g=(h+i)/2,h===i)e=f=0;else{var j=h-i;switch(f=g>.5?j/(2-h-i):j/(h+i),h){case a:e=(b-c)/j+(c>b?6:0);break;case b:e=(c-a)/j+2;break;case c:e=(a-b)/j+4}e/=6}return[Math.round(360*e),Math.round(100*f),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+b[0]+","+b[1]+"%,"+b[2]+"%)"},toHsla:function(){var a=this.getSource(),b=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+b[0]+","+b[1]+"%,"+b[2]+"%,"+a[3]+")"},toHex:function(){var a,b,c,d=this.getSource();return a=d[0].toString(16),a=1===a.length?"0"+a:a,b=d[1].toString(16),b=1===b.length?"0"+b:b,c=d[2].toString(16),c=1===c.length?"0"+c:c,a.toUpperCase()+b.toUpperCase()+c.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var b=this.getSource();return b[3]=a,this.setSource(b),this},toGrayscale:function(){var a=this.getSource(),b=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10),c=a[3];return this.setSource([b,b,b,c]),this},toBlackWhite:function(a){var b=this.getSource(),c=(.3*b[0]+.59*b[1]+.11*b[2]).toFixed(0),d=b[3];return a=a||127,c=Number(c)<Number(a)?0:255,this.setSource([c,c,c,d]),this},overlayWith:function(a){a instanceof b||(a=new b(a));for(var c=[],d=this.getAlpha(),e=.5,f=this.getSource(),g=a.getSource(),h=0;3>h;h++)c.push(Math.round(f[h]*(1-e)+g[h]*e));return c[3]=d,this.setSource(c),this}},d.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,d.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,d.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},d.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},d.Color.sourceFromRgb=function(a){var c=a.match(b.reRGBa);if(c){var d=parseInt(c[1],10)/(/%$/.test(c[1])?100:1)*(/%$/.test(c[1])?255:1),e=parseInt(c[2],10)/(/%$/.test(c[2])?100:1)*(/%$/.test(c[2])?255:1),f=parseInt(c[3],10)/(/%$/.test(c[3])?100:1)*(/%$/.test(c[3])?255:1);return[parseInt(d,10),parseInt(e,10),parseInt(f,10),c[4]?parseFloat(c[4]):1]}},d.Color.fromRgba=b.fromRgb,d.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},d.Color.sourceFromHsl=function(a){var d=a.match(b.reHSLa);if(d){var e,f,g,h=(parseFloat(d[1])%360+360)%360/360,i=parseFloat(d[2])/(/%$/.test(d[2])?100:1),j=parseFloat(d[3])/(/%$/.test(d[3])?100:1);if(0===i)e=f=g=j;else{var k=.5>=j?j*(i+1):j+i-j*i,l=2*j-k;e=c(l,k,h+1/3),f=c(l,k,h),g=c(l,k,h-1/3)}return[Math.round(255*e),Math.round(255*f),Math.round(255*g),d[4]?parseFloat(d[4]):1]}},d.Color.fromHsla=b.fromHsl,d.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},d.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),d=3===c.length,e=d?c.charAt(0)+c.charAt(0):c.substring(0,2),f=d?c.charAt(1)+c.charAt(1):c.substring(2,4),g=d?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(e,16),parseInt(f,16),parseInt(g,16),1]}},void(d.Color.fromSource=function(a){var c=new b;return c.setSource(a),c}))}("undefined"!=typeof exports?exports:this),function(){function a(a){var b,c,d,e=a.getAttribute("style"),f=a.getAttribute("offset");if(f=parseFloat(f)/(/%$/.test(f)?100:1),f=0>f?0:f>1?1:f,e){var g=e.split(/\s*;\s*/);""===g[g.length-1]&&g.pop();for(var h=g.length;h--;){var i=g[h].split(/\s*:\s*/),j=i[0].trim(),k=i[1].trim();"stop-color"===j?b=k:"stop-opacity"===j&&(d=k)}}return b||(b=a.getAttribute("stop-color")||"rgb(0,0,0)"),d||(d=a.getAttribute("stop-opacity")),b=new fabric.Color(b),c=b.getAlpha(),d=isNaN(parseFloat(d))?1:parseFloat(d),d*=c,{offset:f,color:b.toRgb(),opacity:d}}function b(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function c(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}function d(a,b,c){var d,e=0,f=1,g="";for(var h in b)d=parseFloat(b[h],10),f="string"==typeof b[h]&&/^\d+%$/.test(b[h])?.01:1,"x1"===h||"x2"===h||"r2"===h?(f*="objectBoundingBox"===c?a.width:1,e="objectBoundingBox"===c?a.left||0:0):("y1"===h||"y2"===h)&&(f*="objectBoundingBox"===c?a.height:1,e="objectBoundingBox"===c?a.top||0:0),b[h]=d*f+e;if("ellipse"===a.type&&null!==b.r2&&"objectBoundingBox"===c&&a.rx!==a.ry){var i=a.ry/a.rx;g=" scale(1, "+i+")",b.y1&&(b.y1/=i),b.y2&&(b.y2/=i)}return g}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(a){a||(a={});var b={};this.id=fabric.Object.__uid++,this.type=a.type||"linear",b={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},"radial"===this.type&&(b.r1=a.coords.r1||0,b.r2=a.coords.r2||0),this.coords=b,this.colorStops=a.colorStops.slice(),a.gradientTransform&&(this.gradientTransform=a.gradientTransform),this.offsetX=a.offsetX||this.offsetX,this.offsetY=a.offsetY||this.offsetY},addColorStop:function(a){for(var b in a){var c=new fabric.Color(a[b]);this.colorStops.push({offset:b,color:c.toRgb(),opacity:c.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(a){var b,c,d=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(a,b){return a.offset-b.offset}),!a.group||"path-group"!==a.group.type)for(var e in d)"x1"===e||"x2"===e||"r2"===e?d[e]+=this.offsetX-a.width/2:("y1"===e||"y2"===e)&&(d[e]+=this.offsetY-a.height/2);c='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(c+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?b=["<linearGradient ",c,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,'">\n']:"radial"===this.type&&(b=["<radialGradient ",c,' cx="',d.x2,'" cy="',d.y2,'" r="',d.r2,'" fx="',d.x1,'" fy="',d.y1,'">\n']);for(var f=0;f<this.colorStops.length;f++)b.push("<stop ",'offset="',100*this.colorStops[f].offset+"%",'" style="stop-color:',this.colorStops[f].color,null!=this.colorStops[f].opacity?";stop-opacity: "+this.colorStops[f].opacity:";",'"/>\n');return b.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),b.join("")},toLive:function(a,b){var c,d,e=fabric.util.object.clone(this.coords);if(this.type){if(b.group&&"path-group"===b.group.type)for(d in e)"x1"===d||"x2"===d?e[d]+=-this.offsetX+b.width/2:("y1"===d||"y2"===d)&&(e[d]+=-this.offsetY+b.height/2);if("text"===b.type||"i-text"===b.type)for(d in e)"x1"===d||"x2"===d?e[d]-=b.width/2:("y1"===d||"y2"===d)&&(e[d]-=b.height/2);"linear"===this.type?c=a.createLinearGradient(e.x1,e.y1,e.x2,e.y2):"radial"===this.type&&(c=a.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2));for(var f=0,g=this.colorStops.length;g>f;f++){var h=this.colorStops[f].color,i=this.colorStops[f].opacity,j=this.colorStops[f].offset;"undefined"!=typeof i&&(h=new fabric.Color(h).setAlpha(i).toRgba()),c.addColorStop(parseFloat(j),h)}return c}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(e,f){var g,h=e.getElementsByTagName("stop"),i="linearGradient"===e.nodeName?"linear":"radial",j=e.getAttribute("gradientUnits")||"objectBoundingBox",k=e.getAttribute("gradientTransform"),l=[],m={};"linear"===i?m=b(e):"radial"===i&&(m=c(e));for(var n=h.length;n--;)l.push(a(h[n]));g=d(f,m,j);var o=new fabric.Gradient({type:i,coords:m,colorStops:l,offsetX:-f.left,offsetY:-f.top});return(k||""!==g)&&(o.gradientTransform=fabric.parseTransformAttribute((k||"")+g)),o},forObject:function(a,b){return b||(b={}),d(a,b.coords,"userSpaceOnUse"),new fabric.Gradient(b)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){if(a||(a={}),this.id=fabric.Object.__uid++,a.source)if("string"==typeof a.source)if("undefined"!=typeof fabric.util.getFunctionBody(a.source))this.source=new Function(fabric.util.getFunctionBody(a.source));else{var b=this;this.source=fabric.util.createImage(),fabric.util.loadImage(a.source,function(a){b.source=a})}else this.source=a.source;a.repeat&&(this.repeat=a.repeat),a.offsetX&&(this.offsetX=a.offsetX),a.offsetY&&(this.offsetY=a.offsetY)},toObject:function(){var a;return"function"==typeof this.source?a=String(this.source):"string"==typeof this.source.src&&(a=this.source.src),{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(a){var b="function"==typeof this.source?this.source():this.source,c=b.width/a.getWidth(),d=b.height/a.getHeight(),e=this.offsetX/a.getWidth(),f=this.offsetY/a.getHeight(),g="";return("repeat-x"===this.repeat||"no-repeat"===this.repeat)&&(d=1),("repeat-y"===this.repeat||"no-repeat"===this.repeat)&&(c=1),b.src?g=b.src:b.toDataURL&&(g=b.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+e+'" y="'+f+'" width="'+c+'" height="'+d+'">\n<image x="0" y="0" width="'+b.width+'" height="'+b.height+'" xlink:href="'+g+'"></image>\n</pattern>\n'},toLive:function(a){var b="function"==typeof this.source?this.source():this.source;if(!b)return"";if("undefined"!=typeof b.src){if(!b.complete)return"";if(0===b.naturalWidth||0===b.naturalHeight)return""}return a.createPattern(b,this.repeat)}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.toFixed;return b.Shadow?void b.warn("fabric.Shadow is already defined."):(b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(a){"string"==typeof a&&(a=this._parseShadow(a));for(var c in a)this[c]=a[c];this.id=b.Object.__uid++},_parseShadow:function(a){var c=a.trim(),d=b.Shadow.reOffsetsAndBlur.exec(c)||[],e=c.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:e.trim(),offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(a){var b="SourceAlpha",d=40,e=40;return!a||a.fill!==this.color&&a.stroke!==this.color||(b="SourceGraphic"),a.width&&a.height&&(d=100*c(Math.abs(this.offsetX/a.getWidth()),2)+20,e=100*c(Math.abs(this.offsetY/a.getHeight()),2)+20),'<filter id="SVGID_'+this.id+'" y="-'+e+'%" height="'+(100+2*e)+'%" x="-'+d+'%" width="'+(100+2*d)+'%" >\n	<feGaussianBlur in="'+b+'" stdDeviation="'+c(this.blur?this.blur/2:0,3)+'" result="blurOut"></feGaussianBlur>\n	<feColorMatrix result="matrixOut" in="blurOut" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.30 0" ></feColorMatrix >\n	<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset>\n	<feMerge>\n		<feMergeNode></feMergeNode>\n		<feMergeNode in="SourceGraphic"></feMergeNode>\n	</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var a={},c=b.Shadow.prototype;return this.color!==c.color&&(a.color=this.color),this.blur!==c.blur&&(a.blur=this.blur),this.offsetX!==c.offsetX&&(a.offsetX=this.offsetX),this.offsetY!==c.offsetY&&(a.offsetY=this.offsetY),a}}),void(b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/))}("undefined"!=typeof exports?exports:this),function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var a=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,d=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(a,b){b||(b={}),this._initStatic(a,b),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(a,b){this._objects=[],this._createLowerCanvas(a),this._initOptions(b),this._setImageSmoothing(),b.overlayImage&&this.setOverlayImage(b.overlayImage,this.renderAll.bind(this)),b.backgroundImage&&this.setBackgroundImage(b.backgroundImage,this.renderAll.bind(this)),b.backgroundColor&&this.setBackgroundColor(b.backgroundColor,this.renderAll.bind(this)),b.overlayColor&&this.setOverlayColor(b.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=b(this.lowerCanvasEl),this},setOverlayImage:function(a,b,c){return this.__setBgOverlayImage("overlayImage",a,b,c)},setBackgroundImage:function(a,b,c){return this.__setBgOverlayImage("backgroundImage",a,b,c)},setOverlayColor:function(a,b){return this.__setBgOverlayColor("overlayColor",a,b)},setBackgroundColor:function(a,b){return this.__setBgOverlayColor("backgroundColor",a,b)},_setImageSmoothing:function(){var a=this.getContext();a.imageSmoothingEnabled=this.imageSmoothingEnabled,a.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,a.mozImageSmoothingEnabled=this.imageSmoothingEnabled,a.msImageSmoothingEnabled=this.imageSmoothingEnabled,a.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(a,b,c,d){return"string"==typeof b?fabric.util.loadImage(b,function(b){this[a]=new fabric.Image(b,d),c&&c()},this,d&&d.crossOrigin):(d&&b.setOptions(d),this[a]=b,c&&c()),this},__setBgOverlayColor:function(a,b,c){if(b&&b.source){var d=this;fabric.util.loadImage(b.source,function(e){d[a]=new fabric.Pattern({source:e,repeat:b.repeat,offsetX:b.offsetX,offsetY:b.offsetY}),c&&c()})}else this[a]=b,c&&c();return this},_createCanvasElement:function(){var a=fabric.document.createElement("canvas");if(a.style||(a.style={}),!a)throw d;return this._initCanvasElement(a),a},_initCanvasElement:function(a){if(fabric.util.createCanvasElement(a),"undefined"==typeof a.getContext)throw d},_initOptions:function(a){for(var b in a)this[b]=a[b];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,b){return this.setDimensions({width:a},b)},setHeight:function(a,b){return this.setDimensions({height:a},b)},setDimensions:function(a,b){var c;b=b||{};for(var d in a)c=a[d],b.cssOnly||(this._setBackstoreDimension(d,a[d]),c+="px"),b.backstoreOnly||this._setCssDimension(d,c);return b.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(a,b){return this.lowerCanvasEl[a]=b,this.upperCanvasEl&&(this.upperCanvasEl[a]=b),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=b),this[a]=b,this},_setCssDimension:function(a,b){return this.lowerCanvasEl.style[a]=b,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=b),this.wrapperEl&&(this.wrapperEl.style[a]=b),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(a){var b=this.getActiveGroup();this.viewportTransform=a,this.renderAll();for(var c=0,d=this._objects.length;d>c;c++)this._objects[c].setCoords();return b&&b.setCoords(),this},zoomToPoint:function(a,b){var c=a;a=fabric.util.transformPoint(a,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=b,this.viewportTransform[3]=b;var d=fabric.util.transformPoint(a,this.viewportTransform);this.viewportTransform[4]+=c.x-d.x,this.viewportTransform[5]+=c.y-d.y,this.renderAll();for(var e=0,f=this._objects.length;f>e;e++)this._objects[e].setCoords();return this},setZoom:function(a){return this.zoomToPoint(new fabric.Point(0,0),a),this},absolutePan:function(a){this.viewportTransform[4]=-a.x,this.viewportTransform[5]=-a.y,this.renderAll();for(var b=0,c=this._objects.length;c>b;b++)this._objects[b].setCoords();return this},relativePan:function(a){return this.absolutePan(new fabric.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(a,b){if(b){a.save();var c=this.viewportTransform;a.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._shouldRenderObject(b)&&b.render(a),a.restore(),this.controlsAboveOverlay||b._renderControls(a)}},_shouldRenderObject:function(a){return a?a!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(a){this.stateful&&a.setupState(),a.canvas=this,a.setCoords(),this.fire("object:added",{target:a}),a.fire("added")},_onObjectRemoved:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:a}),a.fire("removed")},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(a){var b=this[a===!0&&this.interactive?"contextTop":"contextContainer"],c=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),a||this.clearContext(b),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,b),this._renderBackground(b),this._renderObjects(b,c),this._renderActiveGroup(b,c),this.clipTo&&b.restore(),this._renderOverlay(b),this.controlsAboveOverlay&&this.interactive&&this.drawControls(b),this.fire("after:render"),this},_renderObjects:function(a,b){var c,d;if(!b||this.preserveObjectStacking)for(c=0,d=this._objects.length;d>c;++c)this._draw(a,this._objects[c]);else for(c=0,d=this._objects.length;d>c;++c)this._objects[c]&&!b.contains(this._objects[c])&&this._draw(a,this._objects[c])},_renderActiveGroup:function(a,b){if(b){var c=[];this.forEachObject(function(a){b.contains(a)&&c.push(a)}),b._set("objects",c),this._draw(a,b)}},_renderBackground:function(a){this.backgroundColor&&(a.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(a):this.backgroundColor,a.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this._draw(a,this.backgroundImage)},_renderOverlay:function(a){this.overlayColor&&(a.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(a):this.overlayColor,a.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this._draw(a,this.overlayImage)},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a),this.selection&&this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();return b&&b.render(a),this._renderOverlay(a),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(a){return this._centerObject(a,new fabric.Point(this.getCenter().left,a.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(a){return this._centerObject(a,new fabric.Point(a.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(a){var b=this.getCenter();return this._centerObject(a,new fabric.Point(b.left,b.top)),this.renderAll(),this},_centerObject:function(a,b){return a.setPositionByOrigin(b,"center","center"),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(b,c){var d={objects:this._toObjects(b,c)};return a(d,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,d,c),d},_toObjects:function(a,b){return this.getObjects().map(function(c){return this._toObject(c,a,b)},this)},_toObject:function(a,b,c){var d;this.includeDefaultValues||(d=a.includeDefaultValues,a.includeDefaultValues=!1);var e=this._realizeGroupTransformOnObject(a),f=a[b](c);return this.includeDefaultValues||(a.includeDefaultValues=d),this._unwindGroupTransformOnObject(a,e),f},_realizeGroupTransformOnObject:function(a){var b=["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"];if(a.group&&a.group===this.getActiveGroup()){var c={};return b.forEach(function(b){c[b]=a[b]}),this.getActiveGroup().realizeTransform(a),c}return null},_unwindGroupTransformOnObject:function(a,b){b&&a.set(b)},__serializeBgOverlay:function(){var a={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(a.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(a.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(a.overlayImage=this.overlayImage.toObject()),a},svgViewportTransformation:!0,toSVG:function(a,b){a||(a={});var c=[];return this._setSVGPreamble(c,a),this._setSVGHeader(c,a),this._setSVGBgOverlayColor(c,"backgroundColor"),this._setSVGBgOverlayImage(c,"backgroundImage"),this._setSVGObjects(c,b),this._setSVGBgOverlayColor(c,"overlayColor"),this._setSVGBgOverlayImage(c,"overlayImage"),c.push("</svg>"),c.join("")},_setSVGPreamble:function(a,b){b.suppressPreamble||a.push('<?xml version="1.0" encoding="',b.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(a,b){var c,d,e;b.viewBox?(c=b.viewBox.width,d=b.viewBox.height):(c=this.width,d=this.height,this.svgViewportTransformation||(e=this.viewportTransform,c/=e[0],d/=e[3])),a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',c,'" ','height="',d,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,b.viewBox?'viewBox="'+b.viewBox.x+" "+b.viewBox.y+" "+b.viewBox.width+" "+b.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>");

},_setSVGObjects:function(a,b){for(var c=0,d=this.getObjects(),e=d.length;e>c;c++){var f=d[c],g=this._realizeGroupTransformOnObject(f);a.push(f.toSVG(b)),this._unwindGroupTransformOnObject(f,g)}},_setSVGBgOverlayImage:function(a,b){this[b]&&this[b].toSVG&&a.push(this[b].toSVG())},_setSVGBgOverlayColor:function(a,b){this[b]&&this[b].source?a.push('<rect x="',this[b].offsetX,'" y="',this[b].offsetY,'" ','width="',"repeat-y"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.width:this.width,'" height="',"repeat-x"===this[b].repeat||"no-repeat"===this[b].repeat?this[b].source.height:this.height,'" fill="url(#'+b+'Pattern)"',"></rect>"):this[b]&&"overlayColor"===b&&a.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[b],'"',"></rect>")},sendToBack:function(a){return c(this._objects,a),this._objects.unshift(a),this.renderAll&&this.renderAll()},bringToFront:function(a){return c(this._objects,a),this._objects.push(a),this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var d=this._objects.indexOf(a);if(0!==d){var e=this._findNewLowerIndex(a,d,b);c(this._objects,a),this._objects.splice(e,0,a),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(a,b,c){var d;if(c){d=b;for(var e=b-1;e>=0;--e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b-1;return d},bringForward:function(a,b){var d=this._objects.indexOf(a);if(d!==this._objects.length-1){var e=this._findNewUpperIndex(a,d,b);c(this._objects,a),this._objects.splice(e,0,a),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(a,b,c){var d;if(c){d=b;for(var e=b+1;e<this._objects.length;++e){var f=a.intersectsWithObject(this._objects[e])||a.isContainedWithinObject(this._objects[e])||this._objects[e].isContainedWithinObject(a);if(f){d=e;break}}}else d=b+1;return d},moveTo:function(a,b){return c(this._objects,a),this._objects.splice(b,0,a),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),a(fabric.StaticCanvas.prototype,fabric.Observable),a(fabric.StaticCanvas.prototype,fabric.Collection),a(fabric.StaticCanvas.prototype,fabric.DataURLExporter),a(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var b=fabric.util.createCanvasElement();if(!b||!b.getContext)return null;var c=b.getContext("2d");if(!c)return null;switch(a){case"getImageData":return"undefined"!=typeof c.getImageData;case"setLineDash":return"undefined"!=typeof c.setLineDash;case"toDataURL":return"undefined"!=typeof b.toDataURL;case"toDataURLWithQuality":try{return b.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(a){return this.shadow=new fabric.Shadow(a),this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&a.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var a=this.canvas.contextTop;a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a,this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a),this._captureDrawingPath(a),this._render()},onMouseMove:function(a){this._captureDrawingPath(a),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){var b=new fabric.Point(a.x,a.y);this._reset(),this._addPoint(b),this.canvas.contextTop.moveTo(b.x,b.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(a){var b=new fabric.Point(a.x,a.y);this._addPoint(b)},_render:function(){var a=this.canvas.contextTop,b=this.canvas.viewportTransform,c=this._points[0],d=this._points[1];a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]),a.beginPath(),2===this._points.length&&c.x===d.x&&c.y===d.y&&(c.x-=.5,d.x+=.5),a.moveTo(c.x,c.y);for(var e=1,f=this._points.length;f>e;e++){var g=c.midPointFrom(d);a.quadraticCurveTo(c.x,c.y,g.x,g.y),c=this._points[e],d=this._points[e+1]}a.lineTo(c.x,c.y),a.stroke(),a.restore()},convertPointsToSVGPath:function(a){var b=[],c=new fabric.Point(a[0].x,a[0].y),d=new fabric.Point(a[1].x,a[1].y);b.push("M ",a[0].x," ",a[0].y," ");for(var e=1,f=a.length;f>e;e++){var g=c.midPointFrom(d);b.push("Q ",c.x," ",c.y," ",g.x," ",g.y," "),c=new fabric.Point(a[e].x,a[e].y),e+1<a.length&&(d=new fabric.Point(a[e+1].x,a[e+1].y))}return b.push("L ",c.x," ",c.y," "),b},createPath:function(a){var b=new fabric.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,b.setShadow(this.shadow)),b},_finalizeAndAddPath:function(){var a=this.canvas.contextTop;a.closePath();var b=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===b)return void this.canvas.renderAll();var c=this.createPath(b);this.canvas.add(c),c.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:c})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var b=this.addPoint(a),c=this.canvas.contextTop,d=this.canvas.viewportTransform;c.save(),c.transform(d[0],d[1],d[2],d[3],d[4],d[5]),c.fillStyle=b.fill,c.beginPath(),c.arc(b.x,b.y,b.radius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.restore()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.points.length;d>c;c++){var e=this.points[c],f=new fabric.Circle({radius:e.radius,left:e.x,top:e.y,originX:"center",originY:"center",fill:e.fill});this.shadow&&f.setShadow(this.shadow),b.push(f)}var g=new fabric.Group(b,{originX:"center",originY:"center"});g.canvas=this.canvas,this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.renderAll()},addPoint:function(a){var b=new fabric.Point(a.x,a.y),c=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return b.radius=c,b.fill=d,this.points.push(b),b}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render()},onMouseMove:function(a){this.addSprayChunk(a),this.render()},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var b=[],c=0,d=this.sprayChunks.length;d>c;c++)for(var e=this.sprayChunks[c],f=0,g=e.length;g>f;f++){var h=new fabric.Rect({width:e[f].width,height:e[f].width,left:e[f].x+1,top:e[f].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&h.setShadow(this.shadow),b.push(h)}this.optimizeOverlapping&&(b=this._getOptimizedRects(b));var i=new fabric.Group(b,{originX:"center",originY:"center"});i.canvas=this.canvas,this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.renderAll()},_getOptimizedRects:function(a){for(var b,c={},d=0,e=a.length;e>d;d++)b=a[d].left+""+a[d].top,c[b]||(c[b]=a[d]);var f=[];for(b in c)f.push(c[b]);return f},render:function(){var a=this.canvas.contextTop;a.fillStyle=this.color;var b=this.canvas.viewportTransform;a.save(),a.transform(b[0],b[1],b[2],b[3],b[4],b[5]);for(var c=0,d=this.sprayChunkPoints.length;d>c;c++){var e=this.sprayChunkPoints[c];"undefined"!=typeof e.opacity&&(a.globalAlpha=e.opacity),a.fillRect(e.x,e.y,e.width,e.width)}a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];for(var b,c,d,e=this.width/2,f=0;f<this.density;f++){b=fabric.util.getRandomInt(a.x-e,a.x+e),c=fabric.util.getRandomInt(a.y-e,a.y+e),d=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var g=new fabric.Point(b,c);g.width=d,this.randomOpacity&&(g.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(g)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var a=20,b=5,c=fabric.document.createElement("canvas"),d=c.getContext("2d");return c.width=c.height=a+b,d.fillStyle=this.color,d.beginPath(),d.arc(a/2,a/2,a/2,0,2*Math.PI,!1),d.closePath(),d.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(a){var b=this.callSuper("createPath",a);return b.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),b}}),function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians,c=fabric.util.radiansToDegrees,d=Math.atan2,e=Math.abs,f=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(a,b){b||(b={}),this._initStatic(a,b),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(a){var b=this._currentTransform;b.target.set({scaleX:b.original.scaleX,scaleY:b.original.scaleY,left:b.original.left,top:b.original.top}),this._shouldCenterTransform(a,b.target)?"rotate"===b.action?this._setOriginToCenter(b.target):("center"!==b.originX&&(b.mouseXSign="right"===b.originX?-1:1),"center"!==b.originY&&(b.mouseYSign="bottom"===b.originY?-1:1),b.originX="center",b.originY="center"):(b.originX=b.original.originX,b.originY=b.original.originY)},containsPoint:function(a,b){var c=this.getPointer(a,!0),d=this._normalizePointer(b,c);return b.containsPoint(d)||b._findTargetCorner(c)},_normalizePointer:function(a,b){var c,d=this.getActiveGroup(),e=b.x,f=b.y,g=d&&"group"!==a.type&&d.contains(a);return g&&(c=new fabric.Point(d.left,d.top),c=fabric.util.transformPoint(c,this.viewportTransform,!0),e-=c.x,f-=c.y),{x:e,y:f}},isTargetTransparent:function(a,b,c){var d=a.hasBorders,e=a.transparentCorners;a.hasBorders=a.transparentCorners=!1,this._draw(this.contextCache,a),a.hasBorders=d,a.transparentCorners=e;var f=fabric.util.isTransparent(this.contextCache,b,c,this.targetFindTolerance);return this.clearContext(this.contextCache),f},_shouldClearSelection:function(a,b){var c=this.getActiveGroup(),d=this.getActiveObject();return!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable&&d&&d!==b},_shouldCenterTransform:function(a,b){if(b){var c,d=this._currentTransform;return"scale"===d.action||"scaleX"===d.action||"scaleY"===d.action?c=this.centeredScaling||b.centeredScaling:"rotate"===d.action&&(c=this.centeredRotation||b.centeredRotation),c?!a.altKey:a.altKey}},_getOriginFromCorner:function(a,b){var c={x:a.originX,y:a.originY};return"ml"===b||"tl"===b||"bl"===b?c.x="right":("mr"===b||"tr"===b||"br"===b)&&(c.x="left"),"tl"===b||"mt"===b||"tr"===b?c.y="bottom":("bl"===b||"mb"===b||"br"===b)&&(c.y="top"),c},_getActionFromCorner:function(a,b){var c="drag";return b&&(c="ml"===b||"mr"===b?"scaleX":"mt"===b||"mb"===b?"scaleY":"mtr"===b?"rotate":"scale"),c},_setupCurrentTransform:function(a,c){if(c){var d=this.getPointer(a),e=c._findTargetCorner(this.getPointer(a,!0)),f=this._getActionFromCorner(c,e),g=this._getOriginFromCorner(c,e);this._currentTransform={target:c,action:f,scaleX:c.scaleX,scaleY:c.scaleY,offsetX:d.x-c.left,offsetY:d.y-c.top,originX:g.x,originY:g.y,ex:d.x,ey:d.y,left:c.left,top:c.top,theta:b(c.angle),width:c.width*c.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:c.left,top:c.top,scaleX:c.scaleX,scaleY:c.scaleY,originX:g.x,originY:g.y},this._resetCurrentTransform(a)}},_translateObject:function(a,b){var c=this._currentTransform.target;c.get("lockMovementX")||c.set("left",a-this._currentTransform.offsetX),c.get("lockMovementY")||c.set("top",b-this._currentTransform.offsetY)},_scaleObject:function(a,b,c){var d=this._currentTransform,e=d.target,f=e.get("lockScalingX"),g=e.get("lockScalingY"),h=e.get("lockScalingFlip");if(!f||!g){var i=e.translateToOriginPoint(e.getCenterPoint(),d.originX,d.originY),j=e.toLocalPoint(new fabric.Point(a,b),d.originX,d.originY);this._setLocalMouse(j,d),this._setObjectScale(j,d,f,g,c,h),e.setPositionByOrigin(i,d.originX,d.originY)}},_setObjectScale:function(a,b,c,d,e,f){var g=b.target,h=!1,i=!1,j=g.stroke?g.strokeWidth:0;b.newScaleX=a.x/(g.width+j/2),b.newScaleY=a.y/(g.height+j/2),f&&b.newScaleX<=0&&b.newScaleX<g.scaleX&&(h=!0),f&&b.newScaleY<=0&&b.newScaleY<g.scaleY&&(i=!0),"equally"!==e||c||d?e?"x"!==e||g.get("lockUniScaling")?"y"!==e||g.get("lockUniScaling")||i||d||g.set("scaleY",b.newScaleY):h||c||g.set("scaleX",b.newScaleX):(h||c||g.set("scaleX",b.newScaleX),i||d||g.set("scaleY",b.newScaleY)):h||i||this._scaleObjectEqually(a,g,b),h||i||this._flipObject(b,e)},_scaleObjectEqually:function(a,b,c){var d=a.y+a.x,e=b.stroke?b.strokeWidth:0,f=(b.height+e/2)*c.original.scaleY+(b.width+e/2)*c.original.scaleX;c.newScaleX=c.original.scaleX*d/f,c.newScaleY=c.original.scaleY*d/f,b.set("scaleX",c.newScaleX),b.set("scaleY",c.newScaleY)},_flipObject:function(a,b){a.newScaleX<0&&"y"!==b&&("left"===a.originX?a.originX="right":"right"===a.originX&&(a.originX="left")),a.newScaleY<0&&"x"!==b&&("top"===a.originY?a.originY="bottom":"bottom"===a.originY&&(a.originY="top"))},_setLocalMouse:function(a,b){var c=b.target;"right"===b.originX?a.x*=-1:"center"===b.originX&&(a.x*=2*b.mouseXSign,a.x<0&&(b.mouseXSign=-b.mouseXSign)),"bottom"===b.originY?a.y*=-1:"center"===b.originY&&(a.y*=2*b.mouseYSign,a.y<0&&(b.mouseYSign=-b.mouseYSign)),e(a.x)>c.padding?a.x<0?a.x+=c.padding:a.x-=c.padding:a.x=0,e(a.y)>c.padding?a.y<0?a.y+=c.padding:a.y-=c.padding:a.y=0},_rotateObject:function(a,b){var e=this._currentTransform;if(!e.target.get("lockRotation")){var f=d(e.ey-e.top,e.ex-e.left),g=d(b-e.top,a-e.left),h=c(g-f+e.theta);0>h&&(h=360+h),e.target.angle=h%360}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,b=this._groupSelector,c=b.left,d=b.top,g=e(c),h=e(d);if(a.fillStyle=this.selectionColor,a.fillRect(b.ex-(c>0?0:-c),b.ey-(d>0?0:-d),g,h),a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1){var i=b.ex+f-(c>0?0:g),j=b.ey+f-(d>0?0:h);a.beginPath(),fabric.util.drawDashedLine(a,i,j,i+g,j,this.selectionDashArray),fabric.util.drawDashedLine(a,i,j+h-1,i+g,j+h-1,this.selectionDashArray),fabric.util.drawDashedLine(a,i,j,i,j+h,this.selectionDashArray),fabric.util.drawDashedLine(a,i+g-1,j,i+g-1,j+h,this.selectionDashArray),a.closePath(),a.stroke()}else a.strokeRect(b.ex+f-(c>0?0:g),b.ey+f-(d>0?0:h),g,h)},_isLastRenderedObject:function(a){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(a,!0))},findTarget:function(a,b){if(!this.skipTargetFind){if(this._isLastRenderedObject(a))return this.lastRenderedObjectWithControlsAboveOverlay;var c=this.getActiveGroup();if(c&&!b&&this.containsPoint(a,c))return c;var d=this._searchPossibleTargets(a);return this._fireOverOutEvents(d),d}},_fireOverOutEvents:function(a){a?this._hoveredTarget!==a&&(this.fire("mouse:over",{target:a}),a.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=a):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(a,b,c){if(b&&b.visible&&b.evented&&this.containsPoint(a,b)){if(!this.perPixelTargetFind&&!b.perPixelTargetFind||b.isEditing)return!0;var d=this.isTargetTransparent(b,c.x,c.y);if(!d)return!0}},_searchPossibleTargets:function(a){for(var b,c=this.getPointer(a,!0),d=this._objects.length;d--;)if(!this._objects[d].group&&this._checkTarget(a,this._objects[d],c)){this.relatedTarget=this._objects[d],b=this._objects[d];break}return b},getPointer:function(b,c,d){d||(d=this.upperCanvasEl);var e,f=a(b,d),g=d.getBoundingClientRect(),h=g.width||0,i=g.height||0;return h&&i||("top"in g&&"bottom"in g&&(i=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(h=Math.abs(g.right-g.left))),this.calcOffset(),f.x=f.x-this._offset.left,f.y=f.y-this._offset.top,c||(f=fabric.util.transformPoint(f,fabric.util.invertTransform(this.viewportTransform))),e=0===h||0===i?{width:1,height:1}:{width:d.width/h,height:d.height/i},{x:f.x*e.width,y:f.y*e.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var b=this.getWidth()||a.width,c=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:b+"px",height:c+"px",left:0,top:0}),a.width=b,a.height=c,fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,b){b.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(a){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=a,a.set("active",!0)},setActiveObject:function(a,b){return this._setActiveObject(a),this.renderAll(),this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(a){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:a}),this},_setActiveGroup:function(a){this._activeGroup=a,a&&a.set("active",!0)},setActiveGroup:function(a,b){return this._setActiveGroup(a),a&&(this.fire("object:selected",{target:a,e:b}),a.fire("selected",{e:b})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(a){return this._discardActiveGroup(),this.fire("selection:cleared",{e:a}),this},deactivateAll:function(){for(var a=this.getObjects(),b=0,c=a.length;c>b;b++)a[b].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(a){var b=this.getActiveGroup()||this.getActiveObject();return b&&this.fire("before:selection:cleared",{target:b,e:a}),this.deactivateAll(),b&&this.fire("selection:cleared",{e:a}),this},drawControls:function(a){var b=this.getActiveGroup();b?this._drawGroupControls(a,b):this._drawObjectsControls(a)},_drawGroupControls:function(a,b){b._renderControls(a)},_drawObjectsControls:function(a){for(var b=0,c=this._objects.length;c>b;++b)this._objects[b]&&this._objects[b].active&&(this._objects[b]._renderControls(a),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[b])}});for(var g in fabric.StaticCanvas)"prototype"!==g&&(fabric.Canvas[g]=fabric.StaticCanvas[g]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,c=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),b(fabric.window,"resize",this._onResize),b(this.upperCanvasEl,"mousedown",this._onMouseDown),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"mousewheel",this._onMouseWheel),b(this.upperCanvasEl,"touchstart",this._onMouseDown),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){c(fabric.window,"resize",this._onResize),c(this.upperCanvasEl,"mousedown",this._onMouseDown),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"mousewheel",this._onMouseWheel),c(this.upperCanvasEl,"touchstart",this._onMouseDown),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(a,b){this.__onTransformGesture&&this.__onTransformGesture(a,b)},_onDrag:function(a,b){this.__onDrag&&this.__onDrag(a,b)},_onMouseWheel:function(a,b){this.__onMouseWheel&&this.__onMouseWheel(a,b)},_onOrientationChange:function(a,b){this.__onOrientationChange&&this.__onOrientationChange(a,b)},_onShake:function(a,b){this.__onShake&&this.__onShake(a,b)},_onLongPress:function(a,b){this.__onLongPress&&this.__onLongPress(a,b)},_onMouseDown:function(a){this.__onMouseDown(a),b(fabric.document,"touchend",this._onMouseUp),b(fabric.document,"touchmove",this._onMouseMove),c(this.upperCanvasEl,"mousemove",this._onMouseMove),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===a.type?c(this.upperCanvasEl,"mousedown",this._onMouseDown):(b(fabric.document,"mouseup",this._onMouseUp),b(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(a){if(this.__onMouseUp(a),c(fabric.document,"mouseup",this._onMouseUp),c(fabric.document,"touchend",this._onMouseUp),c(fabric.document,"mousemove",this._onMouseMove),c(fabric.document,"touchmove",this._onMouseMove),b(this.upperCanvasEl,"mousemove",this._onMouseMove),b(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===a.type){var d=this;setTimeout(function(){b(d.upperCanvasEl,"mousedown",d._onMouseDown)},400)}},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a,b){var c=this.getActiveGroup()||this.getActiveObject();return!!(a&&(a.isMoving||a!==c)||!a&&c||!a&&!c&&!this._groupSelector||b&&this._previousPointer&&this.selection&&(b.x!==this._previousPointer.x||b.y!==this._previousPointer.y))},__onMouseUp:function(a){var b;if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(a);this._currentTransform?(this._finalizeCurrentTransform(),b=this._currentTransform.target):b=this.findTarget(a,!0);var c=this._shouldRender(b,this.getPointer(a));this._maybeGroupObjects(a),b&&(b.isMoving=!1),c&&this.renderAll(),this._handleCursorAndEvent(a,b)},_handleCursorAndEvent:function(a,b){this._setCursorFromEvent(a,b);var c=this;setTimeout(function(){c._setCursorFromEvent(a,b)},50),this.fire("mouse:up",{target:b,e:a}),b&&b.fire("mouseup",{e:a})},_finalizeCurrentTransform:function(){var a=this._currentTransform,b=a.target;b._scaling&&(b._scaling=!1),b.setCoords(),this.stateful&&b.hasStateChanged()&&(this.fire("object:modified",{target:b}),b.fire("modified")),this._restoreOriginXY(b)},_restoreOriginXY:function(a){if(this._previousOriginX&&this._previousOriginY){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.discardActiveObject(a).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var b=fabric.util.invertTransform(this.viewportTransform),c=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseDown(c),this.fire("mouse:down",{e:a});var d=this.findTarget(a);"undefined"!=typeof d&&d.fire("mousedown",{e:a,target:d})},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var b=fabric.util.invertTransform(this.viewportTransform),c=fabric.util.transformPoint(this.getPointer(a,!0),b);this.freeDrawingBrush.onMouseMove(c)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:a});var d=this.findTarget(a);"undefined"!=typeof d&&d.fire("mousemove",{e:a,target:d})},_onMouseUpInDrawingMode:function(a){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:a});var b=this.findTarget(a);"undefined"!=typeof b&&b.fire("mouseup",{e:a,target:b})},__onMouseDown:function(a){var b="which"in a?1===a.which:1===a.button;if(b||fabric.isTouchSupported){if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(a);if(!this._currentTransform){var c=this.findTarget(a),d=this.getPointer(a,!0);this._previousPointer=d;var e=this._shouldRender(c,d),f=this._shouldGroup(a,c);this._shouldClearSelection(a,c)?this._clearSelection(a,c,d):f&&(this._handleGrouping(a,c),c=this.getActiveGroup()),c&&c.selectable&&!f&&(this._beforeTransform(a,c),this._setupCurrentTransform(a,c)),e&&this.renderAll(),this.fire("mouse:down",{target:c,e:a}),c&&c.fire("mousedown",{e:a})}}},_beforeTransform:function(a,b){this.stateful&&b.saveState(),b._findTargetCorner(this.getPointer(a))&&this.onBeforeScaleRotate(b),b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a))},_clearSelection:function(a,b,c){this.deactivateAllWithDispatch(a),b&&b.selectable?this.setActiveObject(b,a):this.selection&&(this._groupSelector={ex:c.x,ey:c.y,top:0,left:0})},_setOriginToCenter:function(a){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var b=a.getCenterPoint();a.originX="center",a.originY="center",a.left=b.x,a.top=b.y,this._currentTransform.left=a.left,this._currentTransform.top=a.top},_setCenterToOrigin:function(a){var b=a.translateToOriginPoint(a.getCenterPoint(),this._previousOriginX,this._previousOriginY);a.originX=this._previousOriginX,a.originY=this._previousOriginY,a.left=b.x,a.top=b.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(a){var b,c;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(a);if(!("undefined"!=typeof a.touches&&a.touches.length>1)){var d=this._groupSelector;d?(c=this.getPointer(a,!0),d.left=c.x-d.ex,d.top=c.y-d.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(b=this.findTarget(a),!b||b&&!b.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(a,b)),this.fire("mouse:move",{target:b,e:a}),b&&b.fire("mousemove",{e:a})}},_transformObject:function(a){var b=this.getPointer(a),c=this._currentTransform;c.reset=!1,c.target.isMoving=!0,this._beforeScaleTransform(a,c),this._performTransformAction(a,c,b),this.renderAll()},_performTransformAction:function(a,b,c){var d=c.x,e=c.y,f=b.target,g=b.action;"rotate"===g?(this._rotateObject(d,e),this._fire("rotating",f,a)):"scale"===g?(this._onScale(a,b,d,e),this._fire("scaling",f,a)):"scaleX"===g?(this._scaleObject(d,e,"x"),this._fire("scaling",f,a)):"scaleY"===g?(this._scaleObject(d,e,"y"),this._fire("scaling",f,a)):(this._translateObject(d,e),this._fire("moving",f,a),this.setCursor(this.moveCursor))},_fire:function(a,b,c){this.fire("object:"+a,{target:b,e:c}),b.fire(a,{e:c})},_beforeScaleTransform:function(a,b){if("scale"===b.action||"scaleX"===b.action||"scaleY"===b.action){var c=this._shouldCenterTransform(a,b.target);(c&&("center"!==b.originX||"center"!==b.originY)||!c&&"center"===b.originX&&"center"===b.originY)&&(this._resetCurrentTransform(a),b.reset=!0)}},_onScale:function(a,b,c,d){!a.shiftKey&&!this.uniScaleTransform||b.target.get("lockUniScaling")?(b.reset||"scale"!==b.currentAction||this._resetCurrentTransform(a,b.target),b.currentAction="scaleEqually",this._scaleObject(c,d,"equally")):(b.currentAction="scale",this._scaleObject(c,d))},_setCursorFromEvent:function(a,b){if(!b||!b.selectable)return this.setCursor(this.defaultCursor),!1;var c=this.getActiveGroup(),d=b._findTargetCorner&&(!c||!c.contains(b))&&b._findTargetCorner(this.getPointer(a,!0));

return d?this._setCornerCursor(d,b):this.setCursor(b.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(b,c){if(b in a)this.setCursor(this._getRotatedCornerCursor(b,c));else{if("mtr"!==b||!c.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(b,c){var d=Math.round(c.getAngle()%360/45);return 0>d&&(d+=8),d+=a[b],d%=8,this.cursorMap[d]}})}(),function(){var a=Math.min,b=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(a,b){var c=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||c&&c!==b)&&this.selection},_handleGrouping:function(a,b){(b!==this.getActiveGroup()||(b=this.findTarget(a,!0),b&&!b.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(b,a):this._createActiveGroup(b,a),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(a,b){var c=this.getActiveGroup();if(c.contains(a)){if(c.removeWithUpdate(a),this._resetObjectTransform(c),a.set("active",!1),1===c.size())return this.discardActiveGroup(b),void this.setActiveObject(c.item(0))}else c.addWithUpdate(a),this._resetObjectTransform(c);this.fire("selection:created",{target:c,e:b}),c.set("active",!0)},_createActiveGroup:function(a,b){if(this._activeObject&&a!==this._activeObject){var c=this._createGroup(a);c.addWithUpdate(),this.setActiveGroup(c),this._activeObject=null,this.fire("selection:created",{target:c,e:b})}a.set("active",!0)},_createGroup:function(a){var b=this.getObjects(),c=b.indexOf(this._activeObject)<b.indexOf(a),d=c?[this._activeObject,a]:[a,this._activeObject];return new fabric.Group(d,{canvas:this})},_groupSelectedObjects:function(a){var b=this._collectObjects();1===b.length?this.setActiveObject(b[0],a):b.length>1&&(b=new fabric.Group(b.reverse(),{canvas:this}),b.addWithUpdate(),this.setActiveGroup(b,a),b.saveCoords(),this.fire("selection:created",{target:b}),this.renderAll())},_collectObjects:function(){for(var c,d=[],e=this._groupSelector.ex,f=this._groupSelector.ey,g=e+this._groupSelector.left,h=f+this._groupSelector.top,i=new fabric.Point(a(e,g),a(f,h)),j=new fabric.Point(b(e,g),b(f,h)),k=e===g&&f===h,l=this._objects.length;l--&&(c=this._objects[l],!(c&&c.selectable&&c.visible&&(c.intersectsWithRect(i,j)||c.isContainedWithinRect(i,j)||c.containsPoint(i)||c.containsPoint(j))&&(c.set("active",!0),d.push(c),k))););return d},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a);var b=this.getActiveGroup();b&&(b.setObjectsCoords().setCoords(),b.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",c=a.quality||1,d=a.multiplier||1,e={left:a.left,top:a.top,width:a.width,height:a.height};return 1!==d?this.__toDataURLWithMultiplier(b,c,e,d):this.__toDataURL(b,c,e)},__toDataURL:function(a,b,c){this.renderAll(!0);var d=this.upperCanvasEl||this.lowerCanvasEl,e=this.__getCroppedCanvas(d,c);"jpg"===a&&(a="jpeg");var f=fabric.StaticCanvas.supports("toDataURLWithQuality")?(e||d).toDataURL("image/"+a,b):(e||d).toDataURL("image/"+a);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),e&&(e=null),f},__getCroppedCanvas:function(a,b){var c,d,e="left"in b||"top"in b||"width"in b||"height"in b;return e&&(c=fabric.util.createCanvasElement(),d=c.getContext("2d"),c.width=b.width||this.width,c.height=b.height||this.height,d.drawImage(a,-b.left||0,-b.top||0)),c},__toDataURLWithMultiplier:function(a,b,c,d){var e=this.getWidth(),f=this.getHeight(),g=e*d,h=f*d,i=this.getActiveObject(),j=this.getActiveGroup(),k=this.contextTop||this.contextContainer;d>1&&this.setWidth(g).setHeight(h),k.scale(d,d),c.left&&(c.left*=d),c.top&&(c.top*=d),c.width?c.width*=d:1>d&&(c.width=g),c.height?c.height*=d:1>d&&(c.height=h),j?this._tempRemoveBordersControlsFromGroup(j):i&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var l=this.__toDataURL(a,b,c);return this.width=e,this.height=f,k.scale(1/d,1/d),this.setWidth(e).setHeight(f),j?this._restoreBordersControlsOnGroup(j):i&&this.setActiveObject&&this.setActiveObject(i),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),l},toDataURLWithMultiplier:function(a,b,c){return this.toDataURL({format:a,multiplier:b,quality:c})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls,a.origBorderColor=a.borderColor,a.hasControls=!0,a.borderColor="rgba(0,0,0,0)",a.forEachObject(function(a){a.origBorderColor=a.borderColor,a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls,a.borderColor=a.origBorderColor,a.forEachObject(function(a){a.borderColor=a.origBorderColor,delete a.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b,c){return this.loadFromJSON(a,b,c)},loadFromJSON:function(a,b,c){if(a){var d="string"==typeof a?JSON.parse(a):a;this.clear();var e=this;return this._enlivenObjects(d.objects,function(){e._setBgOverlay(d,b)},c),this}},_setBgOverlay:function(a,b){var c=this,d={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!(a.backgroundImage||a.overlayImage||a.background||a.overlay))return void(b&&b());var e=function(){d.backgroundImage&&d.overlayImage&&d.backgroundColor&&d.overlayColor&&(c.renderAll(),b&&b())};this.__setBgOverlay("backgroundImage",a.backgroundImage,d,e),this.__setBgOverlay("overlayImage",a.overlayImage,d,e),this.__setBgOverlay("backgroundColor",a.background,d,e),this.__setBgOverlay("overlayColor",a.overlay,d,e),e()},__setBgOverlay:function(a,b,c,d){var e=this;return b?void("backgroundImage"===a||"overlayImage"===a?fabric.Image.fromObject(b,function(b){e[a]=b,c[a]=!0,d&&d()}):this["set"+fabric.util.string.capitalize(a,!0)](b,function(){c[a]=!0,d&&d()})):void(c[a]=!0)},_enlivenObjects:function(a,b,c){var d=this;if(!a||0===a.length)return void(b&&b());var e=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(a,function(a){a.forEach(function(a,b){d.insertAt(a,b,!0)}),d.renderOnAddRemove=e,b&&b()},null,c)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,c){this.clone(function(d){c(d.toDataURLWithMultiplier(a,b))})},clone:function(a,b){var c=JSON.stringify(this.toJSON(b));this.cloneWithoutData(function(b){b.loadFromJSON(c,function(){a&&a(b)})})},cloneWithoutData:function(a){var b=fabric.document.createElement("canvas");b.width=this.getWidth(),b.height=this.getHeight();var c=new fabric.Canvas(b);c.clipTo=this.clipTo,this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll(),a&&a(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):a&&a(c)}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.toFixed,e=b.util.string.capitalize,f=b.util.degreesToRadians,g=b.StaticCanvas.supports("setLineDash");b.Object||(b.Object=b.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||!a.fill.colorStops||a.fill instanceof b.Gradient||this.set("fill",new b.Gradient(a.fill))},_initPattern:function(a){!a.fill||!a.fill.source||a.fill instanceof b.Pattern||this.set("fill",new b.Pattern(a.fill)),!a.stroke||!a.stroke.source||a.stroke instanceof b.Pattern||this.set("stroke",new b.Pattern(a.stroke))},_initClipping:function(a){if(a.clipTo&&"string"==typeof a.clipTo){var c=b.util.getFunctionBody(a.clipTo);"undefined"!=typeof c&&(this.clipTo=new Function("ctx",c))}},setOptions:function(a){for(var b in a)this.set(b,a[b]);this._initGradient(a),this._initPattern(a),this._initClipping(a)},transform:function(a,b){var c=b?this._getLeftTopCoords():this.getCenterPoint();a.translate(c.x,c.y),a.rotate(f(this.angle)),a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var c=b.Object.NUM_FRACTION_DIGITS,e={type:this.type,originX:this.originX,originY:this.originY,left:d(this.left,c),top:d(this.top,c),width:d(this.width,c),height:d(this.height,c),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:d(this.strokeWidth,c),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:d(this.strokeMiterLimit,c),scaleX:d(this.scaleX,c),scaleY:d(this.scaleY,c),angle:d(this.getAngle(),c),flipX:this.flipX,flipY:this.flipY,opacity:d(this.opacity,c),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};return this.includeDefaultValues||(e=this._removeDefaultValues(e)),b.util.populateWithProperties(this,e,a),e},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var c=b.util.getKlass(a.type).prototype,d=c.stateProperties;return d.forEach(function(b){a[b]===c[b]&&delete a[b]}),a},toString:function(){return"#<fabric."+e(this.type)+">"},get:function(a){return this[a]},_setObject:function(a){for(var b in a)this._set(b,a[b])},set:function(a,b){return"object"==typeof a?this._setObject(a):"function"==typeof b&&"clipTo"!==a?this._set(a,b(this.get(a))):this._set(a,b),this},_set:function(a,c){var e="scaleX"===a||"scaleY"===a;return e&&(c=this._constrainScale(c)),"scaleX"===a&&0>c?(this.flipX=!this.flipX,c*=-1):"scaleY"===a&&0>c?(this.flipY=!this.flipY,c*=-1):"width"===a||"height"===a?this.minScaleLimit=d(Math.min(.1,1/Math.max(this.width,this.height)),2):"shadow"!==a||!c||c instanceof b.Shadow||(c=new b.Shadow(c)),this[a]=c,this},toggle:function(a){var b=this.get(a);return"boolean"==typeof b&&this.set(a,!b),this},setSourcePath:function(a){return this.sourcePath=a,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(a,c){0===this.width&&0===this.height||!this.visible||(a.save(),this._setupCompositeOperation(a),c||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this._setOpacity(a),this._setShadow(a),this.clipTo&&b.util.clipContext(this,a),this._render(a,c),this.clipTo&&a.restore(),this._removeShadow(a),this._restoreCompositeOperation(a),a.restore())},_setOpacity:function(a){this.group&&this.group._setOpacity(a),a.globalAlpha*=this.opacity},_setStrokeStyles:function(a){this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a,this):this.stroke)},_setFillStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a,this):this.fill)},_renderControls:function(a,c){if(this.active&&!c){var d=this.getViewportTransform();a.save();var e;this.group&&(e=b.util.transformPoint(this.group.getCenterPoint(),d),a.translate(e.x,e.y),a.rotate(f(this.group.angle))),e=b.util.transformPoint(this.getCenterPoint(),d,null!=this.group),this.group&&(e.x*=this.group.scaleX,e.y*=this.group.scaleY),a.translate(e.x,e.y),a.rotate(f(this.angle)),this.drawBorders(a),this.drawControls(a),a.restore()}},_setShadow:function(a){if(this.shadow){var b=this.canvas&&this.canvas.viewportTransform[0]||1,c=this.canvas&&this.canvas.viewportTransform[3]||1;a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur*(b+c)*(this.scaleX+this.scaleY)/4,a.shadowOffsetX=this.shadow.offsetX*b*this.scaleX,a.shadowOffsetY=this.shadow.offsetY*c*this.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_renderFill:function(a){if(this.fill){if(a.save(),this.fill.gradientTransform){var b=this.fill.gradientTransform;a.transform.apply(a,b)}this.fill.toLive&&a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?a.fill("evenodd"):a.fill(),a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a)}},_renderStroke:function(a){if(this.stroke&&0!==this.strokeWidth){if(a.save(),this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke();else{if(this.stroke.gradientTransform){var b=this.stroke.gradientTransform;a.transform.apply(a,b)}this._stroke?this._stroke(a):a.stroke()}this._removeShadow(a),a.restore()}},clone:function(a,c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),a):new b.Object(this.toObject(c))},cloneAsImage:function(a){var c=this.toDataURL();return b.util.loadImage(c,function(c){a&&a(new b.Image(c))}),this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement(),d=this.getBoundingRect();c.width=d.width,c.height=d.height,b.util.wrapElement(c,"div");var e=new b.StaticCanvas(c);"jpg"===a.format&&(a.format="jpeg"),"jpeg"===a.format&&(e.backgroundColor="#fff");var f={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new b.Point(c.width/2,c.height/2),"center","center");var g=this.canvas;e.add(this);var h=e.toDataURL(a);return this.set(f).setCoords(),this.canvas=g,e.dispose(),e=null,h},isType:function(a){return this.type===a},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};d.type=c.type||(c.r1||c.r2?"radial":"linear"),d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2},(c.r1||c.r2)&&(d.coords.r1=c.r1,d.coords.r2=c.r2);for(var e in c.colorStops){var f=new b.Color(c.colorStops[e]);d.colorStops.push({offset:e,color:f.toRgb(),opacity:f.getAlpha()})}return this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",a?new b.Shadow(a):null)},setColor:function(a){return this.set("fill",a),this},setAngle:function(a){var b=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return b&&this._setOriginToCenter(),this.set("angle",a),b&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(a,b){b=b||this.canvas.getPointer(a);var c=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:b.x-c.x,y:b.y-c.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(this._prevGlobalCompositeOperation=a.globalCompositeOperation,a.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(a){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(a.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,c(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object.__uid=0)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(b,c,d){var e=b.x,f=b.y,g=this.stroke?this.strokeWidth:0;return"left"===c?e=b.x+(this.getWidth()+g*this.scaleX)/2:"right"===c&&(e=b.x-(this.getWidth()+g*this.scaleX)/2),"top"===d?f=b.y+(this.getHeight()+g*this.scaleY)/2:"bottom"===d&&(f=b.y-(this.getHeight()+g*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(e,f),b,a(this.angle))},translateToOriginPoint:function(b,c,d){var e=b.x,f=b.y,g=this.stroke?this.strokeWidth:0;return"left"===c?e=b.x-(this.getWidth()+g*this.scaleX)/2:"right"===c&&(e=b.x+(this.getWidth()+g*this.scaleX)/2),"top"===d?f=b.y-(this.getHeight()+g*this.scaleY)/2:"bottom"===d&&(f=b.y+(this.getHeight()+g*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(e,f),b,a(this.angle))},getCenterPoint:function(){var a=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,b){var c=this.getCenterPoint();return this.translateToOriginPoint(c,a,b)},toLocalPoint:function(b,c,d){var e,f,g=this.getCenterPoint(),h=this.stroke?this.strokeWidth:0;return c&&d?(e="left"===c?g.x-(this.getWidth()+h*this.scaleX)/2:"right"===c?g.x+(this.getWidth()+h*this.scaleX)/2:g.x,f="top"===d?g.y-(this.getHeight()+h*this.scaleY)/2:"bottom"===d?g.y+(this.getHeight()+h*this.scaleY)/2:g.y):(e=this.left,f=this.top),fabric.util.rotatePoint(new fabric.Point(b.x,b.y),g,-a(this.angle)).subtractEquals(new fabric.Point(e,f))},setPositionByOrigin:function(a,b,c){var d=this.translateToCenterPoint(a,b,c),e=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(b){var c=a(this.angle),d=this.getWidth()/2,e=Math.cos(c)*d,f=Math.sin(c)*d,g=this.getWidth(),h=Math.cos(c)*g,i=Math.sin(c)*g;"center"===this.originX&&"left"===b||"right"===this.originX&&"center"===b?(this.left-=e,this.top-=f):"left"===this.originX&&"center"===b||"center"===this.originX&&"right"===b?(this.left+=e,this.top+=f):"left"===this.originX&&"right"===b?(this.left+=h,this.top+=i):"right"===this.originX&&"left"===b&&(this.left-=h,this.top-=i),this.setCoords(),this.originX=b},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center",this.originY="center",this.left=a.x,this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=a.x,this.top=a.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(a,b){var c=this.oCoords,d=new fabric.Point(c.tl.x,c.tl.y),e=new fabric.Point(c.tr.x,c.tr.y),f=new fabric.Point(c.bl.x,c.bl.y),g=new fabric.Point(c.br.x,c.br.y),h=fabric.Intersection.intersectPolygonRectangle([d,e,g,f],a,b);return"Intersection"===h.status},intersectsWithObject:function(a){function b(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,a.tr.y),bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var c=b(this.oCoords),d=b(a.oCoords),e=fabric.Intersection.intersectPolygonPolygon([c.tl,c.tr,c.br,c.bl],[d.tl,d.tr,d.br,d.bl]);return"Intersection"===e.status},isContainedWithinObject:function(a){var b=a.getBoundingRect(),c=new fabric.Point(b.left,b.top),d=new fabric.Point(b.left+b.width,b.top+b.height);return this.isContainedWithinRect(c,d)},isContainedWithinRect:function(a,b){var c=this.getBoundingRect();return c.left>=a.x&&c.left+c.width<=b.x&&c.top>=a.y&&c.top+c.height<=b.y},containsPoint:function(a){var b=this._getImageLines(this.oCoords),c=this._findCrossPoints(a,b);return 0!==c&&c%2===1},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,b){var c,d,e,f,g,h,i,j=0;for(var k in b)if(i=b[k],!(i.o.y<a.y&&i.d.y<a.y||i.o.y>=a.y&&i.d.y>=a.y||(i.o.x===i.d.x&&i.o.x>=a.x?(g=i.o.x,h=a.y):(c=0,d=(i.d.y-i.o.y)/(i.d.x-i.o.x),e=a.y-c*a.x,f=i.o.y-d*i.o.x,g=-(e-f)/(c-d),h=e+c*g),g>=a.x&&(j+=1),2!==j)))break;return j},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],b=fabric.util.array.min(a),c=fabric.util.array.max(a),d=Math.abs(b-c),e=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],f=fabric.util.array.min(e),g=fabric.util.array.max(e),h=Math.abs(f-g);return{left:b,top:f,width:d,height:h}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){return a=this._constrainScale(a),0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1),this.scaleX=a,this.scaleY=a,this.setCoords(),this},scaleToWidth:function(a){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(a/this.width/b)},scaleToHeight:function(a){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/b)},setCoords:function(){var b=a(this.angle),c=this.getViewportTransform(),d=function(a){return fabric.util.transformPoint(a,c)},e=this._calculateCurrentDimensions(!1),f=e.x,g=e.y;0>f&&(f=Math.abs(f));var h=Math.sqrt(Math.pow(f/2,2)+Math.pow(g/2,2)),i=Math.atan(isFinite(g/f)?g/f:0),j=Math.cos(i+b)*h,k=Math.sin(i+b)*h,l=Math.sin(b),m=Math.cos(b),n=this.getCenterPoint(),o=new fabric.Point(f,g),p=new fabric.Point(n.x-j,n.y-k),q=new fabric.Point(p.x+o.x*m,p.y+o.x*l),r=d(new fabric.Point(p.x-o.y*l,p.y+o.y*m)),s=d(new fabric.Point(q.x-o.y*l,q.y+o.y*m)),t=d(p),u=d(q),v=new fabric.Point((t.x+r.x)/2,(t.y+r.y)/2),w=new fabric.Point((u.x+t.x)/2,(u.y+t.y)/2),x=new fabric.Point((s.x+u.x)/2,(s.y+u.y)/2),y=new fabric.Point((s.x+r.x)/2,(s.y+r.y)/2),z=new fabric.Point(w.x+l*this.rotatingPointOffset,w.y-m*this.rotatingPointOffset);return this.oCoords={tl:t,tr:u,br:s,bl:r,ml:v,mt:w,mr:x,mb:y,mtr:z},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,a),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var a=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",b=this.fillRule,c=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",d=this.strokeWidth?this.strokeWidth:"0",e=this.strokeDashArray?this.strokeDashArray.join(" "):"",f=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",h=this.strokeMiterLimit?this.strokeMiterLimit:"4",i="undefined"!=typeof this.opacity?this.opacity:"1",j=this.visible?"":" visibility: hidden;",k=this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",c,"; ","stroke-width: ",d,"; ","stroke-dasharray: ",e,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",h,"; ","fill: ",a,"; ","fill-rule: ",b,"; ","opacity: ",i,";",k,j].join("")},getSvgTransform:function(){if(this.group&&"path-group"===this.group.type)return"";var a=fabric.util.toFixed,b=this.getAngle(),c=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],d=fabric.util.transformPoint(this.getCenterPoint(),c),e=fabric.Object.NUM_FRACTION_DIGITS,f="path-group"===this.type?"":"translate("+a(d.x,e)+" "+a(d.y,e)+")",g=0!==b?" rotate("+a(b,e)+")":"",h=1===this.scaleX&&1===this.scaleY&&1===c[0]&&1===c[3]?"":" scale("+a(this.scaleX*c[0],e)+" "+a(this.scaleY*c[3],e)+")",i="path-group"===this.type?this.width*c[0]:0,j=this.flipX?" matrix(-1 0 0 1 "+i+" 0) ":"",k="path-group"===this.type?this.height*c[3]:0,l=this.flipY?" matrix(1 0 0 -1 0 "+k+")":"";return[f,g,h,j,l].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var a=[];return this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1)),this.shadow&&a.push(this.shadow.toSVG(this)),a}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this.get(a)!==this.originalState[a]},this)},saveState:function(a){return this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this),a&&a.stateProperties&&a.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var a=fabric.util.degreesToRadians,b=function(){return"undefined"!=typeof G_vmlCanvasManager};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(a){if(!this.hasControls||!this.active)return!1;var b,c,d=a.x,e=a.y;for(var f in this.oCoords)if(this.isControlVisible(f)&&("mtr"!==f||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==f&&"mr"!==f&&"mb"!==f&&"ml"!==f)&&(c=this._getImageLines(this.oCoords[f].corner),b=this._findCrossPoints({x:d,y:e},c),0!==b&&b%2===1))return this.__corner=f,f;return!1},_setCornerCoords:function(){var b,c,d=this.oCoords,e=a(45-this.angle),f=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,g=f*Math.cos(e),h=f*Math.sin(e);for(var i in d)b=d[i].x,c=d[i].y,d[i].corner={tl:{x:b-h,y:c-g},tr:{x:b+g,y:c-h},bl:{x:b-g,y:c+h},br:{x:b+h,y:c+g}}},_calculateCurrentDimensions:function(a){var b=this.getViewportTransform(),c=this.strokeWidth,d=this.width,e=this.height,f="round"===this.strokeLineCap||"square"===this.strokeLineCap,g="line"===this.type&&0===this.width,h="line"===this.type&&0===this.height,i=g||h,j=f&&h||!i,k=f&&g||!i;return g?d=c:h&&(e=c),j&&(d+=0>d?-c:c),k&&(e+=0>e?-c:c),d=d*this.scaleX+2*this.padding,e=e*this.scaleY+2*this.padding,a?fabric.util.transformPoint(new fabric.Point(d,e),b,!0):{x:d,y:e}},drawBorders:function(a){if(!this.hasBorders)return this;a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=this.borderColor,a.lineWidth=1/this.borderScaleFactor;var b=this._calculateCurrentDimensions(!0),c=b.x,d=b.y;if(this.group&&(c*=this.group.scaleX,d*=this.group.scaleY),a.strokeRect(~~-(c/2)-.5,~~-(d/2)-.5,~~c+1,~~d+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var e=-d/2;a.beginPath(),a.moveTo(0,e),a.lineTo(0,e-this.rotatingPointOffset),a.closePath(),a.stroke()}return a.restore(),this},drawControls:function(a){if(!this.hasControls)return this;var b=this._calculateCurrentDimensions(!0),c=b.x,d=b.y,e=-(c/2),f=-(d/2),g=this.cornerSize/2,h=this.transparentCorners?"strokeRect":"fillRect";return a.save(),a.lineWidth=1,a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,a.strokeStyle=a.fillStyle=this.cornerColor,this._drawControl("tl",a,h,e-g,f-g),this._drawControl("tr",a,h,e+c-g,f-g),this._drawControl("bl",a,h,e-g,f+d-g),this._drawControl("br",a,h,e+c-g,f+d-g),this.get("lockUniScaling")||(this._drawControl("mt",a,h,e+c/2-g,f-g),this._drawControl("mb",a,h,e+c/2-g,f+d-g),this._drawControl("mr",a,h,e+c-g,f+d/2-g),this._drawControl("ml",a,h,e-g,f+d/2-g)),this.hasRotatingPoint&&this._drawControl("mtr",a,h,e+c/2-g,f-this.rotatingPointOffset-g),a.restore(),this},_drawControl:function(a,c,d,e,f){if(this.isControlVisible(a)){var g=this.cornerSize;b()||this.transparentCorners||c.clearRect(e,f,g,g),c[d](e,f,g,g)}},isControlVisible:function(a){return this._getControlsVisibility()[a]},setControlVisible:function(a,b){return this._getControlsVisibility()[a]=b,this},setControlsVisibility:function(a){a||(a={});for(var b in a)this.setControlVisible(b,a[b]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(b){a.set("left",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxCenterObjectV:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(b){a.set("top",b),f.renderAll(),e()},onComplete:function(){a.setCoords(),d()}}),this},fxRemove:function(a,b){b=b||{};var c=function(){},d=b.onComplete||c,e=b.onChange||c,f=this;return fabric.util.animate({startValue:a.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){a.set("active",!1)},onChange:function(b){a.set("opacity",b),f.renderAll(),e()},onComplete:function(){f.remove(a),d()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var a,b,c=[];for(a in arguments[0])c.push(a);for(var d=0,e=c.length;e>d;d++)a=c[d],b=d!==e-1,this._animate(a,arguments[0][a],arguments[1],b)}else this._animate.apply(this,arguments);return this},_animate:function(a,b,c,d){var e,f=this;b=b.toString(),c=c?fabric.util.object.clone(c):{},~a.indexOf(".")&&(e=a.split("."));var g=e?this.get(e[0])[e[1]]:this.get(a);"from"in c||(c.from=g),b=~b.indexOf("=")?g+parseFloat(b.replace("=","")):parseFloat(b),fabric.util.animate({startValue:c.from,endValue:b,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(b){e?f[e[0]][e[1]]=b:f.set(a,b),d||c.onChange&&c.onChange()},onComplete:function(){d||(f.setCoords(),c.onComplete&&c.onComplete())}})}}),function(a){"use strict";function b(a,b){var c=a.origin,d=a.axis1,e=a.axis2,f=a.dimension,g=b.nearest,h=b.center,i=b.farthest;return function(){switch(this.get(c)){case g:return Math.min(this.get(d),this.get(e));case h:return Math.min(this.get(d),this.get(e))+.5*this.get(f);case i:return Math.max(this.get(d),this.get(e))}}}var c=a.fabric||(a.fabric={}),d=c.util.object.extend,e={x1:1,x2:1,y1:1,y2:1},f=c.StaticCanvas.supports("setLineDash");return c.Line?void c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,{
type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(a,b){b=b||{},a||(a=[0,0,0,0]),this.callSuper("initialize",b),this.set("x1",a[0]),this.set("y1",a[1]),this.set("x2",a[2]),this.set("y2",a[3]),this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in a?a.left:this._getLeftToOriginX(),this.top="top"in a?a.top:this._getTopToOriginY()},_set:function(a,b){return this.callSuper("_set",a,b),"undefined"!=typeof e[a]&&this._setWidthHeight(),this},_getLeftToOriginX:b({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:b({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(a,b){if(a.beginPath(),b){var c=this.getCenterPoint();a.translate(c.x-this.strokeWidth/2,c.y-this.strokeWidth/2)}if(!this.strokeDashArray||this.strokeDashArray&&f){var d=this.calcLinePoints();a.moveTo(d.x1,d.y1),a.lineTo(d.x2,d.y2)}a.lineWidth=this.strokeWidth;var e=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle,this.stroke&&this._renderStroke(a),a.strokeStyle=e},_renderDashedStroke:function(a){var b=this.calcLinePoints();a.beginPath(),c.util.drawDashedLine(a,b.x1,b.y1,b.x2,b.y2,this.strokeDashArray),a.closePath()},toObject:function(a){return d(this.callSuper("toObject",a),this.calcLinePoints())},calcLinePoints:function(){var a=this.x1<=this.x2?-1:1,b=this.y1<=this.y2?-1:1,c=a*this.width*.5,d=b*this.height*.5,e=a*this.width*-.5,f=b*this.height*-.5;return{x1:c,x2:e,y1:d,y2:f}},toSVG:function(a){var b=this._createBaseSVGMarkup(),c={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(c=this.calcLinePoints()),b.push("<line ",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),c.Line.fromElement=function(a,b){var e=c.parseAttributes(a,c.Line.ATTRIBUTE_NAMES),f=[e.x1||0,e.y1||0,e.x2||0,e.y2||0];return new c.Line(f,d(e,b))},void(c.Line.fromObject=function(a){var b=[a.x1,a.y1,a.x2,a.y2];return new c.Line(b,a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";function b(a){return"radius"in a&&a.radius>=0}var c=a.fabric||(a.fabric={}),d=Math.PI,e=c.util.object.extend;return c.Circle?void c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*d,initialize:function(a){a=a||{},this.callSuper("initialize",a),this.set("radius",a.radius||0),this.startAngle=a.startAngle||this.startAngle,this.endAngle=a.endAngle||this.endAngle},_set:function(a,b){return this.callSuper("_set",a,b),"radius"===a&&this.setRadius(b),this},toObject:function(a){return e(this.callSuper("toObject",a),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,e=0,f=(this.endAngle-this.startAngle)%(2*d);if(0===f)this.group&&"path-group"===this.group.type&&(c=this.left+this.radius,e=this.top+this.radius),b.push("<circle ",'cx="'+c+'" cy="'+e+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var g=Math.cos(this.startAngle)*this.radius,h=Math.sin(this.startAngle)*this.radius,i=Math.cos(this.endAngle)*this.radius,j=Math.sin(this.endAngle)*this.radius,k=f>d?"1":"0";b.push('<path d="M '+g+" "+h," A "+this.radius+" "+this.radius," 0 ",+k+" 1"," "+i+" "+j,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath(),a.arc(b?this.left+this.radius:0,b?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(a),this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a,this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),c.Circle.fromElement=function(a,d){d||(d={});var f=c.parseAttributes(a,c.Circle.ATTRIBUTE_NAMES);if(!b(f))throw new Error("value of `r` attribute is required and can not be negative");f.left=f.left||0,f.top=f.top||0;var g=new c.Circle(e(f,d));return g.left-=g.radius,g.top-=g.radius,g},void(c.Circle.fromObject=function(a){return new c.Circle(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Triangle?void b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(a){a=a||{},this.callSuper("initialize",a),this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var b=this.width/2,c=this.height/2;a.beginPath(),a.moveTo(-b,c),a.lineTo(0,-c),a.lineTo(b,c),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=this.width/2,d=this.height/2;a.beginPath(),b.util.drawDashedLine(a,-c,d,0,-d,this.strokeDashArray),b.util.drawDashedLine(a,0,-d,c,d,this.strokeDashArray),b.util.drawDashedLine(a,c,d,-c,d,this.strokeDashArray),a.closePath()},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.width/2,d=this.height/2,e=[-c+" "+d,"0 "+-d,c+" "+d].join(",");return b.push("<polygon ",'points="',e,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),void(b.Triangle.fromObject=function(a){return new b.Triangle(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=2*Math.PI,d=b.util.object.extend;return b.Ellipse?void b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{},this.callSuper("initialize",a),this.set("rx",a.rx||0),this.set("ry",a.ry||0)},_set:function(a,b){switch(this.callSuper("_set",a,b),a){case"rx":this.rx=b,this.set("width",2*b);break;case"ry":this.ry=b,this.set("height",2*b)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(a){return d(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=0,d=0;return this.group&&"path-group"===this.group.type&&(c=this.left+this.rx,d=this.top+this.ry),b.push("<ellipse ",'cx="',c,'" cy="',d,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},_render:function(a,b){a.beginPath(),a.save(),a.transform(1,0,0,this.ry/this.rx,0,0),a.arc(b?this.left+this.rx:0,b?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,c,!1),a.restore(),this._renderFill(a),this._renderStroke(a)},complexity:function(){return 1}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),b.Ellipse.fromElement=function(a,c){c||(c={});var e=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0;var f=new b.Ellipse(d(e,c));return f.top-=f.ry,f.left-=f.rx,f},void(b.Ellipse.fromObject=function(a){return new b.Ellipse(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;if(b.Rect)return void console.warn("fabric.Rect is already defined");var d=b.Object.prototype.stateProperties.concat();d.push("rx","ry","x","y"),b.Rect=b.util.createClass(b.Object,{stateProperties:d,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{},this.callSuper("initialize",a),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a,b){if(1===this.width&&1===this.height)return void a.fillRect(0,0,1,1);var c=this.rx?Math.min(this.rx,this.width/2):0,d=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,f=this.height,g=b?this.left:-this.width/2,h=b?this.top:-this.height/2,i=0!==c||0!==d,j=.4477152502;a.beginPath(),a.moveTo(g+c,h),a.lineTo(g+e-c,h),i&&a.bezierCurveTo(g+e-j*c,h,g+e,h+j*d,g+e,h+d),a.lineTo(g+e,h+f-d),i&&a.bezierCurveTo(g+e,h+f-j*d,g+e-j*c,h+f,g+e-c,h+f),a.lineTo(g+c,h+f),i&&a.bezierCurveTo(g+j*c,h+f,g,h+f-j*d,g,h+f-d),a.lineTo(g,h+d),i&&a.bezierCurveTo(g,h+j*d,g+j*c,h,g+c,h),a.closePath(),this._renderFill(a),this._renderStroke(a)},_renderDashedStroke:function(a){var c=-this.width/2,d=-this.height/2,e=this.width,f=this.height;a.beginPath(),b.util.drawDashedLine(a,c,d,c+e,d,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d,c+e,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c+e,d+f,c,d+f,this.strokeDashArray),b.util.drawDashedLine(a,c,d+f,c,d,this.strokeDashArray),a.closePath()},toObject:function(a){var b=c(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(b),b},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this.left,d=this.top;return this.group&&"path-group"===this.group.type||(c=-this.width/2,d=-this.height/2),b.push("<rect ",'x="',c,'" y="',d,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),a?a(b.join("")):b.join("")},complexity:function(){return 1}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,d){if(!a)return null;d=d||{};var e=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);e.left=e.left||0,e.top=e.top||0;var f=new b.Rect(c(d?b.util.object.clone(d):{},e));return f.visible=f.width>0&&f.height>0,f},b.Rect.fromObject=function(a){return new b.Rect(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});return b.Polyline?void b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(a,c){return b.Polygon.prototype.initialize.call(this,a,c)},_calcDimensions:function(){return b.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return b.Polygon.prototype._applyPointOffset.call(this)},toObject:function(a){return b.Polygon.prototype.toObject.call(this,a)},toSVG:function(a){return b.Polygon.prototype.toSVG.call(this,a)},_render:function(a){b.Polygon.prototype.commonRender.call(this,a)&&(this._renderFill(a),this._renderStroke(a))},_renderDashedStroke:function(a){var c,d;a.beginPath();for(var e=0,f=this.points.length;f>e;e++)c=this.points[e],d=this.points[e+1]||c,b.util.drawDashedLine(a,c.x,c.y,d.x,d.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,c){if(!a)return null;c||(c={});var d=b.parsePointsAttribute(a.getAttribute("points")),e=b.parseAttributes(a,b.Polyline.ATTRIBUTE_NAMES);return new b.Polyline(d,b.util.object.extend(e,c))},void(b.Polyline.fromObject=function(a){var c=a.points;return new b.Polyline(c,a,!0)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.toFixed;return b.Polygon?void b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(a,b){b=b||{},this.points=a||[],this.callSuper("initialize",b),this._calcDimensions(),"top"in b||(this.top=this.minY),"left"in b||(this.left=this.minX)},_calcDimensions:function(){var a=this.points,b=d(a,"x"),c=d(a,"y"),f=e(a,"x"),g=e(a,"y");this.width=f-b||0,this.height=g-c||0,this.minX=b||0,this.minY=c||0},_applyPointOffset:function(){this.points.forEach(function(a){a.x-=this.minX+this.width/2,a.y-=this.minY+this.height/2},this)},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d=0,e=this.points.length;e>d;d++)b.push(f(this.points[d].x,2),",",f(this.points[d].y,2)," ");return c.push("<",this.type," ",'points="',b.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),a?a(c.join("")):c.join("")},_render:function(a){this.commonRender(a)&&(this._renderFill(a),(this.stroke||this.strokeDashArray)&&(a.closePath(),this._renderStroke(a)))},commonRender:function(a){var b,c=this.points.length;if(!c||isNaN(this.points[c-1].y))return!1;a.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null),a.moveTo(this.points[0].x,this.points[0].y);for(var d=0;c>d;d++)b=this.points[d],a.lineTo(b.x,b.y);return!0},_renderDashedStroke:function(a){b.Polyline.prototype._renderDashedStroke.call(this,a),a.closePath()},complexity:function(){return this.points.length}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});var e=b.parsePointsAttribute(a.getAttribute("points")),f=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES);return new b.Polygon(e,c(f,d))},void(b.Polygon.fromObject=function(a){return new b.Polygon(a.points,a,!0)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.array.min,d=b.util.array.max,e=b.util.object.extend,f=Object.prototype.toString,g=b.util.drawArc,h={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i={m:"l",M:"L"};return b.Path?void b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(a,b){if(b=b||{},this.setOptions(b),!a)throw new Error("`path` argument is required");var c="[object Array]"===f.call(a);this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(c||(this.path=this._parsePath()),this._setPositionDimensions(),b.sourcePath&&this.setSourcePath(b.sourcePath))},_setPositionDimensions:function(){var a=this._parseDimensions();this.minX=a.left,this.minY=a.top,this.width=a.width,this.height=a.height,a.left+="center"===this.originX?this.width/2:"right"===this.originX?this.width:0,a.top+="center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0,this.top=this.top||a.top,this.left=this.left||a.left,this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(a){var b,c,d,e=null,f=0,h=0,i=0,j=0,k=0,l=0,m=-this.pathOffset.x,n=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(m=0,n=0),a.beginPath();for(var o=0,p=this.path.length;p>o;++o){switch(b=this.path[o],b[0]){case"l":i+=b[1],j+=b[2],a.lineTo(i+m,j+n);break;case"L":i=b[1],j=b[2],a.lineTo(i+m,j+n);break;case"h":i+=b[1],a.lineTo(i+m,j+n);break;case"H":i=b[1],a.lineTo(i+m,j+n);break;case"v":j+=b[1],a.lineTo(i+m,j+n);break;case"V":j=b[1],a.lineTo(i+m,j+n);break;case"m":i+=b[1],j+=b[2],f=i,h=j,a.moveTo(i+m,j+n);break;case"M":i=b[1],j=b[2],f=i,h=j,a.moveTo(i+m,j+n);break;case"c":c=i+b[5],d=j+b[6],k=i+b[3],l=j+b[4],a.bezierCurveTo(i+b[1]+m,j+b[2]+n,k+m,l+n,c+m,d+n),i=c,j=d;break;case"C":i=b[5],j=b[6],k=b[3],l=b[4],a.bezierCurveTo(b[1]+m,b[2]+n,k+m,l+n,i+m,j+n);break;case"s":c=i+b[3],d=j+b[4],null===e[0].match(/[CcSs]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.bezierCurveTo(k+m,l+n,i+b[1]+m,j+b[2]+n,c+m,d+n),k=i+b[1],l=j+b[2],i=c,j=d;break;case"S":c=b[3],d=b[4],null===e[0].match(/[CcSs]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.bezierCurveTo(k+m,l+n,b[1]+m,b[2]+n,c+m,d+n),i=c,j=d,k=b[1],l=b[2];break;case"q":c=i+b[3],d=j+b[4],k=i+b[1],l=j+b[2],a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"Q":c=b[3],d=b[4],a.quadraticCurveTo(b[1]+m,b[2]+n,c+m,d+n),i=c,j=d,k=b[1],l=b[2];break;case"t":c=i+b[1],d=j+b[2],null===e[0].match(/[QqTt]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"T":c=b[1],d=b[2],null===e[0].match(/[QqTt]/)?(k=i,l=j):(k=2*i-k,l=2*j-l),a.quadraticCurveTo(k+m,l+n,c+m,d+n),i=c,j=d;break;case"a":g(a,i+m,j+n,[b[1],b[2],b[3],b[4],b[5],b[6]+i+m,b[7]+j+n]),i+=b[6],j+=b[7];break;case"A":g(a,i+m,j+n,[b[1],b[2],b[3],b[4],b[5],b[6]+m,b[7]+n]),i=b[6],j=b[7];break;case"z":case"Z":i=f,j=h,a.closePath()}e=b}this._renderFill(a),this._renderStroke(a)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){var b=e(this.callSuper("toObject",a),{path:this.path.map(function(a){return a.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(b.sourcePath=this.sourcePath),this.transformMatrix&&(b.transformMatrix=this.transformMatrix),b},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.path=this.sourcePath),delete b.sourcePath,b},toSVG:function(a){for(var b=[],c=this._createBaseSVGMarkup(),d="",e=0,f=this.path.length;f>e;e++)b.push(this.path[e].join(" "));var g=b.join(" ");return this.group&&"path-group"===this.group.type||(d=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),c.push("<path ",'d="',g,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),d,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),a?a(c.join("")):c.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a,b,c,d,e,f=[],g=[],j=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,k=0,l=this.path.length;l>k;k++){for(a=this.path[k],d=a.slice(1).trim(),g.length=0;c=j.exec(d);)g.push(c[0]);e=[a.charAt(0)];for(var m=0,n=g.length;n>m;m++)b=parseFloat(g[m]),isNaN(b)||e.push(b);var o=e[0],p=h[o.toLowerCase()],q=i[o]||o;if(e.length-1>p)for(var r=1,s=e.length;s>r;r+=p)f.push([o].concat(e.slice(r,r+p))),o=q;else f.push(e)}return f},_parseDimensions:function(){for(var a,e,f,g,h=[],i=[],j=null,k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=this.path.length;r>q;++q){switch(a=this.path[q],a[0]){case"l":m+=a[1],n+=a[2],g=[];break;case"L":m=a[1],n=a[2],g=[];break;case"h":m+=a[1],g=[];break;case"H":m=a[1],g=[];break;case"v":n+=a[1],g=[];break;case"V":n=a[1],g=[];break;case"m":m+=a[1],n+=a[2],k=m,l=n,g=[];break;case"M":m=a[1],n=a[2],k=m,l=n,g=[];break;case"c":e=m+a[5],f=n+a[6],o=m+a[3],p=n+a[4],g=b.util.getBoundsOfCurve(m,n,m+a[1],n+a[2],o,p,e,f),m=e,n=f;break;case"C":m=a[5],n=a[6],o=a[3],p=a[4],g=b.util.getBoundsOfCurve(m,n,a[1],a[2],o,p,m,n);break;case"s":e=m+a[3],f=n+a[4],null===j[0].match(/[CcSs]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,m+a[1],n+a[2],e,f),o=m+a[1],p=n+a[2],m=e,n=f;break;case"S":e=a[3],f=a[4],null===j[0].match(/[CcSs]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,a[1],a[2],e,f),m=e,n=f,o=a[1],p=a[2];break;case"q":e=m+a[3],f=n+a[4],o=m+a[1],p=n+a[2],g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"Q":o=a[1],p=a[2],g=b.util.getBoundsOfCurve(m,n,o,p,o,p,a[3],a[4]),m=a[3],n=a[4];break;case"t":e=m+a[1],f=n+a[2],null===j[0].match(/[QqTt]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"T":e=a[1],f=a[2],null===j[0].match(/[QqTt]/)?(o=m,p=n):(o=2*m-o,p=2*n-p),g=b.util.getBoundsOfCurve(m,n,o,p,o,p,e,f),m=e,n=f;break;case"a":g=b.util.getBoundsOfArc(m,n,a[1],a[2],a[3],a[4],a[5],a[6]+m,a[7]+n),m+=a[6],n+=a[7];break;case"A":g=b.util.getBoundsOfArc(m,n,a[1],a[2],a[3],a[4],a[5],a[6],a[7]),m=a[6],n=a[7];break;case"z":case"Z":m=k,n=l}j=a,g.forEach(function(a){h.push(a.x),i.push(a.y)}),h.push(m),i.push(n)}var s=c(h),t=c(i),u=d(h),v=d(i),w=u-s,x=v-t,y={left:s,top:t,width:w,height:x};return y}}),b.Path.fromObject=function(a,c){"string"==typeof a.path?b.loadSVGFromURL(a.path,function(d){var e=d[0],f=a.path;delete a.path,b.util.object.extend(e,a),e.setSourcePath(f),c(e)}):c(new b.Path(a.path,a))},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(a,c,d){var f=b.parseAttributes(a,b.Path.ATTRIBUTE_NAMES);c&&c(new b.Path(f.d,e(f,d)))},void(b.Path.async=!0))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.invoke,e=b.Object.prototype.toObject;return b.PathGroup?void b.warn("fabric.PathGroup is already defined"):(b.PathGroup=b.util.createClass(b.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{},this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;b.toBeParsed&&(this.parseDimensionsFromPaths(b),delete b.toBeParsed),this.setOptions(b),this.setCoords(),b.sourcePath&&this.setSourcePath(b.sourcePath)},parseDimensionsFromPaths:function(a){for(var c,d,e,f,g,h=[],i=[],j=this.transformMatrix,k=this.paths.length;k--;){e=this.paths[k],f=e.height+e.strokeWidth,g=e.width+e.strokeWidth,c=[{x:e.left,y:e.top},{x:e.left+g,y:e.top},{x:e.left,y:e.top+f},{x:e.left+g,y:e.top+f}];for(var l=0;l<c.length;l++)d=c[l],j&&(d=b.util.transformPoint(d,j,!1)),h.push(d.x),i.push(d.y)}a.width=Math.max.apply(null,h),a.height=Math.max.apply(null,i)},render:function(a){if(this.visible){a.save(),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.transform(a),this._setShadow(a),this.clipTo&&b.util.clipContext(this,a),a.translate(-this.width/2,-this.height/2);for(var c=0,d=this.paths.length;d>c;++c)this.paths[c].render(a,!0);this.clipTo&&a.restore(),this._removeShadow(a),a.restore()}},_set:function(a,b){if("fill"===a&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){var b=c(e.call(this,a),{paths:d(this.getObjects(),"toObject",a)});return this.sourcePath&&(b.sourcePath=this.sourcePath),b},toDatalessObject:function(a){var b=this.toObject(a);return this.sourcePath&&(b.paths=this.sourcePath),b},toSVG:function(a){for(var b=this.getObjects(),c=this.getPointByOrigin("left","top"),d="translate("+c.x+" "+c.y+")",e=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),d,this.getSvgTransform(),'" ',">\n"],f=0,g=b.length;g>f;f++)e.push(b[f].toSVG(a));return e.push("</g>\n"),a?a(e.join("")):e.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(b){return(b.get("fill")||"").toLowerCase()===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(a,c){"string"==typeof a.paths?b.loadSVGFromURL(a.paths,function(d){var e=a.paths;delete a.paths;var f=b.util.groupSVGElements(d,a,e);c(f)}):b.util.enlivenObjects(a.paths,function(d){delete a.paths,c(new b.PathGroup(d,a))})},void(b.PathGroup.async=!0))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.array.min,e=b.util.array.max,f=b.util.array.invoke;if(!b.Group){var g={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",initialize:function(a,b){b=b||{},this._objects=a||[];for(var c=this._objects.length;c--;)this._objects[c].group=this;this.originalState={},this.callSuper("initialize"),b.originX&&(this.originX=b.originX),b.originY&&(this.originY=b.originY),this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",b),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(a){var b=a.getLeft(),c=a.getTop(),d=this.getCenterPoint();a.set({originalLeft:b,originalTop:c,left:b-d.x,top:c-d.y}),a.setCoords(),a.__origHasControls=a.hasControls,a.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){return this._restoreObjectsState(),a&&(this._objects.push(a),a.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(a){a.set("active",!0),a.group=this},removeWithUpdate:function(a){return this._moveFlippedObject(a),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group,a.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties)for(var c=this._objects.length;c--;)this._objects[c].set(a,b);this.callSuper("_set",a,b)},toObject:function(a){return c(this.callSuper("toObject",a),{objects:f(this._objects,"toObject",a)})},render:function(a){if(this.visible){a.save(),this.clipTo&&b.util.clipContext(this,a),this.transform(a);for(var c=0,d=this._objects.length;d>c;c++)this._renderObject(this._objects[c],a);this.clipTo&&a.restore(),a.restore()}},_renderControls:function(a,b){this.callSuper("_renderControls",a,b);for(var c=0,d=this._objects.length;d>c;c++)this._objects[c]._renderControls(a)},_renderObject:function(a,b){var c=a.hasRotatingPoint;a.visible&&(a.hasRotatingPoint=!1,a.render(b),a.hasRotatingPoint=c)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(a){return this._moveFlippedObject(a),this._setObjectPosition(a),a},_moveFlippedObject:function(a){var b=a.get("originX"),c=a.get("originY"),d=a.getCenterPoint();a.set({originX:"center",originY:"center",left:d.x,top:d.y}),this._toggleFlipping(a);var e=a.getPointByOrigin(b,c);return a.set({originX:b,originY:c,left:e.x,top:e.y}),this},_toggleFlipping:function(a){this.flipX&&(a.toggle("flipX"),a.set("left",-a.get("left")),a.setAngle(-a.getAngle())),this.flipY&&(a.toggle("flipY"),a.set("top",-a.get("top")),a.setAngle(-a.getAngle()))},_restoreObjectState:function(a){return this._setObjectPosition(a),a.setCoords(),a.hasControls=a.__origHasControls,delete a.__origHasControls,a.set("active",!1),a.setCoords(),delete a.group,this},_setObjectPosition:function(a){var b=this.getCenterPoint(),c=this._getRotatedLeftTop(a);a.set({angle:a.getAngle()+this.getAngle(),left:b.x+c.left,top:b.y+c.top,scaleX:a.get("scaleX")*this.get("scaleX"),scaleY:a.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(a){var b=this.getAngle()*(Math.PI/180);return{left:-Math.sin(b)*a.getTop()*this.get("scaleY")+Math.cos(b)*a.getLeft()*this.get("scaleX"),top:Math.cos(b)*a.getTop()*this.get("scaleY")+Math.sin(b)*a.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(a){a.setCoords()}),this},_calcBounds:function(a){for(var b,c,d=[],e=[],f=["tr","br","bl","tl"],g=0,h=this._objects.length;h>g;++g){b=this._objects[g],b.setCoords();for(var i=0;i<f.length;i++)c=f[i],d.push(b.oCoords[c].x),e.push(b.oCoords[c].y)}this.set(this._getBounds(d,e,a))},_getBounds:function(a,c,f){var g=b.util.invertTransform(this.getViewportTransform()),h=b.util.transformPoint(new b.Point(d(a),d(c)),g),i=b.util.transformPoint(new b.Point(e(a),e(c)),g),j={width:i.x-h.x||0,height:i.y-h.y||0};return f||(j.left=h.x||0,j.top=h.y||0,"center"===this.originX&&(j.left+=j.width/2),"right"===this.originX&&(j.left+=j.width),"center"===this.originY&&(j.top+=j.height/2),"bottom"===this.originY&&(j.top+=j.height)),j},toSVG:function(a){for(var b=["<g ",'transform="',this.getSvgTransform(),'">\n'],c=0,d=this._objects.length;d>c;c++)b.push(this._objects[c].toSVG(a));return b.push("</g>\n"),a?a(b.join("")):b.join("")},get:function(a){if(a in g){if(this[a])return this[a];for(var b=0,c=this._objects.length;c>b;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}}),b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects,c&&c(new b.Group(d,a))})},b.Group.async=!0}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=fabric.util.object.extend;return a.fabric||(a.fabric={}),a.fabric.Image?void fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(a,b){b||(b={}),this.filters=[],this.resizeFilters=[],this.callSuper("initialize",b),this._initElement(a,b),this._initConfig(b),b.filters&&(this.filters=b.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(a,b,c){return this._element=a,this._originalElement=a,this._initConfig(c),0!==this.filters.length?this.applyFilters(b):b&&b(),this},setCrossOrigin:function(a){return this.crossOrigin=a,this._element.crossOrigin=a,this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},_stroke:function(a){a.save(),this._setStrokeStyles(a),a.beginPath(),a.strokeRect(-this.width/2,-this.height/2,this.width,this.height),a.closePath(),a.restore()},_renderDashedStroke:function(a){var b=-this.width/2,c=-this.height/2,d=this.width,e=this.height;a.save(),this._setStrokeStyles(a),a.beginPath(),fabric.util.drawDashedLine(a,b,c,b+d,c,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c,b+d,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b+d,c+e,b,c+e,this.strokeDashArray),fabric.util.drawDashedLine(a,b,c+e,b,c,this.strokeDashArray),a.closePath(),a.restore()},toObject:function(a){return b(this.callSuper("toObject",a),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(a){return a&&a.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(a){var b=[],c=-this.width/2,d=-this.height/2,e="none";if(this.group&&"path-group"===this.group.type&&(c=this.left,d=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(e="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),b.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',c,'" y="',d,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',e,'"',"></image>\n"),this.stroke||this.strokeDashArray){var f=this.fill;this.fill=null,b.push("<rect ",'x="',c,'" y="',d,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f}return b.push("</g>\n"),a?a(b.join("")):b.join("")},getSrc:function(){return this.getElement()?this.getElement().src||this.getElement()._src:void 0},setSrc:function(a,b,c){fabric.util.loadImage(a,function(a){return this.setElement(a,b,c)},this,c&&c.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a,b,c,d){if(b=b||this.filters,c=c||this._originalElement){var e=c,f=fabric.util.createCanvasElement(),g=fabric.util.createImage(),h=this;return f.width=e.width,f.height=e.height,f.getContext("2d").drawImage(e,0,0,e.width,e.height),0===b.length?(this._element=c,a&&a(),f):(b.forEach(function(a){a&&a.applyTo(f,a.scaleX||h.scaleX,a.scaleY||h.scaleY),!d&&a&&"Resize"===a.type&&(h.width*=a.scaleX,h.height*=a.scaleY)}),g.width=f.width,
g.height=f.height,fabric.isLikelyNode?(g.src=f.toBuffer(void 0,fabric.Image.pngCompression),h._element=g,!d&&(h._filteredEl=g),a&&a()):(g.onload=function(){h._element=g,!d&&(h._filteredEl=g),a&&a(),g.onload=f=e=null},g.src=f.toDataURL("image/png")),f)}},_render:function(a,b){var c,d,e,f=this._findMargins();c=b?this.left:-this.width/2,d=b?this.top:-this.height/2,"slice"===this.meetOrSlice&&(a.beginPath(),a.rect(c,d,this.width,this.height),a.clip()),this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,e=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):e=this._element,e&&a.drawImage(e,c+f.marginX,d+f.marginY,f.width,f.height),this._renderStroke(a)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var a,b,c=this.width,d=this.height,e=0,f=0;return("none"!==this.alignX||"none"!==this.alignY)&&(a=[this.width/this._element.width,this.height/this._element.height],b="meet"===this.meetOrSlice?Math.min.apply(null,a):Math.max.apply(null,a),c=this._element.width*b,d=this._element.height*b,"Mid"===this.alignX&&(e=(this.width-c)/2),"Max"===this.alignX&&(e=this.width-c),"Mid"===this.alignY&&(f=(this.height-d)/2),"Max"===this.alignY&&(f=this.height-d)),{width:c,height:d,marginX:e,marginY:f}},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width),this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(a,b){a.filters&&a.filters.length?fabric.util.enlivenObjects(a.filters,function(a){b&&b(a)},"fabric.Image.filters"):b&&b()},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement()?this.getElement().width||0:0,this.height="height"in a?a.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c){fabric.Image.prototype._initFilters.call(a,a,function(d){a.filters=d||[];var e=new fabric.Image(c,a);b&&b(e)})},null,a.crossOrigin)},fabric.Image.fromURL=function(a,b,c){fabric.util.loadImage(a,function(a){b&&b(new fabric.Image(a,c))},null,c&&c.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(a,c,d){var e,f,g,h=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES),i="xMidYMid",j="meet";h.preserveAspectRatio&&(g=h.preserveAspectRatio.split(" ")),g&&g.length&&(j=g.pop(),"meet"!==j&&"slice"!==j?(i=j,j="meet"):g.length&&(i=g.pop())),e="none"!==i?i.slice(1,4):"none",f="none"!==i?i.slice(5,8):"none",h.alignX=e,h.alignY=f,h.meetOrSlice=j,fabric.Image.fromURL(h["xlink:href"],c,b(d?fabric.util.object.clone(d):{},h))},fabric.Image.async=!0,void(fabric.Image.pngCompression=1))}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(a){a=a||{};var b=function(){},c=a.onComplete||b,d=a.onChange||b,e=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){e.setAngle(a),d()},onComplete:function(){e.setCoords(),c()},onStart:function(){e.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.renderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var b in a)this[b]=a[b]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Brightness=b.util.createClass(b.Image.filters.BaseFilter,{type:"Brightness",initialize:function(a){a=a||{},this.brightness=a.brightness||0},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.brightness,f=0,g=d.length;g>f;f+=4)d[f]+=e,d[f+1]+=e,d[f+2]+=e;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}}),b.Image.filters.Brightness.fromObject=function(a){return new b.Image.filters.Brightness(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Convolute=b.util.createClass(b.Image.filters.BaseFilter,{type:"Convolute",initialize:function(a){a=a||{},this.opaque=a.opaque,this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0];var c=b.util.createCanvasElement();this.tmpCtx=c.getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,b)},applyTo:function(a){for(var b=this.matrix,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=Math.round(Math.sqrt(b.length)),f=Math.floor(e/2),g=d.data,h=d.width,i=d.height,j=h,k=i,l=this._createImageData(j,k),m=l.data,n=this.opaque?1:0,o=0;k>o;o++)for(var p=0;j>p;p++){for(var q=o,r=p,s=4*(o*j+p),t=0,u=0,v=0,w=0,x=0;e>x;x++)for(var y=0;e>y;y++){var z=q+x-f,A=r+y-f;if(!(0>z||z>i||0>A||A>h)){var B=4*(z*h+A),C=b[x*e+y];t+=g[B]*C,u+=g[B+1]*C,v+=g[B+2]*C,w+=g[B+3]*C}}m[s]=t,m[s+1]=u,m[s+2]=v,m[s+3]=w+n*(255-w)}c.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),b.Image.filters.Convolute.fromObject=function(a){return new b.Image.filters.Convolute(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.GradientTransparency=b.util.createClass(b.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(a){a=a||{},this.threshold=a.threshold||100},applyTo:function(a){for(var b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=c.data,e=this.threshold,f=d.length,g=0,h=d.length;h>g;g+=4)d[g+3]=e+255*(f-g)/f;b.putImageData(c,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}}),b.Image.filters.GradientTransparency.fromObject=function(a){return new b.Image.filters.GradientTransparency(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.Grayscale=b.util.createClass(b.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=d.width*d.height*4,g=0;f>g;)b=(e[g]+e[g+1]+e[g+2])/3,e[g]=b,e[g+1]=b,e[g+2]=b,g+=4;c.putImageData(d,0,0)}}),b.Image.filters.Grayscale.fromObject=function(){return new b.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.Invert=b.util.createClass(b.Image.filters.BaseFilter,{type:"Invert",applyTo:function(a){var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=e.length;for(b=0;f>b;b+=4)e[b]=255-e[b],e[b+1]=255-e[b+1],e[b+2]=255-e[b+2];c.putImageData(d,0,0)}}),b.Image.filters.Invert.fromObject=function(){return new b.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Mask=b.util.createClass(b.Image.filters.BaseFilter,{type:"Mask",initialize:function(a){a=a||{},this.mask=a.mask,this.channel=[0,1,2,3].indexOf(a.channel)>-1?a.channel:0},applyTo:function(a){if(this.mask){var c,d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data,g=this.mask.getElement(),h=b.util.createCanvasElement(),i=this.channel,j=e.width*e.height*4;h.width=g.width,h.height=g.height,h.getContext("2d").drawImage(g,0,0,g.width,g.height);var k=h.getContext("2d").getImageData(0,0,g.width,g.height),l=k.data;for(c=0;j>c;c+=4)f[c+3]=l[c+i];d.putImageData(e,0,0)}},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),b.Image.filters.Mask.fromObject=function(a,c){b.util.loadImage(a.mask.src,function(d){a.mask=new b.Image(d,a.mask),c&&c(new b.Image.filters.Mask(a))})},b.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Noise=b.util.createClass(b.Image.filters.BaseFilter,{type:"Noise",initialize:function(a){a=a||{},this.noise=a.noise||0},applyTo:function(a){for(var b,c=a.getContext("2d"),d=c.getImageData(0,0,a.width,a.height),e=d.data,f=this.noise,g=0,h=e.length;h>g;g+=4)b=(.5-Math.random())*f,e[g]+=b,e[g+1]+=b,e[g+2]+=b;c.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}}),b.Image.filters.Noise.fromObject=function(a){return new b.Image.filters.Noise(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Pixelate=b.util.createClass(b.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(a){a=a||{},this.blocksize=a.blocksize||4},applyTo:function(a){var b,c,d,e,f,g,h,i=a.getContext("2d"),j=i.getImageData(0,0,a.width,a.height),k=j.data,l=j.height,m=j.width;for(c=0;l>c;c+=this.blocksize)for(d=0;m>d;d+=this.blocksize){b=4*c*m+4*d,e=k[b],f=k[b+1],g=k[b+2],h=k[b+3];for(var n=c,o=c+this.blocksize;o>n;n++)for(var p=d,q=d+this.blocksize;q>p;p++)b=4*n*m+4*p,k[b]=e,k[b+1]=f,k[b+2]=g,k[b+3]=h}i.putImageData(j,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}}),b.Image.filters.Pixelate.fromObject=function(a){return new b.Image.filters.Pixelate(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.RemoveWhite=b.util.createClass(b.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(a){a=a||{},this.threshold=a.threshold||30,this.distance=a.distance||20},applyTo:function(a){for(var b,c,d,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),g=f.data,h=this.threshold,i=this.distance,j=255-h,k=Math.abs,l=0,m=g.length;m>l;l+=4)b=g[l],c=g[l+1],d=g[l+2],b>j&&c>j&&d>j&&k(b-c)<i&&k(b-d)<i&&k(c-d)<i&&(g[l+3]=1);e.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),b.Image.filters.RemoveWhite.fromObject=function(a){return new b.Image.filters.RemoveWhite(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.Sepia=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(a){var b,c,d=a.getContext("2d"),e=d.getImageData(0,0,a.width,a.height),f=e.data,g=f.length;for(b=0;g>b;b+=4)c=.3*f[b]+.59*f[b+1]+.11*f[b+2],f[b]=c+100,f[b+1]=c+50,f[b+2]=c+255;d.putImageData(e,0,0)}}),b.Image.filters.Sepia.fromObject=function(){return new b.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={});b.Image.filters.Sepia2=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(a){var b,c,d,e,f=a.getContext("2d"),g=f.getImageData(0,0,a.width,a.height),h=g.data,i=h.length;for(b=0;i>b;b+=4)c=h[b],d=h[b+1],e=h[b+2],h[b]=(.393*c+.769*d+.189*e)/1.351,h[b+1]=(.349*c+.686*d+.168*e)/1.203,h[b+2]=(.272*c+.534*d+.131*e)/2.14;f.putImageData(g,0,0)}}),b.Image.filters.Sepia2.fromObject=function(){return new b.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Tint=b.util.createClass(b.Image.filters.BaseFilter,{type:"Tint",initialize:function(a){a=a||{},this.color=a.color||"#000000",this.opacity="undefined"!=typeof a.opacity?a.opacity:new b.Color(this.color).getAlpha()},applyTo:function(a){var c,d,e,f,g,h,i,j,k,l=a.getContext("2d"),m=l.getImageData(0,0,a.width,a.height),n=m.data,o=n.length;for(k=new b.Color(this.color).getSource(),d=k[0]*this.opacity,e=k[1]*this.opacity,f=k[2]*this.opacity,j=1-this.opacity,c=0;o>c;c+=4)g=n[c],h=n[c+1],i=n[c+2],n[c]=d+g*j,n[c+1]=e+h*j,n[c+2]=f+i*j;l.putImageData(m,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),b.Image.filters.Tint.fromObject=function(a){return new b.Image.filters.Tint(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Multiply=b.util.createClass(b.Image.filters.BaseFilter,{type:"Multiply",initialize:function(a){a=a||{},this.color=a.color||"#000000"},applyTo:function(a){var c,d,e=a.getContext("2d"),f=e.getImageData(0,0,a.width,a.height),g=f.data,h=g.length;for(d=new b.Color(this.color).getSource(),c=0;h>c;c+=4)g[c]*=d[0]/255,g[c+1]*=d[1]/255,g[c+2]*=d[2]/255;e.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}}),b.Image.filters.Multiply.fromObject=function(a){return new b.Image.filters.Multiply(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric;b.Image.filters.Blend=b.util.createClass({type:"Blend",initialize:function(a){a=a||{},this.color=a.color||"#000",this.image=a.image||!1,this.mode=a.mode||"multiply",this.alpha=a.alpha||1},applyTo:function(a){var c,d,e,f,g,h,i,j,k,l,m=a.getContext("2d"),n=m.getImageData(0,0,a.width,a.height),o=n.data,p=!1;if(this.image){p=!0;var q=b.util.createCanvasElement();q.width=this.image.width,q.height=this.image.height;var r=new b.StaticCanvas(q);r.add(this.image);var s=r.getContext("2d");l=s.getImageData(0,0,r.width,r.height).data}else l=new b.Color(this.color).getSource(),c=l[0]*this.alpha,d=l[1]*this.alpha,e=l[2]*this.alpha;for(var t=0,u=o.length;u>t;t+=4)switch(f=o[t],g=o[t+1],h=o[t+2],p&&(c=l[t]*this.alpha,d=l[t+1]*this.alpha,e=l[t+2]*this.alpha),this.mode){case"multiply":o[t]=f*c/255,o[t+1]=g*d/255,o[t+2]=h*e/255;break;case"screen":o[t]=1-(1-f)*(1-c),o[t+1]=1-(1-g)*(1-d),o[t+2]=1-(1-h)*(1-e);break;case"add":o[t]=Math.min(255,f+c),o[t+1]=Math.min(255,g+d),o[t+2]=Math.min(255,h+e);break;case"diff":case"difference":o[t]=Math.abs(f-c),o[t+1]=Math.abs(g-d),o[t+2]=Math.abs(h-e);break;case"subtract":i=f-c,j=g-d,k=h-e,o[t]=0>i?0:i,o[t+1]=0>j?0:j,o[t+2]=0>k?0:k;break;case"darken":o[t]=Math.min(f,c),o[t+1]=Math.min(g,d),o[t+2]=Math.min(h,e);break;case"lighten":o[t]=Math.max(f,c),o[t+1]=Math.max(g,d),o[t+2]=Math.max(h,e)}m.putImageData(n,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),b.Image.filters.Blend.fromObject=function(a){return new b.Image.filters.Blend(a)}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=Math.pow,d=Math.floor,e=Math.sqrt,f=Math.abs,g=Math.max,h=Math.round,i=Math.sin,j=Math.ceil;b.Image.filters.Resize=b.util.createClass(b.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(a,b,c){this.rcpScaleX=1/b,this.rcpScaleY=1/c;var d,e=a.width,f=a.height,g=h(e*b),i=h(f*c);"sliceHack"===this.resizeType&&(d=this.sliceByTwo(a,e,f,g,i)),"hermite"===this.resizeType&&(d=this.hermiteFastResize(a,e,f,g,i)),"bilinear"===this.resizeType&&(d=this.bilinearFiltering(a,e,f,g,i)),"lanczos"===this.resizeType&&(d=this.lanczosResize(a,e,f,g,i)),a.width=g,a.height=i,a.getContext("2d").putImageData(d,0,0)},sliceByTwo:function(a,c,e,f,h){var i,j=a.getContext("2d"),k=.5,l=.5,m=1,n=1,o=!1,p=!1,q=c,r=e,s=b.util.createCanvasElement(),t=s.getContext("2d");for(f=d(f),h=d(h),s.width=g(f,c),s.height=g(h,e),f>c&&(k=2,m=-1),h>e&&(l=2,n=-1),i=j.getImageData(0,0,c,e),a.width=g(f,c),a.height=g(h,e),j.putImageData(i,0,0);!o||!p;)c=q,e=r,f*m<d(q*k*m)?q=d(q*k):(q=f,o=!0),h*n<d(r*l*n)?r=d(r*l):(r=h,p=!0),i=j.getImageData(0,0,c,e),t.putImageData(i,0,0),j.clearRect(0,0,q,r),j.drawImage(s,0,0,c,e,0,0,q,r);return j.getImageData(0,0,f,h)},lanczosResize:function(a,b,g,h,k){function l(a){return function(b){if(b>a)return 0;if(b*=Math.PI,f(b)<1e-16)return 1;var c=b/a;return i(b)*i(c)/b/c}}function m(a){var i,j,l,n,o,C,D,E,F,G,H;for(A.x=(a+.5)*t,B.x=d(A.x),i=0;k>i;i++){for(A.y=(i+.5)*u,B.y=d(A.y),o=0,C=0,D=0,E=0,F=0,j=B.x-x;j<=B.x+x;j++)if(!(0>j||j>=b)){G=d(1e3*f(j-A.x)),z[G]||(z[G]={});for(var I=B.y-y;I<=B.y+y;I++)0>I||I>=g||(H=d(1e3*f(I-A.y)),z[G][H]||(z[G][H]=s(e(c(G*v,2)+c(H*w,2))/1e3)),l=z[G][H],l>0&&(n=4*(I*b+j),o+=l,C+=l*q[n],D+=l*q[n+1],E+=l*q[n+2],F+=l*q[n+3]))}n=4*(i*h+a),r[n]=C/o,r[n+1]=D/o,r[n+2]=E/o,r[n+3]=F/o}return++a<h?m(a):p}var n=a.getContext("2d"),o=n.getImageData(0,0,b,g),p=n.getImageData(0,0,h,k),q=o.data,r=p.data,s=l(this.lanczosLobes),t=this.rcpScaleX,u=this.rcpScaleY,v=2/this.rcpScaleX,w=2/this.rcpScaleY,x=j(t*this.lanczosLobes/2),y=j(u*this.lanczosLobes/2),z={},A={},B={};return m(0)},bilinearFiltering:function(a,b,c,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t=0,u=this.rcpScaleX,v=this.rcpScaleY,w=a.getContext("2d"),x=4*(b-1),y=w.getImageData(0,0,b,c),z=y.data,A=w.getImageData(0,0,e,f),B=A.data;for(m=0;f>m;m++)for(n=0;e>n;n++)for(k=d(u*n),l=d(v*m),o=u*n-k,p=v*m-l,s=4*(l*b+k),q=0;4>q;q++)g=z[s+q],h=z[s+4+q],i=z[s+x+q],j=z[s+x+4+q],r=g*(1-o)*(1-p)+h*o*(1-p)+i*p*(1-o)+j*o*p,B[t++]=r;return A},hermiteFastResize:function(a,b,c,g,h){for(var i=this.rcpScaleX,k=this.rcpScaleY,l=j(i/2),m=j(k/2),n=a.getContext("2d"),o=n.getImageData(0,0,b,c),p=o.data,q=n.getImageData(0,0,g,h),r=q.data,s=0;h>s;s++)for(var t=0;g>t;t++){for(var u=4*(t+s*g),v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=(s+.5)*k,D=d(s*k);(s+1)*k>D;D++)for(var E=f(C-(D+.5))/m,F=(t+.5)*i,G=E*E,H=d(t*i);(t+1)*i>H;H++){var I=f(F-(H+.5))/l,J=e(G+I*I);J>1&&-1>J||(v=2*J*J*J-3*J*J+1,v>0&&(I=4*(H+D*b),B+=v*p[I+3],x+=v,p[I+3]<255&&(v=v*p[I+3]/250),y+=v*p[I],z+=v*p[I+1],A+=v*p[I+2],w+=v))}r[u]=y/w,r[u+1]=z/w,r[u+2]=A/w,r[u+3]=B/x}return q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaley:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),b.Image.filters.Resize.fromObject=function(){return new b.Image.filters.Resize}}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b=a.fabric||(a.fabric={}),c=b.util.object.extend,d=b.util.object.clone,e=b.util.toFixed,f=b.StaticCanvas.supports("setLineDash");if(b.Text)return void b.warn("fabric.Text is already defined");var g=b.Object.prototype.stateProperties.concat();g.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:g,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(a,b){b=b||{},this.text=a,this.__skipDimension=!0,this.setOptions(b),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(a){if(!this.__skipDimension){a||(a=b.util.createCanvasElement().getContext("2d"),this._setTextStyles(a)),this._textLines=this.text.split(this._reNewline),this._clearCache();var c=this.textAlign;this.textAlign="left",this.width=this._getTextWidth(a),this.textAlign=c,this.height=this._getTextHeight(a)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){this.clipTo&&b.util.clipContext(this,a),this._renderTextBackground(a),this._renderText(a),this._renderTextDecoration(a),this.clipTo&&a.restore()},_renderText:function(a){a.save(),this._translateForTextAlign(a),this._setOpacity(a),this._setShadow(a),this._setupCompositeOperation(a),this._renderTextFill(a),this._renderTextStroke(a),this._restoreCompositeOperation(a),this._removeShadow(a),a.restore()},_translateForTextAlign:function(a){"left"!==this.textAlign&&"justify"!==this.textAlign&&a.translate("center"===this.textAlign?this.width/2:this.width,0)},_setTextStyles:function(a){a.textBaseline="alphabetic",this.skipTextAlign||(a.textAlign=this.textAlign),a.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(a){for(var b=this._getLineWidth(a,0),c=1,d=this._textLines.length;d>c;c++){var e=this._getLineWidth(a,c);e>b&&(b=e)}return b},_renderChars:function(a,b,c,d,e){b[a](c,d,e)},_renderTextLine:function(a,b,c,d,e,f){if(e-=this.fontSize*this._fontSizeFraction,"justify"!==this.textAlign)return void this._renderChars(a,b,c,d,e,f);var g=this._getLineWidth(b,f),h=this.width;if(h>=g)for(var i=c.split(/\s+/),j=this._getWidthOfWords(b,c,f),k=h-j,l=i.length-1,m=k/l,n=0,o=0,p=i.length;p>o;o++)this._renderChars(a,b,i[o],d+n,e,f),n+=b.measureText(i[o]).width+m;else this._renderChars(a,b,c,d,e,f)},_getWidthOfWords:function(a,b){return a.measureText(b.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(a){if(this.fill||this._skipFillStrokeCheck){for(var b=0,c=0,d=this._textLines.length;d>c;c++){var e=this._getHeightOfLine(a,c),f=e/this.lineHeight;this._renderTextLine("fillText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+f,c),b+=e}this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a)}},_renderTextStroke:function(a){if(this.stroke&&0!==this.strokeWidth||this._skipFillStrokeCheck){var b=0;a.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),f&&a.setLineDash(this.strokeDashArray)),a.beginPath();for(var c=0,d=this._textLines.length;d>c;c++){var e=this._getHeightOfLine(a,c),g=e/this.lineHeight;this._renderTextLine("strokeText",a,this._textLines[c],this._getLeftOffset(),this._getTopOffset()+b+g,c),b+=e}a.closePath(),a.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(a){this._renderTextBoxBackground(a),this._renderTextLinesBackground(a)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a){var b=0,c=this._getHeightOfLine();if(this.textBackgroundColor){a.save(),a.fillStyle=this.textBackgroundColor;for(var d=0,e=this._textLines.length;e>d;d++){if(""!==this._textLines[d]){var f=this._getLineWidth(a,d),g=this._getLineLeftOffset(f);a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+b,f,this.fontSize*this._fontSizeMult)}b+=c}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__lineOffsets=[]},_shouldClearCache:function(){var a=!1;for(var b in this._dimensionAffectingProps)this["__"+b]!==this[b]&&(this["__"+b]=this[b],a=!0);return a},_getLineWidth:function(a,b){return this.__lineWidths[b]?this.__lineWidths[b]:(this.__lineWidths[b]=a.measureText(this._textLines[b]).width,this.__lineWidths[b])},_renderTextDecoration:function(a){function b(b){var e,f,g,h,i=0;for(e=0,f=d._textLines.length;f>e;e++){var j=d._getLineWidth(a,e),k=d._getLineLeftOffset(j),l=d._getHeightOfLine(a,e);for(g=0,h=b.length;h>g;g++)a.fillRect(d._getLeftOffset()+k,i+(d._fontSizeMult-1+b[g])*d.fontSize-c,j,d.fontSize/15);i+=l}}if(this.textDecoration){var c=this.height/2,d=this,e=[];this.textDecoration.indexOf("underline")>-1&&e.push(.85),this.textDecoration.indexOf("line-through")>-1&&e.push(.43),this.textDecoration.indexOf("overline")>-1&&e.push(-.12),e.length>0&&b(e)}},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._setTextStyles(a),this._shouldClearCache()&&this._initDimensions(a),b||this.transform(a),this._setStrokeStyles(a),this._setFillStyles(a),this.transformMatrix&&a.transform.apply(a,this.transformMatrix),this.group&&"path-group"===this.group.type&&a.translate(this.left,this.top),this._render(a),a.restore())},toObject:function(a){var b=c(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||this._removeDefaultValues(b),b},toSVG:function(a){var b=this._createBaseSVGMarkup(),c=this._getSVGLeftTopOffsets(this.ctx),d=this._getSVGTextAndBg(c.textTop,c.textLeft);return this._wrapSVGTextAndBg(b,d),a?a(b.join("")):b.join("")},_getSVGLeftTopOffsets:function(a){var b=this._getHeightOfLine(a,0),c=-this.width/2,d=0;return{textLeft:c+(this.group&&"path-group"===this.group.type?this.left:0),textTop:d+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:b}},_wrapSVGTextAndBg:function(a,b){a.push('	<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',b.textBgRects.join(""),"		<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',b.textSpans.join(""),"</text>\n","	</g>\n")},_getSVGTextAndBg:function(a,b){var c=[],d=[],e=0;this._setSVGBg(d);for(var f=0,g=this._textLines.length;g>f;f++)this.textBackgroundColor&&this._setSVGTextLineBg(d,f,b,a,e),this._setSVGTextLineText(f,c,e,b,a,d),e+=this._getHeightOfLine(this.ctx,f);return{textSpans:c,textBgRects:d}},_setSVGTextLineText:function(a,c,d,f,g){var h=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-g+d-this.height/2;c.push('<tspan x="',e(f+this._getLineLeftOffset(this.__lineWidths[a]),4),'" ','y="',e(h,4),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(this._textLines[a]),"</tspan>")},_setSVGTextLineBg:function(a,b,c,d,f){a.push("		<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',e(c+this._getLineLeftOffset(this.__lineWidths[b]),4),'" y="',e(f-this.height/2,4),'" width="',e(this.__lineWidths[b],4),'" height="',e(this._getHeightOfLine(this.ctx,b)/this.lineHeight,4),'"></rect>\n')},_setSVGBg:function(a){this.backgroundColor&&a.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',e(-this.width/2,4),'" y="',e(-this.height/2,4),'" width="',e(this.width,4),'" height="',e(this.height,4),'"></rect>\n')},_getFillAttributes:function(a){var c=a&&"string"==typeof a?new b.Color(a):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_set:function(a,b){this.callSuper("_set",a,b),a in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),b.Text.DEFAULT_SVG_FONT_SIZE=16,b.Text.fromElement=function(a,c){if(!a)return null;var d=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);c=b.util.object.extend(c?b.util.object.clone(c):{},d),c.top=c.top||0,c.left=c.left||0,"dx"in d&&(c.left+=d.dx),"dy"in d&&(c.top+=d.dy),"fontSize"in c||(c.fontSize=b.Text.DEFAULT_SVG_FONT_SIZE),c.originX||(c.originX="left");var e=a.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),f=new b.Text(e,c),g=0;return"left"===f.originX&&(g=f.getWidth()/2),"right"===f.originX&&(g=-f.getWidth()/2),f.set({left:f.getLeft()+g,top:f.getTop()-f.getHeight()/2+f.fontSize*(.18+f._fontSizeFraction)}),f},b.Text.fromObject=function(a){return new b.Text(a.text,d(a))},b.util.createAccessors(b.Text)}("undefined"!=typeof exports?exports:this),function(){var a=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!1,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(a,b){this.styles=b?b.styles||{}:{},this.callSuper("initialize",a,b),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__maxFontHeights=[],this.__widthOfSpace=[]},isEmptyStyles:function(){if(!this.styles)return!0;var a=this.styles;for(var b in a)for(var c in a[b])for(var d in a[b][c])return!1;return!0},setSelectionStart:function(a){a=Math.max(a,0),this.selectionStart!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=a),this._updateTextarea()},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this.selectionEnd!==a&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=a),this._updateTextarea()},getSelectionStyles:function(a,b){if(2===arguments.length){for(var c=[],d=a;b>d;d++)c.push(this.getSelectionStyles(d));return c}var e=this.get2DCursorLocation(a);return this.styles[e.lineIndex]?this.styles[e.lineIndex][e.charIndex]||{}:{}},setSelectionStyles:function(a){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,a);else for(var b=this.selectionStart;b<this.selectionEnd;b++)this._extendStyles(b,a);return this._clearCache(),this},_extendStyles:function(a,b){var c=this.get2DCursorLocation(a);this.styles[c.lineIndex]||(this.styles[c.lineIndex]={}),this.styles[c.lineIndex][c.charIndex]||(this.styles[c.lineIndex][c.charIndex]={}),fabric.util.object.extend(this.styles[c.lineIndex][c.charIndex],b)},_render:function(a){this.callSuper("_render",a),this.ctx=a,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var a,b,c=this.text.split("");this.canvas.contextTop?(b=this.canvas.contextTop,b.save(),b.transform.apply(b,this.canvas.viewportTransform),this.transform(b)):(b=this.ctx,b.save()),this.selectionStart===this.selectionEnd?(a=this._getCursorBoundaries(c,"cursor"),this.renderCursor(a,b)):(a=this._getCursorBoundaries(c,"selection"),this.renderSelection(c,a,b)),b.restore()}},get2DCursorLocation:function(a){"undefined"==typeof a&&(a=this.selectionStart);var b=this.text.slice(0,a),c=b.split(this._reNewline);return{lineIndex:c.length-1,charIndex:c[c.length-1].length}},getCurrentCharStyle:function(a,b){var c=this.styles[a]&&this.styles[a][0===b?0:b-1];return{fontSize:c&&c.fontSize||this.fontSize,fill:c&&c.fill||this.fill,textBackgroundColor:c&&c.textBackgroundColor||this.textBackgroundColor,textDecoration:c&&c.textDecoration||this.textDecoration,fontFamily:c&&c.fontFamily||this.fontFamily,fontWeight:c&&c.fontWeight||this.fontWeight,fontStyle:c&&c.fontStyle||this.fontStyle,stroke:c&&c.stroke||this.stroke,strokeWidth:c&&c.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(a,b){
return this.styles[a]&&this.styles[a][0===b?0:b-1]&&this.styles[a][0===b?0:b-1].fontSize||this.fontSize},getCurrentCharColor:function(a,b){return this.styles[a]&&this.styles[a][0===b?0:b-1]&&this.styles[a][0===b?0:b-1].fill||this.cursorColor},_getCursorBoundaries:function(a,b){var c=Math.round(this._getLeftOffset()),d=this._getTopOffset(),e=this._getCursorBoundariesOffsets(a,b);return{left:c,top:d,leftOffset:e.left+e.lineLeft,topOffset:e.top}},_getCursorBoundariesOffsets:function(a,b){for(var c=0,d=0,e=0,f=0,g=0,h=0;h<this.selectionStart;h++)"\n"===a[h]?(g=0,f+=this._getHeightOfLine(this.ctx,d),d++,e=0):(g+=this._getWidthOfChar(this.ctx,a[h],d,e),e++),c=this._getCachedLineOffset(d);return"cursor"===b&&(f+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,d)/this.lineHeight-this.getCurrentCharFontSize(d,e)*(1-this._fontSizeFraction)),{top:f,left:g,lineLeft:c}},_getCachedLineOffset:function(a){var b=this._getLineWidth(this.ctx,a);return this.__lineOffsets[a]||(this.__lineOffsets[a]=this._getLineLeftOffset(b))},renderCursor:function(a,b){var c=this.get2DCursorLocation(),d=c.lineIndex,e=c.charIndex,f=this.getCurrentCharFontSize(d,e),g=0===d&&0===e?this._getCachedLineOffset(d):a.leftOffset;b.fillStyle=this.getCurrentCharColor(d,e),b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,b.fillRect(a.left+g,a.top+a.topOffset,this.cursorWidth/this.scaleX,f)},renderSelection:function(a,b,c){c.fillStyle=this.selectionColor;for(var d=this.get2DCursorLocation(this.selectionStart),e=this.get2DCursorLocation(this.selectionEnd),f=d.lineIndex,g=e.lineIndex,h=f;g>=h;h++){var i=this._getCachedLineOffset(h)||0,j=this._getHeightOfLine(this.ctx,h),k=0,l=this._textLines[h];if(h===f)for(var m=0,n=l.length;n>m;m++)m>=d.charIndex&&(h!==g||m<e.charIndex)&&(k+=this._getWidthOfChar(c,l[m],h,m)),m<d.charIndex&&(i+=this._getWidthOfChar(c,l[m],h,m));else if(h>f&&g>h)k+=this._getLineWidth(c,h)||5;else if(h===g)for(var o=0,p=e.charIndex;p>o;o++)k+=this._getWidthOfChar(c,l[o],h,o);c.fillRect(b.left+i,b.top+b.topOffset,k,j),b.topOffset+=j}},_renderChars:function(a,b,c,d,e,f){if(this.isEmptyStyles())return this._renderCharsFast(a,b,c,d,e);this.skipTextAlign=!0,d-="center"===this.textAlign?this.width/2:"right"===this.textAlign?this.width:0;var g,h=this._getHeightOfLine(b,f),i=this._getCachedLineOffset(f),j=c.split(""),k="";d+=i||0,b.save(),e-=h/this.lineHeight*this._fontSizeFraction;for(var l=0,m=j.length;m>=l;l++){g=g||this.getCurrentCharStyle(f,l);var n=this.getCurrentCharStyle(f,l+1);(this._hasStyleChanged(g,n)||l===m)&&(this._renderChar(a,b,f,l-1,k,d,e,h),k="",g=n),k+=j[l]}b.restore()},_renderCharsFast:function(a,b,c,d,e){this.skipTextAlign=!1,"fillText"===a&&this.fill&&this.callSuper("_renderChars",a,b,c,d,e),"strokeText"===a&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",a,b,c,d,e)},_renderChar:function(a,b,c,d,e,f,g,h){var i,j,k,l=this._fontSizeFraction*h/this.lineHeight;if(this.styles&&this.styles[c]&&(i=this.styles[c][d])){var m=i.stroke||this.stroke,n=i.fill||this.fill;b.save(),j=this._applyCharStylesGetWidth(b,e,c,d,i),k=this._getHeightOfChar(b,e,c,d),n&&b.fillText(e,f,g),m&&b.strokeText(e,f,g),this._renderCharDecoration(b,i,f,g,l,j,k),b.restore(),b.translate(j,0)}else"strokeText"===a&&this.stroke&&b[a](e,f,g),"fillText"===a&&this.fill&&b[a](e,f,g),j=this._applyCharStylesGetWidth(b,e,c,d),this._renderCharDecoration(b,null,f,g,l,j,this.fontSize),b.translate(b.measureText(e).width,0)},_hasStyleChanged:function(a,b){return a.fill!==b.fill||a.fontSize!==b.fontSize||a.textBackgroundColor!==b.textBackgroundColor||a.textDecoration!==b.textDecoration||a.fontFamily!==b.fontFamily||a.fontWeight!==b.fontWeight||a.fontStyle!==b.fontStyle||a.stroke!==b.stroke||a.strokeWidth!==b.strokeWidth},_renderCharDecoration:function(a,b,c,d,e,f,g){var h=b?b.textDecoration||this.textDecoration:this.textDecoration;h&&(h.indexOf("underline")>-1&&a.fillRect(c,d+g/10,f,g/15),h.indexOf("line-through")>-1&&a.fillRect(c,d-g*(this._fontSizeFraction+this._fontSizeMult-1)+g/15,f,g/15),h.indexOf("overline")>-1&&a.fillRect(c,d-(this._fontSizeMult-this._fontSizeFraction)*g,f,g/15))},_renderTextLine:function(a,b,c,d,e,f){this.isEmptyStyles()||(e+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",a,b,c,d,e,f)},_renderTextDecoration:function(a){return this.isEmptyStyles()?this.callSuper("_renderTextDecoration",a):void 0},_renderTextLinesBackground:function(a){if(this.textBackgroundColor||this.styles){a.save(),this.textBackgroundColor&&(a.fillStyle=this.textBackgroundColor);for(var b=0,c=0,d=this._textLines.length;d>c;c++){var e=this._getHeightOfLine(a,c);if(""!==this._textLines[c]){var f=this._getLineWidth(a,c),g=this._getCachedLineOffset(c);if(this.textBackgroundColor&&(a.fillStyle=this.textBackgroundColor,a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+b,f,e/this.lineHeight)),this.styles[c])for(var h=0,i=this._textLines[c].length;i>h;h++)if(this.styles[c]&&this.styles[c][h]&&this.styles[c][h].textBackgroundColor){var j=this._textLines[c][h];a.fillStyle=this.styles[c][h].textBackgroundColor,a.fillRect(this._getLeftOffset()+g+this._getWidthOfCharsAt(a,c,h),this._getTopOffset()+b,this._getWidthOfChar(a,j,c,h)+1,e/this.lineHeight)}b+=e}else b+=e}a.restore()}},_getCacheProp:function(a,b){return a+b.fontFamily+b.fontSize+b.fontWeight+b.fontStyle+b.shadow},_applyCharStylesGetWidth:function(b,c,d,e,f){var g=f||this.styles[d]&&this.styles[d][e];g=g?a(g):{},this._applyFontStyles(g);var h=this._getCacheProp(c,g);if(this.isEmptyStyles()&&this._charWidthsCache[h]&&this.caching)return this._charWidthsCache[h];"string"==typeof g.shadow&&(g.shadow=new fabric.Shadow(g.shadow));var i=g.fill||this.fill;return b.fillStyle=i.toLive?i.toLive(b,this):i,g.stroke&&(b.strokeStyle=g.stroke&&g.stroke.toLive?g.stroke.toLive(b,this):g.stroke),b.lineWidth=g.strokeWidth||this.strokeWidth,b.font=this._getFontDeclaration.call(g),this._setShadow.call(g,b),this.caching?(this._charWidthsCache[h]||(this._charWidthsCache[h]=b.measureText(c).width),this._charWidthsCache[h]):b.measureText(c).width},_applyFontStyles:function(a){a.fontFamily||(a.fontFamily=this.fontFamily),a.fontSize||(a.fontSize=this.fontSize),a.fontWeight||(a.fontWeight=this.fontWeight),a.fontStyle||(a.fontStyle=this.fontStyle)},_getStyleDeclaration:function(b,c){return this.styles[b]&&this.styles[b][c]?a(this.styles[b][c]):{}},_getWidthOfChar:function(a,b,c,d){if("justify"===this.textAlign&&/\s/.test(b))return this._getWidthOfSpace(a,c);var e=this._getStyleDeclaration(c,d);this._applyFontStyles(e);var f=this._getCacheProp(b,e);if(this._charWidthsCache[f]&&this.caching)return this._charWidthsCache[f];if(a){a.save();var g=this._applyCharStylesGetWidth(a,b,c,d);return a.restore(),g}},_getHeightOfChar:function(a,b,c,d){return this.styles[c]&&this.styles[c][d]?this.styles[c][d].fontSize||this.fontSize:this.fontSize},_getHeightOfCharAt:function(a,b,c){var d=this._textLines[b][c];return this._getHeightOfChar(a,d,b,c)},_getWidthOfCharsAt:function(a,b,c){var d,e,f=0;for(d=0;c>d;d++)e=this._textLines[b][d],f+=this._getWidthOfChar(a,e,b,d);return f},_getLineWidth:function(a,b){return this.__lineWidths[b]?this.__lineWidths[b]:(this.__lineWidths[b]=this._getWidthOfCharsAt(a,b,this._textLines[b].length),this.__lineWidths[b])},_getWidthOfSpace:function(a,b){if(this.__widthOfSpace[b])return this.__widthOfSpace[b];var c=this._textLines[b],d=this._getWidthOfWords(a,c,b),e=this.width-d,f=c.length-c.replace(/\s+/g,"").length,g=e/f;return this.__widthOfSpace[b]=g,g},_getWidthOfWords:function(a,b,c){for(var d=0,e=0;e<b.length;e++){var f=b[e];f.match(/\s/)||(d+=this._getWidthOfChar(a,f,c,e))}return d},_getHeightOfLine:function(a,b){if(this.__lineHeights[b])return this.__lineHeights[b];for(var c=this._textLines[b],d=this._getHeightOfChar(a,c[0],b,0),e=1,f=c.length;f>e;e++){var g=this._getHeightOfChar(a,c[e],b,e);g>d&&(d=g)}return this.__maxFontHeights[b]=d,this.__lineHeights[b]=d*this.lineHeight*this._fontSizeMult,this.__lineHeights[b]},_getTextHeight:function(a){for(var b=0,c=0,d=this._textLines.length;d>c;c++)b+=this._getHeightOfLine(a,c);return b},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},toObject:function(b){return fabric.util.object.extend(this.callSuper("toObject",b),{styles:a(this.styles)})}}),fabric.IText.fromObject=function(b){return new fabric.IText(b.text,a(b))}}(),function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var a=this;setTimeout(function(){a.selected=!0},100)})},initAddedHandler:function(){var a=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers()),a.canvas&&(a.canvas._iTextInstances=a.canvas._iTextInstances||[],a.canvas._iTextInstances.push(a))})},initRemovedHandler:function(){var a=this;this.on("removed",function(){a.canvas&&(a.canvas._iTextInstances=a.canvas._iTextInstances||[],fabric.util.removeFromArray(a.canvas._iTextInstances,a))})},_initCanvasHandlers:function(){var a=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(a.canvas)}),this.canvas.on("mouse:up",function(){a.canvas._iTextInstances&&a.canvas._iTextInstances.forEach(function(a){a.__isMousedown=!1})}),this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(a.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(a,b,c,d){var e;return e={isAborted:!1,abort:function(){this.isAborted=!0}},a.animate("_currentCursorOpacity",b,{duration:c,onComplete:function(){e.isAborted||a[d]()},onChange:function(){a.canvas&&(a.canvas.clearContext(a.canvas.contextTop||a.ctx),a.renderCursorOrSelection())},abort:function(){return e.isAborted}}),e},_onTickComplete:function(){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var b=this,c=a?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){b._tick()},c)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0),this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(a){var b=0,c=a-1;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)b++,c--;for(;/\S/.test(this.text.charAt(c))&&c>-1;)b++,c--;return a-b},findWordBoundaryRight:function(a){var b=0,c=a;if(this._reSpace.test(this.text.charAt(c)))for(;this._reSpace.test(this.text.charAt(c));)b++,c++;for(;/\S/.test(this.text.charAt(c))&&c<this.text.length;)b++,c++;return a+b},findLineBoundaryLeft:function(a){for(var b=0,c=a-1;!/\n/.test(this.text.charAt(c))&&c>-1;)b++,c--;return a-b},findLineBoundaryRight:function(a){for(var b=0,c=a;!/\n/.test(this.text.charAt(c))&&c<this.text.length;)b++,c++;return a+b},getNumNewLinesInSelectedText:function(){for(var a=this.getSelectedText(),b=0,c=0,d=a.split(""),e=d.length;e>c;c++)"\n"===d[c]&&b++;return b},searchWordBoundary:function(a,b){for(var c=this._reSpace.test(this.text.charAt(a))?a-1:a,d=this.text.charAt(c),e=/[ \n\.,;!\?\-]/;!e.test(d)&&c>0&&c<this.text.length;)c+=b,d=this.text.charAt(c);return e.test(d)&&"\n"!==d&&(c+=1===b?0:1),c},selectWord:function(a){var b=this.searchWordBoundary(a,-1),c=this.searchWordBoundary(a,1);this.setSelectionStart(b),this.setSelectionEnd(c)},selectLine:function(a){var b=this.findLineBoundaryLeft(a),c=this.findLineBoundaryRight(a);this.setSelectionStart(b),this.setSelectionEnd(c)},enterEditing:function(){return!this.isEditing&&this.editable?(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.fire("editing:entered"),this.canvas?(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this):this):void 0},exitEditingOnOthers:function(a){a._iTextInstances&&a._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){var a=this;this.canvas.on("mouse:move",function(b){if(a.__isMousedown&&a.isEditing){var c=a.getSelectionStartFromPointer(b.e);c>=a.__selectionStartOnMouseDown?(a.setSelectionStart(a.__selectionStartOnMouseDown),a.setSelectionEnd(c)):(a.setSelectionStart(c),a.setSelectionEnd(a.__selectionStartOnMouseDown))}})},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){for(var a in this.styles)this._textLines[a]||delete this.styles[a]},_removeCharsFromTo:function(a,b){for(var c=b;c!==a;){var d=this.get2DCursorLocation(c).charIndex;c--;var e=this.get2DCursorLocation(c).charIndex,f=e>d;f?this.removeStyleObject(f,c+1):this.removeStyleObject(0===this.get2DCursorLocation(c).charIndex,c)}this.text=this.text.slice(0,a)+this.text.slice(b),this._clearCache()},insertChars:function(a,b){var c="\n"===this.text.slice(this.selectionStart,this.selectionStart+1);this.text=this.text.slice(0,this.selectionStart)+a+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd&&this.insertStyleObjects(a,c,b),this.setSelectionStart(this.selectionStart+a.length),this.setSelectionEnd(this.selectionStart),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(b,c,d){this.shiftLineStyles(b,1),this.styles[b+1]||(this.styles[b+1]={});var e=this.styles[b][c-1],f={};if(d)f[0]=a(e),this.styles[b+1]=f;else{for(var g in this.styles[b])parseInt(g,10)>=c&&(f[parseInt(g,10)-c]=this.styles[b][g],delete this.styles[b][g]);this.styles[b+1]=f}this._clearCache()},insertCharStyleObject:function(b,c,d){var e=this.styles[b],f=a(e);0!==c||d||(c=1);for(var g in f){var h=parseInt(g,10);h>=c&&(e[h+1]=f[h])}this.styles[b][c]=d||a(e[c-1]),this._clearCache()},insertStyleObjects:function(a,b,c){var d=this.get2DCursorLocation(),e=d.lineIndex,f=d.charIndex;this.styles[e]||(this.styles[e]={}),"\n"===a?this.insertNewlineStyleObject(e,f,b):c?this._insertStyles(this.copiedStyles):this.insertCharStyleObject(e,f)},_insertStyles:function(a){for(var b=0,c=a.length;c>b;b++){var d=this.get2DCursorLocation(this.selectionStart+b),e=d.lineIndex,f=d.charIndex;this.insertCharStyleObject(e,f,a[b])}},shiftLineStyles:function(b,c){var d=a(this.styles);for(var e in this.styles){var f=parseInt(e,10);f>b&&(this.styles[f+c]=d[f])}},removeStyleObject:function(b,c){var d=this.get2DCursorLocation(c),e=d.lineIndex,f=d.charIndex;if(b){var g=this._textLines[e-1],h=g?g.length:0;this.styles[e-1]||(this.styles[e-1]={});for(f in this.styles[e])this.styles[e-1][parseInt(f,10)+h]=this.styles[e][f];this.shiftLineStyles(e,-1)}else{var i=this.styles[e];if(i){var j=this.selectionStart===this.selectionEnd?-1:0;delete i[f+j]}var k=a(i);for(var l in k){var m=parseInt(l,10);m>=f&&0!==m&&(i[m-1]=k[m],delete i[m])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(a){this.__newClickTime=+new Date;var b=this.canvas.getPointer(a.e);this.isTripleClick(b)?(this.fire("tripleclick",a),this._stopEvent(a.e)):this.isDoubleClick(b)&&(this.fire("dblclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=b,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y&&this.__lastIsEditing},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))}),this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},initMousedownHandler:function(){this.on("mousedown",function(a){var b=this.canvas.getPointer(a.e);this.__mousedownX=b.x,this.__mousedownY=b.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(a.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},_isObjectMoved:function(a){var b=this.canvas.getPointer(a);return this.__mousedownX!==b.x||this.__mousedownY!==b.y},initMouseupHandler:function(){this.on("mouseup",function(a){this.__isMousedown=!1,this._isObjectMoved(a.e)||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(a){var b=this.getSelectionStartFromPointer(a);a.shiftKey?b<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(b)):this.setSelectionEnd(b):(this.setSelectionStart(b),this.setSelectionEnd(b))},_getLocalRotatedPointer:function(a){var b=this.canvas.getPointer(a),c=new fabric.Point(b.x,b.y),d=new fabric.Point(this.left,this.top),e=fabric.util.rotatePoint(c,d,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(a,e)},getSelectionStartFromPointer:function(a){for(var b,c,d=this._getLocalRotatedPointer(a),e=0,f=0,g=0,h=0,i=0,j=this._textLines.length;j>i;i++){c=this._textLines[i].split(""),g+=this._getHeightOfLine(this.ctx,i)*this.scaleY;var k=this._getLineWidth(this.ctx,i),l=this._getLineLeftOffset(k);f=l*this.scaleX,this.flipX&&(this._textLines[i]=c.reverse().join(""));for(var m=0,n=c.length;n>m;m++){var o=c[m];if(e=f,f+=this._getWidthOfChar(this.ctx,o,i,this.flipX?n-m:m)*this.scaleX,!(g<=d.y||f<=d.x))return this._getNewSelectionStartFromOffset(d,e,f,h+i,n);h++}if(d.y<g)return this._getNewSelectionStartFromOffset(d,e,f,h+i,n)}return"undefined"==typeof b?this.text.length:void 0},_getNewSelectionStartFromOffset:function(a,b,c,d,e){var f=a.x-b,g=c-a.x,h=g>f?0:1,i=d+h;return this.flipX&&(i=e-i),i>this.text.length&&(i=this.text.length),i}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){if(a.keyCode in this._keysMap)this[this._keysMap[a.keyCode]](a);else{if(!(a.keyCode in this._ctrlKeysMap&&(a.ctrlKey||a.metaKey)))return;this[this._ctrlKeysMap[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.renderAll()}},forwardDelete:function(a){this.selectionStart===this.selectionEnd&&this.moveCursorRight(a),this.removeChars(a)},copy:function(a){var b=this.getSelectedText(),c=this._getClipboardData(a);c&&c.setData("text",b),this.copiedText=b,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(a){var b=null,c=this._getClipboardData(a);b=c?c.getData("text"):this.copiedText,b&&this.insertChars(b,!0)},cut:function(a){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(a))},_getClipboardData:function(a){return a&&(a.clipboardData||fabric.window.clipboardData)},onKeyPress:function(a){!this.isEditing||a.metaKey||a.ctrlKey||(0!==a.which&&this.insertChars(String.fromCharCode(a.which)),a.stopPropagation())},getDownCursorOffset:function(a,b){var c,d,e=b?this.selectionEnd:this.selectionStart,f=this.text.slice(0,e),g=this.text.slice(e),h=f.slice(f.lastIndexOf("\n")+1),i=g.match(/(.*)\n?/)[1],j=(g.match(/.*\n(.*)\n?/)||{})[1]||"",k=this.get2DCursorLocation(e);if(k.lineIndex===this._textLines.length-1||a.metaKey||34===a.keyCode)return this.text.length-e;var l=this._getLineWidth(this.ctx,k.lineIndex);d=this._getLineLeftOffset(l);for(var m=d,n=k.lineIndex,o=0,p=h.length;p>o;o++)c=h[o],m+=this._getWidthOfChar(this.ctx,c,n,o);var q=this._getIndexOnNextLine(k,j,m);return i.length+1+q},_getIndexOnNextLine:function(a,b,c){for(var d,e=a.lineIndex+1,f=this._getLineWidth(this.ctx,e),g=this._getLineLeftOffset(f),h=g,i=0,j=0,k=b.length;k>j;j++){var l=b[j],m=this._getWidthOfChar(this.ctx,l,e,j);if(h+=m,h>c){d=!0;var n=h-m,o=h,p=Math.abs(n-c),q=Math.abs(o-c);i=p>q?j+1:j;break}}return d||(i=b.length),i},moveCursorDown:function(a){this.abortCursorAnimation(),this._currentCursorOpacity=1;var b=this.getDownCursorOffset(a,"right"===this._selectionDirection);a.shiftKey?this.moveCursorDownWithShift(b):this.moveCursorDownWithoutShift(b),this.initDelayedCursor()},moveCursorDownWithoutShift:function(a){this._selectionDirection="right",this.setSelectionStart(this.selectionStart+a),this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var a=this.selectionEnd;this.setSelectionEnd(this.selectionStart),this.setSelectionStart(a)},moveCursorDownWithShift:function(a){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd+a):this.setSelectionStart(this.selectionStart+a),this.selectionEnd<this.selectionStart&&"left"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="right"),this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(a,b){var c=b?this.selectionEnd:this.selectionStart,d=this.get2DCursorLocation(c);if(0===d.lineIndex||a.metaKey||33===a.keyCode)return c;for(var e,f=this.text.slice(0,c),g=f.slice(f.lastIndexOf("\n")+1),h=(f.match(/\n?(.*)\n.*$/)||{})[1]||"",i=this._getLineWidth(this.ctx,d.lineIndex),j=this._getLineLeftOffset(i),k=j,l=d.lineIndex,m=0,n=g.length;n>m;m++)e=g[m],k+=this._getWidthOfChar(this.ctx,e,l,m);var o=this._getIndexOnPrevLine(d,h,k);return h.length-o+g.length},_getIndexOnPrevLine:function(a,b,c){for(var d,e=a.lineIndex-1,f=this._getLineWidth(this.ctx,e),g=this._getLineLeftOffset(f),h=g,i=0,j=0,k=b.length;k>j;j++){var l=b[j],m=this._getWidthOfChar(this.ctx,l,e,j);if(h+=m,h>c){d=!0;var n=h-m,o=h,p=Math.abs(n-c),q=Math.abs(o-c);i=p>q?j:j-1;break}}return d||(i=b.length-1),i},moveCursorUp:function(a){this.abortCursorAnimation(),this._currentCursorOpacity=1;var b=this.getUpCursorOffset(a,"right"===this._selectionDirection);a.shiftKey?this.moveCursorUpWithShift(b):this.moveCursorUpWithoutShift(b),this.initDelayedCursor()},moveCursorUpWithShift:function(a){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left"),"right"===this._selectionDirection?this.setSelectionEnd(this.selectionEnd-a):this.setSelectionStart(this.selectionStart-a),this.selectionEnd<this.selectionStart&&"right"===this._selectionDirection&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(a){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-a),this.setSelectionEnd(this.selectionStart),this._selectionDirection="left"},moveCursorLeft:function(a){(0!==this.selectionStart||0!==this.selectionEnd)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,a.shiftKey?this.moveCursorLeftWithShift(a):this.moveCursorLeftWithoutShift(a),this.initDelayedCursor())},_move:function(a,b,c){var d="selectionStart"===b?"setSelectionStart":"setSelectionEnd";this[d](a.altKey?this["findWordBoundary"+c](this[b]):a.metaKey||35===a.keyCode||36===a.keyCode?this["findLineBoundary"+c](this[b]):this[b]+("Left"===c?-1:1))},_moveLeft:function(a,b){this._move(a,b,"Left")},_moveRight:function(a,b){this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(a,"selectionStart"),this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(a){"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(a,"selectionStart"),"\n"===this.text.charAt(this.selectionStart)&&this.setSelectionStart(this.selectionStart-1))},moveCursorRight:function(a){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,a.shiftKey?this.moveCursorRightWithShift(a):this.moveCursorRightWithoutShift(a),this.initDelayedCursor())},moveCursorRightWithShift:function(a){"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):(this._selectionDirection="right",this._moveRight(a,"selectionEnd"),"\n"===this.text.charAt(this.selectionEnd-1)&&this.setSelectionEnd(this.selectionEnd+1))},moveCursorRightWithoutShift:function(a){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(a,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(a){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(a):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this._clearCache(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(a){if(0!==this.selectionStart)if(a.metaKey){var b=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(b,this.selectionStart),this.setSelectionStart(b)}else if(a.altKey){var c=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(c,this.selectionStart),this.setSelectionStart(c)}else{var d="\n"===this.text.slice(this.selectionStart-1,this.selectionStart);this.removeStyleObject(d),this.setSelectionStart(this.selectionStart-1),this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(a,b,c,d,e,f){this.styles[a]?this._setSVGTextLineChars(a,b,c,d,f):this.callSuper("_setSVGTextLineText",a,b,c,d,e)},_setSVGTextLineChars:function(a,b,c,d,e){for(var f=this._textLines[a].split(""),g=0,h=this._getSVGLineLeftOffset(a)-this.width/2,i=this._getSVGLineTopOffset(a),j=this._getHeightOfLine(this.ctx,a),k=0,l=f.length;l>k;k++){var m=this.styles[a][k]||{};b.push(this._createTextCharSpan(f[k],m,h,i.lineTop+i.offset,g));var n=this._getWidthOfChar(this.ctx,f[k],a,k);m.textBackgroundColor&&e.push(this._createTextCharBg(m,h,i.lineTop,j,n,g)),g+=n}},_getSVGLineLeftOffset:function(a){return fabric.util.toFixed(this._getLineLeftOffset(this.__lineWidths[a]),2)},_getSVGLineTopOffset:function(a){for(var b=0,c=0,d=0;a>d;d++)b+=this._getHeightOfLine(this.ctx,d);return c=this._getHeightOfLine(this.ctx,d),{lineTop:b,offset:(this._fontSizeMult-this._fontSizeFraction)*c/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(a,b,c,d,e,f){return['<rect fill="',a.textBackgroundColor,'" x="',b+f,'" y="',c-this.height/2,'" width="',e,'" height="',d/this.lineHeight,'"></rect>'].join("")},_createTextCharSpan:function(a,b,c,d,e){var f=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},b));return['<tspan x="',c+e,'" y="',d-this.height/2,'" ',b.fontFamily?'font-family="'+b.fontFamily.replace(/"/g,"'")+'" ':"",b.fontSize?'font-size="'+b.fontSize+'" ':"",b.fontStyle?'font-style="'+b.fontStyle+'" ':"",b.fontWeight?'font-weight="'+b.fontWeight+'" ':"",b.textDecoration?'text-decoration="'+b.textDecoration+'" ':"",'style="',f,'">',fabric.util.string.escapeXml(a),"</tspan>"].join("")}}),function(){function request(a,b,c){var d=URL.parse(a);d.port||(d.port=0===d.protocol.indexOf("https:")?443:80);var e=0===d.protocol.indexOf("https:")?HTTPS:HTTP,f=e.request({hostname:d.hostname,port:d.port,path:d.path,method:"GET"},function(a){var d="";b&&a.setEncoding(b),a.on("end",function(){c(d)}),a.on("data",function(b){200===a.statusCode&&(d+=b);

})});f.on("error",function(a){fabric.log(a.errno===process.ECONNREFUSED?"ECONNREFUSED: connection refused to "+d.hostname+":"+d.port:a.message)}),f.end()}function requestFs(a,b){var c=require("fs");c.readFile(a,function(a,c){if(a)throw fabric.log(a),a;b(c)})}if("undefined"==typeof document||"undefined"==typeof window){var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(a,b,c){function d(d){e.src=new Buffer(d,"binary"),e._src=a,b&&b.call(c,e)}var e=new Image;a&&(a instanceof Buffer||0===a.indexOf("data"))?(e.src=e._src=a,b&&b.call(c,e)):a&&0!==a.indexOf("http")?requestFs(a,d):a?request(a,"binary",d):b&&b.call(c,a)},fabric.loadSVGFromURL=function(a,b,c){a=a.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),0!==a.indexOf("http")?requestFs(a,function(a){fabric.loadSVGFromString(a.toString(),b,c)}):request(a,"",function(a){fabric.loadSVGFromString(a,b,c)})},fabric.loadSVGFromString=function(a,b,c){var d=(new DOMParser).parseFromString(a);fabric.parseSVGDocument(d.documentElement,function(a,c){b&&b(a,c)},c)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,function(c){var d=new fabric.Image(c);d._initConfig(a),d._initFilters(a,function(a){d.filters=a||[],b&&b(d)})})},fabric.createCanvasForNode=function(a,b,c,d){d=d||c;var e=fabric.document.createElement("canvas"),f=new Canvas(a||600,b||600,d);e.style={},e.width=f.width,e.height=f.height;var g=fabric.Canvas||fabric.StaticCanvas,h=new g(e,c);return h.contextContainer=f.getContext("2d"),h.nodeCanvas=f,h.Font=Canvas.Font,h},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(a){return this.nodeCanvas.createJPEGStream(a)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a,b){return origSetWidth.call(this,a,b),this.nodeCanvas.width=a,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(a,b){return origSetHeight.call(this,a,b),this.nodeCanvas.height=a,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}(),Array.prototype.removeFromTo=function(a,b){return this.splice(a,!b||1+b-a+(!(0>b^a>=0)&&(0>b||-1)*this.length)),this.length};var UndoManager=function(){"use strict";var a,b,c=[],d=-1,e=0,f=!1;return b=function(a,b){return a&&"function"==typeof a[b]?(f=!0,a[b](),f=!1,this):this},{add:function(b){return f?this:(c.splice(d+1,c.length-d),c.push(b),e&&c.length>e&&c.removeFromTo(0,-(e+1)),d=c.length-1,a&&a(),this)},setCallback:function(b){a=b},undo:function(){var e=c[d];return e?(b(e,"undo"),d-=1,a&&a(),this):this},redo:function(){var e=c[d+1];return e?(b(e,"redo"),d+=1,a&&a(),this):this},clear:function(){var b=c.length;c=[],d=-1,a&&b>0&&a()},hasUndo:function(){return-1!==d},hasRedo:function(){return d<c.length-1},getCommands:function(){return c},setLimit:function(a){e=a}}};!function(a,b){if("function"==typeof define&&define.amd)define(["jquery"],b);else if("object"==typeof module&&module.exports){var c;try{c=require("jquery")}catch(d){c=null}module.exports=b(c)}else a.Slider=b(a.jQuery)}(this,function(a){var b;return function(a){"use strict";function b(){}function c(a){function c(b){b.prototype.option||(b.prototype.option=function(b){a.isPlainObject(b)&&(this.options=a.extend(!0,this.options,b))})}function e(b,c){a.fn[b]=function(e){if("string"==typeof e){for(var g=d.call(arguments,1),h=0,i=this.length;i>h;h++){var j=this[h],k=a.data(j,b);if(k)if(a.isFunction(k[e])&&"_"!==e.charAt(0)){var l=k[e].apply(k,g);if(void 0!==l&&l!==k)return l}else f("no such method '"+e+"' for "+b+" instance");else f("cannot call methods on "+b+" prior to initialization; attempted to call '"+e+"'")}return this}var m=this.map(function(){var d=a.data(this,b);return d?(d.option(e),d._init()):(d=new c(this,e),a.data(this,b,d)),a(this)});return!m||m.length>1?m:m[0]}}if(a){var f="undefined"==typeof console?b:function(a){console.error(a)};return a.bridget=function(a,b){c(b),e(a,b)},a.bridget}}var d=Array.prototype.slice;c(a)}(a),function(a){function c(b,c){function d(a,b){var c="data-slider-"+b,d=a.getAttribute(c);try{return JSON.parse(d)}catch(e){return d}}"string"==typeof b?this.element=document.querySelector(b):b instanceof HTMLElement&&(this.element=b),c=c?c:{};for(var f=Object.keys(this.defaultOptions),g=0;g<f.length;g++){var h=f[g],i=c[h];i="undefined"!=typeof i?i:d(this.element,h),i=null!==i?i:this.defaultOptions[h],this.options||(this.options={}),this.options[h]=i}var j,k,l,m,n,o=this.element.style.width,p=!1,q=this.element.parentNode;if(this.sliderElem)p=!0;else{this.sliderElem=document.createElement("div"),this.sliderElem.className="slider";var r=document.createElement("div");if(r.className="slider-track",k=document.createElement("div"),k.className="slider-track-low",j=document.createElement("div"),j.className="slider-selection",l=document.createElement("div"),l.className="slider-track-high",m=document.createElement("div"),m.className="slider-handle min-slider-handle",n=document.createElement("div"),n.className="slider-handle max-slider-handle",r.appendChild(k),r.appendChild(j),r.appendChild(l),this.ticks=[],this.options.ticks instanceof Array&&this.options.ticks.length>0){for(g=0;g<this.options.ticks.length;g++){var s=document.createElement("div");s.className="slider-tick",this.ticks.push(s),r.appendChild(s)}j.className+=" tick-slider-selection"}if(r.appendChild(m),r.appendChild(n),this.tickLabels=[],this.options.ticks_labels instanceof Array&&this.options.ticks_labels.length>0)for(this.tickLabelContainer=document.createElement("div"),this.tickLabelContainer.className="slider-tick-label-container",g=0;g<this.options.ticks_labels.length;g++){var t=document.createElement("div");t.className="slider-tick-label",t.innerHTML=this.options.ticks_labels[g],this.tickLabels.push(t),this.tickLabelContainer.appendChild(t)}var u=function(a){var b=document.createElement("div");b.className="tooltip-arrow";var c=document.createElement("div");c.className="tooltip-inner",a.appendChild(b),a.appendChild(c)},v=document.createElement("div");v.className="tooltip tooltip-main",u(v);var w=document.createElement("div");w.className="tooltip tooltip-min",u(w);var x=document.createElement("div");x.className="tooltip tooltip-max",u(x),this.sliderElem.appendChild(r),this.sliderElem.appendChild(v),this.sliderElem.appendChild(w),this.sliderElem.appendChild(x),this.tickLabelContainer&&this.sliderElem.appendChild(this.tickLabelContainer),q.insertBefore(this.sliderElem,this.element),this.element.style.display="none"}if(a&&(this.$element=a(this.element),this.$sliderElem=a(this.sliderElem)),this.eventToCallbackMap={},this.sliderElem.id=this.options.id,this.touchCapable="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,this.tooltip=this.sliderElem.querySelector(".tooltip-main"),this.tooltipInner=this.tooltip.querySelector(".tooltip-inner"),this.tooltip_min=this.sliderElem.querySelector(".tooltip-min"),this.tooltipInner_min=this.tooltip_min.querySelector(".tooltip-inner"),this.tooltip_max=this.sliderElem.querySelector(".tooltip-max"),this.tooltipInner_max=this.tooltip_max.querySelector(".tooltip-inner"),e[this.options.scale]&&(this.options.scale=e[this.options.scale]),p===!0&&(this._removeClass(this.sliderElem,"slider-horizontal"),this._removeClass(this.sliderElem,"slider-vertical"),this._removeClass(this.tooltip,"hide"),this._removeClass(this.tooltip_min,"hide"),this._removeClass(this.tooltip_max,"hide"),["left","top","width","height"].forEach(function(a){this._removeProperty(this.trackLow,a),this._removeProperty(this.trackSelection,a),this._removeProperty(this.trackHigh,a)},this),[this.handle1,this.handle2].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top")},this),[this.tooltip,this.tooltip_min,this.tooltip_max].forEach(function(a){this._removeProperty(a,"left"),this._removeProperty(a,"top"),this._removeProperty(a,"margin-left"),this._removeProperty(a,"margin-top"),this._removeClass(a,"right"),this._removeClass(a,"top")},this)),"vertical"===this.options.orientation?(this._addClass(this.sliderElem,"slider-vertical"),this.stylePos="top",this.mousePos="pageY",this.sizePos="offsetHeight",this._addClass(this.tooltip,"right"),this.tooltip.style.left="100%",this._addClass(this.tooltip_min,"right"),this.tooltip_min.style.left="100%",this._addClass(this.tooltip_max,"right"),this.tooltip_max.style.left="100%"):(this._addClass(this.sliderElem,"slider-horizontal"),this.sliderElem.style.width=o,this.options.orientation="horizontal",this.stylePos="left",this.mousePos="pageX",this.sizePos="offsetWidth",this._addClass(this.tooltip,"top"),this.tooltip.style.top=-this.tooltip.outerHeight-14+"px",this._addClass(this.tooltip_min,"top"),this.tooltip_min.style.top=-this.tooltip_min.outerHeight-14+"px",this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=-this.tooltip_max.outerHeight-14+"px"),this.options.ticks instanceof Array&&this.options.ticks.length>0&&(this.options.max=Math.max.apply(Math,this.options.ticks),this.options.min=Math.min.apply(Math,this.options.ticks)),this.options.value instanceof Array?this.options.range=!0:this.options.range&&(this.options.value=[this.options.value,this.options.max]),this.trackLow=k||this.trackLow,this.trackSelection=j||this.trackSelection,this.trackHigh=l||this.trackHigh,"none"===this.options.selection&&(this._addClass(this.trackLow,"hide"),this._addClass(this.trackSelection,"hide"),this._addClass(this.trackHigh,"hide")),this.handle1=m||this.handle1,this.handle2=n||this.handle2,p===!0)for(this._removeClass(this.handle1,"round triangle"),this._removeClass(this.handle2,"round triangle hide"),g=0;g<this.ticks.length;g++)this._removeClass(this.ticks[g],"round triangle hide");var y=["round","triangle","custom"],z=-1!==y.indexOf(this.options.handle);if(z)for(this._addClass(this.handle1,this.options.handle),this._addClass(this.handle2,this.options.handle),g=0;g<this.ticks.length;g++)this._addClass(this.ticks[g],this.options.handle);this.offset=this._offset(this.sliderElem),this.size=this.sliderElem[this.sizePos],this.setValue(this.options.value),this.handle1Keydown=this._keydown.bind(this,0),this.handle1.addEventListener("keydown",this.handle1Keydown,!1),this.handle2Keydown=this._keydown.bind(this,1),this.handle2.addEventListener("keydown",this.handle2Keydown,!1),this.touchCapable?(this.mousedown=this._mousedown.bind(this),this.sliderElem.addEventListener("touchstart",this.mousedown,!1)):(this.mousedown=this._mousedown.bind(this),this.sliderElem.addEventListener("mousedown",this.mousedown,!1)),"hide"===this.options.tooltip?(this._addClass(this.tooltip,"hide"),this._addClass(this.tooltip_min,"hide"),this._addClass(this.tooltip_max,"hide")):"always"===this.options.tooltip?(this._showTooltip(),this._alwaysShowTooltip=!0):(this.showTooltip=this._showTooltip.bind(this),this.hideTooltip=this._hideTooltip.bind(this),this.sliderElem.addEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.addEventListener("mouseleave",this.hideTooltip,!1),this.handle1.addEventListener("focus",this.showTooltip,!1),this.handle1.addEventListener("blur",this.hideTooltip,!1),this.handle2.addEventListener("focus",this.showTooltip,!1),this.handle2.addEventListener("blur",this.hideTooltip,!1)),this.options.enabled?this.enable():this.disable()}var d={formatInvalidInputErrorMsg:function(a){return"Invalid input value '"+a+"' passed in"},callingContextNotSliderInstance:"Calling context element does not have instance of Slider bound to it. Check your code to make sure the JQuery object returned from the call to the slider() initializer is calling the method"},e={linear:{toValue:function(a){var b=a/100*(this.options.max-this.options.min),c=this.options.min+Math.round(b/this.options.step)*this.options.step;return c<this.options.min?this.options.min:c>this.options.max?this.options.max:c},toPercentage:function(a){return this.options.max===this.options.min?0:100*(a-this.options.min)/(this.options.max-this.options.min)}},logarithmic:{toValue:function(a){var b=0===this.options.min?0:Math.log(this.options.min),c=Math.log(this.options.max);return Math.exp(b+(c-b)*a/100)},toPercentage:function(a){if(this.options.max===this.options.min)return 0;var b=Math.log(this.options.max),c=0===this.options.min?0:Math.log(this.options.min),d=0===a?0:Math.log(a);return 100*(d-c)/(b-c)}}};if(b=function(a,b){return c.call(this,a,b),this},b.prototype={_init:function(){},constructor:b,defaultOptions:{id:"",min:0,max:10,step:1,precision:0,orientation:"horizontal",value:5,range:!1,selection:"before",tooltip:"show",tooltip_split:!1,handle:"round",reversed:!1,enabled:!0,formatter:function(a){return a instanceof Array?a[0]+" : "+a[1]:a},natural_arrow_keys:!1,ticks:[],ticks_labels:[],ticks_snap_bounds:0,scale:"linear"},over:!1,inDrag:!1,getValue:function(){return this.options.range?this.options.value:this.options.value[0]},setValue:function(a,b){a||(a=0);var c=this.getValue();this.options.value=this._validateInputValue(a);var d=this._applyPrecision.bind(this);this.options.range?(this.options.value[0]=d(this.options.value[0]),this.options.value[1]=d(this.options.value[1]),this.options.value[0]=Math.max(this.options.min,Math.min(this.options.max,this.options.value[0])),this.options.value[1]=Math.max(this.options.min,Math.min(this.options.max,this.options.value[1]))):(this.options.value=d(this.options.value),this.options.value=[Math.max(this.options.min,Math.min(this.options.max,this.options.value))],this._addClass(this.handle2,"hide"),this.options.value[1]="after"===this.options.selection?this.options.max:this.options.min),this.percentage=this.options.max>this.options.min?[this._toPercentage(this.options.value[0]),this._toPercentage(this.options.value[1]),100*this.options.step/(this.options.max-this.options.min)]:[0,0,100],this._layout();var e=this.options.range?this.options.value:this.options.value[0];return b===!0&&this._trigger("slide",e),c!==e&&this._trigger("change",{oldValue:c,newValue:e}),this._setDataVal(e),this},destroy:function(){this._removeSliderEventHandlers(),this.sliderElem.parentNode.removeChild(this.sliderElem),this.element.style.display="",this._cleanUpEventCallbacksMap(),this.element.removeAttribute("data"),a&&(this._unbindJQueryEventHandlers(),this.$element.removeData("slider"))},disable:function(){return this.options.enabled=!1,this.handle1.removeAttribute("tabindex"),this.handle2.removeAttribute("tabindex"),this._addClass(this.sliderElem,"slider-disabled"),this._trigger("slideDisabled"),this},enable:function(){return this.options.enabled=!0,this.handle1.setAttribute("tabindex",0),this.handle2.setAttribute("tabindex",0),this._removeClass(this.sliderElem,"slider-disabled"),this._trigger("slideEnabled"),this},toggle:function(){return this.options.enabled?this.disable():this.enable(),this},isEnabled:function(){return this.options.enabled},on:function(b,c){return a?(this.$element.on(b,c),this.$sliderElem.on(b,c)):this._bindNonQueryEventHandler(b,c),this},getAttribute:function(a){return a?this.options[a]:this.options},setAttribute:function(a,b){return this.options[a]=b,this},refresh:function(){return this._removeSliderEventHandlers(),c.call(this,this.element,this.options),a&&a.data(this.element,"slider",this),this},relayout:function(){return this._layout(),this},_removeSliderEventHandlers:function(){this.handle1.removeEventListener("keydown",this.handle1Keydown,!1),this.handle1.removeEventListener("focus",this.showTooltip,!1),this.handle1.removeEventListener("blur",this.hideTooltip,!1),this.handle2.removeEventListener("keydown",this.handle2Keydown,!1),this.handle2.removeEventListener("focus",this.handle2Keydown,!1),this.handle2.removeEventListener("blur",this.handle2Keydown,!1),this.sliderElem.removeEventListener("mouseenter",this.showTooltip,!1),this.sliderElem.removeEventListener("mouseleave",this.hideTooltip,!1),this.sliderElem.removeEventListener("touchstart",this.mousedown,!1),this.sliderElem.removeEventListener("mousedown",this.mousedown,!1)},_bindNonQueryEventHandler:function(a,b){void 0===this.eventToCallbackMap[a]&&(this.eventToCallbackMap[a]=[]),this.eventToCallbackMap[a].push(b)},_cleanUpEventCallbacksMap:function(){for(var a=Object.keys(this.eventToCallbackMap),b=0;b<a.length;b++){var c=a[b];this.eventToCallbackMap[c]=null}},_showTooltip:function(){this.options.tooltip_split===!1?this._addClass(this.tooltip,"in"):(this._addClass(this.tooltip_min,"in"),this._addClass(this.tooltip_max,"in")),this.over=!0},_hideTooltip:function(){this.inDrag===!1&&this.alwaysShowTooltip!==!0&&(this._removeClass(this.tooltip,"in"),this._removeClass(this.tooltip_min,"in"),this._removeClass(this.tooltip_max,"in")),this.over=!1},_layout:function(){var a;if(a=this.options.reversed?[100-this.percentage[0],this.percentage[1]]:[this.percentage[0],this.percentage[1]],this.handle1.style[this.stylePos]=a[0]+"%",this.handle2.style[this.stylePos]=a[1]+"%",this.options.ticks instanceof Array&&this.options.ticks.length>0){var b=Math.max.apply(Math,this.options.ticks),c=Math.min.apply(Math,this.options.ticks),d="vertical"===this.options.orientation?"height":"width",e="vertical"===this.options.orientation?"margin-top":"margin-left",f=this.size/(this.options.ticks.length-1);if(this.tickLabelContainer&&(this.tickLabelContainer.style[e]=-f/2+"px","horizontal"===this.options.orientation)){var g=this.tickLabelContainer.offsetHeight-this.sliderElem.offsetHeight;this.sliderElem.style.marginBottom=g+"px"}for(var h=0;h<this.options.ticks.length;h++){var i=100*(this.options.ticks[h]-c)/(b-c);this.ticks[h].style[this.stylePos]=i+"%",this._removeClass(this.ticks[h],"in-selection"),i<=a[0]&&!this.options.range?this._addClass(this.ticks[h],"in-selection"):i>=a[0]&&i<=a[1]&&this._addClass(this.ticks[h],"in-selection"),this.tickLabels[h]&&(this.tickLabels[h].style[d]=f+"px")}}if("vertical"===this.options.orientation)this.trackLow.style.top="0",this.trackLow.style.height=Math.min(a[0],a[1])+"%",this.trackSelection.style.top=Math.min(a[0],a[1])+"%",this.trackSelection.style.height=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.bottom="0",this.trackHigh.style.height=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";else{this.trackLow.style.left="0",this.trackLow.style.width=Math.min(a[0],a[1])+"%",this.trackSelection.style.left=Math.min(a[0],a[1])+"%",this.trackSelection.style.width=Math.abs(a[0]-a[1])+"%",this.trackHigh.style.right="0",this.trackHigh.style.width=100-Math.min(a[0],a[1])-Math.abs(a[0]-a[1])+"%";var j=this.tooltip_min.getBoundingClientRect(),k=this.tooltip_max.getBoundingClientRect();j.right>k.left?(this._removeClass(this.tooltip_max,"top"),this._addClass(this.tooltip_max,"bottom"),this.tooltip_max.style.top="18px"):(this._removeClass(this.tooltip_max,"bottom"),this._addClass(this.tooltip_max,"top"),this.tooltip_max.style.top=this.tooltip_min.style.top)}var l;if(this.options.range){l=this.options.formatter(this.options.value),this._setText(this.tooltipInner,l),this.tooltip.style[this.stylePos]=(a[1]+a[0])/2+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px"),"vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px");var m=this.options.formatter(this.options.value[0]);this._setText(this.tooltipInner_min,m);var n=this.options.formatter(this.options.value[1]);this._setText(this.tooltipInner_max,n),this.tooltip_min.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip_min,"margin-top",-this.tooltip_min.offsetHeight/2+"px"):this._css(this.tooltip_min,"margin-left",-this.tooltip_min.offsetWidth/2+"px"),this.tooltip_max.style[this.stylePos]=a[1]+"%","vertical"===this.options.orientation?this._css(this.tooltip_max,"margin-top",-this.tooltip_max.offsetHeight/2+"px"):this._css(this.tooltip_max,"margin-left",-this.tooltip_max.offsetWidth/2+"px")}else l=this.options.formatter(this.options.value[0]),this._setText(this.tooltipInner,l),this.tooltip.style[this.stylePos]=a[0]+"%","vertical"===this.options.orientation?this._css(this.tooltip,"margin-top",-this.tooltip.offsetHeight/2+"px"):this._css(this.tooltip,"margin-left",-this.tooltip.offsetWidth/2+"px")},_removeProperty:function(a,b){a.style.removeProperty?a.style.removeProperty(b):a.style.removeAttribute(b)},_mousedown:function(a){if(!this.options.enabled)return!1;this._triggerFocusOnHandle(),this.offset=this._offset(this.sliderElem),this.size=this.sliderElem[this.sizePos];var b=this._getPercentage(a);if(this.options.range){var c=Math.abs(this.percentage[0]-b),d=Math.abs(this.percentage[1]-b);this.dragged=d>c?0:1}else this.dragged=0;this.percentage[this.dragged]=this.options.reversed?100-b:b,this._layout(),this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),this.mousemove&&document.removeEventListener("mousemove",this.mousemove,!1),this.mouseup&&document.removeEventListener("mouseup",this.mouseup,!1),this.mousemove=this._mousemove.bind(this),this.mouseup=this._mouseup.bind(this),this.touchCapable&&(document.addEventListener("touchmove",this.mousemove,!1),document.addEventListener("touchend",this.mouseup,!1)),document.addEventListener("mousemove",this.mousemove,!1),document.addEventListener("mouseup",this.mouseup,!1),this.inDrag=!0;var e=this._calculateValue();return this._trigger("slideStart",e),this._setDataVal(e),this.setValue(e),this._pauseEvent(a),!0},_triggerFocusOnHandle:function(a){0===a&&this.handle1.focus(),1===a&&this.handle2.focus()},_keydown:function(a,b){if(!this.options.enabled)return!1;var c;switch(b.keyCode){case 37:case 40:c=-1;break;case 39:case 38:c=1}if(c){if(this.options.natural_arrow_keys){var d="vertical"===this.options.orientation&&!this.options.reversed,e="horizontal"===this.options.orientation&&this.options.reversed;(d||e)&&(c=-c)}var f=this.options.value[a]+c*this.options.step;return this.options.range&&(f=[a?this.options.value[0]:f,a?f:this.options.value[1]]),this._trigger("slideStart",f),this._setDataVal(f),this.setValue(f,!0),this._trigger("slideStop",f),this._setDataVal(f),this._layout(),this._pauseEvent(b),!1}},_pauseEvent:function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1},_mousemove:function(a){if(!this.options.enabled)return!1;var b=this._getPercentage(a);this._adjustPercentageForRangeSliders(b),this.percentage[this.dragged]=this.options.reversed?100-b:b,this._layout();var c=this._calculateValue(!0);return this.setValue(c,!0),!1},_adjustPercentageForRangeSliders:function(a){this.options.range&&(0===this.dragged&&this.percentage[1]<a?(this.percentage[0]=this.percentage[1],this.dragged=1):1===this.dragged&&this.percentage[0]>a&&(this.percentage[1]=this.percentage[0],this.dragged=0))},_mouseup:function(){if(!this.options.enabled)return!1;this.touchCapable&&(document.removeEventListener("touchmove",this.mousemove,!1),document.removeEventListener("touchend",this.mouseup,!1)),document.removeEventListener("mousemove",this.mousemove,!1),document.removeEventListener("mouseup",this.mouseup,!1),this.inDrag=!1,this.over===!1&&this._hideTooltip();var a=this._calculateValue(!0);return this._layout(),this._trigger("slideStop",a),this._setDataVal(a),!1},_calculateValue:function(a){var b;if(this.options.range?(b=[this.options.min,this.options.max],0!==this.percentage[0]&&(b[0]=this._toValue(this.percentage[0]),b[0]=this._applyPrecision(b[0])),100!==this.percentage[1]&&(b[1]=this._toValue(this.percentage[1]),b[1]=this._applyPrecision(b[1]))):(b=this._toValue(this.percentage[0]),b=parseFloat(b),b=this._applyPrecision(b)),a){for(var c=[b,1/0],d=0;d<this.options.ticks.length;d++){var e=Math.abs(this.options.ticks[d]-b);e<=c[1]&&(c=[this.options.ticks[d],e])}if(c[1]<=this.options.ticks_snap_bounds)return c[0]}return b},_applyPrecision:function(a){var b=this.options.precision||this._getNumDigitsAfterDecimalPlace(this.options.step);return this._applyToFixedAndParseFloat(a,b)},_getNumDigitsAfterDecimalPlace:function(a){var b=(""+a).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return b?Math.max(0,(b[1]?b[1].length:0)-(b[2]?+b[2]:0)):0},_applyToFixedAndParseFloat:function(a,b){var c=a.toFixed(b);return parseFloat(c)},_getPercentage:function(a){!this.touchCapable||"touchstart"!==a.type&&"touchmove"!==a.type||(a=a.touches[0]);var b=100*(a[this.mousePos]-this.offset[this.stylePos])/this.size;return b=Math.round(b/this.percentage[2])*this.percentage[2],Math.max(0,Math.min(100,b))},_validateInputValue:function(a){if("number"==typeof a)return a;if(a instanceof Array)return this._validateArray(a),a;throw new Error(d.formatInvalidInputErrorMsg(a))},_validateArray:function(a){for(var b=0;b<a.length;b++){var c=a[b];if("number"!=typeof c)throw new Error(d.formatInvalidInputErrorMsg(c))}},_setDataVal:function(a){var b="value: '"+a+"'";this.element.setAttribute("data",b),this.element.setAttribute("value",a),this.element.value=a},_trigger:function(b,c){c=c||0===c?c:void 0;var d=this.eventToCallbackMap[b];if(d&&d.length)for(var e=0;e<d.length;e++){var f=d[e];f(c)}a&&this._triggerJQueryEvent(b,c)},_triggerJQueryEvent:function(a,b){var c={type:a,value:b};this.$element.trigger(c),this.$sliderElem.trigger(c)},_unbindJQueryEventHandlers:function(){this.$element.off(),this.$sliderElem.off()},_setText:function(a,b){"undefined"!=typeof a.innerText?a.innerText=b:"undefined"!=typeof a.textContent&&(a.textContent=b)},_removeClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)");d=d.replace(g," ")}a.className=d.trim()},_addClass:function(a,b){for(var c=b.split(" "),d=a.className,e=0;e<c.length;e++){var f=c[e],g=new RegExp("(?:\\s|^)"+f+"(?:\\s|$)"),h=g.test(d);h||(d+=" "+f)}a.className=d.trim()},_offset:function(a){var b=a.getBoundingClientRect(),c=b.left,d=b.top;return{left:c,top:d}},_css:function(b,c,d){if(a)a.style(b,c,d);else{var e=c.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(a,b){return b.toUpperCase()});b.style[e]=d}},_toValue:function(a){return this.options.scale.toValue.apply(this,[a])},_toPercentage:function(a){return this.options.scale.toPercentage.apply(this,[a])}},a){var f=a.fn.slider?"bootstrapSlider":"slider";a.bridget(f,b)}}(a),b}),function(a){"use strict";var b='[data-toggle="context"]',c=function(b,c){this.$element=a(b),this.before=c.before||this.before,this.onItem=c.onItem||this.onItem,this.scopes=c.scopes||null,c.target&&this.$element.data("target",c.target),this.listen()};c.prototype={constructor:c,show:function(b){var c,d,e,f,g={relatedTarget:this,target:b.currentTarget};if(!this.isDisabled()&&(this.closemenu(),this.before.call(this,b,a(b.currentTarget))))return c=this.getMenu(),c.trigger(d=a.Event("show.bs.context",g)),e=this.getPosition(b,c),f="li:not(.divider)",c.attr("style","").css(e).addClass("open").on("click.context.data-api",f,a.proxy(this.onItem,this,a(b.currentTarget))).trigger("shown.bs.context",g),a("html").on("click.context.data-api",c.selector,a.proxy(this.closemenu,this)),!1},closemenu:function(b){var c,d,e,f;return c=this.getMenu(),c.hasClass("open")?(f={relatedTarget:this},c.trigger(d=a.Event("hide.bs.context",f)),e="li:not(.divider)",c.removeClass("open").off("click.context.data-api",e).trigger("hidden.bs.context",f),a("html").off("click.context.data-api",c.selector),!1):void 0},keydown:function(a){27==a.which&&this.closemenu(a)},before:function(a){return!0},onItem:function(a){return!0},listen:function(){this.$element.on("contextmenu.context.data-api",this.scopes,a.proxy(this.show,this)),a("html").on("click.context.data-api",a.proxy(this.closemenu,this)),a("html").on("keydown.context.data-api",a.proxy(this.keydown,this))},destroy:function(){this.$element.off(".context.data-api").removeData("context"),a("html").off(".context.data-api")},isDisabled:function(){return this.$element.hasClass("disabled")||this.$element.attr("disabled")},getMenu:function(){var b,c=this.$element.data("target");return c||(c=this.$element.attr("href"),c=c&&c.replace(/.*(?=#[^\s]*$)/,"")),b=a(c),b&&b.length?b:this.$element.find(c)},getPosition:function(b,c){var d,e,f,g=b.clientX,h=b.clientY,i=a(window).width(),j=a(window).height(),k=c.find(".dropdown-menu").outerWidth(),l=c.find(".dropdown-menu").outerHeight(),m={position:"absolute","z-index":9999};return d=h+l>j?{top:h-l+a(window).scrollTop()}:{top:h+a(window).scrollTop()},e=g+k>i&&g-k>0?{left:g-k+a(window).scrollLeft()}:{left:g+a(window).scrollLeft()},f=c.offsetParent().offset(),e.left=e.left-f.left,d.top=d.top-f.top,a.extend(m,d,e)}},a.fn.contextmenu=function(b,d){return this.each(function(){var e=a(this),f=e.data("context"),g="object"==typeof b&&b;f||e.data("context",f=new c(e,g)),"string"==typeof b&&f[b].call(f,d)})},a.fn.contextmenu.Constructor=c,a(document).on("contextmenu.context.data-api",function(){a(b).each(function(){var b=a(this).data("context");b&&b.closemenu()})}).on("contextmenu.context.data-api",b,function(b){a(this).contextmenu("show",b),b.preventDefault(),b.stopPropagation()})}(jQuery),function(a,b,c){function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function e(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return q[a.which]?q[a.which]:r[a.which]?r[a.which]:String.fromCharCode(a.which).toLowerCase()}function f(a){a=a||{};var b,c=!1;for(b in w)a[b]?c=!0:w[b]=0;c||(z=!1)}function g(a,b,c,d,e,f){var g,h,i=[],j=c.type;if(!u[a])return[];for("keyup"==j&&k(a)&&(b=[a]),g=0;g<u[a].length;++g)if(h=u[a][g],!(!d&&h.seq&&w[h.seq]!=h.level||j!=h.action||("keypress"!=j||c.metaKey||c.ctrlKey)&&b.sort().join(",")!==h.modifiers.sort().join(","))){var l=d&&h.seq==d&&h.level==f;(!d&&h.combo==e||l)&&u[a].splice(g,1),i.push(h)}return i}function h(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function i(a,b,c,d){A.stopCallback(b,b.target||b.srcElement,c,d)||!1!==a(b,c)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function j(a){"number"!=typeof a.which&&(a.which=a.keyCode);var b=e(a);b&&("keyup"==a.type&&x===b?x=!1:A.handleKey(b,h(a),a))}function k(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function l(a,b,c,d){function g(b){return function(){z=b,++w[a],clearTimeout(p),p=setTimeout(f,1e3)}}function h(b){i(c,b,a),"keyup"!==d&&(x=e(b)),setTimeout(f,10)}for(var j=w[a]=0;j<b.length;++j){var k=j+1===b.length?h:g(d||m(b[j+1]).action);n(b[j],k,d,a,j)}}function m(a,b){var c,d,e,f=[];for(c="+"===a?["+"]:a.split("+"),e=0;e<c.length;++e)d=c[e],t[d]&&(d=t[d]),b&&"keypress"!=b&&s[d]&&(d=s[d],f.push("shift")),k(d)&&f.push(d);if(c=d,e=b,!e){if(!o){o={};for(var g in q)g>95&&112>g||q.hasOwnProperty(g)&&(o[q[g]]=g)}e=o[c]?"keydown":"keypress"}return"keypress"==e&&f.length&&(e="keydown"),{key:d,modifiers:f,action:e}}function n(a,b,c,d,e){v[a+":"+c]=b,a=a.replace(/\s+/g," ");var f=a.split(" ");1<f.length?l(a,f,b,c):(c=m(a,c),u[c.key]=u[c.key]||[],g(c.key,c.modifiers,{type:c.action},d,a,e),u[c.key][d?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:d,level:e,combo:a}))}var o,p,q={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},r={106:"*",107:"+",109:"-",110:".",111:"/",
186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},t={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u={},v={},w={},x=!1,y=!1,z=!1;for(c=1;20>c;++c)q[111+c]="f"+c;for(c=0;9>=c;++c)q[c+96]=c;d(b,"keypress",j),d(b,"keydown",j),d(b,"keyup",j);var A={bind:function(a,b,c){a=a instanceof Array?a:[a];for(var d=0;d<a.length;++d)n(a[d],b,c);return this},unbind:function(a,b){return A.bind(a,function(){},b)},trigger:function(a,b){return v[a+":"+b]&&v[a+":"+b]({},a),this},reset:function(){return u={},v={},this},stopCallback:function(a,b){return-1<(" "+b.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable},handleKey:function(a,b,c){var d,e=g(a,b,c);b={};var h=0,j=!1;for(d=0;d<e.length;++d)e[d].seq&&(h=Math.max(h,e[d].level));for(d=0;d<e.length;++d)e[d].seq?e[d].level==h&&(j=!0,b[e[d].seq]=1,i(e[d].callback,c,e[d].combo,e[d].seq)):j||i(e[d].callback,c,e[d].combo);e="keypress"==c.type&&y,c.type!=z||k(a)||e||f(b),y=j&&"keydown"==c.type}};a.Mousetrap=A,"function"==typeof define&&define.amd&&define(A)}(window,document),function(a,b){"function"==typeof define&&define.amd?define(b):a.Dragdealer=b()}(this,function(){var a=function(a,b){this.bindMethods(),this.options=this.applyDefaults(b||{}),this.wrapper=this.getWrapperElement(a),this.wrapper&&(this.handle=this.getHandleElement(this.wrapper,this.options.handleClass),this.handle&&(this.init(),this.bindEventListeners()))};a.prototype={defaults:{disabled:!1,horizontal:!0,vertical:!1,slide:!0,steps:0,snap:!1,loose:!1,speed:.1,xPrecision:0,yPrecision:0,handleClass:"handle"},init:function(){this.value={prev:[-1,-1],current:[this.options.x||0,this.options.y||0],target:[this.options.x||0,this.options.y||0]},this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]},this.change=[0,0],this.stepRatios=this.calculateStepRatios(),this.activity=!1,this.dragging=!1,this.tapping=!1,this.reflow(),this.options.disabled&&this.disable()},applyDefaults:function(a){for(var b in this.defaults)a.hasOwnProperty(b)||(a[b]=this.defaults[b]);return a},getWrapperElement:function(a){return"string"==typeof a?document.getElementById(a):a},getHandleElement:function(a,b){var c,d=a.getElementsByTagName("div"),e=new RegExp("(^|\\s)"+b+"(\\s|$)");for(c=0;c<d.length;c++)if(e.test(d[c].className))return d[c]},calculateStepRatios:function(){var a=[];if(this.options.steps>1)for(var b=0;b<=this.options.steps-1;b++)a[b]=b/(this.options.steps-1);return a},setWrapperOffset:function(){this.offset.wrapper=h.get(this.wrapper)},calculateBounds:function(){var a={top:this.options.top||0,bottom:-(this.options.bottom||0)+this.wrapper.offsetHeight,left:this.options.left||0,right:-(this.options.right||0)+this.wrapper.offsetWidth};return a.availWidth=a.right-a.left-this.handle.offsetWidth,a.availHeight=a.bottom-a.top-this.handle.offsetHeight,a},calculateValuePrecision:function(){var a=this.options.xPrecision||Math.abs(this.bounds.availWidth),b=this.options.yPrecision||Math.abs(this.bounds.availHeight);return[a?1/a:0,b?1/b:0]},bindMethods:function(){this.onHandleMouseDown=b(this.onHandleMouseDown,this),this.onHandleTouchStart=b(this.onHandleTouchStart,this),this.onDocumentMouseMove=b(this.onDocumentMouseMove,this),this.onWrapperTouchMove=b(this.onWrapperTouchMove,this),this.onWrapperMouseDown=b(this.onWrapperMouseDown,this),this.onWrapperTouchStart=b(this.onWrapperTouchStart,this),this.onDocumentMouseUp=b(this.onDocumentMouseUp,this),this.onDocumentTouchEnd=b(this.onDocumentTouchEnd,this),this.onHandleClick=b(this.onHandleClick,this),this.onWindowResize=b(this.onWindowResize,this)},bindEventListeners:function(){c(this.handle,"mousedown",this.onHandleMouseDown),c(this.handle,"touchstart",this.onHandleTouchStart),c(document,"mousemove",this.onDocumentMouseMove),c(this.wrapper,"touchmove",this.onWrapperTouchMove),c(this.wrapper,"mousedown",this.onWrapperMouseDown),c(this.wrapper,"touchstart",this.onWrapperTouchStart),c(document,"mouseup",this.onDocumentMouseUp),c(document,"touchend",this.onDocumentTouchEnd),c(this.handle,"click",this.onHandleClick),c(window,"resize",this.onWindowResize);var a=this;this.interval=setInterval(function(){a.animate()},25),this.animate(!1,!0)},unbindEventListeners:function(){d(this.handle,"mousedown",this.onHandleMouseDown),d(this.handle,"touchstart",this.onHandleTouchStart),d(document,"mousemove",this.onDocumentMouseMove),d(this.wrapper,"touchmove",this.onWrapperTouchMove),d(this.wrapper,"mousedown",this.onWrapperMouseDown),d(this.wrapper,"touchstart",this.onWrapperTouchStart),d(document,"mouseup",this.onDocumentMouseUp),d(document,"touchend",this.onDocumentTouchEnd),d(this.handle,"click",this.onHandleClick),d(window,"resize",this.onWindowResize),clearInterval(this.interval)},onHandleMouseDown:function(a){g.refresh(a),e(a),f(a),this.activity=!1,this.startDrag()},onHandleTouchStart:function(a){g.refresh(a),f(a),this.activity=!1,this.startDrag()},onDocumentMouseMove:function(a){g.refresh(a),this.dragging&&(this.activity=!0)},onWrapperTouchMove:function(a){return g.refresh(a),!this.activity&&this.draggingOnDisabledAxis()?void(this.dragging&&this.stopDrag()):(e(a),void(this.activity=!0))},onWrapperMouseDown:function(a){g.refresh(a),e(a),this.startTap()},onWrapperTouchStart:function(a){g.refresh(a),e(a),this.startTap()},onDocumentMouseUp:function(a){this.stopDrag(),this.stopTap()},onDocumentTouchEnd:function(a){this.stopDrag(),this.stopTap()},onHandleClick:function(a){this.activity&&(e(a),f(a))},onWindowResize:function(a){this.reflow()},enable:function(){this.disabled=!1,this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=!0,this.handle.className+=" disabled"},reflow:function(){this.setWrapperOffset(),this.bounds=this.calculateBounds(),this.valuePrecision=this.calculateValuePrecision(),this.updateOffsetFromValue()},getStep:function(){return[this.getStepNumber(this.value.target[0]),this.getStepNumber(this.value.target[1])]},getValue:function(){return this.value.target},setStep:function(a,b,c){this.setValue(this.options.steps&&a>1?(a-1)/(this.options.steps-1):0,this.options.steps&&b>1?(b-1)/(this.options.steps-1):0,c)},setValue:function(a,b,c){this.setTargetValue([a,b||0]),c&&(this.groupCopy(this.value.current,this.value.target),this.updateOffsetFromValue(),this.callAnimationCallback())},startTap:function(){this.disabled||(this.tapping=!0,this.setWrapperOffset(),this.setTargetValueByOffset([g.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,g.y-this.offset.wrapper[1]-this.handle.offsetHeight/2]))},stopTap:function(){!this.disabled&&this.tapping&&(this.tapping=!1,this.setTargetValue(this.value.current))},startDrag:function(){this.disabled||(this.dragging=!0,this.setWrapperOffset(),this.offset.mouse=[g.x-h.get(this.handle)[0],g.y-h.get(this.handle)[1]])},stopDrag:function(){if(!this.disabled&&this.dragging){this.dragging=!1;var a=this.groupClone(this.value.current);if(this.options.slide){var b=this.change;a[0]+=4*b[0],a[1]+=4*b[1]}this.setTargetValue(a)}},callAnimationCallback:function(){var a=this.value.current;this.options.snap&&this.options.steps>1&&(a=this.getClosestSteps(a)),this.groupCompare(a,this.value.prev)||("function"==typeof this.options.animationCallback&&this.options.animationCallback.call(this,a[0],a[1]),this.groupCopy(this.value.prev,a))},callTargetCallback:function(){"function"==typeof this.options.callback&&this.options.callback.call(this,this.value.target[0],this.value.target[1])},animate:function(a,b){if(!a||this.dragging){if(this.dragging){var c=this.groupClone(this.value.target),d=[g.x-this.offset.wrapper[0]-this.offset.mouse[0],g.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetValueByOffset(d,this.options.loose),this.change=[this.value.target[0]-c[0],this.value.target[1]-c[1]]}(this.dragging||b)&&this.groupCopy(this.value.current,this.value.target),(this.dragging||this.glide()||b)&&(this.updateOffsetFromValue(),this.callAnimationCallback())}},glide:function(){var a=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];return a[0]||a[1]?(Math.abs(a[0])>this.valuePrecision[0]||Math.abs(a[1])>this.valuePrecision[1]?(this.value.current[0]+=a[0]*this.options.speed,this.value.current[1]+=a[1]*this.options.speed):this.groupCopy(this.value.current,this.value.target),!0):!1},updateOffsetFromValue:function(){this.offset.current=this.getOffsetsByRatios(this.options.snap?this.getClosestSteps(this.value.current):this.value.current),this.groupCompare(this.offset.current,this.offset.prev)||(this.renderHandlePosition(),this.groupCopy(this.offset.prev,this.offset.current))},renderHandlePosition:function(){this.options.horizontal&&(this.handle.style.left=String(this.offset.current[0])+"px"),this.options.vertical&&(this.handle.style.top=String(this.offset.current[1])+"px")},setTargetValue:function(a,b){var c=b?this.getLooseValue(a):this.getProperValue(a);this.groupCopy(this.value.target,c),this.offset.target=this.getOffsetsByRatios(c),this.callTargetCallback()},setTargetValueByOffset:function(a,b){var c=this.getRatiosByOffsets(a),d=b?this.getLooseValue(c):this.getProperValue(c);this.groupCopy(this.value.target,d),this.offset.target=this.getOffsetsByRatios(d)},getLooseValue:function(a){var b=this.getProperValue(a);return[b[0]+(a[0]-b[0])/4,b[1]+(a[1]-b[1])/4]},getProperValue:function(a){var b=this.groupClone(a);return b[0]=Math.max(b[0],0),b[1]=Math.max(b[1],0),b[0]=Math.min(b[0],1),b[1]=Math.min(b[1],1),(!this.dragging&&!this.tapping||this.options.snap)&&this.options.steps>1&&(b=this.getClosestSteps(b)),b},getRatiosByOffsets:function(a){return[this.getRatioByOffset(a[0],this.bounds.availWidth,this.bounds.left),this.getRatioByOffset(a[1],this.bounds.availHeight,this.bounds.top)]},getRatioByOffset:function(a,b,c){return b?(a-c)/b:0},getOffsetsByRatios:function(a){return[this.getOffsetByRatio(a[0],this.bounds.availWidth,this.bounds.left),this.getOffsetByRatio(a[1],this.bounds.availHeight,this.bounds.top)]},getOffsetByRatio:function(a,b,c){return Math.round(a*b)+c},getStepNumber:function(a){return this.getClosestStep(a)*(this.options.steps-1)+1},getClosestSteps:function(a){return[this.getClosestStep(a[0]),this.getClosestStep(a[1])]},getClosestStep:function(a){for(var b=0,c=1,d=0;d<=this.options.steps-1;d++)Math.abs(this.stepRatios[d]-a)<c&&(c=Math.abs(this.stepRatios[d]-a),b=d);return this.stepRatios[b]},groupCompare:function(a,b){return a[0]==b[0]&&a[1]==b[1]},groupCopy:function(a,b){a[0]=b[0],a[1]=b[1]},groupClone:function(a){return[a[0],a[1]]},draggingOnDisabledAxis:function(){return!this.options.horizontal&&g.xDiff>g.yDiff||!this.options.vertical&&g.yDiff>g.xDiff}};var b=function(a,b){return function(){return a.apply(b,arguments)}},c=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},d=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)},e=function(a){a||(a=window.event),a.preventDefault&&a.preventDefault(),a.returnValue=!1},f=function(a){a||(a=window.event),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},g={x:0,y:0,xDiff:0,yDiff:0,refresh:function(a){a||(a=window.event),"mousemove"==a.type?this.set(a):a.touches&&this.set(a.touches[0])},set:function(a){var b=this.x,c=this.y;a.pageX||a.pageY?(this.x=a.pageX,this.y=a.pageY):(a.clientX||a.clientY)&&(this.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),this.xDiff=Math.abs(this.x-b),this.yDiff=Math.abs(this.y-c)}},h={get:function(a){var b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return[b,c]}};return a}),ConvexHullGrahamScan.prototype={constructor:ConvexHullGrahamScan,Point:function(a,b){this.x=a,this.y=b},_findPolarAngle:function(a,b){var c=57.295779513082,d=b.x-a.x,e=b.y-a.y;if(0==d&&0==e)return 0;var f=Math.atan2(e,d)*c;return this.reverse?0>=f&&(f+=360):f>=0&&(f+=360),f},addPoint:function(a,b){if(void 0===this.anchorPoint)this.anchorPoint=new this.Point(a,b);else if(this.anchorPoint.y>b||this.anchorPoint.y==b&&this.anchorPoint.x>a)return this.anchorPoint.y=b,this.anchorPoint.x=a,void this.points.unshift(new this.Point(a,b));this.points.push(new this.Point(a,b))},_sortPoints:function(){var a=this;return this.points.sort(function(b,c){var d=a._findPolarAngle(a.anchorPoint,b),e=a._findPolarAngle(a.anchorPoint,c);return e>d?-1:d>e?1:0})},_checkPoints:function(a,b,c){var d,e=this._findPolarAngle(a,b),f=this._findPolarAngle(a,c);return e>f?(d=e-f,!(d>180)):f>e?(d=f-e,d>180):!1},getHull:function(){var a,b,c=[];if(this.reverse=this.points.every(function(a){return a.x<0&&a.y<0}),a=this._sortPoints(),b=a.length,4>b)return a;for(c.push(a.shift(),a.shift());;){var d,e,f;if(c.push(a.shift()),d=c[c.length-3],e=c[c.length-2],f=c[c.length-1],this._checkPoints(d,e,f)&&c.splice(c.length-2,1),0==a.length){if(b==c.length)return c;a=c,b=a.length,c=[],c.push(a.shift(),a.shift())}}}},function(){"use strict";function a(a,b,c){cb.biginteger_used=1,null!=a&&("number"==typeof a&&"undefined"==typeof b?this.fromInt(a):"number"==typeof a?this.fromNumber(a,b,c):null==b&&"string"!=typeof a?this.fromString(a,256):this.fromString(a,b))}function b(){return new a(null)}function c(a,b,c,d,e,f){for(;--f>=0;){var g=b*this[a++]+c[d]+e;e=Math.floor(g/67108864),c[d++]=67108863&g}return e}function d(a,b,c,d,e,f){for(var g=32767&b,h=b>>15;--f>=0;){var i=32767&this[a],j=this[a++]>>15,k=h*i+j*g;i=g*i+((32767&k)<<15)+c[d]+(1073741823&e),e=(i>>>30)+(k>>>15)+h*j+(e>>>30),c[d++]=1073741823&i}return e}function e(a,b,c,d,e,f){for(var g=16383&b,h=b>>14;--f>=0;){var i=16383&this[a],j=this[a++]>>14,k=h*i+j*g;i=g*i+((16383&k)<<14)+c[d]+e,e=(i>>28)+(k>>14)+h*j,c[d++]=268435455&i}return e}function f(a){return nb.charAt(a)}function g(a,b){var c=ob[a.charCodeAt(b)];return null==c?-1:c}function h(a){for(var b=this.t-1;b>=0;--b)a[b]=this[b];a.t=this.t,a.s=this.s}function i(a){this.t=1,this.s=0>a?-1:0,a>0?this[0]=a:-1>a?this[0]=a+this.DV:this.t=0}function j(a){var c=b();return c.fromInt(a),c}function k(b,c){var d;if(16==c)d=4;else if(8==c)d=3;else if(256==c)d=8;else if(2==c)d=1;else if(32==c)d=5;else{if(4!=c)return void this.fromRadix(b,c);d=2}this.t=0,this.s=0;for(var e=b.length,f=!1,h=0;--e>=0;){var i=8==d?255&b[e]:g(b,e);0>i?"-"==b.charAt(e)&&(f=!0):(f=!1,0==h?this[this.t++]=i:h+d>this.DB?(this[this.t-1]|=(i&(1<<this.DB-h)-1)<<h,this[this.t++]=i>>this.DB-h):this[this.t-1]|=i<<h,h+=d,h>=this.DB&&(h-=this.DB))}8==d&&0!=(128&b[0])&&(this.s=-1,h>0&&(this[this.t-1]|=(1<<this.DB-h)-1<<h)),this.clamp(),f&&a.ZERO.subTo(this,this)}function l(){for(var a=this.s&this.DM;this.t>0&&this[this.t-1]==a;)--this.t}function m(a){if(this.s<0)return"-"+this.negate().toString(a);var b;if(16==a)b=4;else if(8==a)b=3;else if(2==a)b=1;else if(32==a)b=5;else{if(4!=a)return this.toRadix(a);b=2}var c,d=(1<<b)-1,e=!1,g="",h=this.t,i=this.DB-h*this.DB%b;if(h-->0)for(i<this.DB&&(c=this[h]>>i)>0&&(e=!0,g=f(c));h>=0;)b>i?(c=(this[h]&(1<<i)-1)<<b-i,c|=this[--h]>>(i+=this.DB-b)):(c=this[h]>>(i-=b)&d,0>=i&&(i+=this.DB,--h)),c>0&&(e=!0),e&&(g+=f(c));return e?g:"0"}function n(){var c=b();return a.ZERO.subTo(this,c),c}function o(){return this.s<0?this.negate():this}function p(a){var b=this.s-a.s;if(0!=b)return b;var c=this.t;if(b=c-a.t,0!=b)return this.s<0?-b:b;for(;--c>=0;)if(0!=(b=this[c]-a[c]))return b;return 0}function q(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function r(){return this.t<=0?0:this.DB*(this.t-1)+q(this[this.t-1]^this.s&this.DM)}function s(a,b){var c;for(c=this.t-1;c>=0;--c)b[c+a]=this[c];for(c=a-1;c>=0;--c)b[c]=0;b.t=this.t+a,b.s=this.s}function t(a,b){for(var c=a;c<this.t;++c)b[c-a]=this[c];b.t=Math.max(this.t-a,0),b.s=this.s}function u(a,b){var c,d=a%this.DB,e=this.DB-d,f=(1<<e)-1,g=Math.floor(a/this.DB),h=this.s<<d&this.DM;for(c=this.t-1;c>=0;--c)b[c+g+1]=this[c]>>e|h,h=(this[c]&f)<<d;for(c=g-1;c>=0;--c)b[c]=0;b[g]=h,b.t=this.t+g+1,b.s=this.s,b.clamp()}function v(a,b){b.s=this.s;var c=Math.floor(a/this.DB);if(c>=this.t)return void(b.t=0);var d=a%this.DB,e=this.DB-d,f=(1<<d)-1;b[0]=this[c]>>d;for(var g=c+1;g<this.t;++g)b[g-c-1]|=(this[g]&f)<<e,b[g-c]=this[g]>>d;d>0&&(b[this.t-c-1]|=(this.s&f)<<e),b.t=this.t-c,b.clamp()}function w(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]-a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d-=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d-=a[c],b[c++]=d&this.DM,d>>=this.DB;d-=a.s}b.s=0>d?-1:0,-1>d?b[c++]=this.DV+d:d>0&&(b[c++]=d),b.t=c,b.clamp()}function x(b,c){var d=this.abs(),e=b.abs(),f=d.t;for(c.t=f+e.t;--f>=0;)c[f]=0;for(f=0;f<e.t;++f)c[f+d.t]=d.am(0,e[f],c,f,0,d.t);c.s=0,c.clamp(),this.s!=b.s&&a.ZERO.subTo(c,c)}function y(a){for(var b=this.abs(),c=a.t=2*b.t;--c>=0;)a[c]=0;for(c=0;c<b.t-1;++c){var d=b.am(c,b[c],a,2*c,0,1);(a[c+b.t]+=b.am(c+1,2*b[c],a,2*c+1,d,b.t-c-1))>=b.DV&&(a[c+b.t]-=b.DV,a[c+b.t+1]=1)}a.t>0&&(a[a.t-1]+=b.am(c,b[c],a,2*c,0,1)),a.s=0,a.clamp()}function z(c,d,e){var f=c.abs();if(!(f.t<=0)){var g=this.abs();if(g.t<f.t)return null!=d&&d.fromInt(0),void(null!=e&&this.copyTo(e));null==e&&(e=b());var h=b(),i=this.s,j=c.s,k=this.DB-q(f[f.t-1]);k>0?(f.lShiftTo(k,h),g.lShiftTo(k,e)):(f.copyTo(h),g.copyTo(e));var l=h.t,m=h[l-1];if(0!=m){var n=m*(1<<this.F1)+(l>1?h[l-2]>>this.F2:0),o=this.FV/n,p=(1<<this.F1)/n,r=1<<this.F2,s=e.t,t=s-l,u=null==d?b():d;for(h.dlShiftTo(t,u),e.compareTo(u)>=0&&(e[e.t++]=1,e.subTo(u,e)),a.ONE.dlShiftTo(l,u),u.subTo(h,h);h.t<l;)h[h.t++]=0;for(;--t>=0;){var v=e[--s]==m?this.DM:Math.floor(e[s]*o+(e[s-1]+r)*p);if((e[s]+=h.am(0,v,e,t,0,l))<v)for(h.dlShiftTo(t,u),e.subTo(u,e);e[s]<--v;)e.subTo(u,e)}null!=d&&(e.drShiftTo(l,d),i!=j&&a.ZERO.subTo(d,d)),e.t=l,e.clamp(),k>0&&e.rShiftTo(k,e),0>i&&a.ZERO.subTo(e,e)}}}function A(c){var d=b();return this.abs().divRemTo(c,null,d),this.s<0&&d.compareTo(a.ZERO)>0&&c.subTo(d,d),d}function B(a){this.m=a}function C(a){return a.s<0||a.compareTo(this.m)>=0?a.mod(this.m):a}function D(a){return a}function E(a){a.divRemTo(this.m,null,a)}function F(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function G(a,b){a.squareTo(b),this.reduce(b)}function H(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return b=b*(2-(15&a)*b)&15,b=b*(2-(255&a)*b)&255,b=b*(2-((65535&a)*b&65535))&65535,b=b*(2-a*b%this.DV)%this.DV,b>0?this.DV-b:-b}function I(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function J(c){var d=b();return c.abs().dlShiftTo(this.m.t,d),d.divRemTo(this.m,null,d),c.s<0&&d.compareTo(a.ZERO)>0&&this.m.subTo(d,d),d}function K(a){var c=b();return a.copyTo(c),this.reduce(c),c}function L(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var b=0;b<this.m.t;++b){var c=32767&a[b],d=c*this.mpl+((c*this.mph+(a[b]>>15)*this.mpl&this.um)<<15)&a.DM;for(c=b+this.m.t,a[c]+=this.m.am(0,d,a,b,0,this.m.t);a[c]>=a.DV;)a[c]-=a.DV,a[++c]++}a.clamp(),a.drShiftTo(this.m.t,a),a.compareTo(this.m)>=0&&a.subTo(this.m,a)}function M(a,b){a.squareTo(b),this.reduce(b)}function N(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function O(){return 0==(this.t>0?1&this[0]:this.s)}function P(c,d){if(c>4294967295||1>c)return a.ONE;var e=b(),f=b(),g=d.convert(this),h=q(c)-1;for(g.copyTo(e);--h>=0;)if(d.sqrTo(e,f),(c&1<<h)>0)d.mulTo(f,g,e);else{var i=e;e=f,f=i}return d.revert(e)}function Q(a,b){var c;return c=256>a||b.isEven()?new B(b):new I(b),this.exp(a,c)}function R(){var a=b();return this.copyTo(a),a}function S(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function T(){return 0==this.t?this.s:this[0]<<24>>24}function U(){return 0==this.t?this.s:this[0]<<16>>16}function V(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function W(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function X(a){if(null==a&&(a=10),0==this.signum()||2>a||a>36)return"0";var c=this.chunkSize(a),d=Math.pow(a,c),e=j(d),f=b(),g=b(),h="";for(this.divRemTo(e,f,g);f.signum()>0;)h=(d+g.intValue()).toString(a).substr(1)+h,f.divRemTo(e,f,g);return g.intValue().toString(a)+h}function Y(b,c){this.fromInt(0),null==c&&(c=10);for(var d=this.chunkSize(c),e=Math.pow(c,d),f=!1,h=0,i=0,j=0;j<b.length;++j){var k=g(b,j);0>k?"-"==b.charAt(j)&&0==this.signum()&&(f=!0):(i=c*i+k,++h>=d&&(this.dMultiply(e),this.dAddOffset(i,0),h=0,i=0))}h>0&&(this.dMultiply(Math.pow(c,h)),this.dAddOffset(i,0)),f&&a.ZERO.subTo(this,this)}function Z(b,c,d){if("number"==typeof c)if(2>b)this.fromInt(1);else for(this.fromNumber(b,d),this.testBit(b-1)||this.bitwiseTo(a.ONE.shiftLeft(b-1),fa,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(c);)this.dAddOffset(2,0),this.bitLength()>b&&this.subTo(a.ONE.shiftLeft(b-1),this);else{var e=new Array,f=7&b;e.length=(b>>3)+1,c.nextBytes(e),f>0?e[0]&=(1<<f)-1:e[0]=0,this.fromString(e,256)}}function $(){var a=this.t,b=new Array;b[0]=this.s;var c,d=this.DB-a*this.DB%8,e=0;if(a-->0)for(d<this.DB&&(c=this[a]>>d)!=(this.s&this.DM)>>d&&(b[e++]=c|this.s<<this.DB-d);a>=0;)8>d?(c=(this[a]&(1<<d)-1)<<8-d,c|=this[--a]>>(d+=this.DB-8)):(c=this[a]>>(d-=8)&255,0>=d&&(d+=this.DB,--a)),0!=(128&c)&&(c|=-256),0==e&&(128&this.s)!=(128&c)&&++e,(e>0||c!=this.s)&&(b[e++]=c);return b}function _(a){return 0==this.compareTo(a)}function aa(a){return this.compareTo(a)<0?this:a}function ba(a){return this.compareTo(a)>0?this:a}function ca(a,b,c){var d,e,f=Math.min(a.t,this.t);for(d=0;f>d;++d)c[d]=b(this[d],a[d]);if(a.t<this.t){for(e=a.s&this.DM,d=f;d<this.t;++d)c[d]=b(this[d],e);c.t=this.t}else{for(e=this.s&this.DM,d=f;d<a.t;++d)c[d]=b(e,a[d]);c.t=a.t}c.s=b(this.s,a.s),c.clamp()}function da(a,b){return a&b}function ea(a){var c=b();return this.bitwiseTo(a,da,c),c}function fa(a,b){return a|b}function ga(a){var c=b();return this.bitwiseTo(a,fa,c),c}function ha(a,b){return a^b}function ia(a){var c=b();return this.bitwiseTo(a,ha,c),c}function ja(a,b){return a&~b}function ka(a){var c=b();return this.bitwiseTo(a,ja,c),c}function la(){for(var a=b(),c=0;c<this.t;++c)a[c]=this.DM&~this[c];return a.t=this.t,a.s=~this.s,a}function ma(a){var c=b();return 0>a?this.rShiftTo(-a,c):this.lShiftTo(a,c),c}function na(a){var c=b();return 0>a?this.lShiftTo(-a,c):this.rShiftTo(a,c),c}function oa(a){if(0==a)return-1;var b=0;return 0==(65535&a)&&(a>>=16,b+=16),0==(255&a)&&(a>>=8,b+=8),0==(15&a)&&(a>>=4,b+=4),0==(3&a)&&(a>>=2,b+=2),0==(1&a)&&++b,b}function pa(){for(var a=0;a<this.t;++a)if(0!=this[a])return a*this.DB+oa(this[a]);return this.s<0?this.t*this.DB:-1}function qa(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function ra(){for(var a=0,b=this.s&this.DM,c=0;c<this.t;++c)a+=qa(this[c]^b);return a}function sa(a){var b=Math.floor(a/this.DB);return b>=this.t?0!=this.s:0!=(this[b]&1<<a%this.DB)}function ta(b,c){var d=a.ONE.shiftLeft(b);return this.bitwiseTo(d,c,d),d}function ua(a){return this.changeBit(a,fa)}function va(a){return this.changeBit(a,ja)}function wa(a){return this.changeBit(a,ha)}function xa(a,b){for(var c=0,d=0,e=Math.min(a.t,this.t);e>c;)d+=this[c]+a[c],b[c++]=d&this.DM,d>>=this.DB;if(a.t<this.t){for(d+=a.s;c<this.t;)d+=this[c],b[c++]=d&this.DM,d>>=this.DB;d+=this.s}else{for(d+=this.s;c<a.t;)d+=a[c],b[c++]=d&this.DM,d>>=this.DB;d+=a.s}b.s=0>d?-1:0,d>0?b[c++]=d:-1>d&&(b[c++]=this.DV+d),b.t=c,b.clamp()}function ya(a){var c=b();return this.addTo(a,c),c}function za(a){var c=b();return this.subTo(a,c),c}function Aa(a){var c=b();return this.multiplyTo(a,c),c}function Ba(){var a=b();return this.squareTo(a),a}function Ca(a){var c=b();return this.divRemTo(a,c,null),c}function Da(a){var c=b();return this.divRemTo(a,null,c),c}function Ea(a){var c=b(),d=b();return this.divRemTo(a,c,d),new Array(c,d)}function Fa(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function Ga(a,b){if(0!=a){for(;this.t<=b;)this[this.t++]=0;for(this[b]+=a;this[b]>=this.DV;)this[b]-=this.DV,++b>=this.t&&(this[this.t++]=0),++this[b]}}function Ha(){}function Ia(a){return a}function Ja(a,b,c){a.multiplyTo(b,c)}function Ka(a,b){a.squareTo(b)}function La(a){return this.exp(a,new Ha)}function Ma(a,b,c){var d=Math.min(this.t+a.t,b);for(c.s=0,c.t=d;d>0;)c[--d]=0;var e;for(e=c.t-this.t;e>d;++d)c[d+this.t]=this.am(0,a[d],c,d,0,this.t);for(e=Math.min(a.t,b);e>d;++d)this.am(0,a[d],c,d,0,b-d);c.clamp()}function Na(a,b,c){--b;var d=c.t=this.t+a.t-b;for(c.s=0;--d>=0;)c[d]=0;for(d=Math.max(b-this.t,0);d<a.t;++d)c[this.t+d-b]=this.am(b-d,a[d],c,0,0,this.t+d-b);c.clamp(),c.drShiftTo(1,c)}function Oa(c){this.r2=b(),this.q3=b(),a.ONE.dlShiftTo(2*c.t,this.r2),this.mu=this.r2.divide(c),this.m=c}function Pa(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var c=b();return a.copyTo(c),this.reduce(c),c}function Qa(a){return a}function Ra(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);a.compareTo(this.m)>=0;)a.subTo(this.m,a)}function Sa(a,b){a.squareTo(b),this.reduce(b)}function Ta(a,b,c){a.multiplyTo(b,c),this.reduce(c)}function Ua(a,c){var d,e,f=a.bitLength(),g=j(1);if(0>=f)return g;d=18>f?1:48>f?3:144>f?4:768>f?5:6,e=8>f?new B(c):c.isEven()?new Oa(c):new I(c);var h=new Array,i=3,k=d-1,l=(1<<d)-1;if(h[1]=e.convert(this),d>1){var m=b();for(e.sqrTo(h[1],m);l>=i;)h[i]=b(),e.mulTo(m,h[i-2],h[i]),i+=2}var n,o,p=a.t-1,r=!0,s=b();for(f=q(a[p])-1;p>=0;){for(f>=k?n=a[p]>>f-k&l:(n=(a[p]&(1<<f+1)-1)<<k-f,p>0&&(n|=a[p-1]>>this.DB+f-k)),i=d;0==(1&n);)n>>=1,--i;if((f-=i)<0&&(f+=this.DB,--p),r)h[n].copyTo(g),r=!1;else{for(;i>1;)e.sqrTo(g,s),e.sqrTo(s,g),i-=2;i>0?e.sqrTo(g,s):(o=g,g=s,s=o),e.mulTo(s,h[n],g)}for(;p>=0&&0==(a[p]&1<<f);)e.sqrTo(g,s),o=g,g=s,s=o,--f<0&&(f=this.DB-1,--p)}return e.revert(g)}function Va(a){var b=this.s<0?this.negate():this.clone(),c=a.s<0?a.negate():a.clone();if(b.compareTo(c)<0){var d=b;b=c,c=d}var e=b.getLowestSetBit(),f=c.getLowestSetBit();if(0>f)return b;for(f>e&&(f=e),f>0&&(b.rShiftTo(f,b),c.rShiftTo(f,c));b.signum()>0;)(e=b.getLowestSetBit())>0&&b.rShiftTo(e,b),(e=c.getLowestSetBit())>0&&c.rShiftTo(e,c),b.compareTo(c)>=0?(b.subTo(c,b),b.rShiftTo(1,b)):(c.subTo(b,c),c.rShiftTo(1,c));return f>0&&c.lShiftTo(f,c),c}function Wa(a){if(0>=a)return 0;var b=this.DV%a,c=this.s<0?a-1:0;if(this.t>0)if(0==b)c=this[0]%a;else for(var d=this.t-1;d>=0;--d)c=(b*c+this[d])%a;return c}function Xa(b){var c=b.isEven();if(this.isEven()&&c||0==b.signum())return a.ZERO;for(var d=b.clone(),e=this.clone(),f=j(1),g=j(0),h=j(0),i=j(1);0!=d.signum();){for(;d.isEven();)d.rShiftTo(1,d),c?(f.isEven()&&g.isEven()||(f.addTo(this,f),g.subTo(b,g)),f.rShiftTo(1,f)):g.isEven()||g.subTo(b,g),g.rShiftTo(1,g);for(;e.isEven();)e.rShiftTo(1,e),c?(h.isEven()&&i.isEven()||(h.addTo(this,h),i.subTo(b,i)),h.rShiftTo(1,h)):i.isEven()||i.subTo(b,i),i.rShiftTo(1,i);d.compareTo(e)>=0?(d.subTo(e,d),c&&f.subTo(h,f),g.subTo(i,g)):(e.subTo(d,e),c&&h.subTo(f,h),i.subTo(g,i))}return 0!=e.compareTo(a.ONE)?a.ZERO:i.compareTo(b)>=0?i.subtract(b):i.signum()<0?(i.addTo(b,i),i.signum()<0?i.add(b):i):i}function Ya(a){var b,c=this.abs();if(1==c.t&&c[0]<=pb[pb.length-1]){for(b=0;b<pb.length;++b)if(c[0]==pb[b])return!0;return!1}if(c.isEven())return!1;for(b=1;b<pb.length;){for(var d=pb[b],e=b+1;e<pb.length&&qb>d;)d*=pb[e++];for(d=c.modInt(d);e>b;)if(d%pb[b++]==0)return!1}return c.millerRabin(a)}function Za(c){var d=this.subtract(a.ONE),e=d.getLowestSetBit();if(0>=e)return!1;var f=d.shiftRight(e);c=c+1>>1,c>pb.length&&(c=pb.length);for(var g=b(),h=0;c>h;++h){g.fromInt(pb[Math.floor(Math.random()*pb.length)]);var i=g.modPow(f,this);if(0!=i.compareTo(a.ONE)&&0!=i.compareTo(d)){for(var j=1;j++<e&&0!=i.compareTo(d);)if(i=i.modPowInt(2,this),0==i.compareTo(a.ONE))return!1;if(0!=i.compareTo(d))return!1}}return!0}var $a=!1,_a=!1,ab=!0,bb=!1,cb={},db=!1;"undefined"!=typeof module&&module.exports?(module.exports=cb,db=!0):"undefined"!=typeof document?window.ClipperLib=cb:self.ClipperLib=cb;var eb;if(db){var fb="chrome";eb="Netscape"}else{var fb=navigator.userAgent.toString().toLowerCase();eb=navigator.appName}var gb={};gb.chrome=-1!=fb.indexOf("chrome")&&-1==fb.indexOf("chromium")?1:0,gb.chromium=-1!=fb.indexOf("chromium")?1:0,gb.safari=-1!=fb.indexOf("safari")&&-1==fb.indexOf("chrome")&&-1==fb.indexOf("chromium")?1:0,gb.firefox=-1!=fb.indexOf("firefox")?1:0,gb.firefox17=-1!=fb.indexOf("firefox/17")?1:0,gb.firefox15=-1!=fb.indexOf("firefox/15")?1:0,gb.firefox3=-1!=fb.indexOf("firefox/3")?1:0,gb.opera=-1!=fb.indexOf("opera")?1:0,gb.msie10=-1!=fb.indexOf("msie 10")?1:0,gb.msie9=-1!=fb.indexOf("msie 9")?1:0,gb.msie8=-1!=fb.indexOf("msie 8")?1:0,gb.msie7=-1!=fb.indexOf("msie 7")?1:0,gb.msie=-1!=fb.indexOf("msie ")?1:0,cb.biginteger_used=null;var hb,ib=0xdeadbeefcafe,jb=15715070==(16777215&ib);jb&&"Microsoft Internet Explorer"==eb?(a.prototype.am=d,hb=30):jb&&"Netscape"!=eb?(a.prototype.am=c,hb=26):(a.prototype.am=e,hb=28),a.prototype.DB=hb,a.prototype.DM=(1<<hb)-1,a.prototype.DV=1<<hb;var kb=52;a.prototype.FV=Math.pow(2,kb),a.prototype.F1=kb-hb,a.prototype.F2=2*hb-kb;var lb,mb,nb="0123456789abcdefghijklmnopqrstuvwxyz",ob=new Array;for(lb="0".charCodeAt(0),mb=0;9>=mb;++mb)ob[lb++]=mb;for(lb="a".charCodeAt(0),mb=10;36>mb;++mb)ob[lb++]=mb;for(lb="A".charCodeAt(0),mb=10;36>mb;++mb)ob[lb++]=mb;B.prototype.convert=C,B.prototype.revert=D,B.prototype.reduce=E,B.prototype.mulTo=F,B.prototype.sqrTo=G,I.prototype.convert=J,I.prototype.revert=K,I.prototype.reduce=L,I.prototype.mulTo=N,I.prototype.sqrTo=M,a.prototype.copyTo=h,a.prototype.fromInt=i,a.prototype.fromString=k,a.prototype.clamp=l,a.prototype.dlShiftTo=s,a.prototype.drShiftTo=t,a.prototype.lShiftTo=u,a.prototype.rShiftTo=v,a.prototype.subTo=w,a.prototype.multiplyTo=x,a.prototype.squareTo=y,a.prototype.divRemTo=z,a.prototype.invDigit=H,a.prototype.isEven=O,a.prototype.exp=P,a.prototype.toString=m,a.prototype.negate=n,a.prototype.abs=o,a.prototype.compareTo=p,a.prototype.bitLength=r,a.prototype.mod=A,a.prototype.modPowInt=Q,a.ZERO=j(0),a.ONE=j(1),Ha.prototype.convert=Ia,Ha.prototype.revert=Ia,Ha.prototype.mulTo=Ja,Ha.prototype.sqrTo=Ka,Oa.prototype.convert=Pa,Oa.prototype.revert=Qa,Oa.prototype.reduce=Ra,Oa.prototype.mulTo=Ta,Oa.prototype.sqrTo=Sa;var pb=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],qb=(1<<26)/pb[pb.length-1];a.prototype.chunkSize=V,a.prototype.toRadix=X,a.prototype.fromRadix=Y,a.prototype.fromNumber=Z,a.prototype.bitwiseTo=ca,a.prototype.changeBit=ta,a.prototype.addTo=xa,a.prototype.dMultiply=Fa,a.prototype.dAddOffset=Ga,a.prototype.multiplyLowerTo=Ma,a.prototype.multiplyUpperTo=Na,a.prototype.modInt=Wa,a.prototype.millerRabin=Za,a.prototype.clone=R,a.prototype.intValue=S,a.prototype.byteValue=T,a.prototype.shortValue=U,a.prototype.signum=W,a.prototype.toByteArray=$,a.prototype.equals=_,a.prototype.min=aa,a.prototype.max=ba,a.prototype.and=ea,a.prototype.or=ga,a.prototype.xor=ia,a.prototype.andNot=ka,a.prototype.not=la,a.prototype.shiftLeft=ma,
a.prototype.shiftRight=na,a.prototype.getLowestSetBit=pa,a.prototype.bitCount=ra,a.prototype.testBit=sa,a.prototype.setBit=ua,a.prototype.clearBit=va,a.prototype.flipBit=wa,a.prototype.add=ya,a.prototype.subtract=za,a.prototype.multiply=Aa,a.prototype.divide=Ca,a.prototype.remainder=Da,a.prototype.divideAndRemainder=Ea,a.prototype.modPow=Ua,a.prototype.modInverse=Xa,a.prototype.pow=La,a.prototype.gcd=Va,a.prototype.isProbablePrime=Ya,a.prototype.square=Ba;var rb=a;if(rb.prototype.IsNegative=function(){return-1==this.compareTo(rb.ZERO)?!0:!1},rb.op_Equality=function(a,b){return 0==a.compareTo(b)?!0:!1},rb.op_Inequality=function(a,b){return 0!=a.compareTo(b)?!0:!1},rb.op_GreaterThan=function(a,b){return a.compareTo(b)>0?!0:!1},rb.op_LessThan=function(a,b){return a.compareTo(b)<0?!0:!1},rb.op_Addition=function(a,b){return new rb(a).add(new rb(b))},rb.op_Subtraction=function(a,b){return new rb(a).subtract(new rb(b))},rb.Int128Mul=function(a,b){return new rb(a).multiply(new rb(b))},rb.op_Division=function(a,b){return a.divide(b)},rb.prototype.ToDouble=function(){return parseFloat(this.toString())},"undefined"==typeof sb)var sb=function(a,b){var c;if("undefined"==typeof Object.getOwnPropertyNames){for(c in b.prototype)("undefined"==typeof a.prototype[c]||a.prototype[c]==Object.prototype[c])&&(a.prototype[c]=b.prototype[c]);for(c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);a.$baseCtor=b}else{for(var d=Object.getOwnPropertyNames(b.prototype),e=0;e<d.length;e++)"undefined"==typeof Object.getOwnPropertyDescriptor(a.prototype,d[e])&&Object.defineProperty(a.prototype,d[e],Object.getOwnPropertyDescriptor(b.prototype,d[e]));for(c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);a.$baseCtor=b}};cb.Path=function(){return[]},cb.Paths=function(){return[]},cb.DoublePoint=function(){var a=arguments;this.X=0,this.Y=0,1==a.length?(this.X=a[0].X,this.Y=a[0].Y):2==a.length&&(this.X=a[0],this.Y=a[1])},cb.DoublePoint0=function(){this.X=0,this.Y=0},cb.DoublePoint1=function(a){this.X=a.X,this.Y=a.Y},cb.DoublePoint2=function(a,b){this.X=a,this.Y=b},cb.PolyNode=function(){this.m_Parent=null,this.m_polygon=new cb.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},cb.PolyNode.prototype.IsHoleNode=function(){for(var a=!0,b=this.m_Parent;null!==b;)a=!a,b=b.m_Parent;return a},cb.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},cb.PolyNode.prototype.Contour=function(){return this.m_polygon},cb.PolyNode.prototype.AddChild=function(a){var b=this.m_Childs.length;this.m_Childs.push(a),a.m_Parent=this,a.m_Index=b},cb.PolyNode.prototype.GetNext=function(){return this.m_Childs.length>0?this.m_Childs[0]:this.GetNextSiblingUp()},cb.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},cb.PolyNode.prototype.Childs=function(){return this.m_Childs},cb.PolyNode.prototype.Parent=function(){return this.m_Parent},cb.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},cb.PolyTree=function(){this.m_AllPolys=[],cb.PolyNode.call(this)},cb.PolyTree.prototype.Clear=function(){for(var a=0,b=this.m_AllPolys.length;b>a;a++)this.m_AllPolys[a]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},cb.PolyTree.prototype.GetFirst=function(){return this.m_Childs.length>0?this.m_Childs[0]:null},cb.PolyTree.prototype.Total=function(){return this.m_AllPolys.length},sb(cb.PolyTree,cb.PolyNode),cb.Math_Abs_Int64=cb.Math_Abs_Int32=cb.Math_Abs_Double=function(a){return Math.abs(a)},cb.Math_Max_Int32_Int32=function(a,b){return Math.max(a,b)},cb.Cast_Int32=gb.msie||gb.opera||gb.safari?function(a){return 0|a}:function(a){return~~a},cb.Cast_Int64=gb.chrome?function(a){return-2147483648>a||a>2147483647?0>a?Math.ceil(a):Math.floor(a):~~a}:gb.firefox&&"function"==typeof Number.toInteger?function(a){return Number.toInteger(a)}:gb.msie7||gb.msie8?function(a){return parseInt(a,10)}:gb.msie?function(a){return-2147483648>a||a>2147483647?0>a?Math.ceil(a):Math.floor(a):0|a}:function(a){return 0>a?Math.ceil(a):Math.floor(a)},cb.Clear=function(a){a.length=0},cb.PI=3.141592653589793,cb.PI2=6.283185307179586,cb.IntPoint=function(){var a=arguments,b=a.length;if(this.X=0,this.Y=0,_a)if(this.Z=0,3==b)this.X=a[0],this.Y=a[1],this.Z=a[2];else if(2==b)this.X=a[0],this.Y=a[1],this.Z=0;else if(1==b)if(a[0]instanceof cb.DoublePoint){var c=a[0];this.X=cb.Clipper.Round(c.X),this.Y=cb.Clipper.Round(c.Y),this.Z=0}else{var d=a[0];"undefined"==typeof d.Z&&(d.Z=0),this.X=d.X,this.Y=d.Y,this.Z=d.Z}else this.X=0,this.Y=0,this.Z=0;else if(2==b)this.X=a[0],this.Y=a[1];else if(1==b)if(a[0]instanceof cb.DoublePoint){var c=a[0];this.X=cb.Clipper.Round(c.X),this.Y=cb.Clipper.Round(c.Y)}else{var d=a[0];this.X=d.X,this.Y=d.Y}else this.X=0,this.Y=0},cb.IntPoint.op_Equality=function(a,b){return a.X==b.X&&a.Y==b.Y},cb.IntPoint.op_Inequality=function(a,b){return a.X!=b.X||a.Y!=b.Y},_a?(cb.IntPoint0=function(){this.X=0,this.Y=0,this.Z=0},cb.IntPoint1=function(a){this.X=a.X,this.Y=a.Y,this.Z=a.Z},cb.IntPoint1dp=function(a){this.X=cb.Clipper.Round(a.X),this.Y=cb.Clipper.Round(a.Y),this.Z=0},cb.IntPoint2=function(a,b){this.X=a,this.Y=b,this.Z=0},cb.IntPoint3=function(a,b,c){this.X=a,this.Y=b,this.Z=c}):(cb.IntPoint0=function(){this.X=0,this.Y=0},cb.IntPoint1=function(a){this.X=a.X,this.Y=a.Y},cb.IntPoint1dp=function(a){this.X=cb.Clipper.Round(a.X),this.Y=cb.Clipper.Round(a.Y)},cb.IntPoint2=function(a,b){this.X=a,this.Y=b}),cb.IntRect=function(){var a=arguments,b=a.length;4==b?(this.left=a[0],this.top=a[1],this.right=a[2],this.bottom=a[3]):1==b?(this.left=ir.left,this.top=ir.top,this.right=ir.right,this.bottom=ir.bottom):(this.left=0,this.top=0,this.right=0,this.bottom=0)},cb.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},cb.IntRect1=function(a){this.left=a.left,this.top=a.top,this.right=a.right,this.bottom=a.bottom},cb.IntRect4=function(a,b,c,d){this.left=a,this.top=b,this.right=c,this.bottom=d},cb.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},cb.PolyType={ptSubject:0,ptClip:1},cb.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},cb.JoinType={jtSquare:0,jtRound:1,jtMiter:2},cb.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},bb&&(cb.EndType_={etSquare:0,etRound:1,etButt:2,etClosed:3}),cb.EdgeSide={esLeft:0,esRight:1},cb.Direction={dRightToLeft:0,dLeftToRight:1},cb.TEdge=function(){this.Bot=new cb.IntPoint,this.Curr=new cb.IntPoint,this.Top=new cb.IntPoint,this.Delta=new cb.IntPoint,this.Dx=0,this.PolyTyp=cb.PolyType.ptSubject,this.Side=cb.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},cb.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new cb.IntPoint},cb.MyIntersectNodeSort=function(){},cb.MyIntersectNodeSort.Compare=function(a,b){return b.Pt.Y-a.Pt.Y},cb.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},cb.Scanbeam=function(){this.Y=0,this.Next=null},cb.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},cb.OutPt=function(){this.Idx=0,this.Pt=new cb.IntPoint,this.Next=null,this.Prev=null},cb.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new cb.IntPoint},cb.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_MinimaList=null,this.m_CurrentLM=null,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},cb.ClipperBase.horizontal=-9007199254740992,cb.ClipperBase.Skip=-2,cb.ClipperBase.Unassigned=-1,cb.ClipperBase.tolerance=1e-20,$a?(cb.ClipperBase.loRange=46340,cb.ClipperBase.hiRange=46340):(cb.ClipperBase.loRange=47453132,cb.ClipperBase.hiRange=0xfffffffffffff),cb.ClipperBase.near_zero=function(a){return a>-cb.ClipperBase.tolerance&&a<cb.ClipperBase.tolerance},cb.ClipperBase.IsHorizontal=function(a){return 0===a.Delta.Y},cb.ClipperBase.prototype.PointIsVertex=function(a,b){var c=b;do{if(cb.IntPoint.op_Equality(c.Pt,a))return!0;c=c.Next}while(c!=b);return!1},cb.ClipperBase.prototype.PointOnLineSegment=function(a,b,c,d){return d?a.X==b.X&&a.Y==b.Y||a.X==c.X&&a.Y==c.Y||a.X>b.X==a.X<c.X&&a.Y>b.Y==a.Y<c.Y&&rb.op_Equality(rb.Int128Mul(a.X-b.X,c.Y-b.Y),rb.Int128Mul(c.X-b.X,a.Y-b.Y)):a.X==b.X&&a.Y==b.Y||a.X==c.X&&a.Y==c.Y||a.X>b.X==a.X<c.X&&a.Y>b.Y==a.Y<c.Y&&(a.X-b.X)*(c.Y-b.Y)==(c.X-b.X)*(a.Y-b.Y)},cb.ClipperBase.prototype.PointOnPolygon=function(a,b,c){for(var d=b;;){if(this.PointOnLineSegment(a,d.Pt,d.Next.Pt,c))return!0;if(d=d.Next,d==b)break}return!1},cb.ClipperBase.prototype.SlopesEqual=cb.ClipperBase.SlopesEqual=function(){var a,b,c,d,e,f,g,h=arguments,i=h.length;return 3==i?(a=h[0],b=h[1],g=h[2],g?rb.op_Equality(rb.Int128Mul(a.Delta.Y,b.Delta.X),rb.Int128Mul(a.Delta.X,b.Delta.Y)):cb.Cast_Int64(a.Delta.Y*b.Delta.X)==cb.Cast_Int64(a.Delta.X*b.Delta.Y)):4==i?(c=h[0],d=h[1],e=h[2],g=h[3],g?rb.op_Equality(rb.Int128Mul(c.Y-d.Y,d.X-e.X),rb.Int128Mul(c.X-d.X,d.Y-e.Y)):cb.Cast_Int64((c.Y-d.Y)*(d.X-e.X))-cb.Cast_Int64((c.X-d.X)*(d.Y-e.Y))===0):(c=h[0],d=h[1],e=h[2],f=h[3],g=h[4],g?rb.op_Equality(rb.Int128Mul(c.Y-d.Y,e.X-f.X),rb.Int128Mul(c.X-d.X,e.Y-f.Y)):cb.Cast_Int64((c.Y-d.Y)*(e.X-f.X))-cb.Cast_Int64((c.X-d.X)*(e.Y-f.Y))===0)},cb.ClipperBase.SlopesEqual3=function(a,b,c){return c?rb.op_Equality(rb.Int128Mul(a.Delta.Y,b.Delta.X),rb.Int128Mul(a.Delta.X,b.Delta.Y)):cb.Cast_Int64(a.Delta.Y*b.Delta.X)==cb.Cast_Int64(a.Delta.X*b.Delta.Y)},cb.ClipperBase.SlopesEqual4=function(a,b,c,d){return d?rb.op_Equality(rb.Int128Mul(a.Y-b.Y,b.X-c.X),rb.Int128Mul(a.X-b.X,b.Y-c.Y)):cb.Cast_Int64((a.Y-b.Y)*(b.X-c.X))-cb.Cast_Int64((a.X-b.X)*(b.Y-c.Y))===0},cb.ClipperBase.SlopesEqual5=function(a,b,c,d,e){return e?rb.op_Equality(rb.Int128Mul(a.Y-b.Y,c.X-d.X),rb.Int128Mul(a.X-b.X,c.Y-d.Y)):cb.Cast_Int64((a.Y-b.Y)*(c.X-d.X))-cb.Cast_Int64((a.X-b.X)*(c.Y-d.Y))===0},cb.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var a=0,b=this.m_edges.length;b>a;++a){for(var c=0,d=this.m_edges[a].length;d>c;++c)this.m_edges[a][c]=null;cb.Clear(this.m_edges[a])}cb.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},cb.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var a=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=a}this.m_CurrentLM=null},cb.ClipperBase.prototype.RangeTest=function(a,b){b.Value?(a.X>cb.ClipperBase.hiRange||a.Y>cb.ClipperBase.hiRange||-a.X>cb.ClipperBase.hiRange||-a.Y>cb.ClipperBase.hiRange)&&cb.Error("Coordinate outside allowed range in RangeTest()."):(a.X>cb.ClipperBase.loRange||a.Y>cb.ClipperBase.loRange||-a.X>cb.ClipperBase.loRange||-a.Y>cb.ClipperBase.loRange)&&(b.Value=!0,this.RangeTest(a,b))},cb.ClipperBase.prototype.InitEdge=function(a,b,c,d){a.Next=b,a.Prev=c,a.Curr.X=d.X,a.Curr.Y=d.Y,a.OutIdx=-1},cb.ClipperBase.prototype.InitEdge2=function(a,b){a.Curr.Y>=a.Next.Curr.Y?(a.Bot.X=a.Curr.X,a.Bot.Y=a.Curr.Y,a.Top.X=a.Next.Curr.X,a.Top.Y=a.Next.Curr.Y):(a.Top.X=a.Curr.X,a.Top.Y=a.Curr.Y,a.Bot.X=a.Next.Curr.X,a.Bot.Y=a.Next.Curr.Y),this.SetDx(a),a.PolyTyp=b},cb.ClipperBase.prototype.FindNextLocMin=function(a){for(var b;;){for(;cb.IntPoint.op_Inequality(a.Bot,a.Prev.Bot)||cb.IntPoint.op_Equality(a.Curr,a.Top);)a=a.Next;if(a.Dx!=cb.ClipperBase.horizontal&&a.Prev.Dx!=cb.ClipperBase.horizontal)break;for(;a.Prev.Dx==cb.ClipperBase.horizontal;)a=a.Prev;for(b=a;a.Dx==cb.ClipperBase.horizontal;)a=a.Next;if(a.Top.Y!=a.Prev.Bot.Y){b.Prev.Bot.X<a.Bot.X&&(a=b);break}}return a},cb.ClipperBase.prototype.ProcessBound=function(a,b){var c,d,e=a,f=a;if(a.Dx==cb.ClipperBase.horizontal&&(d=b?a.Prev.Bot.X:a.Next.Bot.X,a.Bot.X!=d&&this.ReverseHorizontal(a)),f.OutIdx!=cb.ClipperBase.Skip)if(b){for(;f.Top.Y==f.Next.Bot.Y&&f.Next.OutIdx!=cb.ClipperBase.Skip;)f=f.Next;if(f.Dx==cb.ClipperBase.horizontal&&f.Next.OutIdx!=cb.ClipperBase.Skip){for(c=f;c.Prev.Dx==cb.ClipperBase.horizontal;)c=c.Prev;c.Prev.Top.X==f.Next.Top.X?b||(f=c.Prev):c.Prev.Top.X>f.Next.Top.X&&(f=c.Prev)}for(;a!=f;)a.NextInLML=a.Next,a.Dx==cb.ClipperBase.horizontal&&a!=e&&a.Bot.X!=a.Prev.Top.X&&this.ReverseHorizontal(a),a=a.Next;a.Dx==cb.ClipperBase.horizontal&&a!=e&&a.Bot.X!=a.Prev.Top.X&&this.ReverseHorizontal(a),f=f.Next}else{for(;f.Top.Y==f.Prev.Bot.Y&&f.Prev.OutIdx!=cb.ClipperBase.Skip;)f=f.Prev;if(f.Dx==cb.ClipperBase.horizontal&&f.Prev.OutIdx!=cb.ClipperBase.Skip){for(c=f;c.Next.Dx==cb.ClipperBase.horizontal;)c=c.Next;c.Next.Top.X==f.Prev.Top.X?b||(f=c.Next):c.Next.Top.X>f.Prev.Top.X&&(f=c.Next)}for(;a!=f;)a.NextInLML=a.Prev,a.Dx==cb.ClipperBase.horizontal&&a!=e&&a.Bot.X!=a.Next.Top.X&&this.ReverseHorizontal(a),a=a.Prev;a.Dx==cb.ClipperBase.horizontal&&a!=e&&a.Bot.X!=a.Next.Top.X&&this.ReverseHorizontal(a),f=f.Prev}if(f.OutIdx==cb.ClipperBase.Skip){if(a=f,b){for(;a.Top.Y==a.Next.Bot.Y;)a=a.Next;for(;a!=f&&a.Dx==cb.ClipperBase.horizontal;)a=a.Prev}else{for(;a.Top.Y==a.Prev.Bot.Y;)a=a.Prev;for(;a!=f&&a.Dx==cb.ClipperBase.horizontal;)a=a.Next}if(a==f)f=b?a.Next:a.Prev;else{a=b?f.Next:f.Prev;var g=new cb.LocalMinima;g.Next=null,g.Y=a.Bot.Y,g.LeftBound=null,g.RightBound=a,g.RightBound.WindDelta=0,f=this.ProcessBound(g.RightBound,b),this.InsertLocalMinima(g)}}return f},cb.ClipperBase.prototype.AddPath=function(a,b,c){ab?c||b!=cb.PolyType.ptClip||cb.Error("AddPath: Open paths must be subject."):c||cb.Error("AddPath: Open paths have been disabled.");var d=a.length-1;if(c)for(;d>0&&cb.IntPoint.op_Equality(a[d],a[0]);)--d;for(;d>0&&cb.IntPoint.op_Equality(a[d],a[d-1]);)--d;if(c&&2>d||!c&&1>d)return!1;for(var e=new Array,f=0;d>=f;f++)e.push(new cb.TEdge);var g=!0;e[1].Curr.X=a[1].X,e[1].Curr.Y=a[1].Y;var h={Value:this.m_UseFullRange};this.RangeTest(a[0],h),this.m_UseFullRange=h.Value,h.Value=this.m_UseFullRange,this.RangeTest(a[d],h),this.m_UseFullRange=h.Value,this.InitEdge(e[0],e[1],e[d],a[0]),this.InitEdge(e[d],e[0],e[d-1],a[d]);for(var f=d-1;f>=1;--f)h.Value=this.m_UseFullRange,this.RangeTest(a[f],h),this.m_UseFullRange=h.Value,this.InitEdge(e[f],e[f+1],e[f-1],a[f]);for(var i=e[0],j=i,k=i;;)if(cb.IntPoint.op_Equality(j.Curr,j.Next.Curr)){if(j==j.Next)break;j==i&&(i=j.Next),j=this.RemoveEdge(j),k=j}else{if(j.Prev==j.Next)break;if(!c||!cb.ClipperBase.SlopesEqual(j.Prev.Curr,j.Curr,j.Next.Curr,this.m_UseFullRange)||this.PreserveCollinear&&this.Pt2IsBetweenPt1AndPt3(j.Prev.Curr,j.Curr,j.Next.Curr)){if(j=j.Next,j==k)break}else j==i&&(i=j.Next),j=this.RemoveEdge(j),j=j.Prev,k=j}if(!c&&j==j.Next||c&&j.Prev==j.Next)return!1;c||(this.m_HasOpenPaths=!0,i.Prev.OutIdx=cb.ClipperBase.Skip);j=i;do this.InitEdge2(j,b),j=j.Next,g&&j.Curr.Y!=i.Curr.Y&&(g=!1);while(j!=i);if(g){if(c)return!1;j.Prev.OutIdx=cb.ClipperBase.Skip,j.Prev.Bot.X<j.Prev.Top.X&&this.ReverseHorizontal(j.Prev);var l=new cb.LocalMinima;for(l.Next=null,l.Y=j.Bot.Y,l.LeftBound=null,l.RightBound=j,l.RightBound.Side=cb.EdgeSide.esRight,l.RightBound.WindDelta=0;j.Next.OutIdx!=cb.ClipperBase.Skip;)j.NextInLML=j.Next,j.Bot.X!=j.Prev.Top.X&&this.ReverseHorizontal(j),j=j.Next;return this.InsertLocalMinima(l),this.m_edges.push(e),!0}this.m_edges.push(e);for(var m,n=null;j=this.FindNextLocMin(j),j!=n;){null==n&&(n=j);var l=new cb.LocalMinima;l.Next=null,l.Y=j.Bot.Y,j.Dx<j.Prev.Dx?(l.LeftBound=j.Prev,l.RightBound=j,m=!1):(l.LeftBound=j,l.RightBound=j.Prev,m=!0),l.LeftBound.Side=cb.EdgeSide.esLeft,l.RightBound.Side=cb.EdgeSide.esRight,l.LeftBound.WindDelta=c?l.LeftBound.Next==l.RightBound?-1:1:0,l.RightBound.WindDelta=-l.LeftBound.WindDelta,j=this.ProcessBound(l.LeftBound,m);var o=this.ProcessBound(l.RightBound,!m);l.LeftBound.OutIdx==cb.ClipperBase.Skip?l.LeftBound=null:l.RightBound.OutIdx==cb.ClipperBase.Skip&&(l.RightBound=null),this.InsertLocalMinima(l),m||(j=o)}return!0},cb.ClipperBase.prototype.AddPaths=function(a,b,c){for(var d=!1,e=0,f=a.length;f>e;++e)this.AddPath(a[e],b,c)&&(d=!0);return d},cb.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(a,b,c){return cb.IntPoint.op_Equality(a,c)||cb.IntPoint.op_Equality(a,b)||cb.IntPoint.op_Equality(c,b)?!1:a.X!=c.X?b.X>a.X==b.X<c.X:b.Y>a.Y==b.Y<c.Y},cb.ClipperBase.prototype.RemoveEdge=function(a){a.Prev.Next=a.Next,a.Next.Prev=a.Prev;var b=a.Next;return a.Prev=null,b},cb.ClipperBase.prototype.SetDx=function(a){a.Delta.X=a.Top.X-a.Bot.X,a.Delta.Y=a.Top.Y-a.Bot.Y,a.Dx=0===a.Delta.Y?cb.ClipperBase.horizontal:a.Delta.X/a.Delta.Y},cb.ClipperBase.prototype.InsertLocalMinima=function(a){if(null===this.m_MinimaList)this.m_MinimaList=a;else if(a.Y>=this.m_MinimaList.Y)a.Next=this.m_MinimaList,this.m_MinimaList=a;else{for(var b=this.m_MinimaList;null!==b.Next&&a.Y<b.Next.Y;)b=b.Next;a.Next=b.Next,b.Next=a}},cb.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)},cb.ClipperBase.prototype.ReverseHorizontal=function(a){var b=a.Top.X;a.Top.X=a.Bot.X,a.Bot.X=b,_a&&(b=a.Top.Z,a.Top.Z=a.Bot.Z,a.Bot.Z=b)},cb.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!=this.m_CurrentLM)for(var a=this.m_MinimaList;null!=a;){var b=a.LeftBound;null!=b&&(b.Curr.X=b.Bot.X,b.Curr.Y=b.Bot.Y,b.Side=cb.EdgeSide.esLeft,b.OutIdx=cb.ClipperBase.Unassigned),b=a.RightBound,null!=b&&(b.Curr.X=b.Bot.X,b.Curr.Y=b.Bot.Y,b.Side=cb.EdgeSide.esRight,b.OutIdx=cb.ClipperBase.Unassigned),a=a.Next}},cb.Clipper=function(a){"undefined"==typeof a&&(a=0),this.m_PolyOuts=null,this.m_ClipType=cb.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=cb.PolyFillType.pftEvenOdd,this.m_SubjFillType=cb.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,cb.ClipperBase.call(this),this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=cb.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=0!==(1&a),this.StrictlySimple=0!==(2&a),this.PreserveCollinear=0!==(4&a),_a&&(this.ZFillFunction=null)},cb.Clipper.ioReverseSolution=1,cb.Clipper.ioStrictlySimple=2,cb.Clipper.ioPreserveCollinear=4,cb.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),cb.ClipperBase.prototype.Clear.call(this))},cb.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var a=this.m_Scanbeam.Next;this.m_Scanbeam=null,this.m_Scanbeam=a}},cb.Clipper.prototype.Reset=function(){cb.ClipperBase.prototype.Reset.call(this),this.m_Scanbeam=null,this.m_ActiveEdges=null,this.m_SortedEdges=null;for(var a=this.m_MinimaList;null!==a;)this.InsertScanbeam(a.Y),a=a.Next},cb.Clipper.prototype.InsertScanbeam=function(a){if(null===this.m_Scanbeam)this.m_Scanbeam=new cb.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=a;else if(a>this.m_Scanbeam.Y){var b=new cb.Scanbeam;b.Y=a,b.Next=this.m_Scanbeam,this.m_Scanbeam=b}else{for(var c=this.m_Scanbeam;null!==c.Next&&a<=c.Next.Y;)c=c.Next;if(a==c.Y)return;var b=new cb.Scanbeam;b.Y=a,b.Next=c.Next,c.Next=b}},cb.Clipper.prototype.Execute=function(){var a=arguments,b=a.length,c=a[1]instanceof cb.PolyTree;if(4==b&&!c){var d=a[0],e=a[1],f=a[2],g=a[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&cb.Error("Error: PolyTree struct is need for open path clipping."),this.m_ExecuteLocked=!0,cb.Clear(e),this.m_SubjFillType=f,this.m_ClipFillType=g,this.m_ClipType=d,this.m_UsingPolyTree=!1;try{var h=this.ExecuteInternal();h&&this.BuildResult(e)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return h}if(4==b&&c){var d=a[0],i=a[1],f=a[2],g=a[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=f,this.m_ClipFillType=g,this.m_ClipType=d,this.m_UsingPolyTree=!0;try{var h=this.ExecuteInternal();h&&this.BuildResult2(i)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return h}if(2==b&&!c){var d=a[0],e=a[1];return this.Execute(d,e,cb.PolyFillType.pftEvenOdd,cb.PolyFillType.pftEvenOdd)}if(2==b&&c){var d=a[0],i=a[1];return this.Execute(d,i,cb.PolyFillType.pftEvenOdd,cb.PolyFillType.pftEvenOdd)}},cb.Clipper.prototype.FixHoleLinkage=function(a){if(null!==a.FirstLeft&&(a.IsHole==a.FirstLeft.IsHole||null===a.FirstLeft.Pts)){for(var b=a.FirstLeft;null!==b&&(b.IsHole==a.IsHole||null===b.Pts);)b=b.FirstLeft;a.FirstLeft=b}},cb.Clipper.prototype.ExecuteInternal=function(){try{if(this.Reset(),null===this.m_CurrentLM)return!1;var a=this.PopScanbeam();do{if(this.InsertLocalMinimaIntoAEL(a),cb.Clear(this.m_GhostJoins),this.ProcessHorizontals(!1),null===this.m_Scanbeam)break;var b=this.PopScanbeam();if(!this.ProcessIntersections(a,b))return!1;this.ProcessEdgesAtTopOfScanbeam(b),a=b}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var c=0,d=this.m_PolyOuts.length;d>c;c++){var e=this.m_PolyOuts[c];null===e.Pts||e.IsOpen||(e.IsHole^this.ReverseSolution)==this.Area(e)>0&&this.ReversePolyPtLinks(e.Pts)}this.JoinCommonEdges();for(var c=0,d=this.m_PolyOuts.length;d>c;c++){var e=this.m_PolyOuts[c];null===e.Pts||e.IsOpen||this.FixupOutPolygon(e)}return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{cb.Clear(this.m_Joins),cb.Clear(this.m_GhostJoins)}},cb.Clipper.prototype.PopScanbeam=function(){var a=this.m_Scanbeam.Y,b=this.m_Scanbeam;return this.m_Scanbeam=this.m_Scanbeam.Next,b=null,a},cb.Clipper.prototype.DisposeAllPolyPts=function(){for(var a=0,b=this.m_PolyOuts.length;b>a;++a)this.DisposeOutRec(a);cb.Clear(this.m_PolyOuts)},cb.Clipper.prototype.DisposeOutRec=function(a){var b=this.m_PolyOuts[a];null!==b.Pts&&this.DisposeOutPts(b.Pts),b=null,this.m_PolyOuts[a]=null},cb.Clipper.prototype.DisposeOutPts=function(a){if(null!==a){var b=null;for(a.Prev.Next=null;null!==a;)b=a,a=a.Next,b=null}},cb.Clipper.prototype.AddJoin=function(a,b,c){var d=new cb.Join;d.OutPt1=a,d.OutPt2=b,d.OffPt.X=c.X,d.OffPt.Y=c.Y,this.m_Joins.push(d)},cb.Clipper.prototype.AddGhostJoin=function(a,b){var c=new cb.Join;c.OutPt1=a,c.OffPt.X=b.X,c.OffPt.Y=b.Y,this.m_GhostJoins.push(c)},_a&&(cb.Clipper.prototype.SetZ=function(a,b){a.Z=0,null!==this.ZFillFunction&&(b.OutIdx<0?this.ZFillFunction(b.Bot,b.Top,a):this.ZFillFunction(b.Top,b.Bot,a))}),cb.Clipper.prototype.InsertLocalMinimaIntoAEL=function(a){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==a;){var b=this.m_CurrentLM.LeftBound,c=this.m_CurrentLM.RightBound;this.PopLocalMinima();var d=null;if(null===b?(this.InsertEdgeIntoAEL(c,null),this.SetWindingCount(c),this.IsContributing(c)&&(d=this.AddOutPt(c,c.Bot))):null==c?(this.InsertEdgeIntoAEL(b,null),this.SetWindingCount(b),this.IsContributing(b)&&(d=this.AddOutPt(b,b.Bot)),this.InsertScanbeam(b.Top.Y)):(this.InsertEdgeIntoAEL(b,null),this.InsertEdgeIntoAEL(c,b),this.SetWindingCount(b),c.WindCnt=b.WindCnt,c.WindCnt2=b.WindCnt2,this.IsContributing(b)&&(d=this.AddLocalMinPoly(b,c,b.Bot)),this.InsertScanbeam(b.Top.Y)),null!=c&&(cb.ClipperBase.IsHorizontal(c)?this.AddEdgeToSEL(c):this.InsertScanbeam(c.Top.Y)),null!=b&&null!=c){if(null!==d&&cb.ClipperBase.IsHorizontal(c)&&this.m_GhostJoins.length>0&&0!==c.WindDelta)for(var e=0,f=this.m_GhostJoins.length;f>e;e++){var g=this.m_GhostJoins[e];this.HorzSegmentsOverlap(g.OutPt1.Pt,g.OffPt,c.Bot,c.Top)&&this.AddJoin(g.OutPt1,d,g.OffPt)}if(b.OutIdx>=0&&null!==b.PrevInAEL&&b.PrevInAEL.Curr.X==b.Bot.X&&b.PrevInAEL.OutIdx>=0&&cb.ClipperBase.SlopesEqual(b.PrevInAEL,b,this.m_UseFullRange)&&0!==b.WindDelta&&0!==b.PrevInAEL.WindDelta){var h=this.AddOutPt(b.PrevInAEL,b.Bot);this.AddJoin(d,h,b.Top)}if(b.NextInAEL!=c){if(c.OutIdx>=0&&c.PrevInAEL.OutIdx>=0&&cb.ClipperBase.SlopesEqual(c.PrevInAEL,c,this.m_UseFullRange)&&0!==c.WindDelta&&0!==c.PrevInAEL.WindDelta){var h=this.AddOutPt(c.PrevInAEL,c.Bot);this.AddJoin(d,h,c.Top)}var i=b.NextInAEL;if(null!==i)for(;i!=c;)this.IntersectEdges(c,i,b.Curr,!1),i=i.NextInAEL}}}},cb.Clipper.prototype.InsertEdgeIntoAEL=function(a,b){if(null===this.m_ActiveEdges)a.PrevInAEL=null,a.NextInAEL=null,this.m_ActiveEdges=a;else if(null===b&&this.E2InsertsBeforeE1(this.m_ActiveEdges,a))a.PrevInAEL=null,a.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=a,this.m_ActiveEdges=a;else{for(null===b&&(b=this.m_ActiveEdges);null!==b.NextInAEL&&!this.E2InsertsBeforeE1(b.NextInAEL,a);)b=b.NextInAEL;a.NextInAEL=b.NextInAEL,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=a),a.PrevInAEL=b,b.NextInAEL=a}},cb.Clipper.prototype.E2InsertsBeforeE1=function(a,b){return b.Curr.X==a.Curr.X?b.Top.Y>a.Top.Y?b.Top.X<cb.Clipper.TopX(a,b.Top.Y):a.Top.X>cb.Clipper.TopX(b,a.Top.Y):b.Curr.X<a.Curr.X},cb.Clipper.prototype.IsEvenOddFillType=function(a){return a.PolyTyp==cb.PolyType.ptSubject?this.m_SubjFillType==cb.PolyFillType.pftEvenOdd:this.m_ClipFillType==cb.PolyFillType.pftEvenOdd},cb.Clipper.prototype.IsEvenOddAltFillType=function(a){return a.PolyTyp==cb.PolyType.ptSubject?this.m_ClipFillType==cb.PolyFillType.pftEvenOdd:this.m_SubjFillType==cb.PolyFillType.pftEvenOdd},cb.Clipper.prototype.IsContributing=function(a){var b,c;switch(a.PolyTyp==cb.PolyType.ptSubject?(b=this.m_SubjFillType,c=this.m_ClipFillType):(b=this.m_ClipFillType,c=this.m_SubjFillType),b){case cb.PolyFillType.pftEvenOdd:if(0===a.WindDelta&&1!=a.WindCnt)return!1;break;case cb.PolyFillType.pftNonZero:if(1!=Math.abs(a.WindCnt))return!1;break;case cb.PolyFillType.pftPositive:if(1!=a.WindCnt)return!1;break;default:if(-1!=a.WindCnt)return!1}switch(this.m_ClipType){case cb.ClipType.ctIntersection:switch(c){case cb.PolyFillType.pftEvenOdd:case cb.PolyFillType.pftNonZero:return 0!==a.WindCnt2;case cb.PolyFillType.pftPositive:return a.WindCnt2>0;default:return a.WindCnt2<0}case cb.ClipType.ctUnion:switch(c){case cb.PolyFillType.pftEvenOdd:case cb.PolyFillType.pftNonZero:return 0===a.WindCnt2;case cb.PolyFillType.pftPositive:return a.WindCnt2<=0;default:return a.WindCnt2>=0}case cb.ClipType.ctDifference:if(a.PolyTyp==cb.PolyType.ptSubject)switch(c){case cb.PolyFillType.pftEvenOdd:case cb.PolyFillType.pftNonZero:return 0===a.WindCnt2;case cb.PolyFillType.pftPositive:return a.WindCnt2<=0;default:return a.WindCnt2>=0}else switch(c){case cb.PolyFillType.pftEvenOdd:case cb.PolyFillType.pftNonZero:return 0!==a.WindCnt2;case cb.PolyFillType.pftPositive:return a.WindCnt2>0;default:return a.WindCnt2<0}case cb.ClipType.ctXor:if(0!==a.WindDelta)return!0;switch(c){case cb.PolyFillType.pftEvenOdd:case cb.PolyFillType.pftNonZero:return 0===a.WindCnt2;case cb.PolyFillType.pftPositive:return a.WindCnt2<=0;default:return a.WindCnt2>=0}}return!0},cb.Clipper.prototype.SetWindingCount=function(a){for(var b=a.PrevInAEL;null!==b&&(b.PolyTyp!=a.PolyTyp||0===b.WindDelta);)b=b.PrevInAEL;if(null===b)a.WindCnt=0===a.WindDelta?1:a.WindDelta,a.WindCnt2=0,b=this.m_ActiveEdges;else if(0===a.WindDelta&&this.m_ClipType!=cb.ClipType.ctUnion)a.WindCnt=1,a.WindCnt2=b.WindCnt2,b=b.NextInAEL;else if(this.IsEvenOddFillType(a)){if(0===a.WindDelta){for(var c=!0,d=b.PrevInAEL;null!==d;)d.PolyTyp==b.PolyTyp&&0!==d.WindDelta&&(c=!c),d=d.PrevInAEL;a.WindCnt=c?0:1}else a.WindCnt=a.WindDelta;a.WindCnt2=b.WindCnt2,b=b.NextInAEL}else a.WindCnt=b.WindCnt*b.WindDelta<0?Math.abs(b.WindCnt)>1?b.WindDelta*a.WindDelta<0?b.WindCnt:b.WindCnt+a.WindDelta:0===a.WindDelta?1:a.WindDelta:0===a.WindDelta?b.WindCnt<0?b.WindCnt-1:b.WindCnt+1:b.WindDelta*a.WindDelta<0?b.WindCnt:b.WindCnt+a.WindDelta,a.WindCnt2=b.WindCnt2,b=b.NextInAEL;if(this.IsEvenOddAltFillType(a))for(;b!=a;)0!==b.WindDelta&&(a.WindCnt2=0===a.WindCnt2?1:0),b=b.NextInAEL;else for(;b!=a;)a.WindCnt2+=b.WindDelta,b=b.NextInAEL},cb.Clipper.prototype.AddEdgeToSEL=function(a){null===this.m_SortedEdges?(this.m_SortedEdges=a,a.PrevInSEL=null,a.NextInSEL=null):(a.NextInSEL=this.m_SortedEdges,a.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=a,this.m_SortedEdges=a)},cb.Clipper.prototype.CopyAELToSEL=function(){var a=this.m_ActiveEdges;for(this.m_SortedEdges=a;null!==a;)a.PrevInSEL=a.PrevInAEL,a.NextInSEL=a.NextInAEL,a=a.NextInAEL},cb.Clipper.prototype.SwapPositionsInAEL=function(a,b){if(a.NextInAEL!=a.PrevInAEL&&b.NextInAEL!=b.PrevInAEL){if(a.NextInAEL==b){var c=b.NextInAEL;null!==c&&(c.PrevInAEL=a);var d=a.PrevInAEL;null!==d&&(d.NextInAEL=b),b.PrevInAEL=d,b.NextInAEL=a,a.PrevInAEL=b,a.NextInAEL=c}else if(b.NextInAEL==a){var c=a.NextInAEL;null!==c&&(c.PrevInAEL=b);var d=b.PrevInAEL;null!==d&&(d.NextInAEL=a),a.PrevInAEL=d,a.NextInAEL=b,b.PrevInAEL=a,b.NextInAEL=c}else{var c=a.NextInAEL,d=a.PrevInAEL;a.NextInAEL=b.NextInAEL,null!==a.NextInAEL&&(a.NextInAEL.PrevInAEL=a),a.PrevInAEL=b.PrevInAEL,null!==a.PrevInAEL&&(a.PrevInAEL.NextInAEL=a),b.NextInAEL=c,null!==b.NextInAEL&&(b.NextInAEL.PrevInAEL=b),b.PrevInAEL=d,null!==b.PrevInAEL&&(b.PrevInAEL.NextInAEL=b)}null===a.PrevInAEL?this.m_ActiveEdges=a:null===b.PrevInAEL&&(this.m_ActiveEdges=b)}},cb.Clipper.prototype.SwapPositionsInSEL=function(a,b){if(!(null===a.NextInSEL&&null===a.PrevInSEL||null===b.NextInSEL&&null===b.PrevInSEL)){if(a.NextInSEL==b){var c=b.NextInSEL;null!==c&&(c.PrevInSEL=a);var d=a.PrevInSEL;null!==d&&(d.NextInSEL=b),b.PrevInSEL=d,b.NextInSEL=a,a.PrevInSEL=b,a.NextInSEL=c}else if(b.NextInSEL==a){var c=a.NextInSEL;null!==c&&(c.PrevInSEL=b);var d=b.PrevInSEL;null!==d&&(d.NextInSEL=a),a.PrevInSEL=d,a.NextInSEL=b,b.PrevInSEL=a,b.NextInSEL=c}else{var c=a.NextInSEL,d=a.PrevInSEL;a.NextInSEL=b.NextInSEL,null!==a.NextInSEL&&(a.NextInSEL.PrevInSEL=a),a.PrevInSEL=b.PrevInSEL,null!==a.PrevInSEL&&(a.PrevInSEL.NextInSEL=a),b.NextInSEL=c,null!==b.NextInSEL&&(b.NextInSEL.PrevInSEL=b),b.PrevInSEL=d,null!==b.PrevInSEL&&(b.PrevInSEL.NextInSEL=b)}null===a.PrevInSEL?this.m_SortedEdges=a:null===b.PrevInSEL&&(this.m_SortedEdges=b)}},cb.Clipper.prototype.AddLocalMaxPoly=function(a,b,c){this.AddOutPt(a,c),0==b.WindDelta&&this.AddOutPt(b,c),a.OutIdx==b.OutIdx?(a.OutIdx=-1,b.OutIdx=-1):a.OutIdx<b.OutIdx?this.AppendPolygon(a,b):this.AppendPolygon(b,a)},cb.Clipper.prototype.AddLocalMinPoly=function(a,b,c){var d,e,f;if(cb.ClipperBase.IsHorizontal(b)||a.Dx>b.Dx?(d=this.AddOutPt(a,c),b.OutIdx=a.OutIdx,a.Side=cb.EdgeSide.esLeft,b.Side=cb.EdgeSide.esRight,e=a,f=e.PrevInAEL==b?b.PrevInAEL:e.PrevInAEL):(d=this.AddOutPt(b,c),a.OutIdx=b.OutIdx,a.Side=cb.EdgeSide.esRight,b.Side=cb.EdgeSide.esLeft,e=b,f=e.PrevInAEL==a?a.PrevInAEL:e.PrevInAEL),null!==f&&f.OutIdx>=0&&cb.Clipper.TopX(f,c.Y)==cb.Clipper.TopX(e,c.Y)&&cb.ClipperBase.SlopesEqual(e,f,this.m_UseFullRange)&&0!==e.WindDelta&&0!==f.WindDelta){var g=this.AddOutPt(f,c);this.AddJoin(d,g,e.Top)}return d},cb.Clipper.prototype.CreateOutRec=function(){var a=new cb.OutRec;return a.Idx=-1,a.IsHole=!1,a.IsOpen=!1,a.FirstLeft=null,a.Pts=null,a.BottomPt=null,a.PolyNode=null,this.m_PolyOuts.push(a),a.Idx=this.m_PolyOuts.length-1,a},cb.Clipper.prototype.AddOutPt=function(a,b){var c=a.Side==cb.EdgeSide.esLeft;if(a.OutIdx<0){var d=this.CreateOutRec();d.IsOpen=0===a.WindDelta;var e=new cb.OutPt;return d.Pts=e,e.Idx=d.Idx,e.Pt.X=b.X,e.Pt.Y=b.Y,e.Next=e,e.Prev=e,d.IsOpen||this.SetHoleState(a,d),_a&&(cb.IntPoint.op_Equality(b,a.Bot)?(e.Pt.X=a.Bot.X,e.Pt.Y=a.Bot.Y,e.Pt.Z=a.Bot.Z):cb.IntPoint.op_Equality(b,a.Top)?(e.Pt.X=a.Top.X,e.Pt.Y=a.Top.Y,e.Pt.Z=a.Top.Z):this.SetZ(e.Pt,a)),a.OutIdx=d.Idx,e}var d=this.m_PolyOuts[a.OutIdx],f=d.Pts;if(c&&cb.IntPoint.op_Equality(b,f.Pt))return f;if(!c&&cb.IntPoint.op_Equality(b,f.Prev.Pt))return f.Prev;var e=new cb.OutPt;return e.Idx=d.Idx,e.Pt.X=b.X,e.Pt.Y=b.Y,e.Next=f,e.Prev=f.Prev,e.Prev.Next=e,f.Prev=e,c&&(d.Pts=e),_a&&(cb.IntPoint.op_Equality(b,a.Bot)?(e.Pt.X=a.Bot.X,e.Pt.Y=a.Bot.Y,e.Pt.Z=a.Bot.Z):cb.IntPoint.op_Equality(b,a.Top)?(e.Pt.X=a.Top.X,e.Pt.Y=a.Top.Y,e.Pt.Z=a.Top.Z):this.SetZ(e.Pt,a)),e},cb.Clipper.prototype.SwapPoints=function(a,b){var c=new cb.IntPoint(a.Value);a.Value.X=b.Value.X,a.Value.Y=b.Value.Y,b.Value.X=c.X,b.Value.Y=c.Y},cb.Clipper.prototype.HorzSegmentsOverlap=function(a,b,c,d){return a.X>c.X==a.X<d.X?!0:b.X>c.X==b.X<d.X?!0:c.X>a.X==c.X<b.X?!0:d.X>a.X==d.X<b.X?!0:a.X==c.X&&b.X==d.X?!0:a.X==d.X&&b.X==c.X?!0:!1;

},cb.Clipper.prototype.InsertPolyPtBetween=function(a,b,c){var d=new cb.OutPt;return d.Pt.X=c.X,d.Pt.Y=c.Y,b==a.Next?(a.Next=d,b.Prev=d,d.Next=b,d.Prev=a):(b.Next=d,a.Prev=d,d.Next=a,d.Prev=b),d},cb.Clipper.prototype.SetHoleState=function(a,b){for(var c=!1,d=a.PrevInAEL;null!==d;)d.OutIdx>=0&&0!=d.WindDelta&&(c=!c,null===b.FirstLeft&&(b.FirstLeft=this.m_PolyOuts[d.OutIdx])),d=d.PrevInAEL;c&&(b.IsHole=!0)},cb.Clipper.prototype.GetDx=function(a,b){return a.Y==b.Y?cb.ClipperBase.horizontal:(b.X-a.X)/(b.Y-a.Y)},cb.Clipper.prototype.FirstIsBottomPt=function(a,b){for(var c=a.Prev;cb.IntPoint.op_Equality(c.Pt,a.Pt)&&c!=a;)c=c.Prev;var d=Math.abs(this.GetDx(a.Pt,c.Pt));for(c=a.Next;cb.IntPoint.op_Equality(c.Pt,a.Pt)&&c!=a;)c=c.Next;var e=Math.abs(this.GetDx(a.Pt,c.Pt));for(c=b.Prev;cb.IntPoint.op_Equality(c.Pt,b.Pt)&&c!=b;)c=c.Prev;var f=Math.abs(this.GetDx(b.Pt,c.Pt));for(c=b.Next;cb.IntPoint.op_Equality(c.Pt,b.Pt)&&c!=b;)c=c.Next;var g=Math.abs(this.GetDx(b.Pt,c.Pt));return d>=f&&d>=g||e>=f&&e>=g},cb.Clipper.prototype.GetBottomPt=function(a){for(var b=null,c=a.Next;c!=a;)c.Pt.Y>a.Pt.Y?(a=c,b=null):c.Pt.Y==a.Pt.Y&&c.Pt.X<=a.Pt.X&&(c.Pt.X<a.Pt.X?(b=null,a=c):c.Next!=a&&c.Prev!=a&&(b=c)),c=c.Next;if(null!==b)for(;b!=c;)for(this.FirstIsBottomPt(c,b)||(a=b),b=b.Next;cb.IntPoint.op_Inequality(b.Pt,a.Pt);)b=b.Next;return a},cb.Clipper.prototype.GetLowermostRec=function(a,b){null===a.BottomPt&&(a.BottomPt=this.GetBottomPt(a.Pts)),null===b.BottomPt&&(b.BottomPt=this.GetBottomPt(b.Pts));var c=a.BottomPt,d=b.BottomPt;return c.Pt.Y>d.Pt.Y?a:c.Pt.Y<d.Pt.Y?b:c.Pt.X<d.Pt.X?a:c.Pt.X>d.Pt.X?b:c.Next==c?b:d.Next==d?a:this.FirstIsBottomPt(c,d)?a:b},cb.Clipper.prototype.Param1RightOfParam2=function(a,b){do if(a=a.FirstLeft,a==b)return!0;while(null!==a);return!1},cb.Clipper.prototype.GetOutRec=function(a){for(var b=this.m_PolyOuts[a];b!=this.m_PolyOuts[b.Idx];)b=this.m_PolyOuts[b.Idx];return b},cb.Clipper.prototype.AppendPolygon=function(a,b){var c,d=this.m_PolyOuts[a.OutIdx],e=this.m_PolyOuts[b.OutIdx];c=this.Param1RightOfParam2(d,e)?e:this.Param1RightOfParam2(e,d)?d:this.GetLowermostRec(d,e);var f,g=d.Pts,h=g.Prev,i=e.Pts,j=i.Prev;a.Side==cb.EdgeSide.esLeft?(b.Side==cb.EdgeSide.esLeft?(this.ReversePolyPtLinks(i),i.Next=g,g.Prev=i,h.Next=j,j.Prev=h,d.Pts=j):(j.Next=g,g.Prev=j,i.Prev=h,h.Next=i,d.Pts=i),f=cb.EdgeSide.esLeft):(b.Side==cb.EdgeSide.esRight?(this.ReversePolyPtLinks(i),h.Next=j,j.Prev=h,i.Next=g,g.Prev=i):(h.Next=i,i.Prev=h,g.Prev=j,j.Next=g),f=cb.EdgeSide.esRight),d.BottomPt=null,c==e&&(e.FirstLeft!=d&&(d.FirstLeft=e.FirstLeft),d.IsHole=e.IsHole),e.Pts=null,e.BottomPt=null,e.FirstLeft=d;var k=a.OutIdx,l=b.OutIdx;a.OutIdx=-1,b.OutIdx=-1;for(var m=this.m_ActiveEdges;null!==m;){if(m.OutIdx==l){m.OutIdx=k,m.Side=f;break}m=m.NextInAEL}e.Idx=d.Idx},cb.Clipper.prototype.ReversePolyPtLinks=function(a){if(null!==a){var b,c;b=a;do c=b.Next,b.Next=b.Prev,b.Prev=c,b=c;while(b!=a)}},cb.Clipper.SwapSides=function(a,b){var c=a.Side;a.Side=b.Side,b.Side=c},cb.Clipper.SwapPolyIndexes=function(a,b){var c=a.OutIdx;a.OutIdx=b.OutIdx,b.OutIdx=c},cb.Clipper.prototype.IntersectEdges=function(a,b,c,d){var e=!d&&null===a.NextInLML&&a.Top.X==c.X&&a.Top.Y==c.Y,f=!d&&null===b.NextInLML&&b.Top.X==c.X&&b.Top.Y==c.Y,g=a.OutIdx>=0,h=b.OutIdx>=0;if(ab&&(0===a.WindDelta||0===b.WindDelta))return 0===a.WindDelta&&0===b.WindDelta?(e||f)&&g&&h&&this.AddLocalMaxPoly(a,b,c):a.PolyTyp==b.PolyTyp&&a.WindDelta!=b.WindDelta&&this.m_ClipType==cb.ClipType.ctUnion?0===a.WindDelta?h&&(this.AddOutPt(a,c),g&&(a.OutIdx=-1)):g&&(this.AddOutPt(b,c),h&&(b.OutIdx=-1)):a.PolyTyp!=b.PolyTyp&&(0!==a.WindDelta||1!=Math.abs(b.WindCnt)||this.m_ClipType==cb.ClipType.ctUnion&&0!==b.WindCnt2?0!==b.WindDelta||1!=Math.abs(a.WindCnt)||this.m_ClipType==cb.ClipType.ctUnion&&0!==a.WindCnt2||(this.AddOutPt(b,c),h&&(b.OutIdx=-1)):(this.AddOutPt(a,c),g&&(a.OutIdx=-1))),e&&(a.OutIdx<0?this.DeleteFromAEL(a):cb.Error("Error intersecting polylines")),void(f&&(b.OutIdx<0?this.DeleteFromAEL(b):cb.Error("Error intersecting polylines")));if(a.PolyTyp==b.PolyTyp)if(this.IsEvenOddFillType(a)){var i=a.WindCnt;a.WindCnt=b.WindCnt,b.WindCnt=i}else a.WindCnt+b.WindDelta===0?a.WindCnt=-a.WindCnt:a.WindCnt+=b.WindDelta,b.WindCnt-a.WindDelta===0?b.WindCnt=-b.WindCnt:b.WindCnt-=a.WindDelta;else this.IsEvenOddFillType(b)?a.WindCnt2=0===a.WindCnt2?1:0:a.WindCnt2+=b.WindDelta,this.IsEvenOddFillType(a)?b.WindCnt2=0===b.WindCnt2?1:0:b.WindCnt2-=a.WindDelta;var j,k,l,m;a.PolyTyp==cb.PolyType.ptSubject?(j=this.m_SubjFillType,l=this.m_ClipFillType):(j=this.m_ClipFillType,l=this.m_SubjFillType),b.PolyTyp==cb.PolyType.ptSubject?(k=this.m_SubjFillType,m=this.m_ClipFillType):(k=this.m_ClipFillType,m=this.m_SubjFillType);var n,o;switch(j){case cb.PolyFillType.pftPositive:n=a.WindCnt;break;case cb.PolyFillType.pftNegative:n=-a.WindCnt;break;default:n=Math.abs(a.WindCnt)}switch(k){case cb.PolyFillType.pftPositive:o=b.WindCnt;break;case cb.PolyFillType.pftNegative:o=-b.WindCnt;break;default:o=Math.abs(b.WindCnt)}if(g&&h)e||f||0!==n&&1!=n||0!==o&&1!=o||a.PolyTyp!=b.PolyTyp&&this.m_ClipType!=cb.ClipType.ctXor?this.AddLocalMaxPoly(a,b,c):(this.AddOutPt(a,c),this.AddOutPt(b,c),cb.Clipper.SwapSides(a,b),cb.Clipper.SwapPolyIndexes(a,b));else if(g)(0===o||1==o)&&(this.AddOutPt(a,c),cb.Clipper.SwapSides(a,b),cb.Clipper.SwapPolyIndexes(a,b));else if(h)(0===n||1==n)&&(this.AddOutPt(b,c),cb.Clipper.SwapSides(a,b),cb.Clipper.SwapPolyIndexes(a,b));else if(!(0!==n&&1!=n||0!==o&&1!=o||e||f)){var p,q;switch(l){case cb.PolyFillType.pftPositive:p=a.WindCnt2;break;case cb.PolyFillType.pftNegative:p=-a.WindCnt2;break;default:p=Math.abs(a.WindCnt2)}switch(m){case cb.PolyFillType.pftPositive:q=b.WindCnt2;break;case cb.PolyFillType.pftNegative:q=-b.WindCnt2;break;default:q=Math.abs(b.WindCnt2)}if(a.PolyTyp!=b.PolyTyp)this.AddLocalMinPoly(a,b,c);else if(1==n&&1==o)switch(this.m_ClipType){case cb.ClipType.ctIntersection:p>0&&q>0&&this.AddLocalMinPoly(a,b,c);break;case cb.ClipType.ctUnion:0>=p&&0>=q&&this.AddLocalMinPoly(a,b,c);break;case cb.ClipType.ctDifference:(a.PolyTyp==cb.PolyType.ptClip&&p>0&&q>0||a.PolyTyp==cb.PolyType.ptSubject&&0>=p&&0>=q)&&this.AddLocalMinPoly(a,b,c);break;case cb.ClipType.ctXor:this.AddLocalMinPoly(a,b,c)}else cb.Clipper.SwapSides(a,b)}e!=f&&(e&&a.OutIdx>=0||f&&b.OutIdx>=0)&&(cb.Clipper.SwapSides(a,b),cb.Clipper.SwapPolyIndexes(a,b)),e&&this.DeleteFromAEL(a),f&&this.DeleteFromAEL(b)},cb.Clipper.prototype.DeleteFromAEL=function(a){var b=a.PrevInAEL,c=a.NextInAEL;(null!==b||null!==c||a==this.m_ActiveEdges)&&(null!==b?b.NextInAEL=c:this.m_ActiveEdges=c,null!==c&&(c.PrevInAEL=b),a.NextInAEL=null,a.PrevInAEL=null)},cb.Clipper.prototype.DeleteFromSEL=function(a){var b=a.PrevInSEL,c=a.NextInSEL;(null!==b||null!==c||a==this.m_SortedEdges)&&(null!==b?b.NextInSEL=c:this.m_SortedEdges=c,null!==c&&(c.PrevInSEL=b),a.NextInSEL=null,a.PrevInSEL=null)},cb.Clipper.prototype.UpdateEdgeIntoAEL=function(a){null===a.NextInLML&&cb.Error("UpdateEdgeIntoAEL: invalid call");var b=a.PrevInAEL,c=a.NextInAEL;return a.NextInLML.OutIdx=a.OutIdx,null!==b?b.NextInAEL=a.NextInLML:this.m_ActiveEdges=a.NextInLML,null!==c&&(c.PrevInAEL=a.NextInLML),a.NextInLML.Side=a.Side,a.NextInLML.WindDelta=a.WindDelta,a.NextInLML.WindCnt=a.WindCnt,a.NextInLML.WindCnt2=a.WindCnt2,a=a.NextInLML,a.Curr.X=a.Bot.X,a.Curr.Y=a.Bot.Y,a.PrevInAEL=b,a.NextInAEL=c,cb.ClipperBase.IsHorizontal(a)||this.InsertScanbeam(a.Top.Y),a},cb.Clipper.prototype.ProcessHorizontals=function(a){for(var b=this.m_SortedEdges;null!==b;)this.DeleteFromSEL(b),this.ProcessHorizontal(b,a),b=this.m_SortedEdges},cb.Clipper.prototype.GetHorzDirection=function(a,b){a.Bot.X<a.Top.X?(b.Left=a.Bot.X,b.Right=a.Top.X,b.Dir=cb.Direction.dLeftToRight):(b.Left=a.Top.X,b.Right=a.Bot.X,b.Dir=cb.Direction.dRightToLeft)},cb.Clipper.prototype.PrepareHorzJoins=function(a,b){var c=this.m_PolyOuts[a.OutIdx].Pts;a.Side!=cb.EdgeSide.esLeft&&(c=c.Prev),b&&(cb.IntPoint.op_Equality(c.Pt,a.Top)?this.AddGhostJoin(c,a.Bot):this.AddGhostJoin(c,a.Top))},cb.Clipper.prototype.ProcessHorizontal=function(a,b){var c={Dir:null,Left:null,Right:null};this.GetHorzDirection(a,c);for(var d=c.Dir,e=c.Left,f=c.Right,g=a,h=null;null!==g.NextInLML&&cb.ClipperBase.IsHorizontal(g.NextInLML);)g=g.NextInLML;for(null===g.NextInLML&&(h=this.GetMaximaPair(g));;){for(var i=a==g,j=this.GetNextInAEL(a,d);null!==j&&!(j.Curr.X==a.Top.X&&null!==a.NextInLML&&j.Dx<a.NextInLML.Dx);){var k=this.GetNextInAEL(j,d);if(d==cb.Direction.dLeftToRight&&j.Curr.X<=f||d==cb.Direction.dRightToLeft&&j.Curr.X>=e){if(a.OutIdx>=0&&0!=a.WindDelta&&this.PrepareHorzJoins(a,b),j==h&&i)return d==cb.Direction.dLeftToRight?this.IntersectEdges(a,j,j.Top,!1):this.IntersectEdges(j,a,j.Top,!1),void(h.OutIdx>=0&&cb.Error("ProcessHorizontal error"));if(d==cb.Direction.dLeftToRight){var l=new cb.IntPoint(j.Curr.X,a.Curr.Y);this.IntersectEdges(a,j,l,!0)}else{var l=new cb.IntPoint(j.Curr.X,a.Curr.Y);this.IntersectEdges(j,a,l,!0)}this.SwapPositionsInAEL(a,j)}else if(d==cb.Direction.dLeftToRight&&j.Curr.X>=f||d==cb.Direction.dRightToLeft&&j.Curr.X<=e)break;j=k}if(a.OutIdx>=0&&0!==a.WindDelta&&this.PrepareHorzJoins(a,b),null===a.NextInLML||!cb.ClipperBase.IsHorizontal(a.NextInLML))break;a=this.UpdateEdgeIntoAEL(a),a.OutIdx>=0&&this.AddOutPt(a,a.Bot);var c={Dir:d,Left:e,Right:f};this.GetHorzDirection(a,c),d=c.Dir,e=c.Left,f=c.Right}if(null!==a.NextInLML)if(a.OutIdx>=0){var m=this.AddOutPt(a,a.Top);if(a=this.UpdateEdgeIntoAEL(a),0===a.WindDelta)return;var n=a.PrevInAEL,k=a.NextInAEL;if(null!==n&&n.Curr.X==a.Bot.X&&n.Curr.Y==a.Bot.Y&&0!==n.WindDelta&&n.OutIdx>=0&&n.Curr.Y>n.Top.Y&&cb.ClipperBase.SlopesEqual(a,n,this.m_UseFullRange)){var o=this.AddOutPt(n,a.Bot);this.AddJoin(m,o,a.Top)}else if(null!==k&&k.Curr.X==a.Bot.X&&k.Curr.Y==a.Bot.Y&&0!==k.WindDelta&&k.OutIdx>=0&&k.Curr.Y>k.Top.Y&&cb.ClipperBase.SlopesEqual(a,k,this.m_UseFullRange)){var o=this.AddOutPt(k,a.Bot);this.AddJoin(m,o,a.Top)}}else a=this.UpdateEdgeIntoAEL(a);else null!==h?h.OutIdx>=0?(d==cb.Direction.dLeftToRight?this.IntersectEdges(a,h,a.Top,!1):this.IntersectEdges(h,a,a.Top,!1),h.OutIdx>=0&&cb.Error("ProcessHorizontal error")):(this.DeleteFromAEL(a),this.DeleteFromAEL(h)):(a.OutIdx>=0&&this.AddOutPt(a,a.Top),this.DeleteFromAEL(a))},cb.Clipper.prototype.GetNextInAEL=function(a,b){return b==cb.Direction.dLeftToRight?a.NextInAEL:a.PrevInAEL},cb.Clipper.prototype.IsMinima=function(a){return null!==a&&a.Prev.NextInLML!=a&&a.Next.NextInLML!=a},cb.Clipper.prototype.IsMaxima=function(a,b){return null!==a&&a.Top.Y==b&&null===a.NextInLML},cb.Clipper.prototype.IsIntermediate=function(a,b){return a.Top.Y==b&&null!==a.NextInLML},cb.Clipper.prototype.GetMaximaPair=function(a){var b=null;return cb.IntPoint.op_Equality(a.Next.Top,a.Top)&&null===a.Next.NextInLML?b=a.Next:cb.IntPoint.op_Equality(a.Prev.Top,a.Top)&&null===a.Prev.NextInLML&&(b=a.Prev),null===b||-2!=b.OutIdx&&(b.NextInAEL!=b.PrevInAEL||cb.ClipperBase.IsHorizontal(b))?b:null},cb.Clipper.prototype.ProcessIntersections=function(a,b){if(null==this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(a,b),0==this.m_IntersectList.length)return!0;if(1!=this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(c){this.m_SortedEdges=null,this.m_IntersectList.length=0,cb.Error("ProcessIntersections error")}return this.m_SortedEdges=null,!0},cb.Clipper.prototype.BuildIntersectList=function(a,b){if(null!==this.m_ActiveEdges){var c=this.m_ActiveEdges;for(this.m_SortedEdges=c;null!==c;)c.PrevInSEL=c.PrevInAEL,c.NextInSEL=c.NextInAEL,c.Curr.X=cb.Clipper.TopX(c,b),c=c.NextInAEL;for(var d=!0;d&&null!==this.m_SortedEdges;){for(d=!1,c=this.m_SortedEdges;null!==c.NextInSEL;){var e=c.NextInSEL,f=new cb.IntPoint;if(c.Curr.X>e.Curr.X){!this.IntersectPoint(c,e,f)&&c.Curr.X>e.Curr.X+1&&cb.Error("Intersection error"),f.Y>a&&(f.Y=a,f.X=Math.abs(c.Dx)>Math.abs(e.Dx)?cb.Clipper.TopX(e,a):cb.Clipper.TopX(c,a));var g=new cb.IntersectNode;g.Edge1=c,g.Edge2=e,g.Pt.X=f.X,g.Pt.Y=f.Y,this.m_IntersectList.push(g),this.SwapPositionsInSEL(c,e),d=!0}else c=e}if(null===c.PrevInSEL)break;c.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},cb.Clipper.prototype.EdgesAdjacent=function(a){return a.Edge1.NextInSEL==a.Edge2||a.Edge1.PrevInSEL==a.Edge2},cb.Clipper.IntersectNodeSort=function(a,b){return b.Pt.Y-a.Pt.Y},cb.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var a=this.m_IntersectList.length,b=0;a>b;b++){if(!this.EdgesAdjacent(this.m_IntersectList[b])){for(var c=b+1;a>c&&!this.EdgesAdjacent(this.m_IntersectList[c]);)c++;if(c==a)return!1;var d=this.m_IntersectList[b];this.m_IntersectList[b]=this.m_IntersectList[c],this.m_IntersectList[c]=d}this.SwapPositionsInSEL(this.m_IntersectList[b].Edge1,this.m_IntersectList[b].Edge2)}return!0},cb.Clipper.prototype.ProcessIntersectList=function(){for(var a=0,b=this.m_IntersectList.length;b>a;a++){var c=this.m_IntersectList[a];this.IntersectEdges(c.Edge1,c.Edge2,c.Pt,!0),this.SwapPositionsInAEL(c.Edge1,c.Edge2)}this.m_IntersectList.length=0};var tb=function(a){return 0>a?Math.ceil(a-.5):Math.round(a)},ub=function(a){return 0>a?Math.ceil(a-.5):Math.floor(a+.5)},vb=function(a){return 0>a?-Math.round(Math.abs(a)):Math.round(a)},wb=function(a){return 0>a?(a-=.5,-2147483648>a?Math.ceil(a):0|a):(a+=.5,a>2147483647?Math.floor(a):0|a)};cb.Clipper.Round=gb.msie?tb:gb.chromium?vb:gb.safari?wb:ub,cb.Clipper.TopX=function(a,b){return b==a.Top.Y?a.Top.X:a.Bot.X+cb.Clipper.Round(a.Dx*(b-a.Bot.Y))},cb.Clipper.prototype.IntersectPoint=function(a,b,c){c.X=0,c.Y=0;var d,e;if(cb.ClipperBase.SlopesEqual(a,b,this.m_UseFullRange)||a.Dx==b.Dx)return b.Bot.Y>a.Bot.Y?(c.X=b.Bot.X,c.Y=b.Bot.Y):(c.X=a.Bot.X,c.Y=a.Bot.Y),!1;if(0===a.Delta.X)c.X=a.Bot.X,cb.ClipperBase.IsHorizontal(b)?c.Y=b.Bot.Y:(e=b.Bot.Y-b.Bot.X/b.Dx,c.Y=cb.Clipper.Round(c.X/b.Dx+e));else if(0===b.Delta.X)c.X=b.Bot.X,cb.ClipperBase.IsHorizontal(a)?c.Y=a.Bot.Y:(d=a.Bot.Y-a.Bot.X/a.Dx,c.Y=cb.Clipper.Round(c.X/a.Dx+d));else{d=a.Bot.X-a.Bot.Y*a.Dx,e=b.Bot.X-b.Bot.Y*b.Dx;var f=(e-d)/(a.Dx-b.Dx);c.Y=cb.Clipper.Round(f),c.X=cb.Clipper.Round(Math.abs(a.Dx)<Math.abs(b.Dx)?a.Dx*f+d:b.Dx*f+e)}if(c.Y<a.Top.Y||c.Y<b.Top.Y){if(a.Top.Y>b.Top.Y)return c.Y=a.Top.Y,c.X=cb.Clipper.TopX(b,a.Top.Y),c.X<a.Top.X;c.Y=b.Top.Y,c.X=Math.abs(a.Dx)<Math.abs(b.Dx)?cb.Clipper.TopX(a,c.Y):cb.Clipper.TopX(b,c.Y)}return!0},cb.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(a){for(var b=this.m_ActiveEdges;null!==b;){var c=this.IsMaxima(b,a);if(c){var d=this.GetMaximaPair(b);c=null===d||!cb.ClipperBase.IsHorizontal(d)}if(c){var e=b.PrevInAEL;this.DoMaxima(b),b=null===e?this.m_ActiveEdges:e.NextInAEL}else{if(this.IsIntermediate(b,a)&&cb.ClipperBase.IsHorizontal(b.NextInLML)?(b=this.UpdateEdgeIntoAEL(b),b.OutIdx>=0&&this.AddOutPt(b,b.Bot),this.AddEdgeToSEL(b)):(b.Curr.X=cb.Clipper.TopX(b,a),b.Curr.Y=a),this.StrictlySimple){var e=b.PrevInAEL;if(b.OutIdx>=0&&0!==b.WindDelta&&null!==e&&e.OutIdx>=0&&e.Curr.X==b.Curr.X&&0!==e.WindDelta){var f=this.AddOutPt(e,b.Curr),g=this.AddOutPt(b,b.Curr);this.AddJoin(f,g,b.Curr)}}b=b.NextInAEL}}for(this.ProcessHorizontals(!0),b=this.m_ActiveEdges;null!==b;){if(this.IsIntermediate(b,a)){var f=null;b.OutIdx>=0&&(f=this.AddOutPt(b,b.Top)),b=this.UpdateEdgeIntoAEL(b);var e=b.PrevInAEL,h=b.NextInAEL;if(null!==e&&e.Curr.X==b.Bot.X&&e.Curr.Y==b.Bot.Y&&null!==f&&e.OutIdx>=0&&e.Curr.Y>e.Top.Y&&cb.ClipperBase.SlopesEqual(b,e,this.m_UseFullRange)&&0!==b.WindDelta&&0!==e.WindDelta){var g=this.AddOutPt(e,b.Bot);this.AddJoin(f,g,b.Top)}else if(null!==h&&h.Curr.X==b.Bot.X&&h.Curr.Y==b.Bot.Y&&null!==f&&h.OutIdx>=0&&h.Curr.Y>h.Top.Y&&cb.ClipperBase.SlopesEqual(b,h,this.m_UseFullRange)&&0!==b.WindDelta&&0!==h.WindDelta){var g=this.AddOutPt(h,b.Bot);this.AddJoin(f,g,b.Top)}}b=b.NextInAEL}},cb.Clipper.prototype.DoMaxima=function(a){var b=this.GetMaximaPair(a);if(null===b)return a.OutIdx>=0&&this.AddOutPt(a,a.Top),void this.DeleteFromAEL(a);for(var c=a.NextInAEL,d=!0;null!==c&&c!=b;)this.IntersectEdges(a,c,a.Top,!0),this.SwapPositionsInAEL(a,c),c=a.NextInAEL;-1==a.OutIdx&&-1==b.OutIdx?(this.DeleteFromAEL(a),this.DeleteFromAEL(b)):a.OutIdx>=0&&b.OutIdx>=0?this.IntersectEdges(a,b,a.Top,!1):d&&0===a.WindDelta?(a.OutIdx>=0&&(this.AddOutPt(a,a.Top),a.OutIdx=-1),this.DeleteFromAEL(a),b.OutIdx>=0&&(this.AddOutPt(b,a.Top),b.OutIdx=-1),this.DeleteFromAEL(b)):cb.Error("DoMaxima error")},cb.Clipper.ReversePaths=function(a){for(var b=0,c=a.length;c>b;b++)a[b].reverse()},cb.Clipper.Orientation=function(a){return cb.Clipper.Area(a)>=0},cb.Clipper.prototype.PointCount=function(a){if(null===a)return 0;var b=0,c=a;do b++,c=c.Next;while(c!=a);return b},cb.Clipper.prototype.BuildResult=function(a){cb.Clear(a);for(var b=0,c=this.m_PolyOuts.length;c>b;b++){var d=this.m_PolyOuts[b];if(null!==d.Pts){var e=d.Pts.Prev,f=this.PointCount(e);if(!(2>f)){for(var g=new Array(f),h=0;f>h;h++)g[h]=e.Pt,e=e.Prev;a.push(g)}}}},cb.Clipper.prototype.BuildResult2=function(a){a.Clear();for(var b=0,c=this.m_PolyOuts.length;c>b;b++){var d=this.m_PolyOuts[b],e=this.PointCount(d.Pts);if(!(d.IsOpen&&2>e||!d.IsOpen&&3>e)){this.FixHoleLinkage(d);var f=new cb.PolyNode;a.m_AllPolys.push(f),d.PolyNode=f,f.m_polygon.length=e;for(var g=d.Pts.Prev,h=0;e>h;h++)f.m_polygon[h]=g.Pt,g=g.Prev}}for(var b=0,c=this.m_PolyOuts.length;c>b;b++){var d=this.m_PolyOuts[b];null!==d.PolyNode&&(d.IsOpen?(d.PolyNode.IsOpen=!0,a.AddChild(d.PolyNode)):null!==d.FirstLeft&&null!=d.FirstLeft.PolyNode?d.FirstLeft.PolyNode.AddChild(d.PolyNode):a.AddChild(d.PolyNode))}},cb.Clipper.prototype.FixupOutPolygon=function(a){var b=null;a.BottomPt=null;for(var c=a.Pts;;){if(c.Prev==c||c.Prev==c.Next)return this.DisposeOutPts(c),void(a.Pts=null);if(cb.IntPoint.op_Equality(c.Pt,c.Next.Pt)||cb.IntPoint.op_Equality(c.Pt,c.Prev.Pt)||cb.ClipperBase.SlopesEqual(c.Prev.Pt,c.Pt,c.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(c.Prev.Pt,c.Pt,c.Next.Pt))){b=null;var d=c;c.Prev.Next=c.Next,c.Next.Prev=c.Prev,c=c.Prev,d=null}else{if(c==b)break;null===b&&(b=c),c=c.Next}}a.Pts=c},cb.Clipper.prototype.DupOutPt=function(a,b){var c=new cb.OutPt;return c.Pt.X=a.Pt.X,c.Pt.Y=a.Pt.Y,c.Idx=a.Idx,b?(c.Next=a.Next,c.Prev=a,a.Next.Prev=c,a.Next=c):(c.Prev=a.Prev,c.Next=a,a.Prev.Next=c,a.Prev=c),c},cb.Clipper.prototype.GetOverlap=function(a,b,c,d,e){return b>a?d>c?(e.Left=Math.max(a,c),e.Right=Math.min(b,d)):(e.Left=Math.max(a,d),e.Right=Math.min(b,c)):d>c?(e.Left=Math.max(b,c),e.Right=Math.min(a,d)):(e.Left=Math.max(b,d),e.Right=Math.min(a,c)),e.Left<e.Right},cb.Clipper.prototype.JoinHorz=function(a,b,c,d,e,f){var g=a.Pt.X>b.Pt.X?cb.Direction.dRightToLeft:cb.Direction.dLeftToRight,h=c.Pt.X>d.Pt.X?cb.Direction.dRightToLeft:cb.Direction.dLeftToRight;if(g==h)return!1;if(g==cb.Direction.dLeftToRight){for(;a.Next.Pt.X<=e.X&&a.Next.Pt.X>=a.Pt.X&&a.Next.Pt.Y==e.Y;)a=a.Next;f&&a.Pt.X!=e.X&&(a=a.Next),b=this.DupOutPt(a,!f),cb.IntPoint.op_Inequality(b.Pt,e)&&(a=b,a.Pt.X=e.X,a.Pt.Y=e.Y,b=this.DupOutPt(a,!f))}else{for(;a.Next.Pt.X>=e.X&&a.Next.Pt.X<=a.Pt.X&&a.Next.Pt.Y==e.Y;)a=a.Next;f||a.Pt.X==e.X||(a=a.Next),b=this.DupOutPt(a,f),cb.IntPoint.op_Inequality(b.Pt,e)&&(a=b,a.Pt.X=e.X,a.Pt.Y=e.Y,b=this.DupOutPt(a,f))}if(h==cb.Direction.dLeftToRight){for(;c.Next.Pt.X<=e.X&&c.Next.Pt.X>=c.Pt.X&&c.Next.Pt.Y==e.Y;)c=c.Next;f&&c.Pt.X!=e.X&&(c=c.Next),d=this.DupOutPt(c,!f),cb.IntPoint.op_Inequality(d.Pt,e)&&(c=d,c.Pt.X=e.X,c.Pt.Y=e.Y,d=this.DupOutPt(c,!f))}else{for(;c.Next.Pt.X>=e.X&&c.Next.Pt.X<=c.Pt.X&&c.Next.Pt.Y==e.Y;)c=c.Next;f||c.Pt.X==e.X||(c=c.Next),d=this.DupOutPt(c,f),cb.IntPoint.op_Inequality(d.Pt,e)&&(c=d,c.Pt.X=e.X,c.Pt.Y=e.Y,d=this.DupOutPt(c,f))}return g==cb.Direction.dLeftToRight==f?(a.Prev=c,c.Next=a,b.Next=d,d.Prev=b):(a.Next=c,c.Prev=a,b.Prev=d,d.Next=b),!0},cb.Clipper.prototype.JoinPoints=function(a,b,c){var d=a.OutPt1,e=new cb.OutPt,f=a.OutPt2,g=new cb.OutPt,h=a.OutPt1.Pt.Y==a.OffPt.Y;if(h&&cb.IntPoint.op_Equality(a.OffPt,a.OutPt1.Pt)&&cb.IntPoint.op_Equality(a.OffPt,a.OutPt2.Pt)){for(e=a.OutPt1.Next;e!=d&&cb.IntPoint.op_Equality(e.Pt,a.OffPt);)e=e.Next;var i=e.Pt.Y>a.OffPt.Y;for(g=a.OutPt2.Next;g!=f&&cb.IntPoint.op_Equality(g.Pt,a.OffPt);)g=g.Next;var j=g.Pt.Y>a.OffPt.Y;return i==j?!1:i?(e=this.DupOutPt(d,!1),g=this.DupOutPt(f,!0),d.Prev=f,f.Next=d,e.Next=g,g.Prev=e,a.OutPt1=d,a.OutPt2=e,!0):(e=this.DupOutPt(d,!0),g=this.DupOutPt(f,!1),d.Next=f,f.Prev=d,e.Prev=g,g.Next=e,a.OutPt1=d,a.OutPt2=e,!0)}if(h){for(e=d;d.Prev.Pt.Y==d.Pt.Y&&d.Prev!=e&&d.Prev!=f;)d=d.Prev;for(;e.Next.Pt.Y==e.Pt.Y&&e.Next!=d&&e.Next!=f;)e=e.Next;if(e.Next==d||e.Next==f)return!1;for(g=f;f.Prev.Pt.Y==f.Pt.Y&&f.Prev!=g&&f.Prev!=e;)f=f.Prev;for(;g.Next.Pt.Y==g.Pt.Y&&g.Next!=f&&g.Next!=d;)g=g.Next;if(g.Next==f||g.Next==d)return!1;var k={Left:null,Right:null};if(!this.GetOverlap(d.Pt.X,e.Pt.X,f.Pt.X,g.Pt.X,k))return!1;var l,m=k.Left,n=k.Right,o=new cb.IntPoint;return d.Pt.X>=m&&d.Pt.X<=n?(o.X=d.Pt.X,o.Y=d.Pt.Y,l=d.Pt.X>e.Pt.X):f.Pt.X>=m&&f.Pt.X<=n?(o.X=f.Pt.X,o.Y=f.Pt.Y,l=f.Pt.X>g.Pt.X):e.Pt.X>=m&&e.Pt.X<=n?(o.X=e.Pt.X,o.Y=e.Pt.Y,l=e.Pt.X>d.Pt.X):(o.X=g.Pt.X,o.Y=g.Pt.Y,l=g.Pt.X>f.Pt.X),a.OutPt1=d,a.OutPt2=f,this.JoinHorz(d,e,f,g,o,l)}for(e=d.Next;cb.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Next;var p=e.Pt.Y>d.Pt.Y||!cb.ClipperBase.SlopesEqual(d.Pt,e.Pt,a.OffPt,this.m_UseFullRange);if(p){for(e=d.Prev;cb.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Prev;if(e.Pt.Y>d.Pt.Y||!cb.ClipperBase.SlopesEqual(d.Pt,e.Pt,a.OffPt,this.m_UseFullRange))return!1}for(g=f.Next;cb.IntPoint.op_Equality(g.Pt,f.Pt)&&g!=f;)g=g.Next;var q=g.Pt.Y>f.Pt.Y||!cb.ClipperBase.SlopesEqual(f.Pt,g.Pt,a.OffPt,this.m_UseFullRange);if(q){for(g=f.Prev;cb.IntPoint.op_Equality(g.Pt,f.Pt)&&g!=f;)g=g.Prev;if(g.Pt.Y>f.Pt.Y||!cb.ClipperBase.SlopesEqual(f.Pt,g.Pt,a.OffPt,this.m_UseFullRange))return!1}return e==d||g==f||e==g||b==c&&p==q?!1:p?(e=this.DupOutPt(d,!1),g=this.DupOutPt(f,!0),d.Prev=f,f.Next=d,e.Next=g,g.Prev=e,a.OutPt1=d,a.OutPt2=e,!0):(e=this.DupOutPt(d,!0),g=this.DupOutPt(f,!1),d.Next=f,f.Prev=d,e.Prev=g,g.Next=e,a.OutPt1=d,a.OutPt2=e,!0)},cb.Clipper.GetBounds=function(a){for(var b=0,c=a.length;c>b&&0==a[b].length;)b++;if(b==c)return new cb.IntRect(0,0,0,0);var d=new cb.IntRect;for(d.left=a[b][0].X,d.right=d.left,d.top=a[b][0].Y,d.bottom=d.top;c>b;b++)for(var e=0,f=a[b].length;f>e;e++)a[b][e].X<d.left?d.left=a[b][e].X:a[b][e].X>d.right&&(d.right=a[b][e].X),a[b][e].Y<d.top?d.top=a[b][e].Y:a[b][e].Y>d.bottom&&(d.bottom=a[b][e].Y);return d},cb.Clipper.prototype.GetBounds2=function(a){var b=a,c=new cb.IntRect;for(c.left=a.Pt.X,c.right=a.Pt.X,c.top=a.Pt.Y,c.bottom=a.Pt.Y,a=a.Next;a!=b;)a.Pt.X<c.left&&(c.left=a.Pt.X),a.Pt.X>c.right&&(c.right=a.Pt.X),a.Pt.Y<c.top&&(c.top=a.Pt.Y),a.Pt.Y>c.bottom&&(c.bottom=a.Pt.Y),a=a.Next;return c},cb.Clipper.PointInPolygon=function(a,b){var c=0,d=b.length;if(3>d)return 0;for(var e=b[0],f=1;d>=f;++f){var g=f==d?b[0]:b[f];if(g.Y==a.Y&&(g.X==a.X||e.Y==a.Y&&g.X>a.X==e.X<a.X))return-1;if(e.Y<a.Y!=g.Y<a.Y)if(e.X>=a.X)if(g.X>a.X)c=1-c;else{var h=(e.X-a.X)*(g.Y-a.Y)-(g.X-a.X)*(e.Y-a.Y);if(0==h)return-1;h>0==g.Y>e.Y&&(c=1-c)}else if(g.X>a.X){var h=(e.X-a.X)*(g.Y-a.Y)-(g.X-a.X)*(e.Y-a.Y);if(0==h)return-1;h>0==g.Y>e.Y&&(c=1-c)}e=g}return c},cb.Clipper.prototype.PointInPolygon=function(a,b){for(var c=0,d=b;;){var e=b.Pt.X,f=b.Pt.Y,g=b.Next.Pt.X,h=b.Next.Pt.Y;if(h==a.Y&&(g==a.X||f==a.Y&&g>a.X==e<a.X))return-1;if(f<a.Y!=h<a.Y)if(e>=a.X)if(g>a.X)c=1-c;else{var i=(e-a.X)*(h-a.Y)-(g-a.X)*(f-a.Y);if(0==i)return-1;i>0==h>f&&(c=1-c)}else if(g>a.X){var i=(e-a.X)*(h-a.Y)-(g-a.X)*(f-a.Y);if(0==i)return-1;i>0==h>f&&(c=1-c)}if(b=b.Next,d==b)break}return c},cb.Clipper.prototype.Poly2ContainsPoly1=function(a,b){var c=a;do{var d=this.PointInPolygon(c.Pt,b);if(d>=0)return 0!=d;c=c.Next}while(c!=a);return!0},cb.Clipper.prototype.FixupFirstLefts1=function(a,b){for(var c=0,d=this.m_PolyOuts.length;d>c;c++){var e=this.m_PolyOuts[c];null!==e.Pts&&e.FirstLeft==a&&this.Poly2ContainsPoly1(e.Pts,b.Pts)&&(e.FirstLeft=b)}},cb.Clipper.prototype.FixupFirstLefts2=function(a,b){for(var c=0,d=this.m_PolyOuts,e=d.length,f=d[c];e>c;c++,f=d[c])f.FirstLeft==a&&(f.FirstLeft=b)},cb.Clipper.ParseFirstLeft=function(a){for(;null!=a&&null==a.Pts;)a=a.FirstLeft;return a},cb.Clipper.prototype.JoinCommonEdges=function(){for(var a=0,b=this.m_Joins.length;b>a;a++){var c=this.m_Joins[a],d=this.GetOutRec(c.OutPt1.Idx),e=this.GetOutRec(c.OutPt2.Idx);if(null!=d.Pts&&null!=e.Pts){var f;if(f=d==e?d:this.Param1RightOfParam2(d,e)?e:this.Param1RightOfParam2(e,d)?d:this.GetLowermostRec(d,e),this.JoinPoints(c,d,e))if(d==e){if(d.Pts=c.OutPt1,d.BottomPt=null,e=this.CreateOutRec(),e.Pts=c.OutPt2,this.UpdateOutPtIdxs(e),this.m_UsingPolyTree)for(var g=0,h=this.m_PolyOuts.length;h-1>g;g++){var i=this.m_PolyOuts[g];null!=i.Pts&&cb.Clipper.ParseFirstLeft(i.FirstLeft)==d&&i.IsHole!=d.IsHole&&this.Poly2ContainsPoly1(i.Pts,c.OutPt2)&&(i.FirstLeft=e)}this.Poly2ContainsPoly1(e.Pts,d.Pts)?(e.IsHole=!d.IsHole,e.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,d),(e.IsHole^this.ReverseSolution)==this.Area(e)>0&&this.ReversePolyPtLinks(e.Pts)):this.Poly2ContainsPoly1(d.Pts,e.Pts)?(e.IsHole=d.IsHole,d.IsHole=!e.IsHole,e.FirstLeft=d.FirstLeft,d.FirstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(d,e),(d.IsHole^this.ReverseSolution)==this.Area(d)>0&&this.ReversePolyPtLinks(d.Pts)):(e.IsHole=d.IsHole,e.FirstLeft=d.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(d,e))}else e.Pts=null,e.BottomPt=null,e.Idx=d.Idx,d.IsHole=f.IsHole,f==e&&(d.FirstLeft=e.FirstLeft),e.FirstLeft=d,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,d)}}},cb.Clipper.prototype.UpdateOutPtIdxs=function(a){var b=a.Pts;do b.Idx=a.Idx,b=b.Prev;while(b!=a.Pts)},cb.Clipper.prototype.DoSimplePolygons=function(){for(var a=0;a<this.m_PolyOuts.length;){var b=this.m_PolyOuts[a++],c=b.Pts;if(null!==c)do{for(var d=c.Next;d!=b.Pts;){if(cb.IntPoint.op_Equality(c.Pt,d.Pt)&&d.Next!=c&&d.Prev!=c){var e=c.Prev,f=d.Prev;c.Prev=f,f.Next=c,d.Prev=e,e.Next=d,b.Pts=c;var g=this.CreateOutRec();g.Pts=d,this.UpdateOutPtIdxs(g),this.Poly2ContainsPoly1(g.Pts,b.Pts)?(g.IsHole=!b.IsHole,g.FirstLeft=b):this.Poly2ContainsPoly1(b.Pts,g.Pts)?(g.IsHole=b.IsHole,b.IsHole=!g.IsHole,g.FirstLeft=b.FirstLeft,b.FirstLeft=g):(g.IsHole=b.IsHole,g.FirstLeft=b.FirstLeft),d=c}d=d.Next}c=c.Next}while(c!=b.Pts)}},cb.Clipper.Area=function(a){var b=a.length;if(3>b)return 0;for(var c=0,d=0,e=b-1;b>d;++d)c+=(a[e].X+a[d].X)*(a[e].Y-a[d].Y),e=d;return.5*-c},cb.Clipper.prototype.Area=function(a){var b=a.Pts;if(null==b)return 0;var c=0;do c+=(b.Prev.Pt.X+b.Pt.X)*(b.Prev.Pt.Y-b.Pt.Y),b=b.Next;while(b!=a.Pts);return.5*c},bb&&(cb.Clipper.OffsetPaths=function(a,b,c,d,e){var f=new cb.Paths,g=new cb.ClipperOffset(e,e);return g.AddPaths(a,c,d),g.Execute(f,b),f}),cb.Clipper.SimplifyPolygon=function(a,b){var c=new Array,d=new cb.Clipper(0);return d.StrictlySimple=!0,d.AddPath(a,cb.PolyType.ptSubject,!0),d.Execute(cb.ClipType.ctUnion,c,b,b),c},cb.Clipper.SimplifyPolygons=function(a,b){"undefined"==typeof b&&(b=cb.PolyFillType.pftEvenOdd);var c=new Array,d=new cb.Clipper(0);return d.StrictlySimple=!0,d.AddPaths(a,cb.PolyType.ptSubject,!0),d.Execute(cb.ClipType.ctUnion,c,b,b),c},cb.Clipper.DistanceSqrd=function(a,b){var c=a.X-b.X,d=a.Y-b.Y;return c*c+d*d},cb.Clipper.DistanceFromLineSqrd=function(a,b,c){var d=b.Y-c.Y,e=c.X-b.X,f=d*b.X+e*b.Y;return f=d*a.X+e*a.Y-f,f*f/(d*d+e*e)},cb.Clipper.SlopesNearCollinear=function(a,b,c,d){return cb.Clipper.DistanceFromLineSqrd(b,a,c)<d},cb.Clipper.PointsAreClose=function(a,b,c){var d=a.X-b.X,e=a.Y-b.Y;return c>=d*d+e*e},cb.Clipper.ExcludeOp=function(a){var b=a.Prev;return b.Next=a.Next,a.Next.Prev=b,b.Idx=0,b},cb.Clipper.CleanPolygon=function(a,b){"undefined"==typeof b&&(b=1.415);var c=a.length;if(0==c)return new Array;for(var d=new Array(c),e=0;c>e;++e)d[e]=new cb.OutPt;for(var e=0;c>e;++e)d[e].Pt=a[e],d[e].Next=d[(e+1)%c],d[e].Next.Prev=d[e],d[e].Idx=0;for(var f=b*b,g=d[0];0==g.Idx&&g.Next!=g.Prev;)cb.Clipper.PointsAreClose(g.Pt,g.Prev.Pt,f)?(g=cb.Clipper.ExcludeOp(g),c--):cb.Clipper.PointsAreClose(g.Prev.Pt,g.Next.Pt,f)?(cb.Clipper.ExcludeOp(g.Next),g=cb.Clipper.ExcludeOp(g),c-=2):cb.Clipper.SlopesNearCollinear(g.Prev.Pt,g.Pt,g.Next.Pt,f)?(g=cb.Clipper.ExcludeOp(g),c--):(g.Idx=1,g=g.Next);3>c&&(c=0);for(var h=new Array(c),e=0;c>e;++e)h[e]=new cb.IntPoint(g.Pt),g=g.Next;return d=null,h},cb.Clipper.CleanPolygons=function(a,b){for(var c=new Array(a.length),d=0,e=a.length;e>d;d++)c[d]=cb.Clipper.CleanPolygon(a[d],b);return c},cb.Clipper.Minkowski=function(a,b,c,d){var e=d?1:0,f=a.length,g=b.length,h=new Array;if(c)for(var i=0;g>i;i++){for(var j=new Array(f),k=0,l=a.length,m=a[k];l>k;k++,m=a[k])j[k]=new cb.IntPoint(b[i].X+m.X,b[i].Y+m.Y);h.push(j)}else for(var i=0;g>i;i++){for(var j=new Array(f),k=0,l=a.length,m=a[k];l>k;k++,m=a[k])j[k]=new cb.IntPoint(b[i].X-m.X,b[i].Y-m.Y);h.push(j)}for(var n=new Array,i=0;g-1+e>i;i++)for(var k=0;f>k;k++){var o=new Array;o.push(h[i%g][k%f]),o.push(h[(i+1)%g][k%f]),o.push(h[(i+1)%g][(k+1)%f]),o.push(h[i%g][(k+1)%f]),cb.Clipper.Orientation(o)||o.reverse(),n.push(o)}var p=new cb.Clipper(0);return p.AddPaths(n,cb.PolyType.ptSubject,!0),p.Execute(cb.ClipType.ctUnion,h,cb.PolyFillType.pftNonZero,cb.PolyFillType.pftNonZero),h},cb.Clipper.MinkowskiSum=function(){var a=arguments,b=a.length;if(3==b){var c=a[0],d=a[1],e=a[2];return cb.Clipper.Minkowski(c,d,!0,e)}if(4==b){for(var f,c=a[0],g=a[1],h=a[2],e=a[3],i=new cb.Clipper,j=0,k=g.length;k>j;++j){var f=cb.Clipper.Minkowski(c,g[j],!0,e);i.AddPaths(f,cb.PolyType.ptSubject,!0)}e&&i.AddPaths(g,cb.PolyType.ptClip,!0);var l=new cb.Paths;return i.Execute(cb.ClipType.ctUnion,l,h,h),l}},cb.Clipper.MinkowskiDiff=function(a,b,c){return cb.Clipper.Minkowski(a,b,!1,c)},cb.Clipper.PolyTreeToPaths=function(a){var b=new Array;return cb.Clipper.AddPolyNodeToPaths(a,cb.Clipper.NodeType.ntAny,b),b},cb.Clipper.AddPolyNodeToPaths=function(a,b,c){var d=!0;switch(b){case cb.Clipper.NodeType.ntOpen:return;case cb.Clipper.NodeType.ntClosed:d=!a.IsOpen}a.m_polygon.length>0&&d&&c.push(a.m_polygon);for(var e=0,f=a.Childs(),g=f.length,h=f[e];g>e;e++,h=f[e])cb.Clipper.AddPolyNodeToPaths(h,b,c)},cb.Clipper.OpenPathsFromPolyTree=function(a){for(var b=new cb.Paths,c=0,d=a.ChildCount();d>c;c++)a.Childs()[c].IsOpen&&b.push(a.Childs()[c].m_polygon);return b},cb.Clipper.ClosedPathsFromPolyTree=function(a){var b=new cb.Paths;return cb.Clipper.AddPolyNodeToPaths(a,cb.Clipper.NodeType.ntClosed,b),b},sb(cb.Clipper,cb.ClipperBase),cb.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},cb.ClipperOffset=function(a,b){"undefined"==typeof a&&(a=2),"undefined"==typeof b&&(b=cb.ClipperOffset.def_arc_tolerance),this.m_destPolys=new cb.Paths,this.m_srcPoly=new cb.Path,this.m_destPoly=new cb.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new cb.IntPoint,this.m_polyNodes=new cb.PolyNode,this.MiterLimit=a,this.ArcTolerance=b,this.m_lowest.X=-1},cb.ClipperOffset.two_pi=6.28318530717959,cb.ClipperOffset.def_arc_tolerance=.25,cb.ClipperOffset.prototype.Clear=function(){cb.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},cb.ClipperOffset.Round=cb.Clipper.Round,cb.ClipperOffset.prototype.AddPath=function(a,b,c){var d=a.length-1;if(!(0>d)){var e=new cb.PolyNode;if(e.m_jointype=b,e.m_endtype=c,c==cb.EndType.etClosedLine||c==cb.EndType.etClosedPolygon)for(;d>0&&cb.IntPoint.op_Equality(a[0],a[d]);)d--;e.m_polygon.push(a[0]);for(var f=0,g=0,h=1;d>=h;h++)cb.IntPoint.op_Inequality(e.m_polygon[f],a[h])&&(f++,e.m_polygon.push(a[h]),(a[h].Y>e.m_polygon[g].Y||a[h].Y==e.m_polygon[g].Y&&a[h].X<e.m_polygon[g].X)&&(g=f));if(!(c==cb.EndType.etClosedPolygon&&2>f||c!=cb.EndType.etClosedPolygon&&0>f)&&(this.m_polyNodes.AddChild(e),c==cb.EndType.etClosedPolygon))if(this.m_lowest.X<0)this.m_lowest=new cb.IntPoint(0,g);else{var i=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y];(e.m_polygon[g].Y>i.Y||e.m_polygon[g].Y==i.Y&&e.m_polygon[g].X<i.X)&&(this.m_lowest=new cb.IntPoint(this.m_polyNodes.ChildCount()-1,g))}}},cb.ClipperOffset.prototype.AddPaths=function(a,b,c){
for(var d=0,e=a.length;e>d;d++)this.AddPath(a[d],b,c)},cb.ClipperOffset.prototype.FixOrientations=function(){if(this.m_lowest.X>=0&&!cb.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var a=0;a<this.m_polyNodes.ChildCount();a++){var b=this.m_polyNodes.Childs()[a];(b.m_endtype==cb.EndType.etClosedPolygon||b.m_endtype==cb.EndType.etClosedLine&&cb.Clipper.Orientation(b.m_polygon))&&b.m_polygon.reverse()}else for(var a=0;a<this.m_polyNodes.ChildCount();a++){var b=this.m_polyNodes.Childs()[a];b.m_endtype!=cb.EndType.etClosedLine||cb.Clipper.Orientation(b.m_polygon)||b.m_polygon.reverse()}},cb.ClipperOffset.GetUnitNormal=function(a,b){var c=b.X-a.X,d=b.Y-a.Y;if(0==c&&0==d)return new cb.DoublePoint(0,0);var e=1/Math.sqrt(c*c+d*d);return c*=e,d*=e,new cb.DoublePoint(d,-c)},cb.ClipperOffset.prototype.DoOffset=function(a){if(this.m_destPolys=new Array,this.m_delta=a,cb.ClipperBase.near_zero(a))for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];c.m_endtype==cb.EndType.etClosedPolygon&&this.m_destPolys.push(c.m_polygon)}else{this.m_miterLim=this.MiterLimit>2?2/(this.MiterLimit*this.MiterLimit):.5;var d;d=this.ArcTolerance<=0?cb.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(a)*cb.ClipperOffset.def_arc_tolerance?Math.abs(a)*cb.ClipperOffset.def_arc_tolerance:this.ArcTolerance;var e=3.14159265358979/Math.acos(1-d/Math.abs(a));this.m_sin=Math.sin(cb.ClipperOffset.two_pi/e),this.m_cos=Math.cos(cb.ClipperOffset.two_pi/e),this.m_StepsPerRad=e/cb.ClipperOffset.two_pi,0>a&&(this.m_sin=-this.m_sin);for(var b=0;b<this.m_polyNodes.ChildCount();b++){var c=this.m_polyNodes.Childs()[b];this.m_srcPoly=c.m_polygon;var f=this.m_srcPoly.length;if(!(0==f||0>=a&&(3>f||c.m_endtype!=cb.EndType.etClosedPolygon)))if(this.m_destPoly=new Array,1!=f){this.m_normals.length=0;for(var g=0;f-1>g;g++)this.m_normals.push(cb.ClipperOffset.GetUnitNormal(this.m_srcPoly[g],this.m_srcPoly[g+1]));if(this.m_normals.push(c.m_endtype==cb.EndType.etClosedLine||c.m_endtype==cb.EndType.etClosedPolygon?cb.ClipperOffset.GetUnitNormal(this.m_srcPoly[f-1],this.m_srcPoly[0]):new cb.DoublePoint(this.m_normals[f-2])),c.m_endtype==cb.EndType.etClosedPolygon){for(var h=f-1,g=0;f>g;g++)h=this.OffsetPoint(g,h,c.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(c.m_endtype==cb.EndType.etClosedLine){for(var h=f-1,g=0;f>g;g++)h=this.OffsetPoint(g,h,c.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;for(var i=this.m_normals[f-1],g=f-1;g>0;g--)this.m_normals[g]=new cb.DoublePoint(-this.m_normals[g-1].X,-this.m_normals[g-1].Y);this.m_normals[0]=new cb.DoublePoint(-i.X,-i.Y),h=0;for(var g=f-1;g>=0;g--)h=this.OffsetPoint(g,h,c.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{for(var h=0,g=1;f-1>g;++g)h=this.OffsetPoint(g,h,c.m_jointype);var j;if(c.m_endtype==cb.EndType.etOpenButt){var g=f-1;j=new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[g].X+this.m_normals[g].X*a),cb.ClipperOffset.Round(this.m_srcPoly[g].Y+this.m_normals[g].Y*a)),this.m_destPoly.push(j),j=new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[g].X-this.m_normals[g].X*a),cb.ClipperOffset.Round(this.m_srcPoly[g].Y-this.m_normals[g].Y*a)),this.m_destPoly.push(j)}else{var g=f-1;h=f-2,this.m_sinA=0,this.m_normals[g]=new cb.DoublePoint(-this.m_normals[g].X,-this.m_normals[g].Y),c.m_endtype==cb.EndType.etOpenSquare?this.DoSquare(g,h):this.DoRound(g,h)}for(var g=f-1;g>0;g--)this.m_normals[g]=new cb.DoublePoint(-this.m_normals[g-1].X,-this.m_normals[g-1].Y);this.m_normals[0]=new cb.DoublePoint(-this.m_normals[1].X,-this.m_normals[1].Y),h=f-1;for(var g=h-1;g>0;--g)h=this.OffsetPoint(g,h,c.m_jointype);c.m_endtype==cb.EndType.etOpenButt?(j=new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*a),cb.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*a)),this.m_destPoly.push(j),j=new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*a),cb.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*a)),this.m_destPoly.push(j)):(h=1,this.m_sinA=0,c.m_endtype==cb.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}else{if(c.m_jointype==cb.JoinType.jtRound)for(var k=1,l=0,g=1;e>=g;g++){this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[0].X+k*a),cb.ClipperOffset.Round(this.m_srcPoly[0].Y+l*a)));var m=k;k=k*this.m_cos-this.m_sin*l,l=m*this.m_sin+l*this.m_cos}else for(var k=-1,l=-1,g=0;4>g;++g)this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[0].X+k*a),cb.ClipperOffset.Round(this.m_srcPoly[0].Y+l*a))),0>k?k=1:0>l?l=1:k=-1;this.m_destPolys.push(this.m_destPoly)}}}},cb.ClipperOffset.prototype.Execute=function(){var a=arguments,b=a[0]instanceof cb.PolyTree;if(b){var c=a[0],d=a[1];c.Clear(),this.FixOrientations(),this.DoOffset(d);var e=new cb.Clipper(0);if(e.AddPaths(this.m_destPolys,cb.PolyType.ptSubject,!0),d>0)e.Execute(cb.ClipType.ctUnion,c,cb.PolyFillType.pftPositive,cb.PolyFillType.pftPositive);else{var f=cb.Clipper.GetBounds(this.m_destPolys),g=new cb.Path;if(g.push(new cb.IntPoint(f.left-10,f.bottom+10)),g.push(new cb.IntPoint(f.right+10,f.bottom+10)),g.push(new cb.IntPoint(f.right+10,f.top-10)),g.push(new cb.IntPoint(f.left-10,f.top-10)),e.AddPath(g,cb.PolyType.ptSubject,!0),e.ReverseSolution=!0,e.Execute(cb.ClipType.ctUnion,c,cb.PolyFillType.pftNegative,cb.PolyFillType.pftNegative),1==c.ChildCount()&&c.Childs()[0].ChildCount()>0){var h=c.Childs()[0];c.Childs()[0]=h.Childs()[0];for(var i=1;i<h.ChildCount();i++)c.AddChild(h.Childs()[i])}else c.Clear()}}else{var c=a[0],d=a[1];cb.Clear(c),this.FixOrientations(),this.DoOffset(d);var e=new cb.Clipper(0);if(e.AddPaths(this.m_destPolys,cb.PolyType.ptSubject,!0),d>0)e.Execute(cb.ClipType.ctUnion,c,cb.PolyFillType.pftPositive,cb.PolyFillType.pftPositive);else{var f=cb.Clipper.GetBounds(this.m_destPolys),g=new cb.Path;g.push(new cb.IntPoint(f.left-10,f.bottom+10)),g.push(new cb.IntPoint(f.right+10,f.bottom+10)),g.push(new cb.IntPoint(f.right+10,f.top-10)),g.push(new cb.IntPoint(f.left-10,f.top-10)),e.AddPath(g,cb.PolyType.ptSubject,!0),e.ReverseSolution=!0,e.Execute(cb.ClipType.ctUnion,c,cb.PolyFillType.pftNegative,cb.PolyFillType.pftNegative),c.length>0&&c.splice(0,1)}}},cb.ClipperOffset.prototype.OffsetPoint=function(a,b,c){if(this.m_sinA=this.m_normals[b].X*this.m_normals[a].Y-this.m_normals[a].X*this.m_normals[b].Y,this.m_sinA<5e-5&&this.m_sinA>-5e-5)return b;if(this.m_sinA>1?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1),this.m_sinA*this.m_delta<0)this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[b].X*this.m_delta),cb.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[b].Y*this.m_delta))),this.m_destPoly.push(new cb.IntPoint(this.m_srcPoly[a])),this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[a].X*this.m_delta),cb.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*this.m_delta)));else switch(c){case cb.JoinType.jtMiter:var d=1+(this.m_normals[a].X*this.m_normals[b].X+this.m_normals[a].Y*this.m_normals[b].Y);d>=this.m_miterLim?this.DoMiter(a,b,d):this.DoSquare(a,b);break;case cb.JoinType.jtSquare:this.DoSquare(a,b);break;case cb.JoinType.jtRound:this.DoRound(a,b)}return b=a},cb.ClipperOffset.prototype.DoSquare=function(a,b){var c=Math.tan(Math.atan2(this.m_sinA,this.m_normals[b].X*this.m_normals[a].X+this.m_normals[b].Y*this.m_normals[a].Y)/4);this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_delta*(this.m_normals[b].X-this.m_normals[b].Y*c)),cb.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_delta*(this.m_normals[b].Y+this.m_normals[b].X*c)))),this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_delta*(this.m_normals[a].X+this.m_normals[a].Y*c)),cb.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_delta*(this.m_normals[a].Y-this.m_normals[a].X*c))))},cb.ClipperOffset.prototype.DoMiter=function(a,b,c){var d=this.m_delta/c;this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[a].X+(this.m_normals[b].X+this.m_normals[a].X)*d),cb.ClipperOffset.Round(this.m_srcPoly[a].Y+(this.m_normals[b].Y+this.m_normals[a].Y)*d)))},cb.ClipperOffset.prototype.DoRound=function(a,b){for(var c,d=Math.atan2(this.m_sinA,this.m_normals[b].X*this.m_normals[a].X+this.m_normals[b].Y*this.m_normals[a].Y),e=cb.Cast_Int32(cb.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(d))),f=this.m_normals[b].X,g=this.m_normals[b].Y,h=0;e>h;++h)this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[a].X+f*this.m_delta),cb.ClipperOffset.Round(this.m_srcPoly[a].Y+g*this.m_delta))),c=f,f=f*this.m_cos-this.m_sin*g,g=c*this.m_sin+g*this.m_cos;this.m_destPoly.push(new cb.IntPoint(cb.ClipperOffset.Round(this.m_srcPoly[a].X+this.m_normals[a].X*this.m_delta),cb.ClipperOffset.Round(this.m_srcPoly[a].Y+this.m_normals[a].Y*this.m_delta)))},cb.Error=function(a){try{throw new Error(a)}catch(b){alert(b.message)}},cb.JS={},cb.JS.AreaOfPolygon=function(a,b){return b||(b=1),cb.Clipper.Area(a)/(b*b)},cb.JS.AreaOfPolygons=function(a,b){b||(b=1);for(var c=0,d=0;d<a.length;d++)c+=cb.Clipper.Area(a[d]);return c/(b*b)},cb.JS.BoundsOfPath=function(a,b){return cb.JS.BoundsOfPaths([a],b)},cb.JS.BoundsOfPaths=function(a,b){b||(b=1);var c=cb.Clipper.GetBounds(a);return c.left/=b,c.bottom/=b,c.right/=b,c.top/=b,c},cb.JS.Clean=function(a,b){if(!(a instanceof Array))return[];var c=a[0]instanceof Array,a=cb.JS.Clone(a);if("number"!=typeof b||null===b)return cb.Error("Delta is not a number in Clean()."),a;if(0===a.length||1==a.length&&0===a[0].length||0>b)return a;c||(a=[a]);for(var d,e,f,g,h,i,j,k=a.length,l=[],m=0;k>m;m++)if(e=a[m],d=e.length,0!==d)if(3>d)f=e,l.push(f);else{for(f=e,g=b*b,h=e[0],i=1,j=1;d>j;j++)(e[j].X-h.X)*(e[j].X-h.X)+(e[j].Y-h.Y)*(e[j].Y-h.Y)<=g||(f[i]=e[j],h=e[j],i++);h=e[i-1],(e[0].X-h.X)*(e[0].X-h.X)+(e[0].Y-h.Y)*(e[0].Y-h.Y)<=g&&i--,d>i&&f.splice(i,d-i),f.length&&l.push(f)}return!c&&l.length?l=l[0]:c||0!==l.length?c&&0===l.length&&(l=[[]]):l=[],l},cb.JS.Clone=function(a){if(!(a instanceof Array))return[];if(0===a.length)return[];if(1==a.length&&0===a[0].length)return[[]];var b=a[0]instanceof Array;b||(a=[a]);var c,d,e,f,g=a.length,h=new Array(g);for(d=0;g>d;d++){for(c=a[d].length,f=new Array(c),e=0;c>e;e++)f[e]={X:a[d][e].X,Y:a[d][e].Y};h[d]=f}return b||(h=h[0]),h},cb.JS.Lighten=function(a,b){if(!(a instanceof Array))return[];if("number"!=typeof b||null===b)return cb.Error("Tolerance is not a number in Lighten()."),cb.JS.Clone(a);if(0===a.length||1==a.length&&0===a[0].length||0>b)return cb.JS.Clone(a);a[0]instanceof Array||(a=[a]);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=a.length,u=b*b,v=[];for(c=0;t>c;c++)if(e=a[c],h=e.length,0!=h){for(f=0;1e6>f;f++){for(g=[],h=e.length,e[h-1].X!=e[0].X||e[h-1].Y!=e[0].Y?(n=1,e.push({X:e[0].X,Y:e[0].Y}),h=e.length):n=0,m=[],d=0;h-2>d;d++)i=e[d],k=e[d+1],j=e[d+2],r=i.X,s=i.Y,o=j.X-r,p=j.Y-s,(0!==o||0!==p)&&(q=((k.X-r)*o+(k.Y-s)*p)/(o*o+p*p),q>1?(r=j.X,s=j.Y):q>0&&(r+=o*q,s+=p*q)),o=k.X-r,p=k.Y-s,l=o*o+p*p,u>=l&&(m[d+1]=1,d++);for(g.push({X:e[0].X,Y:e[0].Y}),d=1;h-1>d;d++)m[d]||g.push({X:e[d].X,Y:e[d].Y});if(g.push({X:e[h-1].X,Y:e[h-1].Y}),n&&e.pop(),!m.length)break;e=g}h=g.length,g[h-1].X==g[0].X&&g[h-1].Y==g[0].Y&&g.pop(),g.length>2&&v.push(g)}return!a[0]instanceof Array&&(v=v[0]),"undefined"==typeof v&&(v=[[]]),v},cb.JS.PerimeterOfPath=function(a,b,c){if("undefined"==typeof a)return 0;var d,e,f=Math.sqrt,g=0,h=0,i=0,j=0,k=0,l=a.length;if(2>l)return 0;for(b&&(a[l]=a[0],l++);--l;)d=a[l],h=d.X,i=d.Y,e=a[l-1],j=e.X,k=e.Y,g+=f((h-j)*(h-j)+(i-k)*(i-k));return b&&a.pop(),g/c},cb.JS.PerimeterOfPaths=function(a,b,c){c||(c=1);for(var d=0,e=0;e<a.length;e++)d+=cb.JS.PerimeterOfPath(a[e],b,c);return d},cb.JS.ScaleDownPath=function(a,b){var c,d;for(b||(b=1),c=a.length;c--;)d=a[c],d.X=d.X/b,d.Y=d.Y/b},cb.JS.ScaleDownPaths=function(a,b){{var c,d,e;Math.round}for(b||(b=1),c=a.length;c--;)for(d=a[c].length;d--;)e=a[c][d],e.X=e.X/b,e.Y=e.Y/b},cb.JS.ScaleUpPath=function(a,b){var c,d,e=Math.round;for(b||(b=1),c=a.length;c--;)d=a[c],d.X=e(d.X*b),d.Y=e(d.Y*b)},cb.JS.ScaleUpPaths=function(a,b){var c,d,e,f=Math.round;for(b||(b=1),c=a.length;c--;)for(d=a[c].length;d--;)e=a[c][d],e.X=f(e.X*b),e.Y=f(e.Y*b)},cb.ExPolygons=function(){return[]},cb.ExPolygon=function(){this.outer=null,this.holes=null},cb.JS.AddOuterPolyNodeToExPolygons=function(a,b){var c=new cb.ExPolygon;c.outer=a.Contour();var d=a.Childs(),e=d.length;c.holes=new Array(e);var f,g,h,i,j,k;for(h=0;e>h;h++)for(f=d[h],c.holes[h]=f.Contour(),i=0,j=f.Childs(),k=j.length;k>i;i++)g=j[i],cb.JS.AddOuterPolyNodeToExPolygons(g,b);b.push(c)},cb.JS.ExPolygonsToPaths=function(a){var b,c,d,e,f=new cb.Paths;for(b=0,d=a.length;d>b;b++)for(f.push(a[b].outer),c=0,e=a[b].holes.length;e>c;c++)f.push(a[b].holes[c]);return f},cb.JS.PolyTreeToExPolygons=function(a){var b,c,d,e,f=new cb.ExPolygons;for(c=0,d=a.Childs(),e=d.length;e>c;c++)b=d[c],cb.JS.AddOuterPolyNodeToExPolygons(b,f);return f}}();var initAligningGuidelines;initAligningGuidelines=function(a){var b,c,d,e,f,g,h,i,j,k,l,m;return i=function(a){return h(a.x+.5,a.y1>a.y2?a.y2:a.y1,a.x+.5,a.y2>a.y1?a.y2:a.y1)},g=function(a){return h(a.x1>a.x2?a.x2:a.x1,a.y+.5,a.x2>a.x1?a.x2:a.x1,a.y+.5)},h=function(a,c,d,g){return f.save(),f.lineWidth=e,f.strokeStyle=b,f.beginPath(),f.moveTo(a*m[0],c*m[3]),f.lineTo(d*m[0],g*m[3]),f.stroke(),f.restore()},k=function(a,b){var d,e;for(a=Math.round(a),b=Math.round(b),d=a-c,e=a+c;e>=d;){if(d===b)return!0;d++}return!1},f=a.getSelectionContext(),d=5,c=4,e=1,b="rgb(0,255,0)",m=void 0,l=[],j=[],a.on("mouse:down",function(){return m=a.viewportTransform}),a.on("object:moving",function(b){var c,e,f,g,h,i,n,o,p,q,r,s,t,u,v,w;if(c=b.target,n=a.getObjects(),e=c.getCenterPoint(),g=e.x,h=e.y,f=c.getBoundingRectHeight()/m[3],i=c.getBoundingRectWidth()/m[0],o=!1,w=!1,v=a._currentTransform){for(p=n.length;p--;)n[p]!==c&&"beacon"!==n[p].type&&(q=n[p].getCenterPoint(),s=q.x,t=q.y,r=n[p].getBoundingRectHeight()/m[3],u=n[p].getBoundingRectWidth()/m[0],k(s-u/2,g-i/2)&&(w=!0,l.push({x:s-u/2,y1:h>t?t-r/2-d:t+r/2+d,y2:h>t?h+f/2+d:h-f/2-d}),c.setPositionByOrigin(new fabric.Point(s-u/2+i/2,h),"center","center")),k(s+u/2,g+i/2)&&(w=!0,l.push({x:s+u/2,y1:h>t?t-r/2-d:t+r/2+d,y2:h>t?h+f/2+d:h-f/2-d}),c.setPositionByOrigin(new fabric.Point(s+u/2-i/2,h),"center","center")),k(t-r/2,h-f/2)&&(o=!0,j.push({y:t-r/2,x1:g>s?s-u/2-d:s+u/2+d,x2:g>s?g+i/2+d:g-i/2-d}),c.setPositionByOrigin(new fabric.Point(g,t-r/2+f/2),"center","center")),k(t+r/2,h+f/2)&&(o=!0,j.push({y:t+r/2,x1:g>s?s-u/2-d:s+u/2+d,x2:g>s?g+i/2+d:g-i/2-d}),c.setPositionByOrigin(new fabric.Point(g,t+r/2-f/2),"center","center")));return o||(j.length=0),w?void 0:l.length=0}}),a.on("before:render",function(){return a.clearContext(a.contextTop)}),a.on("after:render",function(){var a;for(a=l.length;a--;)i(l[a]);for(a=j.length;a--;)g(j[a]);return l.length=j.length=0}),a.on("mouse:up",function(){return l.length=j.length=0,a.renderAll()})},function(a){"use strict";var b,c,d;return c=a.fabric||(a.fabric={}),b=c.util.object.extend,c.Shelf?void console.warn("fabric.Shelf is already defined"):(d=c.Object.prototype.stateProperties.concat(),d.push("id","count","side","top_cm","left_cm","eachWidth","eachHeight","label"),c.Shelf=c.util.createClass(c.Object,{stateProperties:d,type:"shelf",eachWidth:90,eachHeight:25,__width:function(){return this.__eachWidth()*this.count},__height:function(){return this.__eachHeight()*this.side},__eachWidth:function(){return this.eachWidth*haika.scaleFactor},__eachHeight:function(){return this.eachHeight*haika.scaleFactor},count:1,side:1,minScaleLimit:1,strokeDashArray:null,fill:"#ffffff",stroke:"#afafaf",initialize:function(a){a=a||{},this.callSuper("initialize",a),this.width=this.__width(),this.height=this.__height(),this.transparentCorners=!1,this.cornerColor="#ffffff"},_render:function(a){var b,c,d,e,f,g,h,i;this.selectable?this.active?(this.fill="rgba(255,77,77,1)",this.stroke="rgba(255,255,255,1)",this.strokeWidth=2):(this.fill="rgba(255,77,77,1)",this.stroke="rgba(255,255,255,1)",this.strokeWidth=2):(this.fill="#ffffff",this.stroke="#afafaf",this.strokeWidth=1),a.strokeStyle=this.stroke,a.fillStyle=this.fill,a.save(),a.scale(1/this.scaleX,1/this.scaleY),e=0,0===this.scaleX||"mr"!==this.__corner&&"tr"!==this.__corner&&"br"!==this.__corner||(e=(this.count*this.__eachWidth()-this.width*this.scaleX)/2),0===this.scaleX||"ml"!==this.__corner&&"tl"!==this.__corner&&"bl"!==this.__corner||(e=-1*(this.count*this.__eachWidth()-this.width*this.scaleX)/2),f=0,0!==this.scaleY&&"mb"===this.__corner&&(f=(this.side*this.__eachHeight()-this.height*this.scaleY)/2),0!==this.scaleY&&"mt"===this.__corner&&(f=-1*(this.side*this.__eachHeight()-this.height*this.scaleY)/2),g=this.__eachWidth(),b=this.__eachHeight(),h=-g/2*this.count+e,i=-b/2*this.side+f,c=this.group&&"path-group"===this.group.type,a.globalAlpha=c?a.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&c&&a.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&c&&a.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y),1===this.side&&(this.__renderShelf(a,h,i,g,b),haika.scaleFactor>.5&&this.__renderSide(a,h,i,g,b)),2===this.side&&this.__renderShelf(a,h,i,g,b),this.active&&!this.isMoving&&(a.font="12px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="rgba(0, 0, 0,1)",d=1===this.side?"":"",d="["+this.id+"] "+d+this.count+"",a.fillText(d,0,this.height*this.scaleY/2+15)),a.restore()},__renderShelf:function(a,b,c,d,e){return this.__renderRect(a,b,c,d*this.count,e),this.__renderPartitionLine(a,b,c,d,e),2===this.side?(this.__renderRect(a,b,c+e,d*this.count,e),this.__renderPartitionLine(a,b,c+e,d,e)):void 0},__renderRect:function(a,b,c,d,e){return a.lineWidth=2,a.beginPath(),a.moveTo(b,c),a.lineTo(b+d,c),a.lineTo(b+d,c+e),a.lineTo(b,c+e),a.lineTo(b,c),a.closePath(),this._renderFill(a),this._renderStroke(a)},__renderPartitionLine:function(a,b,c,d,e){var f;if(1!==this.count){for(a.lineWidth=2,a.beginPath(),f=1;f<this.count;)a.moveTo(b+d*f,c),a.lineTo(b+d*f,c+e),f++;return a.closePath(),this._renderStroke(a)}},__renderSide:function(a,b,c,d,e){return a.lineWidth=5,a.beginPath(),a.moveTo(b,c+e-1),a.lineTo(b+d*this.count,c+e-1),a.closePath(),this._renderStroke(a)},__rotating:function(){return log("__rotating"),Math.abs(this.originalState.angle-this.angle)>20&&(this.angle=this.angle%360,(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280)?this.angle=270:void 0},__moving:function(){return this.left=10*Math.round(this.left/haika.scaleFactor/10)*haika.scaleFactor,this.top=10*Math.round(this.top/haika.scaleFactor/10)*haika.scaleFactor},__resizeShelf:function(){var a,b,c,d,e;return log("__resizeShelf"),d=this._calculateCurrentDimensions(!1),c=d.x,b=d.y,a=Math.floor(c/this.__eachWidth()),1>a&&(a=1),a>15&&(a=15),e=Math.round(b/this.__eachHeight()),1>e&&(e=1),e>2&&(e=2),this.set({count:a,side:e,minScaleLimit:.01,flipX:!1,flipY:!1})},__modifiedShelf:function(){var a;return this.centeredScaling=!1,log("__modifiedShelf"),0===this.scaleX||"mr"!==this.__corner&&"tr"!==this.__corner&&"br"!==this.__corner||(a=this.angle*(Math.PI/180),this.top=this.top+Math.sin(a)*(this.count*this.__eachWidth()-this.width*this.scaleX)/2,this.left=this.left+Math.cos(a)*(this.count*this.__eachWidth()-this.width*this.scaleX)/2),0===this.scaleX||"ml"!==this.__corner&&"tl"!==this.__corner&&"bl"!==this.__corner||(a=this.angle*(Math.PI/180),this.top=this.top-Math.sin(a)*(this.count*this.__eachWidth()-this.width*this.scaleX)/2,this.left=this.left-Math.cos(a)*(this.count*this.__eachWidth()-this.width*this.scaleX)/2),0!==this.scaleY&&"mb"===this.__corner&&(a=this.angle*(Math.PI/180),this.left=this.left+Math.sin(a)*(this.side*this.__eachHeight()-this.height*this.scaleY)/2,this.top=this.top+Math.cos(a)*(this.side*this.__eachHeight()-this.height*this.scaleY)/2),0!==this.scaleY&&"mt"===this.__corner&&(a=this.angle*(Math.PI/180),this.left=this.left-Math.sin(a)*(this.side*this.__eachHeight()-this.height*this.scaleY)/2,this.top=this.top-Math.cos(a)*(this.side*this.__eachHeight()-this.height*this.scaleY)/2),this.scaleX=this.scaleY=1,this.width=this.__width(),this.height=this.__height(),this.setCoords()},_renderDashedStroke:function(a){var b,d,e,f;e=-this.width/2,f=-this.height/2,d=this.width,b=this.height,a.beginPath(),c.util.drawDashedLine(a,e,f,e+d,f,this.strokeDashArray),c.util.drawDashedLine(a,e+d,f,e+d,f+b,this.strokeDashArray),c.util.drawDashedLine(a,e+d,f+b,e,f+b,this.strokeDashArray),c.util.drawDashedLine(a,e,f+b,e,f,this.strokeDashArray),a.closePath()},_normalizeLeftTopProperties:function(a){return"left"in a&&this.set("left",a.left+this.getWidth()/2),this.set("x",a.left||0),"top"in a&&this.set("top",a.top+this.getHeight()/2),this.set("y",a.top||0),this},toObject:function(a){var c;return c=b(this.callSuper("toObject",a),{count:this.get("count"),side:this.get("side")}),this.includeDefaultValues||this._removeDefaultValues(c),c},toGeoJSON:function(){var a,b,d,e,f,g,h,i,j,k,l;for(j=this.eachWidth*this.count,d=this.eachHeight*this.side,k=-j/2+this.left_cm,l=-d/2+this.top_cm,h=[],i=[[k,l],[k+j,l],[k+j,l+d],[k,l+d],[k,l]],e=0,f=i.length;f>e;e++)a=i[e],g=c.util.rotatePoint(new c.Point(a[0],a[1]),new c.Point(this.left_cm,this.top_cm),c.util.degreesToRadians(this.angle)),h.push([-g.x,g.y]);return b={type:"Feature",geometry:{type:"Polygon",coordinates:[h]},properties:{type:this.type,left_cm:this.left_cm,top_cm:this.top_cm,eachWidth:this.eachWidth,eachHeight:this.eachHeight,id:this.id,count:this.count,side:this.side,angle:this.angle}}},getJSONSchema:function(){var a;return a={title:"",type:"object",properties:{count:{title:"",type:"integer","default":3,minimum:1,maximum:15},side:{type:"integer","default":1,minimum:1,maximum:2},angle:{type:"integer","default":0,minimum:0,maximum:360},eachWidth:{type:"integer","default":90,minimum:1},eachHeight:{type:"integer","default":25,minimum:1}}}},complexity:function(){return 1}}),void(c.Shelf.fromObject=function(a){return new c.Shelf(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b,c,d,e;return b=function(a){return a.left=a.left||0,a.top=a.top||0,a},d=a.fabric||(a.fabric={}),c=d.util.object.extend,d.curvedShelf?void console.warn("fabric.curvedShelf is already defined"):(e=d.Object.prototype.stateProperties.concat(),e.push("rx","ry","x","y"),d.curvedShelf=d.util.createClass(d.Object,{stateProperties:e,type:"curved_shelf",rx:0,ry:0,x:0,y:0,__width:function(){return this.__eachWidth()*this.count},__height:function(){return this.__eachHeight()*this.side},__eachWidth:function(){return 90*haika.scaleFactor},__eachHeight:function(){return 25*haika.scaleFactor},count:1,side:1,minScaleLimit:1,strokeDashArray:null,initialize:function(a){a=a||{},this.callSuper("initialize",a),this._initRxRy(),this.x=a.x||0,this.y=a.y||0,this.width=this.__width(),this.height=this.__height()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(a){var b,c,d,e,f,g;return 1===this.width&&1===this.height?void a.fillRect(0,0,1,1):(a.scale(1/this.scaleX,1/this.scaleY),c=(180-30*this.count)/2*Math.PI/180,b=c+30*this.count*Math.PI/180,d=0,e=0,a.beginPath(),a.arc(d,e,this.height*this.scaleY/2,c,b,!1),g=this.height*this.scaleY/2-this.__eachHeight()*this.side,10>=g&&(g=10),30*this.count<360&&a.arc(d,e,g,b,c,!0),a.closePath(),this._renderFill(a),this._renderStroke(a),a.beginPath(),g=this.height*this.scaleY/2-1*this.__eachHeight(),10>=g&&(g=10),a.arc(d,e,g,c,b,!1),a.stroke(),this.active&&(a.font="13.5px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="rgba(0, 0, 0,1)",f=1===this.side?"":"",f="["+this.id+"] "+f+this.count+"",a.fillText(f,0,this.height*this.scaleY/2+15)),void a.scale(this.scaleX,this.scaleY))},__resizeShelf:function(){var a,b,c,d,e;return d=this._calculateCurrentDimensions(!1),c=d.x,b=d.y,a=Math.floor(c/this.__eachWidth()),1>a&&(a=1),a>20&&(a=20),e=Math.round(b/this.__eachHeight()),1>e&&(e=1),e>2&&(e=2),this.set({count:a,side:e,minScaleLimit:.01,flipX:!1,flipY:!1})},__modifiedShelf:function(){return this.angle=this.angle%360,(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280&&(this.angle=270),this.height=this.height*this.scaleY,this.scaleX=this.scaleY=1,this.width=this.__width(),this.setCoords()},_normalizeLeftTopProperties:function(a){return"left"in a&&this.set("left",a.left+this.getWidth()/2),this.set("x",a.left||0),"top"in a&&this.set("top",a.top+this.getHeight()/2),this.set("y",a.top||0),this},toObject:function(a){var b;return b=c(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")}),this.includeDefaultValues||this._removeDefaultValues(b),b},toGeoJSON:function(){var a,b,c,e,f,g,h,i,j,k,l;for(j=this.__eachWidth()*this.count,c=this.__eachHeight()*this.side,k=-j/2+this.left_cm,l=-c/2+this.top_cm,h=[],i=[[k,l],[k+j,l],[k+j,l+c],[k,l+c],[k,l]],e=0,f=i.length;f>e;e++)a=i[e],g=d.util.rotatePoint(new d.Point(a[0],a[1]),new d.Point(this.left_cm,this.top_cm),d.util.degreesToRadians(this.angle)),h.push([-g.x,g.y]);return b={type:"Feature",geometry:{type:"Polygon",coordinates:[h]},properties:{type:this.type,left_cm:this.left_cm,top_cm:this.top_cm,id:this.id,count:this.count,side:this.side,angle:this.angle}}},getJSONSchema:function(){var a;return a={title:"",type:"object",properties:{count:{title:"",type:"integer","default":3,minimum:1,maximum:12},side:{type:"integer","default":1,minimum:1,maximum:2},angle:{type:"integer","default":0,minimum:0,maximum:360}}}},complexity:function(){return 1}}),d.curvedShelf.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat("x y rx ry width height count side".split(" ")),d.curvedShelf.fromElement=function(a,e){var f,g;return a?(f=d.parseAttributes(a,d.Shelf.ATTRIBUTE_NAMES),f=b(f),g=new d.Shelf(c(e?d.util.object.clone(e):{},f)),g._normalizeLeftTopProperties(f),g):null},void(d.curvedShelf.fromObject=function(a){return new d.curvedShelf(a)}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b,c,d;return c=a.fabric||(a.fabric={}),b=c.util.object.extend,c.Beacon?void console.warn("fabric.Beacon is already defined"):(d=c.Object.prototype.stateProperties.concat(),d.push("id","top_cm","left_cm","lane","index"),void(c.Beacon=c.util.createClass(c.Object,{stateProperties:d,type:"beacon",eachWidth:10,eachHeight:10,hasControls:!1,padding:10,lane:"main",index:0,minor:0,__width:function(){return this.eachWidth*haika.scaleFactor},__height:function(){return this.eachHeight*haika.scaleFactor},initialize:function(a){a=a||{},this.callSuper("initialize",a),this.width=this.__width(),this.height=this.__height()},_render:function(a){var b;a.beginPath(),a.fillRect(this.width/2*-1,this.height/2*-1,this.width,this.height),this._renderFill(a),this._renderStroke(a),a.font="12px Arial",a.textAlign="center",a.textBaseline="middle",a.fillStyle="rgba(0, 0, 0,1)",b=this.minor+"("+this.lane+")",a.fillText(b,0,this.height*this.scaleY/2+15)},__resizeShelf:function(){return this.set({flipX:!1,flipY:!1})},__modifiedShelf:function(){return this.angle=0,this.width=this.__width(),this.height=this.__height(),this.setCoords(),this.__is_into()},__is_into:function(){var a,b,c,d,e,f,g,h,i,j,k;for(h=haika.canvas.getObjects(),i=[],d=0,f=h.length;f>d;d++)g=h[d],g.type.match(/shelf$/)?(c=g.__width()/2,e=g.left-c,j=g.left+c,b=g.__height()/2,k=g.top-b,a=g.top+b,i.push(this.left>e&&this.left<j&&this.top>k&&this.top<a?log("into:"+g.id):void 0)):i.push(void 0);return i},_normalizeLeftTopProperties:function(a){return"left"in a&&this.set("left",a.left+this.getWidth()/2),"top"in a&&this.set("top",a.top+this.getHeight()/2),this},toObject:function(a){var c;return c=b(this.callSuper("toObject",a)),this.includeDefaultValues||this._removeDefaultValues(c),c},toGeoJSON:function(){var a;return a={type:"Feature",geometry:{type:"Point",coordinates:[-this.left_cm,this.top_cm]},properties:{type:this.type,id:this.id,left_cm:this.left_cm,top_cm:this.top_cm,minor:this.minor,lane:this.lane,index:this.index}}},getJSONSchema:function(){var a;return a={title:"",type:"object",properties:{minor:{description:"minor",type:"integer"},lane:{description:"",type:"string"},index:{description:"",type:"integer"}}}},complexity:function(){return 1}})))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b,c;return c=a.fabric||(a.fabric={}),b=c.util.object.extend,c.Wall?void console.warn("fabric.Wall is already defined"):void(c.Wall=c.util.createClass(c.Rect,{type:"wall",eachWidth:100,eachHeight:100,width_scale:1,height_scale:1,__width:function(){return this.eachWidth*this.width_scale*haika.scaleFactor},__height:function(){return this.eachHeight*this.height_scale*haika.scaleFactor},initialize:function(a){a=a||{},this.callSuper("initialize",a),this.width=this.__width(),this.height=this.__height()},__resizeShelf:function(){return this.set({flipX:!1,flipY:!1})},__modifiedShelf:function(){return this.angle=this.angle%360,(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280&&(this.angle=270),1!==this.sacleX&&(this.width=this.width*this.scaleX,this.width_scale=this.width/(this.eachWidth*haika.scaleFactor)),1!==this.sacleY&&(this.height=this.height*this.scaleY,this.height_scale=this.height/(this.eachHeight*haika.scaleFactor)),this.scaleX=this.scaleY=1,this.setCoords()},toGeoJSON:function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o;for(m=this.eachWidth*this.width_scale,f=this.eachHeight*this.height_scale,n=-m/2+this.left_cm,o=-f/2+this.top_cm,d=[[[n,o],[n+m,o],[n+m,o+f],[n,o+f],[n,o]]],l=[],g=0,i=d.length;i>g;g++)for(a=d[g],h=0,j=a.length;j>h;h++)b=a[h],k=c.util.rotatePoint(new c.Point(b[0],b[1]),new c.Point(this.left_cm,this.top_cm),c.util.degreesToRadians(this.angle)),l.push([-k.x,k.y]);return e={type:"Feature",geometry:{type:"Polygon",coordinates:[l]},properties:{type:this.type,left_cm:this.left_cm,top_cm:this.top_cm,id:this.id,angle:this.angle,fill:this.fill,stroke:this.stroke,width_scale:this.width_scale,height_scale:this.height_scale}}},getJSONSchema:function(){var a;return a={title:"",type:"object",properties:{angle:{type:"integer","default":0,minimum:0,maximum:360},width_scale:{type:"number","default":1},height_scale:{type:"number","default":1}}}},complexity:function(){return 1}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b,c;return c=a.fabric||(a.fabric={}),b=c.util.degreesToRadians,c.Floor?void console.warn("fabric.Floor is already defined"):void(c.Floor=c.util.createClass(c.Rect,{type:"floor",width_cm:3e3,height_cm:3e3,is_negative:!1,fill:"#ffffff",stroke:"#000000",strokeDashArray:[2,2],__width:function(){return this.width_cm*haika.scaleFactor},__height:function(){return this.height_cm*haika.scaleFactor},initialize:function(a){a=a||{},this.callSuper("initialize",a),this.width=this.__width(),this.height=this.__height()},_render:function(a,c){var d,e,f,g,h,i,j,k;this.selectable&&(g=this.rx?Math.min(this.rx,this.width/2):0,h=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,d=this.height,j=c?this.left:-this.width/2,k=c?this.top:-this.height/2,a.save(),a.fillStyle=this.is_negative?"#353535":"rgba(255,0,0,0.3)",a.beginPath(),a.moveTo(j+g,k),a.lineTo(j+i-g,k),a.lineTo(j+i,k+d-h),a.lineTo(j+g,k+d),a.lineTo(j,k+h),a.closePath(),this._renderFill(a),this.selectable&&(this._renderStroke(a),a.scale(1/this.scaleX,1/this.scaleY),this.angle>90&&this.angle<270&&a.rotate(b(180)),this.is_negative?(a.fillStyle="#999999",e=""):(a.fillStyle="#000000",e=""),a.font="12px Arial",a.textAlign="center",a.textBaseline="middle",
f=a.measureText(e),f.width<=this.__width()?a.fillText(e,0,0):f.width<=this.__height()&&(a.rotate(b(90)),a.fillText(e,0,0))),a.restore())},__resizeShelf:function(){return this.set({flipX:!1,flipY:!1})},__modifiedShelf:function(){return this.angle=Math.floor(this.angle%360),(this.angle>=350||this.angle<=10)&&(this.angle=0),this.angle>=80&&this.angle<=100&&(this.angle=90),this.angle>=170&&this.angle<=190&&(this.angle=180),this.angle>=260&&this.angle<=280&&(this.angle=270),1!==this.scaleX&&(this.width=this.width*this.scaleX,this.width_cm=Math.floor(this.width/haika.scaleFactor)),1!==this.scaleY&&(this.height=this.height*this.scaleY,this.height_cm=Math.floor(this.height/haika.scaleFactor)),this.scaleX=this.scaleY=1,this.setCoords()},toGeoJSON:function(){var a,b,d,e,f,g,h,i,j,k,l,m,n;for(l=this.width_cm,d=this.height_cm,f=this.left_cm,k=this.top_cm,m=-l/2+f,n=-d/2+k,i=[],j=[[m,n],[m+l,n],[m+l,n+d],[m,n+d],[m,n]],e=0,g=j.length;g>e;e++)a=j[e],h=c.util.rotatePoint(new c.Point(a[0],a[1]),new c.Point(f,k),c.util.degreesToRadians(this.angle)),i.push([-h.x,h.y]);return b={type:"Feature",geometry:{type:"Polygon",coordinates:[i]},properties:{id:this.id,type:this.type,left_cm:f,top_cm:k,width_cm:this.width_cm,height_cm:this.height_cm,angle:this.angle,is_negative:this.is_negative}}},getJSONSchema:function(){var a;return a={title:"",type:"object",properties:{angle:{type:"integer","default":0,minimum:0,maximum:360},width_cm:{type:"number","default":1},height_cm:{type:"number","default":1},is_negative:{type:"boolean","default":!1}}}},complexity:function(){return 1}}))}("undefined"!=typeof exports?exports:this),function(a){"use strict";var b;b=a.haika_utils||(a.haika_utils={}),b.drawGridLines=function(a,b){var c,d,e,f,g,h,i,j;for(b.save(),b.opacity=1,j=b.canvas.width,e=b.canvas.height,b.strokeStyle="#cccccc",g=a.cm2px(100),c=1e3*a.cm2px_x(0)%Math.floor(1e3*g)/1e3,d=1e3*a.cm2px_y(0)%Math.floor(1e3*g)/1e3,b.beginPath(),b.lineWidth=Math.max(Math.min(a.scaleFactor,1),.3),f=0;f<Math.ceil(j/g)+1;)b.moveTo(Math.floor(g*f)+c+.5,0),b.lineTo(Math.floor(g*f)+c+.5,e),++f;for(f=0;f<Math.ceil(e/g)+1;)b.moveTo(0,Math.floor(g*f)+d+.5),b.lineTo(j,Math.floor(g*f)+d+.5),++f;for(b.stroke(),g=a.cm2px(500),c=1e3*a.cm2px_x(0)%Math.floor(1e3*g)/1e3,d=1e3*a.cm2px_y(0)%Math.floor(1e3*g)/1e3,b.beginPath(),b.lineWidth=Math.max(Math.min(2*a.scaleFactor,2),.5),f=0;f<Math.ceil(j/g)+1;)b.moveTo(Math.floor(g*f)+c+.5,0),b.lineTo(Math.floor(g*f)+c+.5,e),++f;for(f=0;f<Math.ceil(e/g)+1;)b.moveTo(0,Math.floor(g*f)+d+.5),b.lineTo(j,Math.floor(g*f)+d+.5),++f;b.stroke(),b.lineWidth=Math.max(Math.min(2*a.scaleFactor,2),.5),b.strokeStyle="#aaaaaa",b.beginPath(),h=a.cm2px_x(0),i=a.cm2px_y(0),b.moveTo(Math.floor(h),0),b.lineTo(Math.floor(h),e),b.moveTo(0,Math.floor(i)),b.lineTo(j,Math.floor(i)),b.stroke(),b.restore()},b.drawScale=function(a,b){var c,d,e,f;b.save(),b.opacity=1,c=b.canvas.height,d=30,b.font="10px Open Sans",a.cm2px(100)<=50?(e=500,f="5m"):(e=100,f="1m"),b.lineWidth=3,b.strokeStyle="rgba(255,255,255,0.9)",b.strokeText(f,25,c-66+d),b.strokeStyle="#333333",b.fillText(f,25,c-66+d),b.lineWidth=4,b.strokeStyle="rgba(255,255,255,0.8)",b.beginPath(),b.moveTo(20,c-65+d-2),b.lineTo(20,c-60+d),b.lineTo(20+a.cm2px(e),c-60+d),b.lineTo(20+a.cm2px(e),c-65+d-2),b.stroke(),b.lineWidth=2,b.strokeStyle="#666666",b.beginPath(),b.moveTo(20,c-65+d),b.lineTo(20,c-60+d),b.lineTo(20+a.cm2px(e),c-60+d),b.lineTo(20+a.cm2px(e),c-65+d),b.stroke(),b.restore()},b.drawBackground=function(a,b){a.canvas.backgroundImage&&(b.mozImageSmoothingEnabled=!1,a.canvas.backgroundImage.left=Math.floor(a.cm2px_x(a.canvas.backgroundImage._originalElement.width/2*a.backgroundScaleFactor)),a.canvas.backgroundImage.top=Math.floor(a.cm2px_y(a.canvas.backgroundImage._originalElement.height/2*a.backgroundScaleFactor)),a.canvas.backgroundImage.width=Math.floor(a.cm2px(a.canvas.backgroundImage._originalElement.width*a.backgroundScaleFactor)),a.canvas.backgroundImage.height=Math.floor(a.cm2px(a.canvas.backgroundImage._originalElement.height*a.backgroundScaleFactor)),a.canvas.backgroundImage.opacity=a.backgroundOpacity,a.canvas.backgroundImage.render(b),b.mozImageSmoothingEnabled=!0)}}("undefined"!=typeof exports?exports:this);var haika,log;log=function(a){try{return console.log(a)}catch(b){}},haika={CONST_LAYERS:{SHELF:0,BEACON:1,WALL:2,FLOOR:3},INSTALLED_OBJECTS:{shelf:{layer:0,"class":fabric.Shelf},curved_shelf:{layer:0,"class":fabric.curvedShelf},beacon:{layer:1,"class":fabric.Beacon},wall:{layer:2,"class":fabric.Wall},floor:{layer:3,"class":fabric.Floor}},canvas:null,readOnly:!1,centerX:0,centerY:0,layer:null,scaleFactor:1,objects:[],_geojson:{},backgroundUrl:null,backgroundOpacity:1,backgroundScaleFactor:1,xyLongitude:null,xyLatitude:null,xyAngle:0,xyScaleFactor:1,clipboard:[],cm2px_x:function(a){return this.canvas.getWidth()/2+(this.centerX-a)*this.scaleFactor},cm2px_y:function(a){return this.canvas.getHeight()/2+(this.centerY-a)*this.scaleFactor},cm2px:function(a){return a*this.scaleFactor},px2cm_x:function(a){return this.centerX-(a-this.canvas.getWidth()/2)/this.scaleFactor},px2cm_y:function(a){return this.centerY-(a-this.canvas.getHeight()/2)/this.scaleFactor},init:function(a){var b,c;if(null==a.divId)throw"CanvasID";return this.divId="#"+a.divId,null==a.canvasId&&(a.canvasId="haika-canvas-area"),null!=a.readOnly&&(this.readOnly=a.readOnly),$(this.divId).prepend('<canvas id="'+a.canvasId+'" unselectable="on"></canvas>'),this.scaleFactor=null!=a.scaleFactor?a.scaleFactor:1,this.layer=this.CONST_LAYERS.SHELF,b=new fabric.Canvas(a.canvasId,{width:$(this.divId).width(),height:$(this.divId).height(),rotationCursor:'url("img/rotate.cur") 10 10, crosshair'}),b.selectionBorderColor="black",b.selectionLineWidth=1,b.selectionDashArray=[2,2],$(window).resize(function(a){return function(){return a.canvas.setWidth($(a.divId).width()),a.canvas.setHeight($(a.divId).height()),a.render()}}(this)),fabric.Object.prototype.scaleX=1,fabric.Object.prototype.scaleY=1,fabric.Object.prototype.originX="center",fabric.Object.prototype.originY="center",fabric.Object.prototype.transparentCorners=!0,fabric.Object.prototype.cornerColor="#488BD4",fabric.Object.prototype.borderOpacityWhenMoving=.8,fabric.Object.prototype.cornerSize=10,this.readOnly&&(fabric.Object.prototype.padding=5,fabric.Object.prototype.borderColor="#0000FF",fabric.Object.prototype.cornerColor="#0000FF"),fabric.Canvas.prototype._shouldClearSelection=function(a,b){var c;return c=this.getActiveGroup(),!b||b&&c&&!c.contains(b)&&c!==b&&!a.shiftKey||b&&!b.evented||b&&!b.selectable},b._getActionFromCorner=function(a,b){var c;return c="drag",b&&("ml"===b||"mr"===b||"tr"===b||"tl"===b||"bl"===b||"br"===b?c="scaleX":"mt"===b||"mb"===b?c="scaleY":"mtr"===b&&(c="rotate")),c},b._renderBackground=function(a){return function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;for(e=new ConvexHullGrahamScan,E=a.canvas.getObjects(),q=0,u=E.length;u>q;q++)if(l=E[q],g=l.toGeoJSON(),"floor"!==g.properties.type||!g.properties.is_negative)for(F=g.geometry.coordinates[0],r=0,v=F.length;v>r;r++)j=F[r],e.addPoint(-1*j[0],j[1]);if(p=e.getHull(),p.length>0){for(f=[],s=0,w=p.length;w>s;s++)h=p[s],m={X:h.x,Y:h.y},f.push(m);for(d=new ClipperLib.Clipper,d.AddPaths([f],ClipperLib.PolyType.ptSubject,!0),G=a.canvas.getObjects(),t=0,x=G.length;x>t;t++)if(l=G[t],g=l.toGeoJSON(),"floor"===g.properties.type&&g.properties.is_negative){for(k=g.geometry.coordinates[0],c=[],B=0,y=k.length;y>B;B++)j=k[B],c.push({X:-1*j[0],Y:j[1]});d.AddPaths([c],ClipperLib.PolyType.ptClip,!0)}o=new ClipperLib.Paths,d.Execute(ClipperLib.ClipType.ctDifference,o,ClipperLib.PolyFillType.pftNonZero,ClipperLib.PolyFillType.pftNonZero),a.floor_cache=o}else a.floor_cache=null;if(a.floor_cache){for(b.save(),b.beginPath(),b.lineWidth=Math.floor(Math.min(20,Math.max(3,200*a.scaleFactor))),log(Math.floor(Math.min(20,Math.max(5,20*a.scaleFactor)))),b.strokeStyle="#525252",b.fillStyle="#ffffff",H=a.floor_cache,C=0,z=H.length;z>C;C++){for(n=H[C],i=!0,D=0,A=n.length;A>D;D++)h=n[D],i?(b.moveTo(haika.cm2px_x(h.X),haika.cm2px_y(h.Y)),i=!1):b.lineTo(haika.cm2px_x(h.X),haika.cm2px_y(h.Y));b.lineTo(haika.cm2px_x(n[0].X),haika.cm2px_y(n[0].Y)),b.closePath()}return b.stroke(),b.fill(),b.clip(),haika_utils.drawBackground(a,b),haika_utils.drawGridLines(a,b),b.restore()}}}(this),b._renderOverlay=function(a){return function(b){var c,d,e,f,g,h,i,j;if(haika_utils.drawScale(a,b),a.layer===a.CONST_LAYERS.FLOOR&&a.floor_cache){for(b.save(),b.beginPath(),b.lineWidth=4,b.strokeStyle="#ff0000",j=a.floor_cache,f=0,h=j.length;h>f;f++){for(e=j[f],d=!0,g=0,i=e.length;i>g;g++)c=e[g],d?(b.moveTo(haika.cm2px_x(c.X),haika.cm2px_y(c.Y)),d=!1):b.lineTo(haika.cm2px_x(c.X),haika.cm2px_y(c.Y));b.lineTo(haika.cm2px_x(e[0].X),haika.cm2px_y(e[0].Y)),b.closePath()}return b.stroke(),b.restore()}}}(this),this.readOnly||initAligningGuidelines(b),this.canvas=b,this.canvas.on("object:selected",function(a){return function(a){var b;return b=a.target,null!=b._objects?(b.lockScalingX=!0,b.lockScalingY=!0):void 0}}(this)),this.canvas.on("object:rotating",function(a){return function(a){var b;return b=a.target,null!=b.__rotating?b.__rotating():void 0}}(this)),this.canvas.on("object:moving",function(a){return function(b){var c;return c=b.target,a.readOnly?void 0:null!=c.__moving?c.__moving():void 0}}(this)),this.canvas.on("object:scaling",function(a){return function(a){var b;return b=a.target,null!=b.__resizeShelf?b.__resizeShelf():void 0}}(this)),this.canvas.on("object:modified",function(a){return function(b){var c;return c=b.target,null!=c.__modifiedShelf&&c.__modifiedShelf(),c.top_cm=a.px2cm_y(c.top),c.left_cm=a.px2cm_x(c.left),a.saveDelay()}}(this)),c=!1,$(this.canvas.wrapperEl).on("mousewheel",function(a){return function(b){var d;return d=b.originalEvent.wheelDelta/120,c?void 0:(c=setTimeout(function(){return c=!1},100),d>0&&a.zoomIn(),0>d?a.zoomOut():void 0)}}(this)),$(this).trigger("haika:initialized")},setScale:function(a){return a>=4?a=4:.05>=a&&(a=.05),this.scaleFactor=(100*a).toFixed(0)/100,this.render(),a},setBackgroundUrl:function(a){return this.canvas.backgroundImage=null,this.backgroundUrl=a,this.render()},_getLatestId:function(){var a,b,c,d,e;for(a=0,e=this.objects,c=0,d=e.length;d>c;c++)b=e[c],b.id>a&&(a=b.id);return a+1},getCountFindById:function(a){var b;return b=null,$(this.objects).each(function(c,d){return d.id===a?b=c:void 0}),b},changeObject:function(a,b){var c,d,e,f,g;d=this.getCountFindById(a),f=this.objects[d],c=!1;for(e in b)g=b[e],f[e]!==g&&(f[e]=g,c=!0);return c?(this.render(),this.saveDelay()):void 0},addObject:function(a){return a.id=this._getLatestId(),a.top_cm=this.centerY,a.left_cm=this.centerX,null==a.angle&&(a.angle=0),this.objects.push(a),$(this).trigger("haika:add"),this.render(),this.saveDelay(),this.activeGroup([a.id]),this.undo.add(a.id)},applyActiveObjects:function(a){var b,c,d,e,f;if(this.canvas.getActiveObject())return b=this.canvas.getActiveObject(),a(b);if(this.canvas.getActiveGroup()){for(e=this.canvas.getActiveGroup().getObjects(),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(a(b));return f}},remove:function(){return this.applyActiveObjects(function(a){return function(b){return a.canvas.remove(b),a.objects.splice(a.getCountFindById(b.id),1)}}(this)),this.canvas.deactivateAll(),this.canvas.renderAll(),this.saveDelay(),$(this).trigger("haika:remove")},bringToFront:function(){return this.applyActiveObjects(function(a){return function(b){var c,d;return b.bringToFront(),c=a.getCountFindById(b.id),d=a.objects[c],a.objects.splice(c,1),a.objects.push(d)}}(this)),this.canvas.renderAll(),this.saveDelay()},copy:function(){return this.clipboard=[],this.applyActiveObjects(function(a){return function(b){return a.clipboard.push(b.toGeoJSON().properties)}}(this)),$(this).trigger("haika:copy")},duplicate:function(){var a;return a=this.clipboard,this.copy(),this.paste(),this.clipboard=a,$(this).trigger("haika:duplicate")},activeGroup:function(a){var b,c,d,e,f,g,h,i,j;if(0!==a.length){if(1===a.length)return void $(this.canvas.getObjects()).each(function(b){return function(c,d){return d.id===a[0]?b.canvas.setActiveObject(d):void 0}}(this));for(d=[],j=this.canvas.getObjects(),f=0,h=j.length;h>f;f++)for(e=j[f],g=0,i=a.length;i>g;g++)c=a[g],e.id===c&&d.push(e);return d=d.map(function(a){return a.set("active",!0)}),b=new fabric.Group(d,{originX:"center",originY:"center"}),this.canvas.setActiveGroup(b.setCoords()).renderAll()}},paste:function(){var a,b,c,d,e;if(this.clipboard.length>0){for(a=[],e=this.clipboard,c=0,d=e.length;d>c;c++)b=e[c],b.id=this._getLatestId(),1===this.clipboard.length&&(this.clipboard[0].top_cm=this.centerY,this.clipboard[0].left_cm=this.centerX),a.push(b.id),this.objects.push(b);this.render(),this.saveDelay(),this.activeGroup(a)}return $(this).trigger("haika:paste")},selectAll:function(){var a,b,c,d,e;for(this.canvas.discardActiveGroup(),a=[],e=this.canvas.getObjects(),c=0,d=e.length;d>c;c++)b=e[c],a.push(b.id);return this.activeGroup(a)},unselectAll:function(){return this.canvas.deactivateAll().renderAll()},getClass:function(a){if(null!=this.INSTALLED_OBJECTS[a])return this.INSTALLED_OBJECTS[a]["class"];throw""},render:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;for(!this.canvas.backgroundImage&&this.backgroundUrl&&fabric.Image.fromURL(this.backgroundUrl,function(a){return function(b){return b.set({originX:"left",originY:"top"}),a.canvas.backgroundImage=b,a.canvas.renderAll()}}(this)),a=[],this.applyActiveObjects(function(b){return function(b){return a.push(b.id)}}(this)),this.canvas.renderOnAddRemove=!1,this.canvas._objects.length=0,b=[],e=[],f=[],c=[],y=this.objects,g=0,k=y.length;k>g;g++)d=y[g],d.selectable=this.layer===this.INSTALLED_OBJECTS[d.type].layer?!0:!1,"beacon"===d.type&&b.push(d),"wall"===d.type&&f.push(d),"floor"===d.type&&c.push(d),("shelf"===d.type||"curved_shelf"===d.type)&&e.push(d);if(this.layer===this.CONST_LAYERS.FLOOR){for(h=0,l=f.length;l>h;h++)d=f[h],this.addObjectToCanvas(d);for(i=0,m=e.length;m>i;i++)d=e[i],this.addObjectToCanvas(d);for(j=0,n=b.length;n>j;j++)d=b[j],this.addObjectToCanvas(d);for(t=0,o=c.length;o>t;t++)d=c[t],this.addObjectToCanvas(d)}else{for(u=0,p=c.length;p>u;u++)d=c[u],this.addObjectToCanvas(d);for(v=0,q=f.length;q>v;v++)d=f[v],this.addObjectToCanvas(d);for(w=0,r=e.length;r>w;w++)d=e[w],this.addObjectToCanvas(d);for(x=0,s=b.length;s>x;x++)d=b[x],this.addObjectToCanvas(d)}return a.length>0&&this.activeGroup(a),this.canvas.renderAll(),this.canvas.renderOnAddRemove=!0,$(this).trigger("haika:render")},addObjectToCanvas:function(a){var b,c;return b=this.getClass(a.type),c=new b(a),c.width=c.__width(),c.height=c.__height(),c.top=this.cm2px_y(a.top_cm),c.left=this.cm2px_x(a.left_cm),c.selectable=a.selectable,this.readOnly&&(c.lockMovementX=!0,c.lockMovementY=!0,c.lockRotation=!0,c.lockScalingX=!0,c.lockScalingY=!0,c.lockUniScaling=!0,c.hasControls=!1,c.hoverCursor="pointer"),this.canvas.add(c)},getMovePixel:function(a){return a.shiftKey?10:1},up:function(a){var b;return b=this.canvas.getActiveObject()?this.canvas.getActiveObject():this.canvas.getActiveGroup(),b?(b.top=b.top-this.getMovePixel(a),this.canvas.renderAll(),this.saveDelay()):void 0},down:function(a){var b;return b=this.canvas.getActiveObject()?this.canvas.getActiveObject():this.canvas.getActiveGroup(),b?(b.top=b.top+this.getMovePixel(a),this.canvas.renderAll(),this.saveDelay()):void 0},left:function(a){var b;return b=this.canvas.getActiveObject()?this.canvas.getActiveObject():this.canvas.getActiveGroup(),b?(b.left=b.left-this.getMovePixel(a),this.canvas.renderAll(),this.saveDelay()):void 0},right:function(a){var b;return b=this.canvas.getActiveObject()?this.canvas.getActiveObject():this.canvas.getActiveGroup(),b?(b.left=b.left+this.getMovePixel(a),this.canvas.renderAll(),this.saveDelay()):void 0},alignLeft:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.canvas.getActiveGroup(),b._objects){for(c=0,i=b._objects,e=0,g=i.length;g>e;e++)d=i[e],a=d.getBoundingRect(),c=Math.min(a.left,c);for(j=b._objects,f=0,h=j.length;h>f;f++)d=j[f],a=d.getBoundingRect(),d.left=c+a.width/2;return this.saveDelay(),this.canvas.renderAll()}},alignRight:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.canvas.getActiveGroup(),b._objects){for(c=0,i=b._objects,e=0,g=i.length;g>e;e++)d=i[e],a=d.getBoundingRect(),c=Math.max(a.left+a.width,c);for(j=b._objects,f=0,h=j.length;h>f;f++)d=j[f],a=d.getBoundingRect(),d.left=c-a.width/2;return this.saveDelay(),this.canvas.renderAll()}},alignCenter:function(){var a,b,c,d,e;if(a=this.canvas.getActiveGroup(),a._objects){for(e=a._objects,c=0,d=e.length;d>c;c++)b=e[c],b.left=0;return this.saveDelay(),this.canvas.renderAll()}},alignTop:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.canvas.getActiveGroup(),b._objects){for(d=0,i=b._objects,e=0,g=i.length;g>e;e++)c=i[e],a=c.getBoundingRect(),d=Math.min(a.top,d);for(j=b._objects,f=0,h=j.length;h>f;f++)c=j[f],a=c.getBoundingRect(),c.top=d+a.height/2;return this.saveDelay(),this.canvas.renderAll()}},alignBottom:function(){var a,b,c,d,e,f,g,h,i,j;if(b=this.canvas.getActiveGroup(),b._objects){for(d=0,i=b._objects,e=0,g=i.length;g>e;e++)c=i[e],a=c.getBoundingRect(),d=Math.max(a.top+a.height,d);for(j=b._objects,f=0,h=j.length;h>f;f++)c=j[f],a=c.getBoundingRect(),c.top=d-a.height/2;return this.saveDelay(),this.canvas.renderAll()}},alignVcenter:function(){var a,b,c,d,e;if(a=this.canvas.getActiveGroup(),a._objects){for(e=a._objects,c=0,d=e.length;d>c;c++)b=e[c],b.top=0;return this.saveDelay(),this.canvas.renderAll()}}},$.extend(haika,{_api_load_endpoint:"/api/floor/load",_api_save_endpoint:"/api/floor/save",_dataId:null,_revision:null,_collision:null,_nowSaving:!1,_autoSaveTimerId:null,close:function(){return this._dataId=null,this._revision=null,this._collision=null,this._geojson={},this.objects.length=0,this.canvas.backgroundImage=null},openFromApi:function(a,b){return this._dataId&&this.close(),this._nowSaving&&b.error&&b.error(""),$.ajax({url:this._api_load_endpoint,type:"POST",cache:!1,dataType:"json",data:{id:a,revision:b.revision},error:function(a){return function(){return b.error&&b.error("")}}(this),success:function(a){return function(c){return c.locked?(a.readOnly=!0,b.error&&b.error("")):(a._dataId=c.id,a._revision=c.revision,a._collision=c.collision,a._geojson=c.data,a.loadFromGeoJson(),$(a).trigger("haika:load"),b.success&&b.success())}}(this)})},save:function(a,b){var c;return null==a&&(a=null),null==b&&(b=null),log("save"),this.readOnly?void 0:(this.prepareData(),this._autoSaveTimerId&&(clearTimeout(this._autoSaveTimerId),this._autoSaveTimerId=null),this._nowSaving?void setTimeout(function(c){return function(){return c.save(a,b)}}(this),500):(this._nowSaving=!0,c={id:this._dataId,revision:this._revision,collision:this._collision,data:JSON.stringify(this.toGeoJSON())},$.ajax({url:this._api_save_endpoint,type:"POST",data:c,dataType:"json",success:function(c){return function(d){return c._nowSaving=!1,d.success?(c._revision=d.revision,c._collision=d.collision,a&&a(),$(c).trigger("haika:save")):(b&&b(d.message),void alert(d.message))}}(this),error:function(a){return function(){return a._nowSaving=!1,b&&b("")}}(this)})))},saveDelay:function(a){return null==a&&(a=2e3),log("save-delay"),this.prepareData(),this._autoSaveTimerId&&(clearTimeout(this._autoSaveTimerId),this._autoSaveTimerId=null),this._autoSaveTimerId=setTimeout(function(a){return function(){return a.saveDelayExec()}}(this),a)},saveDelayExec:function(){var a,b;return this._autoSaveTimerId=null,this.canvas?(a=this.canvas.getActiveObject(),b=this.canvas.getActiveGroup()):(a=null,b=null),null!=a&&a.isMoving||null!=b&&b.isMoving?(log("save-delay-exec-deffer"),this._autoSaveTimerId=setTimeout(function(a){return function(){return a.saveDelayExec()}}(this),1e3)):(log("save-delay-exec"),this.save())}}),$.extend(haika,{loadFromGeoJson:function(){var a,b,c,d,e,f;if(a=null!=this._geojson.haika?this._geojson.haika:{},this.backgroundScaleFactor=null!=a.backgroundScaleFactor?a.backgroundScaleFactor:1,this.backgroundOpacity=null!=a.backgroundOpacity?a.backgroundOpacity:1,this.backgroundUrl=null!=a.backgroundUrl?a.backgroundUrl:"",this.xyAngle=null!=a.xyAngle?a.xyAngle:0,this.xyScaleFactor=null!=a.xyScaleFactor?a.xyScaleFactor:1,this.xyLongitude=null!=a.xyLongitude?a.xyLongitude:null,this.xyLatitude=null!=a.xyLatitude?a.xyLatitude:null,this.objects=[],null!=this._geojson.features){for(e=this._geojson.features,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(this.objects.push(b.properties));return f}},prepareData:function(){var a,b,c,d,e,f,g;if(log("prepareData"),this.canvas){for(f=this.canvas.getObjects(),g=[],d=0,e=f.length;e>d;d++)b=f[d],null!=b.group?(b.top_cm=this.px2cm_y(b.top+b.group.top),b.left_cm=this.px2cm_x(b.left+b.group.left)):(b.top_cm=this.px2cm_y(b.top),b.left_cm=this.px2cm_x(b.left)),a=this.getCountFindById(b.id),c=b.toGeoJSON(),g.push(this.objects[a]=c.properties);return g}},toGeoJSON:function(){var a,b,c,d,e,f,g;if(this.canvas)for(b=[],g=this.canvas.getObjects(),e=0,f=g.length;f>e;e++)d=g[e],c=d.toGeoJSON(),b.push(c);else b=this._geojson.features;return a={type:"FeatureCollection",features:b,haika:{backgroundUrl:this.backgroundUrl,backgroundScaleFactor:this.backgroundScaleFactor,backgroundOpacity:this.backgroundOpacity,xyLongitude:this.xyLongitude,xyLatitude:this.xyLatitude,xyAngle:this.xyAngle,xyScaleFactor:this.xyScaleFactor,version:1}}}}),$.extend(haika,{zoomFull:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(!(this.objects.length<=0)){for(d=this.toGeoJSON(),s=d.features,o=0,q=s.length;q>o;o++)if(h=s[o],this.layer===this.CONST_LAYERS.FLOOR||"floor"!==h.properties.type||!h.properties.is_negative)for(t=h.geometry.coordinates[0],p=0,r=t.length;r>p;p++)i=t[p],"undefined"!=typeof g&&null!==g?(g=Math.min(i[0],g),j=Math.max(i[0],j),l=Math.min(i[1],l),a=Math.max(i[1],a)):(g=i[0],j=i[0],l=i[1],a=i[1]);return this.centerX=-(j+g)/2,this.centerY=(a+l)/2,m=j-g,e=a-l,c=this.canvas.getWidth(),b=this.canvas.getHeight(),n=c/m,f=b/e,k=f>n?n:f,this.setScale(.8*k)}},zoomIn:function(){var a,b;return b=this.scaleFactor,a=b+Math.pow(b+1,2)/20,1>a&&b>1&&(a=1),this.setScale(a)},zoomOut:function(){var a,b;return b=this.scaleFactor,a=b-Math.pow(b+1,2)/20,b>1&&1>a&&(a=1),this.setScale(a)}});var initScrollBar;initScrollBar=function(){return new Dragdealer("horizontal-scroller",{x:.5,animationCallback:function(a,b){var c,d;return c=25e3,d=haika.canvas.getWidth()*haika.scaleFactor,haika.centerX=-1*((a-.5)*((c-d)/2)).toFixed(0),haika.render()}}),new Dragdealer("vertical-scroller",{y:.5,horizontal:!1,vertical:!0,animationCallback:function(a,b){var c,d;return c=25e3,d=haika.canvas.getHeight()*haika.scaleFactor,haika.centerY=-1*((b-.5)*((c-d)/2)).toFixed(0),haika.render()}})},$.extend(haika,{toolbar:{init:function(){var a,b,c,d;if($(".haika-toolbar-container").show(),a={shelf:{icon:"square-o",title:"",type:"shelf",eachWidth:90,eachHeight:26,count:5,side:1},big_shelf:{icon:"square-o",title:"",type:"shelf",eachWidth:90,eachHeight:33,count:5,side:1},magazine_shelf:{icon:"square-o",title:"",type:"shelf",eachWidth:90,eachHeight:45,count:5,side:1},kamishibai_shelf:{icon:"square-o",title:"",type:"shelf",eachWidth:90,eachHeight:90,count:1,side:1},booktrack_shelf:{icon:"square-o",title:"",type:"shelf",eachWidth:60,eachHeight:40,count:1,side:1,angle:20},curved_shelf:{icon:"dot-circle-o",title:"",type:"curved_shelf",count:3,side:2},beacon:{type:"beacon",icon:"square",title:"",fill:"#000000",stroke:"#0000ee"},wall:{type:"wall",icon:"square",title:"",height_scale:1,width_scale:1,fill:"#000000"},floor:{type:"floor",icon:"square",title:"",height_scale:1,width_scale:1,fill:""}},!this.readOnly)for(c in a)d=a[c],b='<li id="add_'+c+'" key="'+c+'" type="'+d.type+'"><i class="fa fa-'+d.icon+'"></i> '+d.title+"</li>",$(".toolbar-menu").append(b),$("#add_"+c).click(function(b){var d;return c=$(b.target).attr("key"),d=a[c],haika.addObject(d)});return this.show("shelf")},show:function(a){return $(".haika-toolbar-container ul:first>li").each(function(b,c){return $(c).attr("type").match(a)?$(c).show():$(c).hide()})}}}),$.extend(haika,{event:{init:function(){return this.shortcut(),this.button(),this.zoom(),this.contextMenu(),this.etc()},button:function(){return $(".haika-map-setting").click(function(){return location.href="map.html"+location.hash}),$(".haika-remove").click(function(){var a;return a=haika.canvas.getActiveObject(),haika.remove(),a?haika.undo.remove(a):void 0}),$(".haika-bringtofront").click(function(){return haika.bringToFront()}),$(".haika-duplicate").click(function(){return haika.duplicate()}),$(".haika-copy").click(function(){return haika.copy()}),$(".haika-paste").click(function(){return haika.paste()}),$(".haika-align-left").click(function(){return haika.alignLeft()}),$(".haika-align-center").click(function(){return haika.alignCenter()}),$(".haika-align-right").click(function(){return haika.alignRight()}),$(".haika-align-top").click(function(){return haika.alignTop()}),$(".haika-align-vcenter").click(function(){return haika.alignVcenter()}),$(".haika-align-bottom").click(function(){return haika.alignBottom()}),$("#haika-canvas-bgscale").change(function(){return haika.backgroundScaleFactor=parseFloat($(this).val()),haika.render()}),$("#haika-bgreset").click(function(){return haika.setBackgroundUrl("")}),$("#haika-bgopacity-slider").slider({step:1,min:1,max:100,value:100*haika.backgroundOpacity,formatter:function(a){return haika.backgroundOpacity=a/100,haika.render(),a/100}}),$("#haika-bgimg").change(function(a){var b,c;return c=a.target.files,0!==c.length?(b=new FormData,b.append("id",haika._dataId),b.append("userfile",c[0]),$.ajax({url:"http://lab.calil.jp/haika_store/upload.php",data:b,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(a){var b;return b="http://lab.calil.jp/haika_store/image/"+haika._dataId+"_"+c[0].name,haika.setBackgroundUrl(b)}})):void 0}),$(".haika-undo").click(function(){return haika.undo.undoManager.undo()})},shortcut:function(){var a;return a=function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1},Mousetrap.bind("mod+o",function(){return $("#file").trigger("click"),!1}),Mousetrap.bind("mod+c",function(){return haika.copy(),!1}),Mousetrap.bind("mod+v",function(){return haika.paste(),!1}),Mousetrap.bind("mod+d",function(b){return a(b),haika.duplicate(),!1}),Mousetrap.bind("mod+a",function(b){return a(b),haika.selectAll(),!1}),Mousetrap.bind("mod+z",function(b){return a(b),haika.undo.undoManager.undo(),!1}),Mousetrap.bind(["esc","escape"],function(b){return a(b),haika.unselectAll(),!1}),Mousetrap.bind(["up","shift+up"],function(b){return a(b),haika.up(b),!1}),Mousetrap.bind(["down","shift+down"],function(b){return a(b),haika.down(b),!1}),Mousetrap.bind(["left","shift+left"],function(b){return a(b),haika.left(b),!1}),Mousetrap.bind(["right","shift+right"],function(b){return a(b),haika.right(b),!1}),$(document).unbind("keydown").bind("keydown",function(a){var b,c;c=!1,(8===a.keyCode||46===a.keyCode)&&(b=a.srcElement||a.target,c="INPUT"===b.tagName.toUpperCase()&&("TEXT"===b.type.toUpperCase()||"PASSWORD"===b.type.toUpperCase()||"FILE"===b.type.toUpperCase()||"EMAIL"===b.type.toUpperCase())||"TEXTAREA"===b.tagName.toUpperCase()?b.readOnly||b.disabled:!0),c&&(a.preventDefault(),haika.remove())})},zoom:function(){return $(".haika-full").click(function(){return haika.zoomFull()}),$(".haika-zoomin").click(function(){return haika.zoomIn()}),$(".haika-zoomout").click(function(){return haika.zoomOut()}),$(".zoomreset").click(function(){return haika.setScale(1)})},contextMenu:function(){return $("#haika-canvas").contextmenu({target:"#haika-context-menu",before:function(a,b,c){return a.preventDefault(),"CANVAS"!==a.target.tagName?(this.closemenu(),!1):(haika.canvas.getActiveObject()?(log("selected"),$("#haika-context-menu").find(".haika-select-context-menu").show()):(log("nonselect"),$("#haika-context-menu").find(".haika-select-context-menu").hide()),!0)},onItem:function(a,b){}})},etc:function(){return $(window).on("beforeunload",function(a){return function(a){haika.render(),haika.save()}}(this)),$(".haika-nav a").click(function(a){var b;return a.preventDefault(),b=$(a.target).attr("class"),haika.toolbar.show(b),"beacon"===b&&(haika.layer=haika.CONST_LAYERS.BEACON),"wall"===b&&(haika.layer=haika.CONST_LAYERS.WALL),"floor"===b&&(haika.layer=haika.CONST_LAYERS.FLOOR),"shelf"===b&&(haika.layer=haika.CONST_LAYERS.SHELF),haika.render(),$(".haika-nav li").removeClass("active"),$(this).closest("li").addClass("active")})}}}),$.extend(haika,{undo:{undoManager:new UndoManager,states:[],set_selected:!0,add:function(a){return log("add set"),this.undoManager.add({undo:function(b){return function(){var c;return log("undo add "+a),c=b.getObject(a),log(c),haika.__remove(c)}}(this),redo:function(a){return function(){}}(this)})},remove:function(a){return log("remove set"),this.undoManager.add({undo:function(b){return function(){return log("undo remove "+a.id),log(a),haika.add(a),haika.render()}}(this),redo:function(a){return function(){}}(this)})},init:function(){return haika.canvas.on("object:selected",function(a){return function(b){var c,d;return c=b.target,a.set_selected?0===a.states.length||c.id!==a.states[a.states.length-1].id?(c.saveState(),d=$.extend(!0,{},c.originalState),d.state_type="selected",a.states.push(d)):void 0:void(a.set_selected=!0)}}(this)),haika.canvas.on("selection:cleared",function(a){return function(a){var b;return b=a.target}}(this)),haika.canvas.on("object:modified",function(a){return function(b){var c,d;c=b.target,c.saveState(),d=$.extend(!0,{},c.originalState),d.state_type="modified",a.states.push(d),a.undoManager.add({undo:function(){var b;return a.states.length>0?(haika.canvas.deactivateAll(),b=a.states[a.states.length-2],c=a.getObject(b.id),c&&(a.setState(c,b),a.states.pop(),"selected"===a.states[a.states.length-1].state_type&&a.states.pop(),a.set_selected=!1,haika.canvas.setActiveObject(c)),log(a.states)):void 0},redo:function(){}})}}(this))},getObject:function(a){var b,c,d,e,f;for(c=null,f=haika.canvas.getObjects(),d=0,e=f.length;e>d;d++)if(b=f[d],b.id===a){c=b;break}return c},setState:function(a,b){return a.setOptions(b),a.setCoords()}}}),fabric.Object.prototype.createPropetyPanel=function(){var a,b,c,d,e;b=this.getJSONSchema(),a='<form class="form-horizontal" role="form">',a+='<input type="hidden" prop="id" value="'+this.id+'">',e=b.properties;for(c in e)d=e[c],a+="string"===d.type?'<div class="form-group">\n  <label for="haika-object-'+c+'" class="col-sm-5 control-label">'+c+'</label>\n  <div class="col-sm-7">\n    <input type="text" prop="'+c+'" xtype="'+d.type+'" value="'+this[c]+'" class="form-control '+d.type+'">\n  </div>\n</div>':'<div class="form-group">\n  <label for="haika-object-'+c+'" class="col-sm-5 control-label">'+c+'</label>\n  <div class="col-sm-7">\n    <input type="number" prop="'+c+'" xtype="'+d.type+'" value="'+this[c]+'" class="form-control '+d.type+'">\n  </div>\n</div>';return a},fabric.Object.prototype.getJSON=function(a){var b,c,d,e;b=this.getJSONSchema(),e=b.properties;for(c in e)if(d=e[c],c===a)return d;return{}},fabric.Object.prototype.savePropetyPanel=function(a){var b,c,d,e,f,g,h,i,j;for(c={},j=a.find("input, select, option"),h=0,i=j.length;i>h;h++)b=j[h],e=$(b).attr("prop"),g=$(b).attr("xtype"),d=this.getJSON(e),"string"!==g?(f=parseInt($(b).val()),f&&(null!=d.minimum&&f<d.minimum&&(f=d.minimum),null!=d.maximum&&f>d.maximum&&(f=d.maximum),c[e]=f)):c[e]=$(b).val();return haika.changeObject(this.id,c)},$.extend(haika,{property:{init:function(){return haika.canvas.on("object:selected",function(a){return function(b){return a.setPropetyPanel()}}(this)),haika.canvas.on("selection:cleared",function(a){return function(a){return $(".haika-canvas-panel, .haika-object-panel, .haika-group-panel").hide(),$(".haika-canvas-panel").show()}}(this))},createPanel:function(a){return log("createPanel"),$("#haika-object-property").html(a.createPropetyPanel()),
$("#haika-object-property").find("input, select, option").change(function(b){return function(){return b.savePanel(a)}}(this))},savePanel:function(a){return log("savePanel"),a.savePropetyPanel($("#haika-object-property"))},setPropetyPanel:function(a){var b,c;return log("setPropetyPanel"),$(".haika-canvas-panel, .haika-object-panel, .haika-group-panel").hide(),(a=haika.canvas.getActiveObject())?($(".haika-object-panel").show(),$("#haika-object-id").html(a.id),void this.createPanel(a)):(b=haika.canvas.getActiveGroup(),void(b&&(c=b._objects,$("#haika-group-count").html(c.length),$(".haika-group-panel").show())))}}}),$.extend(haika,{html:function(a){return $(a).html('<div id="haika-canvas">\n  <ul class="haika-nav">\n      <li><a href="#" class="floor"></a></li>\n      <li><a href="#" class="wall"></a></li>\n      <li><a href="#" class="beacon"></a></li>\n      <li class="active"><a href="#" class="shelf"></a></li>\n  </ul>\n  <div class="haika-header">\n      <div style="margin-top: 5px;" class="pull-left">\n        <i class="fa fa-copy haika-copy btn btn-default"> copy</i>\n        <i class="fa fa-paste haika-paste btn btn-default"> paste</i>\n        <i class="fa fa-undobtn haika-undo btn btn-default"> undo</i>\n      </div>\n      <div class="pull-right" style="margin-top: 2px;">\n        <span class="fullscreen btn btn-default">\n          <span class="glyphicon glyphicon-fullscreen"></span>\n          fullscreen\n        </span>\n      </div>\n      <div style="display:none;">\n          <input type="file" id="file"/>\n      </div>\n  </div>\n  <div class="haika-toolbar-container">\n    <ul class="toolbar-menu">\n    </ul>\n  </div>\n  <div class="haika-buttons">\n    <span class="haika-button haika-full">\n      <i class="fa fa-arrows"></i>\n    </span>\n    <span class="haika-button haika-zoomin">\n      <i class="fa fa-plus"></i>\n    </span>\n    <span class="haika-button haika-zoomout">\n      <i class="fa fa-minus"></i>\n    </span>\n  </div>\n  <div  id="vertical-scroller" class="content-scroller">\n    <div class="dragdealer">\n      <div class="handle scroller-gray-bar">\n      </div>\n    </div>\n  </div>\n  <div id="horizontal-scroller" class="dragdealer">\n    <div class="handle scroller-gray-bar">\n    </div>\n  </div>\n<div style="bottom:0px;right:0px;width:16px;height:16px;background-color:#525252;position:absolute;border:1px solid #777">\n</div>\n  <div class="haika-property-panel">\n    <div class="haika-canvas-panel">\n        <h3></h3>\n        <label for="haika-canvas-width">\n            width: <span id="haika-canvas-width"></span>\n        </label>\n        <label for="haika-canvas-height">\n            height: <span id="haika-canvas-height"></span>\n        </label><br/>\n        <label for="haika-canvas-centerX">\n            centerX: <span id="haika-canvas-centerX"></span>\n        </label>\n        <label for="haika-canvas-centerY">\n            centerY: <span id="haika-canvas-centerY"></span>\n        </label><br/>\n        <label for="haika-canvas-bgscale">\n            bgscale:\n            <input type="number" id="haika-canvas-bgscale" class="form-control" value="0" step="0.01"/>\n        </label><br/>\n        <label for="haika-canvas-bgopacity">\n            bgopacity:\n            <input type="number" id="haika-canvas-bgopacity" class="form-control" value="0" step="0.1"/>\n            <input id="haika-bgopacity-slider" data-slider-id=\'haika-bgopacity-slider\' type="text" data-slider-min="0" data-slider-max="1" data-slider-step="0.1" data-slider-value="0.2"/>\n        </label><br/>\n        <label for="haika-bgimg">\n            :\n            <input type="file" id="haika-bgimg" class="btn btn-default"/>\n        </label>\n        <br/>\n        <br/>\n        <span class="haika-map-setting btn btn-default">\n          <i class="fa fa-map-marker"></i>\n          \n        </span>\n        <br/>\n        <br/>\n        <br/>\n        <br/>\n        <span id="haika-bgreset" class="btn btn-default">\n          <i class="fa fa-trash"></i>\n          \n        </span>\n        <br/>\n        <br/>\n        <br/>\n        <br/>\n        <span id="haika-import" class="btn btn-default">\n          <i class="fa fa-download"></i>\n          \n        </span>\n      </div>\n      <div class="haika-object-panel">\n        <h3></h3>\n\n        <p>id: <span id="haika-object-id"></span></p>\n\n        <p><i class="fa fa-trash-o haika-remove btn btn-default"> remove</i></p>\n\n        <p><i class="fa fa-files-o haika-duplicate btn btn-default"> duplicate</i></p>\n\n        <p><input type="button" class="haika-bringtofront btn btn-default" value="bringToFront "/></p>\n\n        <div id="haika-object-property"></div>\n      </div>\n      <div class="haika-group-panel">\n          <h3></h3>\n\n          <p><span id="haika-group-count"></span></p>\n\n          <p><i class="fa fa-trash-o haika-remove btn btn-default"> remove</i></p>\n\n          <p>\n\n          <div class="btn-group">\n              <i class="fa fa-align-left haika-align-left btn btn-default"></i>\n              <i class="fa fa-align-center haika-align-center btn btn-default"></i>\n              <i class="fa fa-align-right haika-align-right btn btn-default"></i>\n          </div>\n          </p>\n          <p>\n\n          <div class="btn-group">\n              <i class="fa fa-align-left fa-rotate-90 haika-align-top btn btn-default"></i>\n              <i class="fa fa-align-center fa-rotate-90 haika-align-vcenter btn btn-default"></i>\n              <i class="fa fa-align-right fa-rotate-90 haika-align-bottom btn btn-default"></i>\n          </div>\n          </p>\n      </div>\n  </div>\n</div>\n<div id="haika-context-menu">\n  <ul class="dropdown-menu" role="menu">\n    <li>\n      <a class="fa fa-undobtn haika-undo"> undo</a>\n    </li>\n    <li role="presentation" class="divider"></li>\n    <li>\n      <a class="haika-zoomin">\n        <i class="fa fa-plus"></i> zoomin\n      </a>\n    </li>\n    <li>\n      <a class="haika-zoomout">\n        <i class="fa fa-minus"></i> zoomout\n      </a>\n    </li>\n    <li role="presentation" class="divider"></li>\n    <li class="haika-select-context-menu">\n      <a class="fa fa-copy haika-copy"> copy</a>\n    </li>\n    <li>\n      <a class="fa fa-paste haika-paste"> paste</a>\n    </li>\n    <li role="presentation" class="divider haika-select-context-menu"></li>\n    <li class="haika-select-context-menu">\n      <a class="haika-bringtofront">bringToFront</a>\n    </li>\n  </ul>\n</div>')}});